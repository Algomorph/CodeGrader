/*

 Copyright (c) 2014 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
  Felipe Heidrich (IBM Corporation) - initial API and implementation
  Silenio Quarti (IBM Corporation) - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
  Felipe Heidrich (IBM Corporation) - initial API and implementation
  Silenio Quarti (IBM Corporation) - initial API and implementation

 Copyright (c) 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
  Felipe Heidrich (IBM Corporation) - initial API and implementation
  Silenio Quarti (IBM Corporation) - initial API and implementation

 Copyright (c) 2010, 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
  Felipe Heidrich (IBM Corporation) - initial API and implementation
  Silenio Quarti (IBM Corporation) - initial API and implementation

 Copyright (c) 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2013,2014 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2014 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made
 available under the terms of the Eclipse Public License v1.0
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html).

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2010, 2015 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
  Felipe Heidrich (IBM Corporation) - initial API and implementation
  Silenio Quarti (IBM Corporation) - initial API and implementation
  Mihai Sucan (Mozilla Foundation) - fix for Bug#334583 Bug#348471 Bug#349485 Bug#350595 Bug#360726 Bug#361180 Bug#362835 Bug#362428 Bug#362286 Bug#354270 Bug#361474 Bug#363945 Bug#366312 Bug#370584

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
  Felipe Heidrich (IBM Corporation) - initial API and implementation
  Silenio Quarti (IBM Corporation) - initial API and implementation

 Copyright (c) 2010, 2014 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made
 available under the terms of the Eclipse Public License v1.0
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html).

 Contributors:
  Felipe Heidrich (IBM Corporation) - initial API and implementation
  Silenio Quarti (IBM Corporation) - initial API and implementation

 Copyright (c) 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2011, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2012, 2014 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 


 Copyright (c) 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2010, 2014 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
  Felipe Heidrich (IBM Corporation) - initial API and implementation
  Silenio Quarti (IBM Corporation) - initial API and implementation

 Copyright (c) 2009, 2015 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made
 available under the terms of the Eclipse Public License v1.0
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html).

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2014 IBM Corporation and others. All rights reserved.
 This program and the accompanying materials are made available under the
 terms of the Eclipse Public License v1.0
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html).

 Contributors: 
 IBM Corporation - initial API and implementation

 Copyright (c) 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made
 available under the terms of the Eclipse Public License v1.0
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html).

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2010, 2014 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2011, 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2011, 2014 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2014 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2014 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2013, 2015 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2015 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2011, 2015 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2014 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2014 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2014 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2011, 2014 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2011, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation 

 Copyright (c) 2011, 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2011, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation 

 Copyright (c) 2011, 2014 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation 

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made
 available under the terms of the Eclipse Public License v1.0
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html).

 Contributors: IBM Corporation - initial API and implementation
               Alex Lakatos - fix for bug#369781

 Copyright (c) 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation
 RequireJS i18n 2.0.4 Copyright (c) 2010-2012, The Dojo Foundation All Rights Reserved.
 Available via the MIT or new BSD license.
 see: http://github.com/requirejs/i18n for details

 Copyright (c) 2011, 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation
*/
var requirejs,require,define;
(function(m){function s(a,b){var d,k,e,c,A,D,y,q,r,f=b&&b.split("/"),u=n.map,g=u&&u["*"]||{};if(a&&"."===a.charAt(0))if(b){f=f.slice(0,f.length-1);a=f.concat(a.split("/"));for(q=0;q<a.length;q+=1)if(d=a[q],"."===d)a.splice(q,1),q-=1;else if(".."===d)if(1===q&&(".."===a[2]||".."===a[0]))break;else 0<q&&(a.splice(q-1,2),q-=2);a=a.join("/")}else 0===a.indexOf("./")&&(a=a.substring(2));if((f||g)&&u){d=a.split("/");for(q=d.length;0<q;q-=1){k=d.slice(0,q).join("/");if(f)for(r=f.length;0<r;r-=1)if(e=u[f.slice(0,
r).join("/")])if(e=e[k]){c=e;A=q;break}if(c)break;!D&&(g&&g[k])&&(D=g[k],y=q)}!c&&D&&(c=D,A=y);c&&(d.splice(0,A,c),a=d.join("/"))}return a}function p(a,d){return function(){return b.apply(m,v.call(arguments,0).concat([a,d]))}}function h(a){return function(b){return s(b,a)}}function c(a){return function(b){d[a]=b}}function f(a){if(q.call(r,a)){var b=r[a];delete r[a];u[a]=!0;l.apply(m,b)}if(!q.call(d,a)&&!q.call(u,a))throw Error("No "+a);return d[a]}function e(a){var b,d=a?a.indexOf("!"):-1;-1<d&&(b=
a.substring(0,d),a=a.substring(d+1,a.length));return[b,a]}function g(a){return function(){return n&&n.config&&n.config[a]||{}}}var l,b,a,k,d={},r={},n={},u={},q=Object.prototype.hasOwnProperty,v=[].slice;a=function(a,b){var d,k=e(a),n=k[0];a=k[1];n&&(n=s(n,b),d=f(n));n?a=d&&d.normalize?d.normalize(a,h(b)):s(a,b):(a=s(a,b),k=e(a),n=k[0],a=k[1],n&&(d=f(n)));return{f:n?n+"!"+a:a,n:a,pr:n,p:d}};k={require:function(a){return p(a)},exports:function(a){var b=d[a];return"undefined"!==typeof b?b:d[a]={}},
module:function(a){return{id:a,uri:"",exports:d[a],config:g(a)}}};l=function(b,n,e,g){var v,l,A,D,y=[],H;g=g||b;if("function"===typeof e){n=!n.length&&e.length?["require","exports","module"]:n;for(D=0;D<n.length;D+=1)if(A=a(n[D],g),l=A.f,"require"===l)y[D]=k.require(b);else if("exports"===l)y[D]=k.exports(b),H=!0;else if("module"===l)v=y[D]=k.module(b);else if(q.call(d,l)||q.call(r,l)||q.call(u,l))y[D]=f(l);else if(A.p)A.p.load(A.n,p(g,!0),c(l),{}),y[D]=d[l];else throw Error(b+" missing "+l);n=e.apply(d[b],
y);if(b)if(v&&v.exports!==m&&v.exports!==d[b])d[b]=v.exports;else if(n!==m||!H)d[b]=n}else b&&(d[b]=e)};requirejs=require=b=function(d,e,c,q,r){if("string"===typeof d)return k[d]?k[d](e):f(a(d,e).f);d.splice||(n=d,e.splice?(d=e,e=c,c=null):d=m);e=e||function(){};"function"===typeof c&&(c=q,q=r);q?l(m,d,e,c):setTimeout(function(){l(m,d,e,c)},4);return b};b.config=function(a){n=a;return b};define=function(a,b,k){b.splice||(k=b,b=[]);!q.call(d,a)&&!q.call(r,a)&&(r[a]=[a,b,k])};define.amd={jQuery:!0}})();
define("almond",function(){});define("orion/editor/config",[],function(){return{languages:{}}});
define("orion/editor/shim",[],function(){Object.create||(Object.create=function(m,s){function p(){}p.prototype=m;var h=new p;if(s)for(var c in s)s.hasOwnProperty(c)&&(s[c].hasOwnProperty("value")?h[c]=s[c].value:h[c]=function(){if(0<arguments.length)return s[c].get();s[c].set(arguments)});return h});Object.keys||(Object.keys=function(m){var s=Object.prototype.hasOwnProperty,p=[],h;for(h in m)s.call(m,h)&&p.push(h);return p});Function.prototype.bind||(Function.prototype.bind=function(m){var s=this,
p=Array.prototype.slice.call(arguments,1);return p.length?function(){return arguments.length?s.apply(m,p.concat(Array.prototype.slice.call(arguments))):s.apply(m,p)}:function(){return arguments.length?s.apply(m,arguments):s.call(m)}});Array.isArray||(Array.isArray=function(m){return"[object Array]"===Object.prototype.toString.call(m)});Array.prototype.indexOf||(Array.prototype.indexOf=function(m){for(var s=0;s<this.length;s++)if(this[s]===m)return s;return-1});Array.prototype.forEach||(Array.prototype.forEach=
function(m){for(var s=0;s<this.length;s++)m(this[s],s)});Array.prototype.map||(Array.prototype.map=function(m){for(var s=Array(this.length),p=0;p<this.length;p++)s[p]=m(this[p]);return s});Array.prototype.reduce||(Array.prototype.reduce=function(m,s){var p,h=!1;1<arguments.length&&(p=s,h=!0);for(var c=0;this.length>c;++c)h?p=m(p,this[c],c,this):(p=this[c],h=!0);return p});String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")});String.prototype.trimLeft||(String.prototype.trimLeft=
function(){return this.replace(/^\s+/g,"")});String.prototype.trimRight||(String.prototype.trimRight=function(){return this.replace(/\s+$/g,"")});return{}});
(function(){function m(c,f,e,g,l,b){f[c]&&(e.push(c),(!0===f[c]||1===f[c])&&g.push(l+c+"/"+b))}function s(c,f,e,g,l){f=g+f+"/"+l;require._fileExists(c.toUrl(f+".js"))&&e.push(f)}function p(c,f,e){for(var g in f)f.hasOwnProperty(g)&&(!c.hasOwnProperty(g)||e)?c[g]=f[g]:"object"===typeof f[g]&&(!c[g]&&f[g]&&(c[g]={}),p(c[g],f[g],e))}var h=/(^.*(^|\/)nls(\/|$))([^\/]*)\/?([^\/]*)/;define("i18n",["module"],function(c){var f=c.config?c.config():{};return{version:"2.0.4",load:function(e,c,l,b){b=b||{};b.locale&&
(f.locale=b.locale);var a=h.exec(e),k=a[1],d=a[4],r=a[5],n=d.split("-"),u=[],q={},v,w="";a[5]?(k=a[1],e=k+r):(r=a[4],d=f.locale,d||(d=f.locale="undefined"===typeof navigator?"root":(navigator.language||navigator.userLanguage||"root").toLowerCase()),n=d.split("-"));if(b.isBuild){u.push(e);s(c,"root",u,k,r);for(v=0;v<n.length;v++)d=n[v],w+=(w?"-":"")+d,s(c,w,u,k,r);if(b.locales)for(a=0;a<b.locales.length;a++){d=b.locales[a];n=d.split("-");w="";for(e=0;e<n.length;e++)d=n[e],w+=(w?"-":"")+d,s(c,w,u,k,
r)}c(u,function(){l()})}else c([e],function(a){var b=[],d;m("root",a,b,u,k,r);for(v=0;v<n.length;v++)d=n[v],w+=(w?"-":"")+d,m(w,a,b,u,k,r);c(u,function(){var d,e,A;for(d=b.length-1;-1<d&&b[d];d--){A=b[d];e=a[A];if(!0===e||1===e)e=c(k+A+"/"+r);p(q,e)}l(q)})})}}})})();define("orion/editor/nls/messages",{root:!0});
define("orion/editor/nls/root/messages",{multipleAnnotations:"Multiple annotations:",line:"Line: ${0}",breakpoint:"Breakpoint",bookmark:"Bookmark",task:"Task",error:"Error",warning:"Warning",matchingSearch:"Matching Search",currentSearch:"Current Search",currentLine:"Current Line",matchingBracket:"Matching Bracket",currentBracket:"Current Bracket",diffAdded:"Diff Added Lines",diffDeleted:"Diff Deleted Lines",diffModified:"Diff Modified Lines",lineUp:"Line Up",lineDown:"Line Down",lineStart:"Line Start",
lineEnd:"Line End",charPrevious:"Previous Character",charNext:"Next Character",pageUp:"Page Up",pageDown:"Page Down",scrollPageUp:"Scroll Page Up",scrollPageDown:"Scroll Page Down",scrollLineUp:"Scroll Line Up",scrollLineDown:"Scroll Line Down",wordPrevious:"Previous Word",wordNext:"Next Word",textStart:"Document Start",textEnd:"Document End",scrollTextStart:"Scroll Document Start",scrollTextEnd:"Scroll Document End",centerLine:"Center Line",selectLineUp:"Select Line Up",selectLineDown:"Select Line Down",
selectWholeLineUp:" Select Whole Line Up",selectWholeLineDown:"Select Whole Line Down",selectLineStart:"Select Line Start",selectLineEnd:"Select Line End",selectCharPrevious:"Select Previous Character",selectCharNext:"Select Next Character",selectPageUp:"Select Page Up",selectPageDown:"Select Page Down",selectWordPrevious:"Select Previous Word",selectWordNext:"Select Next Word",selectTextStart:"Select Document Start",selectTextEnd:"Select Document End",deletePrevious:"Delete Previous Character",deleteNext:"Delete Next Character",
deleteWordPrevious:"Delete Previous Word",deleteWordNext:"Delete Next Word",deleteLineStart:"Delete Line Start",deleteLineEnd:"Delete Line End",tab:"Insert Tab",enter:"Insert Line Delimiter",enterNoCursor:"Insert Line Delimiter",escape:"Escape",selectAll:"Select All",copy:"Copy",cut:"Cut",paste:"Paste",uppercase:"To Upper Case",lowercase:"To Lower Case",capitalize:"Capitalize",reversecase:"Reverse Case",toggleWrapMode:"Toggle Wrap Mode",toggleTabMode:"Toggle Tab Mode",toggleOverwriteMode:"Toggle Overwrite Mode",
committerOnTime:"${0} on ${1}",emacs:"Emacs",exchangeMarkPoint:"Exchange Mark and Point",setMarkCommand:"Set Mark",clearMark:"Clear Mark",digitArgument:"Digit Argument ${0}",negativeArgument:"Negative Argument",Comment:"Comment","Flat outline":"Flat outline",incrementalFindStr:"Incremental find: ${0}",incrementalFindStrNotFound:"Incremental find: ${0} (not found)",incrementalFindReverseStr:"Reverse Incremental find: ${0}",incrementalFindReverseStrNotFound:"Reverse Incremental find: ${0} (not found)",
find:"Find...",undo:"Undo",redo:"Redo",cancelMode:"Cancel Current Mode",findNext:"Find Next Occurrence",findPrevious:"Find Previous Occurrence",incrementalFind:"Incremental Find",incrementalFindReverse:"Incremental Find Reverse",indentLines:"Indent Lines",unindentLines:"Unindent Lines",moveLinesUp:"Move Lines Up",moveLinesDown:"Move Lines Down",copyLinesUp:"Copy Lines Up",copyLinesDown:"Copy Lines Down",deleteLines:"Delete Lines",gotoLine:"Goto Line...",gotoLinePrompty:"Goto Line:",nextAnnotation:"Next Annotation",
prevAnnotation:"Previous Annotation",expand:"Expand",collapse:"Collapse",expandAll:"Expand All",collapseAll:"Collapse All",lastEdit:"Last Edit Location",trimTrailingWhitespaces:"Trim Trailing Whitespaces",toggleLineComment:"Toggle Line Comment",addBlockComment:"Add Block Comment",removeBlockComment:"Remove Block Comment",linkedModeEntered:"Linked Mode entered",linkedModeExited:"Linked Mode exited",syntaxError:"Syntax Error",contentAssist:"Content Assist",lineColumn:"Line ${0} : Column ${1}",multiSelections:"${0} selection regions",
vi:"vi",vimove:"(Move)",viyank:"(Yank)",videlete:"(Delete)",vichange:"(Change)",viLeft:"${0} Left",viRight:"${0} Right",viUp:"${0} Up",viDown:"${0} Down",viw:"${0} Next Word",vib:"${0} Beginning of Word",viW:"${0} Next Word (ws stop)",viB:"${0} Beginning of Word (ws stop)",vie:"${0} End of Word",viE:"${0} End of Word (ws stop)",vi$:"${0} End of the line","vi^_":"${0} First non-blank Char Current Line","vi+":"${0} First Char Next Line","vi-":"${0} First Char Previous Line","vi|":"${0} nth Column in Line",
viH:"${0} Top of Page",viM:"${0} Middle of Page",viL:"${0} Bottom of Page","vi/":"${0} Search Forward","vi?":"${0} Search Backward",vin:"${0} Next Search",viN:"${0} Previous Search",vif:"${0} Search Char Fwd",viF:"${0} Search Char Bckwd",vit:"${0} Search Before Char Fwd",viT:"${0} Search Before Char Bckwd","vi,":"${0} Repeat Reverse Char Search","vi;":"${0} Repeat Char Search",viG:"${0} Go to Line",viycd:"${0} Current Line",via:"Append After Cursor",viA:"Append to End of Line",vii:"Insert Before Cursor",
viI:"Insert at Beginning of Line",viO:"Insert Line Above",vio:"Insert Line Below",viR:"Begin Overwriting Text",vis:"Substitute a Character",viS:"Substitute Entire Line",viC:"Change Text Until Line End",vip:"Paste After Char or Line",viP:"Paste Before Char or Line",viStar:"Search Word Under Cursor",next:"Next",previous:"Previous",replace:"Replace",replaceAll:"Replace All",findWith:"Find With",replaceWith:"Replace With",caseInsensitive:"Aa",regex:"/.*/",wholeWord:"\\b",caseInsensitiveTooltip:"Toggle Case Insensitive",
regexTooltip:"Toggle Regex",wholeWordTooltip:"Toggle Whole Word",closeTooltip:"Close",replacingAll:"Replacing all...",replacedMatches:"Replaced ${0} matches",nothingReplaced:"Nothing replaced",notFound:"Not found"});
define("orion/editor/eventTarget",[],function(){function m(){}m.addMixin=function(s){var p=m.prototype,h;for(h in p)p.hasOwnProperty(h)&&(s[h]=p[h])};m.prototype={addEventListener:function(m,p,h){this._eventTypes||(this._eventTypes={});var c=this._eventTypes[m];c||(c=this._eventTypes[m]={level:0,listeners:[]});c.listeners.push({listener:p,useCapture:h})},dispatchEvent:function(m){var p=m.type;this._dispatchEvent("pre"+p,m);this._dispatchEvent(p,m);this._dispatchEvent("post"+p,m)},_dispatchEvent:function(m,
p){var h=this._eventTypes?this._eventTypes[m]:null;if(h){var c=h.listeners;try{if(h.level++,c)for(var f=0,e=c.length;f<e;f++)if(c[f]){var g=c[f].listener;"function"===typeof g?g.call(this,p):g.handleEvent&&"function"===typeof g.handleEvent&&g.handleEvent(p)}}finally{if(h.level--,h.compact&&0===h.level){for(f=c.length-1;0<=f;f--)c[f]||c.splice(f,1);0===c.length&&delete this._eventTypes[m];h.compact=!1}}}},isListening:function(m){return!this._eventTypes?!1:void 0!==this._eventTypes[m]},removeEventListener:function(m,
p,h){if(this._eventTypes){var c=this._eventTypes[m];if(c){for(var f=c.listeners,e=0,g=f.length;e<g;e++){var l=f[e];if(l&&l.listener===p&&l.useCapture===h){0!==c.level?(f[e]=null,c.compact=!0):f.splice(e,1);break}}0===f.length&&delete this._eventTypes[m]}}}};return{EventTarget:m}});define("orion/regex",[],function(){return{escape:function(m){return m.replace(/([\\$\^*\/+?\.\(\)|{}\[\]])/g,"\\$\x26")},parse:function(m){return(m=/^\s*\/(.+)\/([gim]{0,3})\s*$/.exec(m))?{pattern:m[1],flags:m[2]}:null}}});
define("orion/util",[],function(){var m=navigator.userAgent,s=-1!==m.indexOf("MSIE")||-1!==m.indexOf("Trident")?document.documentMode:void 0,p=parseFloat(m.split("Firefox/")[1]||m.split("Minefield/")[1])||void 0,h=-1!==m.indexOf("Opera")?parseFloat(m.split("Version/")[1]):void 0,c=parseFloat(m.split("Chrome/")[1])||void 0,f=-1!==m.indexOf("Safari")&&!c,e=parseFloat(m.split("WebKit/")[1])||void 0,g=-1!==m.indexOf("Android"),l=-1!==m.indexOf("iPad"),m=-1!==m.indexOf("iPhone"),b=l||m,a=-1!==navigator.platform.indexOf("Mac"),
k=-1!==navigator.platform.indexOf("Win"),d=-1!==navigator.platform.indexOf("Linux"),r="undefined"!==typeof document&&"ontouchstart"in document.createElement("input");return{formatMessage:function(a){var b=arguments;return a.replace(/\$\{([^\}]+)\}/g,function(a,d){return b[(d<<0)+1]})},createElement:function(a,b){return a.createElementNS?a.createElementNS("http://www.w3.org/1999/xhtml",b):a.createElement(b)},isIE:s,isFirefox:p,isOpera:h,isChrome:c,isSafari:f,isWebkit:e,isAndroid:g,isIPad:l,isIPhone:m,
isIOS:b,isMac:a,isWindows:k,isLinux:d,isTouch:r,platformDelimiter:k?"\r\n":"\n"}});
define("orion/editor/textModel",["orion/editor/eventTarget","orion/regex","orion/util"],function(m,s,p){function h(c,f){this._lastLineIndex=-1;this._text=[""];this._lineOffsets=[0];this.setText(c);this.setLineDelimiter(f)}h.prototype={destroy:function(){},find:function(c){1<this._text.length&&(this._text=[this._text.join("")]);var f=c.string,e=c.regex,g=f,l="",b=c.caseInsensitive;if(g)if(e){if(f=s.parse(g))g=f.pattern,l=f.flags}else g=f.replace(/([\\$\^*\/+?\.\(\)|{}\[\]])/g,"\\$\x26"),b&&(g=g.replace(/[iI\u0130\u0131]/g,
"[Ii\u0130\u0131]"));var a=null,k;if(g){var f=c.reverse,d=c.wrap,e=c.wholeWord,r=c.start||0;c=c.end;var n=null!==c&&void 0!==c;-1===l.indexOf("g")&&(l+="g");-1===l.indexOf("m")&&(l+="m");b&&-1===l.indexOf("i")&&(l+="i");e&&(g="\\b"+g+"\\b");var u=this._text[0],q,v,w=0;n&&(b=r<c?r:c,u=u.substring(b,r<c?c:r),w=b);var h=RegExp(g,l);f?k=function(){var a=null;for(h.lastIndex=0;;){v=h.lastIndex;q=h.exec(u);if(v===h.lastIndex)return null;if(q){if(!(q.index+w<r)){if(!d||a)break;r=u.length+w}a={start:q.index+
w,end:h.lastIndex+w}}else break}a&&(r=a.start);return a}:(n||(h.lastIndex=r),k=function(){for(;;){v=h.lastIndex;q=h.exec(u);if(v===h.lastIndex)break;if(q)return{start:q.index+w,end:h.lastIndex+w};if(!(0!==v&&d))break}return null});a=k()}return{next:function(){var b=a;b&&(a=k());return b},hasNext:function(){return null!==a}}},getCharCount:function(){for(var c=0,f=0;f<this._text.length;f++)c+=this._text[f].length;return c},getLine:function(c,f){var e=this.getLineCount();if(!(0<=c&&c<e))return null;
var g=this._lineOffsets[c];if(c+1<e){e=this.getText(g,this._lineOffsets[c+1]);if(f)return e;for(var g=e.length,l;10===(l=e.charCodeAt(g-1))||13===l;)g--;return e.substring(0,g)}return this.getText(g)},getLineAtOffset:function(c){var f=this.getCharCount();if(!(0<=c&&c<=f))return-1;var e=this.getLineCount();if(c===f)return e-1;var g,l,b=this._lastLineIndex;if(0<=b&&b<e&&(g=this._lineOffsets[b],l=b+1<e?this._lineOffsets[b+1]:f,g<=c&&c<l))return b;for(var a=e,k=-1;1<a-k;)if(b=Math.floor((a+k)/2),g=this._lineOffsets[b],
l=b+1<e?this._lineOffsets[b+1]:f,c<=g)a=b;else if(c<l){a=b;break}else k=b;return this._lastLineIndex=a},getLineCount:function(){return this._lineOffsets.length},getLineDelimiter:function(){return this._lineDelimiter},getLineEnd:function(c,f){var e=this.getLineCount();if(!(0<=c&&c<e))return-1;if(c+1<e){e=this._lineOffsets[c+1];if(f)return e;for(var g=this.getText(Math.max(this._lineOffsets[c],e-2),e),l=g.length,b;10===(b=g.charCodeAt(l-1))||13===b;)l--;return e-(g.length-l)}return this.getCharCount()},
getLineStart:function(c){return!(0<=c&&c<this.getLineCount())?-1:this._lineOffsets[c]},getText:function(c,f){void 0===c&&(c=0);void 0===f&&(f=this.getCharCount());if(c===f)return"";for(var e=0,g=0,l;g<this._text.length;){l=this._text[g].length;if(c<=e+l)break;e+=l;g++}for(var b=e,a=g;g<this._text.length;){l=this._text[g].length;if(f<=e+l)break;e+=l;g++}if(a===g)return this._text[a].substring(c-b,f-e);b=this._text[a].substring(c-b);e=this._text[g].substring(0,f-e);return b+this._text.slice(a+1,g).join("")+
e},onChanging:function(c){return this.dispatchEvent(c)},onChanged:function(c){return this.dispatchEvent(c)},setLineDelimiter:function(c,f){"auto"===c&&(c=void 0,1<this.getLineCount()&&(c=this.getText(this.getLineEnd(0),this.getLineEnd(0,!0))));this._lineDelimiter=c?c:p.platformDelimiter;if(f){var e=this.getLineCount();if(1<e){for(var g=Array(e),l=0;l<e;l++)g[l]=this.getLine(l);this.setText(g.join(this._lineDelimiter))}}},setText:function(c,f,e){void 0===c&&(c="");void 0===f&&(f=0);void 0===e&&(e=
this.getCharCount());if(!(f===e&&""===c)){for(var g=this.getLineAtOffset(f),l=this.getLineAtOffset(e),b=f,a=e-f,k=l-g,d=c.length,r=0,n=this.getLineCount(),u=0,q=0,v=0,w=[];;){-1!==u&&u<=v&&(u=c.indexOf("\r",v));-1!==q&&q<=v&&(q=c.indexOf("\n",v));if(-1===q&&-1===u)break;v=-1!==u&&-1!==q?u+1===q?q+1:(u<q?u:q)+1:-1!==u?u+1:q+1;w.push(f+v);r++}this.onChanging({type:"Changing",text:c,start:b,removedCharCount:a,addedCharCount:d,removedLineCount:k,addedLineCount:r});0===w.length&&(v=this.getLineStart(g),
l=l+1<n?this.getLineStart(l+1):this.getCharCount(),f!==v&&(c=this.getText(v,f)+c,f=v),e!==l&&(c+=this.getText(e,l),e=l));v=d-a;for(l=g+k+1;l<n;l++)this._lineOffsets[l]+=v;if(5E4>w.length)g=[g+1,k].concat(w),Array.prototype.splice.apply(this._lineOffsets,g);else{v=g+1;this._lineOffsets.splice(v,k);for(n=0;n<w.length;n+=5E4)g=[v,0].concat(w.slice(n,Math.min(w.length,n+5E4))),Array.prototype.splice.apply(this._lineOffsets,g),v+=5E4}for(v=n=0;v<this._text.length;){l=this._text[v].length;if(f<=n+l)break;
n+=l;v++}g=n;for(w=v;v<this._text.length;){l=this._text[v].length;if(e<=n+l)break;n+=l;v++}l=this._text[v];f=this._text[w].substring(0,f-g);e=l.substring(e-n);w=[w,v-w+1];f&&w.push(f);c&&w.push(c);e&&w.push(e);Array.prototype.splice.apply(this._text,w);0===this._text.length&&(this._text=[""]);this.onChanged({type:"Changed",start:b,removedCharCount:a,addedCharCount:d,removedLineCount:k,addedLineCount:r})}}};m.EventTarget.addMixin(h.prototype);return{TextModel:h}});
define("orion/keyBinding",["orion/util"],function(m){function s(h,c,f,e,g,l){this.type=l||"keydown";this.keyCode="string"===typeof h&&"keydown"===this.type?h.toUpperCase().charCodeAt(0):h;this.mod1=void 0!==c&&null!==c?c:!1;this.mod2=void 0!==f&&null!==f?f:!1;this.mod3=void 0!==e&&null!==e?e:!1;this.mod4=void 0!==g&&null!==g?g:!1}function p(h){this.keys=h}s.prototype={getKeys:function(){return[this]},match:function(h,c){if(void 0!==c){if(0!==c)return!1}else if(h instanceof Array){if(1<h.length)return!1;
h=h[0]}return h.type!==this.type?!1:this.keyCode===h.keyCode||this.keyCode===String.fromCharCode(m.isOpera?h.which:void 0!==h.charCode?h.charCode:h.keyCode)?this.mod1!==(m.isMac?h.metaKey:h.ctrlKey)||"keydown"===this.type&&this.mod2!==h.shiftKey||this.mod3!==h.altKey||m.isMac&&this.mod4!==h.ctrlKey?!1:!0:!1},equals:function(h){return!h||this.keyCode!==h.keyCode||this.mod1!==h.mod1||this.mod2!==h.mod2||this.mod3!==h.mod3||this.mod4!==h.mod4||this.type!==h.type?!1:!0}};p.prototype={getKeys:function(){return this.keys.slice(0)},
match:function(h,c){var f=this.keys;if(void 0!==c)return c>f.length?!1:f[c].match(h)?c===f.length-1?!0:c+1:!1;h instanceof Array||(h=[h]);if(h.length>f.length)return!1;var e;for(e=0;e<h.length;e++)if(!f[e].match(h[e]))return!1;return e===f.length?!0:e},equals:function(h){if(!h.keys||h.keys.length!==this.keys.length)return!1;for(var c=0;c<h.keys.length;c++)if(!h.keys[c].equals(this.keys[c]))return!1;return!0}};return{KeyBinding:s,KeyStroke:s,KeySequence:p}});
define("orion/editor/keyModes",["orion/keyBinding","orion/util"],function(m,s){function p(c){c&&(this._view=c,this._keyBindings=this.createKeyBindings(),this._keyBindingIndex=0)}function h(c){p.call(this,c)}p.prototype={createKeyBindings:function(){return[]},getKeyBindings:function(c){for(var f=[],e=this._keyBindings,g=0;g<e.length;g++)e[g].actionID===c&&f.push(e[g].keyBinding);return f},getView:function(){return this._view},isActive:function(){return-1!==this._view.getKeyModes().indexOf(this)},match:function(c){if("keydown"===
c.type)switch(c.keyCode){case 16:case 17:case 18:case 91:return}for(var f=this._keyBindingIndex,e=this._matchingKeyBindings||this._keyBindings,g=[],l=0;l<e.length;l++){var b=e[l],a=b.keyBinding.match(c,f);if(!0===a)return this._keyBindingIndex=0,this._matchingKeyBindings=null,b.actionID;"number"===typeof a&&g.push(b)}if(0===g.length)this._keyBindingIndex=0,this._matchingKeyBindings=null;else return this._keyBindingIndex++,this._matchingKeyBindings=g,"noop"},setKeyBinding:function(c,f){for(var e=this._keyBindings,
g=0;g<e.length;g++){var l=e[g];if(l.keyBinding.equals(c)){f?l.actionID=f:l.predefined?l.actionID="noop":e.splice(g,1);return}}f&&e.push({keyBinding:c,actionID:f})},setView:function(c){this._view=c}};h.prototype=new p;h.prototype.createKeyBindings=function(){var c=m.KeyBinding,f=[];f.push({actionID:"lineUp",keyBinding:new c(38),predefined:!0});f.push({actionID:"lineDown",keyBinding:new c(40),predefined:!0});f.push({actionID:"charPrevious",keyBinding:new c(37),predefined:!0});f.push({actionID:"charNext",
keyBinding:new c(39),predefined:!0});s.isMac?(f.push({actionID:"scrollPageUp",keyBinding:new c(33),predefined:!0}),f.push({actionID:"scrollPageDown",keyBinding:new c(34),predefined:!0}),f.push({actionID:"pageUp",keyBinding:new c(33,null,null,!0),predefined:!0}),f.push({actionID:"pageDown",keyBinding:new c(34,null,null,!0),predefined:!0}),f.push({actionID:"lineStart",keyBinding:new c(37,!0),predefined:!0}),f.push({actionID:"lineEnd",keyBinding:new c(39,!0),predefined:!0}),f.push({actionID:"wordPrevious",
keyBinding:new c(37,null,null,!0),predefined:!0}),f.push({actionID:"wordNext",keyBinding:new c(39,null,null,!0),predefined:!0}),f.push({actionID:"scrollTextStart",keyBinding:new c(36),predefined:!0}),f.push({actionID:"scrollTextEnd",keyBinding:new c(35),predefined:!0}),f.push({actionID:"textStart",keyBinding:new c(38,!0),predefined:!0}),f.push({actionID:"textEnd",keyBinding:new c(40,!0),predefined:!0}),f.push({actionID:"scrollPageUp",keyBinding:new c(38,null,null,null,!0),predefined:!0}),f.push({actionID:"scrollPageDown",
keyBinding:new c(40,null,null,null,!0),predefined:!0}),f.push({actionID:"lineStart",keyBinding:new c(37,null,null,null,!0),predefined:!0}),f.push({actionID:"lineEnd",keyBinding:new c(39,null,null,null,!0),predefined:!0}),f.push({actionID:"lineStart",keyBinding:new c(38,null,null,!0),predefined:!0}),f.push({actionID:"lineEnd",keyBinding:new c(40,null,null,!0),predefined:!0})):(f.push({actionID:"pageUp",keyBinding:new c(33),predefined:!0}),f.push({actionID:"pageDown",keyBinding:new c(34),predefined:!0}),
f.push({actionID:"lineStart",keyBinding:new c(36),predefined:!0}),f.push({actionID:"lineEnd",keyBinding:new c(35),predefined:!0}),f.push({actionID:"wordPrevious",keyBinding:new c(37,!0),predefined:!0}),f.push({actionID:"wordNext",keyBinding:new c(39,!0),predefined:!0}),f.push({actionID:"textStart",keyBinding:new c(36,!0),predefined:!0}),f.push({actionID:"textEnd",keyBinding:new c(35,!0),predefined:!0}));s.isFirefox&&s.isLinux&&(f.push({actionID:"lineUp",keyBinding:new c(38,!0),predefined:!0}),f.push({actionID:"lineDown",
keyBinding:new c(40,!0),predefined:!0}));s.isWindows&&(f.push({actionID:"scrollLineUp",keyBinding:new c(38,!0),predefined:!0}),f.push({actionID:"scrollLineDown",keyBinding:new c(40,!0),predefined:!0}));f.push({actionID:"selectLineUp",keyBinding:new c(38,null,!0),predefined:!0});f.push({actionID:"selectLineDown",keyBinding:new c(40,null,!0),predefined:!0});f.push({actionID:"selectCharPrevious",keyBinding:new c(37,null,!0),predefined:!0});f.push({actionID:"selectCharNext",keyBinding:new c(39,null,!0),
predefined:!0});f.push({actionID:"selectPageUp",keyBinding:new c(33,null,!0),predefined:!0});f.push({actionID:"selectPageDown",keyBinding:new c(34,null,!0),predefined:!0});s.isMac?(f.push({actionID:"selectLineStart",keyBinding:new c(37,!0,!0),predefined:!0}),f.push({actionID:"selectLineEnd",keyBinding:new c(39,!0,!0),predefined:!0}),f.push({actionID:"selectWordPrevious",keyBinding:new c(37,null,!0,!0),predefined:!0}),f.push({actionID:"selectWordNext",keyBinding:new c(39,null,!0,!0),predefined:!0}),
f.push({actionID:"selectTextStart",keyBinding:new c(36,null,!0),predefined:!0}),f.push({actionID:"selectTextEnd",keyBinding:new c(35,null,!0),predefined:!0}),f.push({actionID:"selectTextStart",keyBinding:new c(38,!0,!0),predefined:!0}),f.push({actionID:"selectTextEnd",keyBinding:new c(40,!0,!0),predefined:!0}),f.push({actionID:"selectLineStart",keyBinding:new c(37,null,!0,null,!0),predefined:!0}),f.push({actionID:"selectLineEnd",keyBinding:new c(39,null,!0,null,!0),predefined:!0}),f.push({actionID:"selectLineStart",
keyBinding:new c(38,null,!0,!0),predefined:!0}),f.push({actionID:"selectLineEnd",keyBinding:new c(40,null,!0,!0),predefined:!0})):(s.isLinux&&(f.push({actionID:"selectWholeLineUp",keyBinding:new c(38,!0,!0),predefined:!0}),f.push({actionID:"selectWholeLineDown",keyBinding:new c(40,!0,!0),predefined:!0})),f.push({actionID:"selectLineStart",keyBinding:new c(36,null,!0),predefined:!0}),f.push({actionID:"selectLineEnd",keyBinding:new c(35,null,!0),predefined:!0}),f.push({actionID:"selectWordPrevious",
keyBinding:new c(37,!0,!0),predefined:!0}),f.push({actionID:"selectWordNext",keyBinding:new c(39,!0,!0),predefined:!0}),f.push({actionID:"selectTextStart",keyBinding:new c(36,!0,!0),predefined:!0}),f.push({actionID:"selectTextEnd",keyBinding:new c(35,!0,!0),predefined:!0}));f.push({actionID:"undo",keyBinding:new m.KeyBinding("z",!0),predefined:!0});s.isMac?f.push({actionID:"redo",keyBinding:new m.KeyBinding("z",!0,!0),predefined:!0}):f.push({actionID:"redo",keyBinding:new m.KeyBinding("y",!0),predefined:!0});
f.push({actionID:"deletePrevious",keyBinding:new c(8),predefined:!0});f.push({actionID:"deletePrevious",keyBinding:new c(8,null,!0),predefined:!0});f.push({actionID:"deleteNext",keyBinding:new c(46),predefined:!0});f.push({actionID:"deleteWordPrevious",keyBinding:new c(8,!0),predefined:!0});f.push({actionID:"deleteWordPrevious",keyBinding:new c(8,!0,!0),predefined:!0});f.push({actionID:"deleteWordNext",keyBinding:new c(46,!0),predefined:!0});f.push({actionID:"tab",keyBinding:new c(9),predefined:!0});
f.push({actionID:"shiftTab",keyBinding:new c(9,null,!0),predefined:!0});f.push({actionID:"enter",keyBinding:new c(13),predefined:!0});f.push({actionID:"enter",keyBinding:new c(13,null,!0),predefined:!0});f.push({actionID:"escape",keyBinding:new c(27),predefined:!0});f.push({actionID:"selectAll",keyBinding:new c("a",!0),predefined:!0});f.push({actionID:"toggleTabMode",keyBinding:new c("m",!0),predefined:!0});s.isMac&&(f.push({actionID:"deleteNext",keyBinding:new c(46,null,!0),predefined:!0}),f.push({actionID:"deleteWordPrevious",
keyBinding:new c(8,null,null,!0),predefined:!0}),f.push({actionID:"deleteWordNext",keyBinding:new c(46,null,null,!0),predefined:!0}));f.push({actionID:"toggleWrapMode",keyBinding:new m.KeyBinding("w",!0,!1,!0)});f.push({actionID:"toggleOverwriteMode",keyBinding:new m.KeyBinding(45)});if(!s.isFirefox){var e=s.isMac&&s.isChrome;f.push({actionID:"noop",keyBinding:new c("u",!e,!1,!1,e),predefined:!0});f.push({actionID:"noop",keyBinding:new c("i",!e,!1,!1,e),predefined:!0});f.push({actionID:"noop",keyBinding:new c("b",
!e,!1,!1,e),predefined:!0})}s.isFirefox&&(f.push({actionID:"copy",keyBinding:new c(45,!0),predefined:!0}),f.push({actionID:"paste",keyBinding:new c(45,null,!0),predefined:!0}),f.push({actionID:"cut",keyBinding:new c(46,null,!0),predefined:!0}));s.isMac&&(f.push({actionID:"lineStart",keyBinding:new c("a",!1,!1,!1,!0),predefined:!0}),f.push({actionID:"lineEnd",keyBinding:new c("e",!1,!1,!1,!0),predefined:!0}),f.push({actionID:"lineUp",keyBinding:new c("p",!1,!1,!1,!0),predefined:!0}),f.push({actionID:"lineDown",
keyBinding:new c("n",!1,!1,!1,!0),predefined:!0}),f.push({actionID:"charPrevious",keyBinding:new c("b",!1,!1,!1,!0),predefined:!0}),f.push({actionID:"charNext",keyBinding:new c("f",!1,!1,!1,!0),predefined:!0}),f.push({actionID:"deletePrevious",keyBinding:new c("h",!1,!1,!1,!0),predefined:!0}),f.push({actionID:"deleteNext",keyBinding:new c("d",!1,!1,!1,!0),predefined:!0}),f.push({actionID:"deleteLineEnd",keyBinding:new c("k",!1,!1,!1,!0),predefined:!0}),s.isFirefox?(f.push({actionID:"scrollPageDown",
keyBinding:new c("v",!1,!1,!1,!0),predefined:!0}),f.push({actionID:"deleteLineStart",keyBinding:new c("u",!1,!1,!1,!0),predefined:!0}),f.push({actionID:"deleteWordPrevious",keyBinding:new c("w",!1,!1,!1,!0),predefined:!0})):(f.push({actionID:"pageDown",keyBinding:new c("v",!1,!1,!1,!0),predefined:!0}),f.push({actionID:"centerLine",keyBinding:new c("l",!1,!1,!1,!0),predefined:!0}),f.push({actionID:"enterNoCursor",keyBinding:new c("o",!1,!1,!1,!0),predefined:!0})));return f};return{KeyMode:p,DefaultKeyMode:h}});
define("orion/editor/textTheme",["require","orion/editor/eventTarget","orion/util"],function(m,s,p){function h(c){c=c||{};this._document=c.document||document}var c={};h.getTheme=function(f){f=f||"default";var e=c[f];e||(e=c[f]=new h);return e};h.prototype={getThemeClass:function(){return this._themeClass},setThemeClass:function(c,e){var g=this,l=g._themeClass;g._themeClass=c;this._load(c,e,function(){g.onThemeChanged({type:"ThemeChanged",oldValue:l,newValue:g.getThemeClass()})})},onThemeChanged:function(c){return this.dispatchEvent(c)},
buildStyleSheet:function(c,e){var g=function(a){return a.replace(this._capitalRegEx,function(a){return"-"+a}.bind(this)).toLowerCase()}.bind(this),l=function(a,b,d,e,c){var f=[];Object.keys(a).forEach(function(q){var v=a[q];"string"===typeof v?f.push("\t"+g(q)+": "+v+";"):l(v,d===q?b:b+(e?" .":".")+q,d,!1,c)});f.length&&(c.push(b+(e?".textview":"")+" {"),c.push.apply(c,f),c.push("}"))},b=[""];l(e.styles,"."+c,e.className,!0,b);return b.join("\n")},_createStyle:function(c,e,g,l){var b=this._document;
c="orion-theme-"+c;var a=b.getElementById(c);if(a){if(l||a.firstChild.data===e)return;a.removeChild(a.firstChild);a.appendChild(b.createTextNode(e))}else l?(a=p.createElement(b,"link"),a.rel="stylesheet",a.type="text/css",a.href=e,a.addEventListener("load",function(){g()})):(a=p.createElement(b,"style"),a.appendChild(b.createTextNode(e))),a.id=c,(b.getElementsByTagName("head")[0]||b.documentElement).appendChild(a);l||g()},_load:function(c,e,g){if(c)if("string"===typeof e)this._createStyle(c,e,g);
else if(e=e.href,".css"!==e.substring(e.length-4)&&(e+=".css"),/^\//.test(e)||/[a-zA-Z0-9]+:\/\//i.test(e)||!m.toUrl)this._createStyle(c,e,g,!0);else{var l=this;m(["text!"+e],function(b){l._createStyle(c,b,g,!1)})}else g()},_capitalRegEx:/[A-Z]/g};s.EventTarget.addMixin(h.prototype);return{TextTheme:h}});
define("orion/editor/util",[],function(){return{contains:function(m,s){if(!s)return!1;if(!m.compareDocumentPosition){for(var p=s;p;){if(m===p)return!0;p=p.parentNode}return!1}return m===s||0!==(m.compareDocumentPosition(s)&16)},getNodeStyle:function(m,s,p){var h;if(m&&(h=m.style[s],!h))if(m.currentStyle){for(h=0;-1!==(h=s.indexOf("-",h));)s=s.substring(0,h)+s.substring(h+1,h+2).toUpperCase()+s.substring(h+2);h=m.currentStyle[s]}else h=(m=m.ownerDocument.defaultView.getComputedStyle(m,null))?m.getPropertyValue(s):
null;return h||p},addEventListener:function(m,s,p,h){"function"===typeof m.addEventListener?m.addEventListener(s,p,!0===h):m.attachEvent("on"+s,p)},removeEventListener:function(m,s,p,h){"function"===typeof m.removeEventListener?m.removeEventListener(s,p,!0===h):m.detachEvent("on"+s,p)},Animation:function(){function m(m){this.options=m}m.prototype.play=function(){var m="number"===typeof this.options.duration?this.options.duration:350,p=this.options.easing||this.defaultEasing,h=this.options.onAnimate||
function(){},c=this.options.curve[0],f=this.options.curve[1],e=f-c,g=-1,l,b=this;this.interval=this.options.window.setInterval(function(){g=-1===g?(new Date).getTime():g;var a=((new Date).getTime()-g)/m;1>a?(a=p(a),l=c+a*e,h(l)):(h(f),b.stop())},"number"===typeof this.options.rate?this.options.rate:20)};m.prototype.stop=function(){this.options.window.clearInterval(this.interval);(this.options.onEnd||function(){})()};m.prototype.defaultEasing=function(m){return Math.sin(m*(Math.PI/2))};return m}()}});
(function(m,s){"function"===typeof define&&define.amd?define("orion/Deferred",s):"object"===typeof exports?module.exports=s():(m.orion=m.orion||{},m.orion.Deferred=s())})(this,function(){function m(){for(var e;e=c.shift();)e();f=!1}function s(g){c.push(g);f||(f=!0,e())}function p(e){return function(c){e(c)}}function h(){function e(){for(var a;a=r.shift();){var b=a.deferred,c="fulfilled"===d?"resolve":"reject";a=a[c];if("function"===typeof a)try{var n=a(k),f=n&&("object"===typeof n||"function"===typeof n)&&
n.then;if("function"===typeof f)if(n===b.promise)b.reject(new TypeError);else{var g=n.cancel;"function"===typeof g?b._parentCancel=g.bind(n):delete b._parentCancel;f.call(n,p(b.resolve),p(b.reject),p(b.progress))}else b.resolve(n)}catch(l){b.reject(l)}else b[c](k)}}function c(a){delete n._parentCancel;d="rejected";k=a;r.length&&s(e)}function b(a){function q(a){return function(b){(!d||"assumed"===d)&&a(b)}}delete n._parentCancel;try{var f=a&&("object"===typeof a||"function"===typeof a)&&a.then;if("function"===
typeof f)if(a===n)c(new TypeError);else{d="assumed";var w=a&&a.cancel;if("function"!==typeof w){var B=new h;a=B.promise;try{f(B.resolve,B.reject,B.progress)}catch(x){B.reject(x)}w=a.cancel;f=a.then}k=a;f.call(a,q(b),q(c));n._parentCancel=w.bind(a)}else d="fulfilled",k=a,r.length&&s(e)}catch(m){q(c)(m)}}function a(){var a=n._parentCancel;a?(delete n._parentCancel,a()):d||(a=Error("Cancel"),a.name="Cancel",c(a))}var k,d,r=[],n=this;this.resolve=function(a){d||b(a);return n};this.reject=function(a){d||
c(a);return n};this.progress=function(a){d||r.forEach(function(b){if(b.progress)try{b.progress(a)}catch(d){}});return n.promise};this.cancel=function(){n._parentCancel?setTimeout(a,0):a();return n};this.then=function(a,b,k){var c=new h;c._parentCancel=n.promise.cancel;r.push({resolve:a,reject:b,progress:k,deferred:c});("fulfilled"===d||"rejected"===d)&&s(e);return c.promise};this.promise={then:n.then,cancel:n.cancel}}var c=[],f=!1,e=function(){if("undefined"!==typeof process&&"function"===typeof process.nextTick){var c=
process.nextTick;return function(){c(m)}}if("function"===typeof MutationObserver){var e=document.createElement("div");(new MutationObserver(m)).observe(e,{attributes:!0});return function(){e.setAttribute("class","_tick")}}return function(){setTimeout(m,0)}}();h.all=function(c,e){function b(a,b){r||(d[a]=b,0===--k&&n.resolve(d))}function a(a,d){if(!r){if(e)try{b(a,e(d));return}catch(k){d=k}n.reject(d)}}var k=c.length,d=[],r=!1,n=new h;n.then(void 0,function(){r=!0;c.forEach(function(a){a.cancel&&a.cancel()})});
0===k?n.resolve(d):c.forEach(function(d,k){d.then(b.bind(void 0,k),a.bind(void 0,k))});return n.promise};h.when=function(c,e,b,a){var k;c&&"function"===typeof c.then||(k=new h,k.resolve(c),c=k.promise);return c.then(e,b,a)};return h});
define("orion/metrics",["orion/Deferred"],function(m){function s(c,e,g,l){if(window[p])window[p]("send","timing",c,e,Math.round(g),l);else h&&h.push({command:"send",arg0:"timing",arg1:c,arg2:e,arg3:Math.round(g),arg4:l})}var p="OrionGA",h=[],c=function(f,e){var g=f.shift();g?g.init?g.init().then(function(c){c.tid&&(function(b,a,k,d,c,e,f){b.GoogleAnalyticsObject=c;b[c]=b[c]||function(){(b[c].q=b[c].q||[]).push(arguments)};b[c].l=1*new Date;e=a.createElement(k);f=a.getElementsByTagName(k)[0];e.async=
1;e.src=d;f.parentNode.insertBefore(e,f)}(window,document,"script","//www.google-analytics.com/analytics.js",p),e=e||{},c.siteSpeedSampleRate&&(e.siteSpeedSampleRate=c.siteSpeedSampleRate),window[p]("create",c.tid,e),window[p]("send","pageview"),h.forEach(function(b){window[p](b.command,b.arg0,b.arg1,b.arg2,b.arg3,b.arg4)}));h=null},function(g){c(f,e)}):c(f,e):h=null};return{init:c,initFromRegistry:function(f,e){var g=[];f.getServiceReferences("orion.analytics.google").forEach(function(c){g.push(f.getService(c))});
c(g,e)},logEvent:function(c,e,g,l){if(window[p])window[p]("send","event",c,e,g,l);else h&&h.push({command:"send",arg0:"event",arg1:c,arg2:e,arg3:g,arg4:l})},logPageLoadTiming:function(c,e){window.performance&&(window.performance.getEntriesByName&&window.performance.mark&&!window.performance.getEntriesByName(c).length)&&(window.performance.mark(c),s("page",c,window.performance.now(),e))},logTiming:s,setDimension:function(c,e){if(window[p])window[p]("set",c,e);else h&&h.push({command:"set",arg0:c,arg1:e})}}});
define("orion/editor/textView","i18n!orion/editor/nls/messages orion/editor/textModel orion/editor/keyModes orion/editor/eventTarget orion/editor/textTheme orion/editor/util orion/util orion/metrics".split(" "),function(m,s,p,h,c,f,e,g){function l(A,a,b){if(b){a.className="";b=a.attributes;for(var d=b.length;0<d--;)(!e.isIE||9<=e.isIE||9>e.isIE&&b[d].specified)&&a.removeAttribute(b[d].name)}if(A){A.styleClass&&(a.className=A.styleClass);if(b=A.style)for(var k in b)b.hasOwnProperty(k)&&(a.style[k]=
b[k]);if(A=A.attributes)for(var c in A)A.hasOwnProperty(c)&&a.setAttribute(c,A[c])}}function b(A){return A instanceof Array?A.slice(0):A}function a(A,a){if(!A)return a;if(!a)return A;for(var b in a)a.hasOwnProperty(b)&&(A.hasOwnProperty(b)||(A[b]=a[b]));return A}function k(a,b){if(a===b)return!0;if(a&&!b||!a&&b||a&&a.constructor===String||b&&b.constructor===String)return!1;if(a instanceof Array||b instanceof Array){if(!(a instanceof Array&&b instanceof Array)||a.length!==b.length)return!1;for(var d=
0;d<a.length;d++)if(!k(a[d],b[d]))return!1;return!0}if(!(a instanceof Object)||!(b instanceof Object))return!1;for(d in a)if(a.hasOwnProperty(d)&&(!b.hasOwnProperty(d)||!k(a[d],b[d])))return!1;for(d in b)if(!a.hasOwnProperty(d))return!1;return!0}function d(a,b,d){for(var k=0,c=0,e=0,n=a.length;e<n;){-1!==k&&k<=e&&(k=a.indexOf("\r",e));-1!==c&&c<=e&&(c=a.indexOf("\n",e));var q=e,r;if(-1===c&&-1===k){b(a.substring(e));break}-1!==k&&-1!==c?k+1===c?(r=k,e=c+1):(r=k<c?k:c,e=(k<c?k:c)+1):-1!==k?(r=k,e=
k+1):(r=c,e=c+1);b(a.substring(q,r));d?d():e===n&&b("")}}function r(a){var b,d,k,c,e=a.ownerDocument.defaultView||a.ownerDocument.parentWindow;e.getComputedStyle?(a=e.getComputedStyle(a,null),b=a.getPropertyValue("padding-left"),d=a.getPropertyValue("padding-top"),k=a.getPropertyValue("padding-right"),c=a.getPropertyValue("padding-bottom")):a.currentStyle&&(b=a.currentStyle.paddingLeft,d=a.currentStyle.paddingTop,k=a.currentStyle.paddingRight,c=a.currentStyle.paddingBottom);return{left:parseInt(b,
10)||0,top:parseInt(d,10)||0,right:parseInt(k,10)||0,bottom:parseInt(c,10)||0}}function n(a){var b,d,k,c,e=a._trim;if(!e){var e=r(a),n=a.ownerDocument.defaultView||a.ownerDocument.parentWindow;n.getComputedStyle?(c=n.getComputedStyle(a,null),b=c.getPropertyValue("border-left-width"),d=c.getPropertyValue("border-top-width"),k=c.getPropertyValue("border-right-width"),c=c.getPropertyValue("border-bottom-width")):a.currentStyle&&(b=a.currentStyle.borderLeftWidth,d=a.currentStyle.borderTopWidth,k=a.currentStyle.borderRightWidth,
c=a.currentStyle.borderBottomWidth);b=parseInt(b,10)||0;d=parseInt(d,10)||0;k=parseInt(k,10)||0;c=parseInt(c,10)||0;e.left+=b;e.top+=d;e.right+=k;e.bottom+=c;a._trim=e}return e}function u(a,b,d,k){function c(b){if(b.animationName===n){var d=b.target;"function"===typeof d.__DOMReady&&(a.defaultView||a.parentWindow).setTimeout(function(){d.__DOMReady()},0)}}function e(a,A){for(var b=["","-webkit-","-moz-","-ms-","-o-"],d="",D="body ."+a+" {\n",k=0;k<b.length;k++)d+="@"+b[k]+"keyframes "+A+" {\nfrom { opacity: 0.99; }\nto { opacity: 1; }\n}\n",
D+=b[k]+"animation-duration: 0.001s;\n"+b[k]+"animation-name: "+A+";\n";return d+(D+"}")}d="_"+d+"DOMReady";b.className=b.className?b.className+" "+d:d;b.__DOMReady=k;k=d+"Style";if(!a.getElementById(k)){var n=d+"Animation";C(a,"animationstart",c,!1);C(a,"MSAnimationStart",c,!1);C(a,"webkitAnimationStart",c,!1);b=a.createElement("style");b.id=k;k=a.getElementsByTagName("head")[0]||a.documentElement;b.appendChild(a.createTextNode(e(d,n)));k.insertBefore(b,k.firstChild)}}function q(a,b,d){this.start=
a;this.end=b;this.caret=d;this._columnX=-1}function v(a){this._view=a;this._divs=[];for(var b=a._clipDiv||a._rootDiv,d=0;3>d;d++){var k=a._createSelectionDiv();b.appendChild(k);this._divs.push(k)}}function w(a){this.left=a.left;this.top=a.top;this.right=a.right;this.bottom=a.bottom}function B(a,b,d){this.view=a;this.lineIndex=b;this._lineDiv=d}function x(a){this._init(a||{})}var C=f.addEventListener,z=f.removeEventListener,E=f.Animation;q.compare=function(a,b){if(a.length!==b.length)return!1;for(var d=
0;d<a.length;d++)if(!a[d].equals(b[d]))return!1;return!0};q.editing=function(a,b){var d;if(b){for(d=a.length-1;0<=d;d--)if(a[d]._editing)return a[d];return a[a.length-1]}for(d=0;d<a.length;d++)if(a[d]._editing)return a[d];return a[0]};q.convert=function(a){return 1===a.length?a[0]:a};q.contains=function(a,b){return a.some(function(a){return a.contains(b)})};q.merge=function(a){if(1>=a.length)return a;a.sort(function(a,A){return a.start-A.start});for(var b=[],d=a[0],k=1;k<a.length;k++)a[k].start>=
d.end||d._editing||a[k]._editing?(b.push(d),d=a[k]):d.end=Math.max(d.end,a[k].end);b.push(d);return b};q.prototype={clone:function(){var a=new q(this.start,this.end,this.caret);a._columnX=this._columnX;a._editing=this._editing;a._docX=this._docX;return a},contains:function(a){return this.start<=a&&a<this.end?!0:!1},collapse:function(){this.caret?this.end=this.start:this.start=this.end},extend:function(a){this.caret?this.start=a:this.end=a;this.start>this.end&&(a=this.start,this.start=this.end,this.end=
a,this.caret=!this.caret)},setCaret:function(a){this.end=this.start=a;this.caret=!1},getCaret:function(){return this.caret?this.start:this.end},getAnchor:function(){return this.caret?this.end:this.start},toString:function(){return"start\x3d"+this.start+" end\x3d"+this.end+(this.caret?" caret is at start":" caret is at end")},isEmpty:function(){return this.start===this.end},equals:function(a){return this.caret===a.caret&&this.start===a.start&&this.end===a.end&&this._editing===a._editing}};v.prototype=
{destroy:function(){this._divs&&(this._divs.forEach(function(a){a.parentNode.removeChild(a)}),this._divs=null)},setPrimary:function(a){this.primary=a},update:function(){var a=this._view,b=this.primary,d=a._hasFocus,a=a._cursorVisible,k=!this.primary&&this._selection&&this._selection.isEmpty(),c;c=k?"textviewSelectionCaret":d?"textviewSelection":"textviewSelectionUnfocused";this._divs[0].style.visibility=k&&a&&d||!k?"visible":"hidden";this._divs[0].style.zIndex=a&&k?"2":"0";this._divs.forEach(function(a){a.className=
c;e.isWebkit&&b&&(a.style.background=d?"transparent":"")})},setSelection:function(a){this._selection=a;this.update();var b=this._view,d=b._model,k=d.getLineAtOffset(a.start),c=d.getLineAtOffset(a.end),e=b._getLineNext();if(e){var n=b._getLinePrevious(),q;k<e.lineIndex?(k=e,q=d.getLineStart(e.lineIndex)):k>n.lineIndex?(k=n,q=d.getLineStart(n.lineIndex)):(k=b._getLineNode(k),q=a.start);c<e.lineIndex?(b=e,d=d.getLineStart(e.lineIndex)):c>n.lineIndex?(b=n,d=d.getLineStart(n.lineIndex)):(b=b._getLineNode(c),
d=a.end);this._setDOMSelection(k,q,b,d,a.caret)}},_setDOMSelection:function(a,b,d,k,c){this._setDOMFullSelection(a,b,d,k);if(this.primary){var n=this._view;a=a._line.getNodeOffset(b);d=d._line.getNodeOffset(k);if(a.node&&d.node)if(k=n._getWindow(),b=n._parent.ownerDocument,k.getSelection){var q=k.getSelection();k=b.createRange();k.setStart(a.node,a.offset);k.setEnd(d.node,d.offset);if(n._hasFocus&&(q.anchorNode!==a.node||q.anchorOffset!==a.offset||q.focusNode!==d.node||q.focusOffset!==d.offset||q.anchorNode!==
d.node||q.anchorOffset!==d.offset||q.focusNode!==a.node||q.focusOffset!==a.offset))n._anchorNode=a.node,n._anchorOffset=a.offset,n._focusNode=d.node,n._focusOffset=d.offset,n._ignoreSelect=!1,0<q.rangeCount&&q.removeAllRanges(),q.addRange(k),n._ignoreSelect=!0;n._cursorDiv&&(k=b.createRange(),c?(k.setStart(a.node,a.offset),k.setEnd(a.node,a.offset)):(k.setStart(d.node,d.offset),k.setEnd(d.node,d.offset)),c=k.getClientRects()[0],a=n._cursorDiv.parentNode,d=a.getBoundingClientRect(),c&&d&&(n._cursorDiv.style.top=
c.top-d.top+a.scrollTop+"px",n._cursorDiv.style.left=c.left-d.left+a.scrollLeft+"px"))}else b.selection&&n._hasFocus&&(c=b.body,k=e.createElement(b,"div"),c.appendChild(k),c.removeChild(k),k=c.createTextRange(),k.moveToElementText(a.node.parentNode),k.moveStart("character",a.offset),c=c.createTextRange(),c.moveToElementText(d.node.parentNode),c.moveStart("character",d.offset),k.setEndPoint("EndToStart",c),n._ignoreSelect=!1,k.select(),n._ignoreSelect=!0)}},_setDOMFullSelection:function(a,b,d,k){this._divs.forEach(function(a){a.style.width=
a.style.height="0px"});var c=this._view;if(c._fullSelection&&!e.isIOS&&!(a===d&&b===k&&this.primary)){var n=c._getViewPadding(),q=c._clientDiv.getBoundingClientRect(),r=c._viewDiv.getBoundingClientRect(),f=r.left+n.left,u=q.right,n=r.top+n.top,g=q.bottom,r=q=0;c._clipDiv?(r=c._clipDiv.getBoundingClientRect(),q=r.left-c._clipDiv.scrollLeft):(r=c._rootDiv.getBoundingClientRect(),q=r.left);r=r.top;c._ignoreDOMSelection=!0;var v=new B(c,a.lineIndex,a),l=v.getBoundingClientRect(b,!1),h=l.left;a===d&&b===
k?(b=v,k=l):(b=new B(c,d.lineIndex,d),k=b.getBoundingClientRect(k,!1));b=k.left;c._ignoreDOMSelection=!1;var v=this._divs[0],h=Math.min(u,Math.max(f,h)),F=Math.min(g,Math.max(n,l.top)),w=u,c=Math.min(g,Math.max(n,l.bottom));v.style.left=h-q+"px";v.style.top=F-r+"px";v.style.width=Math.max(0,w-h)+"px";v.style.height=Math.max(0,c-F)+"px";a.lineIndex===d.lineIndex?(w=Math.min(b,u),v.style.width=Math.max(this.primary?0:1,w-h)+"px"):(l=Math.min(g,Math.max(n,k.top)),b=Math.min(u,Math.max(f,b)),n=Math.min(g,
Math.max(n,k.bottom)),g=this._divs[2],g.style.left=f-q+"px",g.style.top=l-r+"px",g.style.width=Math.max(0,b-f)+"px",g.style.height=Math.max(0,n-l)+"px",1<Math.abs(a.lineIndex-d.lineIndex)&&(a=this._divs[1],a.style.left=f-q+"px",a.style.top=c-r+"px",a.style.width=Math.max(0,u-f)+"px",a.style.height=Math.max(0,l-c)+"px"))}}};w.prototype={toString:function(){return"{l\x3d"+this.left+", t\x3d"+this.top+", r\x3d"+this.right+", b\x3d"+this.bottom+"}"}};B.prototype={create:function(a,b){if(!this._lineDiv){var d=
this._lineDiv=this._createLine(a,b,this.lineIndex);d._line=this;return d}},_createLine:function(a,b,d){var c=this.view,n=c._model,q=n.getLine(d),r=n.getLineStart(d),f={type:"LineStyle",textView:c,lineIndex:d,lineText:q,lineStart:r};c.onLineStyle(f);var g=a.ownerDocument,n=b||e.createElement(g,"div");if(!b||!k(b.viewStyle,f.style))l(f.style,n,b),b&&(b._trim=null),n.viewStyle=f.style,n.setAttribute("role","presentation");n.lineIndex=d;if(b&&n.viewLineText===q&&k(f.ranges,n.viewRanges))return n;n.viewRanges=
f.ranges;n.viewLineText=q;d=[];this._createRanges(f.ranges,q,0,q.length,r,{tabOffset:0,ranges:d});f=" ";!c._fullSelection&&9>e.isIE&&(f="\ufeff");c={text:f,style:c._metrics.largestFontStyle,ignoreChars:1};0===d.length||!d[d.length-1].style||"div"!==d[d.length-1].style.tagName?d.push(c):d.splice(d.length-1,0,c);var u,v,h,w=f=0;if(e.isFirefox&&2E3<q.length){b&&(n.innerHTML="",b.lineWidth=void 0);b=g.createDocumentFragment();for(q=0;q<d.length;q++)c=d[q],r=c.text,u=c.style,u=this._createSpan(n,r,u,c.ignoreChars),
b.appendChild(u);n.appendChild(b)}else{var B,F;if(b){if(v=b.modelChangedEvent)0===v.removedLineCount&&0===v.addedLineCount?(F=v.start-r,B=v.addedCharCount-v.removedCharCount):F=-1,b.modelChangedEvent=void 0;v=b.firstChild}for(q=0;q<d.length;q++){c=d[q];r=c.text;f+=r.length;u=c.style;if(v)if(h=v.firstChild.data,g=v.viewStyle,h===r&&k(u,g)){w+=h.length;v._rectsCache=void 0;u=v=v.nextSibling;continue}else for(;v;){if(-1!==F){g=f;g>=F&&(g-=B);h=(h=v.firstChild.data)?h.length:0;if(w+h>g)break;w+=h}g=v.nextSibling;
n.removeChild(v);v=g}u=this._createSpan(n,r,u,c.ignoreChars);v?n.insertBefore(u,v):n.appendChild(u);b&&(b.lineWidth=void 0)}if(b)for(B=u?u.nextSibling:null;B;)g=B.nextSibling,b.removeChild(B),B=g}n.parentNode||a.appendChild(n);return n},_createRanges:function(a,b,d,c,e,n){if(!(d>c)){if(a)for(var q=0;q<a.length;q++){var r=a[q];if(!(r.end<e+d)){var f=Math.max(e+d,r.start)-e;if(f>c)break;var g=Math.min(e+c,r.end)-e;if(f<=g){f=Math.max(d,f);g=Math.min(c,g);d<f&&this._createRange(b,d,f,null,n);if(!r.style||
!r.style.unmergeable)for(;q+1<a.length&&a[q+1].start-e===g&&k(r.style,a[q+1].style);)r=a[q+1],g=Math.min(e+c,r.end)-e,q++;this._createRange(b,f,g,r.style,n);d=g}}}d<c&&this._createRange(b,d,c,null,n)}},_createRange:function(a,b,d,k,c){if(!(b>d)){var e=this.view._customTabSize;if(e&&8!==e)for(var n=a.indexOf("\t",b);-1!==n&&n<d;){b<n&&(b={text:a.substring(b,n),style:k},c.ranges.push(b),c.tabOffset+=b.text.length);b=e-c.tabOffset%e;if(0<b){for(var q="\u00a0",r=1;r<b;r++)q+=" ";b={text:q,style:k,ignoreChars:b-
1};c.ranges.push(b);c.tabOffset+=b.text.length}b=n+1;if(b===d)return;n=a.indexOf("\t",b)}b<=d&&(b={text:a.substring(b,d),style:k},c.ranges.push(b),c.tabOffset+=b.text.length)}},_createSpan:function(a,b,d,k){var c=this.view,n="span";d&&d.tagName&&(n=d.tagName.toLowerCase());var q="a"===n;q&&(this.hasLink=!0);q&&!c._linksVisible&&(n="span");q=a.ownerDocument;a=e.createElement(a.ownerDocument,n);a.appendChild(q.createTextNode(d&&d.text?d.text:b));d&&d.html?(a.innerHTML=d.html,a.ignore=!0):d&&d.node&&
(a.appendChild(d.node),a.ignore=!0);l(d,a);if("a"===n){var r=c._getWindow();C(a,"click",function(a){return c._handleLinkClick(a?a:r.event)},!1)}a.viewStyle=d;k&&(a.ignoreChars=k);return a},_ensureCreated:function(){return this._lineDiv?this._lineDiv:this._createdDiv=this.create(this.view._clientDiv,null)},getBoundingClientRect:function(a,b){var d=this._ensureCreated(),k=this.view;if(void 0===a)return this._getLineBoundingClientRect(d,!0);var c=k._model,n=d.ownerDocument,q=this.lineIndex,r=null;if(a<
c.getLineEnd(q)){var f=c.getLineStart(q);this.forEach(function(b){var c=b.firstChild,D=this._nodeLength(b);if(f+D>a){var q=a-f;if(1===c.length)r=new w(b.getBoundingClientRect());else if(k._isRangeRects)D=n.createRange(),D.setStart(c,q),D.setEnd(c,q+1),r=new w(D.getBoundingClientRect());else if(e.isIE)D=n.body.createTextRange(),D.moveToElementText(b),D.collapse(),(c=0===q&&8===e.isIE)&&(q=1),D.moveEnd("character",q+1),D.moveStart("character",q),r=new w(D.getBoundingClientRect()),c&&(r.left=b.getClientRects()[0].left);
else{var g=c.data;b.removeChild(c);b.appendChild(n.createTextNode(g.substring(0,q)));var u=e.createElement(n,"span");u.appendChild(n.createTextNode(g.substring(q,q+1)));b.appendChild(u);b.appendChild(n.createTextNode(g.substring(q+1)));r=new w(u.getBoundingClientRect());b.innerHTML="";b.appendChild(c);this._createdDiv||(b=k._getSelections()[0],(f<=b.start&&b.start<f+D||f<=b.end&&b.end<f+D)&&k._updateDOMSelection())}11>e.isIE&&(q=d.ownerDocument.defaultView||d.ownerDocument.parentWindow,b=q.screen.logicalXDPI/
q.screen.deviceXDPI,q=q.screen.logicalYDPI/q.screen.deviceYDPI,r.left*=b,r.right*=b,r.top*=q,r.bottom*=q);return!1}f+=D;return!0})}c=this.getBoundingClientRect();r||(k._wrapMode?(q=this.getClientRects(),r=q[q.length-1],r.left=r.right,r.left+=c.left,r.top+=c.top,r.right+=c.left,r.bottom+=c.top):(r=new w(c),r.left=r.right));if(b||void 0===b)r.left-=c.left,r.top-=c.top,r.right-=c.left,r.bottom-=c.top;return r},forEach:function(a){for(var b=this._ensureCreated().firstChild;b;){var d=b.nextSibling;if(!b.ignore&&
!a.call(this,b))break;b=d}},_getClientRects:function(a,b){var d,c,k,e;if(!a._rectsCache){d=a.getClientRects();c=Array(d.length);for(e=0;e<d.length;e++)k=c[e]=new w(d[e]),k.left-=b.left,k.top-=b.top,k.right-=b.left,k.bottom-=b.top;a._rectsCache=c}d=a._rectsCache;c=[d.length];for(e=0;e<d.length;e++)c[e]=new w(d[e]);return c},getClientRects:function(a){if(!this.view._wrapMode)return[this.getBoundingClientRect()];var b=[],d=this._ensureCreated().getBoundingClientRect();this.forEach(function(a){a=this._getClientRects(a,
d);for(var A=0;A<a.length;A++){var c=a[A],k,e;if(c.top!==c.bottom){var n=c.top+(c.bottom-c.top)/2;for(k=0;k<b.length&&!(e=b[k],e.top<=n&&n<e.bottom);k++);k===b.length?b.push(c):(c.left<e.left&&(e.left=c.left),c.top<e.top&&(e.top=c.top),c.right>e.right&&(e.right=c.right),c.bottom>e.bottom&&(e.bottom=c.bottom))}}return!0});return void 0!==a?b[a]:b},_getLineBoundingClientRect:function(a,b){var d=new w(a.getBoundingClientRect());if(!this.view._wrapMode){d.right=d.left;for(var c=a.lastChild;c&&c.ignoreChars===
c.firstChild.length;)c=c.previousSibling;c&&(c=c.getBoundingClientRect(),d.right=c.right+n(a).right)}b&&(c=n(a),d.left+=c.left,d.right-=c.right);return d},getLineCount:function(){return!this.view._wrapMode?1:this.getClientRects().length},getLineIndex:function(a){if(!this.view._wrapMode)return 0;var b=this.getClientRects();a=this.getBoundingClientRect(a);a=a.top+(a.bottom-a.top)/2;for(var d=0;d<b.length;d++)if(b[d].top<=a&&a<b[d].bottom)return d;return b.length-1},getLineStart:function(a){if(!this.view._wrapMode||
0===a)return this.view._model.getLineStart(this.lineIndex);var b=this.getClientRects();return this.getOffset(b[a].left+1,b[a].top+1)},_nodeLength:function(a){if(!a||a.ignore)return 0;var b=a.firstChild.length;a.ignoreChars&&(b-=a.ignoreChars);return b},getModelOffset:function(a,b){if(!a)return 0;var d=0;this.forEach(function(c){var k=c.firstChild;if(k===a)return c.ignoreChars&&(d-=c.ignoreChars),d+=b,!1;c.ignoreChars&&(d-=c.ignoreChars);d+=k.data.length;return!0});return Math.max(0,d)+this.view._model.getLineStart(this.lineIndex)},
getNodeOffset:function(a){var b=0,d,c,k=this.view._model,e=k.getLineStart(this.lineIndex),n=a-e,q=k.getLineEnd(this.lineIndex)-e;this.forEach(function(a){var A=a.firstChild,k=this._nodeLength(a);if(k+b>n||b+k>=q)return d=A,c=n-b,a.ignoreChars&&(0<k&&c===k)&&(c+=a.ignoreChars),!1;b+=k;return!0});return{node:d,offset:c}},getText:function(a){var b="",d=0;this.forEach(function(c){var k;if(c.ignoreChars){k=c.lastChild;for(var e=0,n=[],q=-1;k;){var r=k.data;if(r)for(var f=r.length-1;0<=f;f--){var g=r.substring(f,
f+1);e<c.ignoreChars&&(" "===g||"\ufeff"===g)?e++:n.push("\u00a0"===g?"\t":g)}a===k&&(q=n.length);k=k.previousSibling}n=n.reverse().join("");-1!==q&&(d=b.length+n.length-q);b+=n}else for(k=c.firstChild;k;)a===k&&(d=b.length),b+=k.data,k=k.nextSibling;return!0});return{text:b,offset:d}},getOffset:function(a,b){function d(c,f,y){var l=c.firstChild,h=v._nodeLength(c),w=g.ownerDocument,H=w.defaultView||w.parentWindow,F=11>e.isIE?H.screen.logicalXDPI/H.screen.deviceXDPI:1,I=11>e.isIE?H.screen.logicalYDPI/
H.screen.deviceYDPI:1,M,B,x,H=y.left+u.left,m,t;if(e.isIE||k._isRangeRects){for(var w=k._isRangeRects?w.createRange():w.body.createTextRange(),p=h,R=-1;1<p-R;){var Q=Math.floor((p+R)/2);y=R+1;M=Q===h-1&&c.ignoreChars?l.length:Q+1;m=0===y&&8===e.isIE;k._isRangeRects?(w.setStart(l,y),w.setEnd(l,M)):(m&&(y=1),w.moveToElementText(c),w.move("character",y),w.moveEnd("character",M-y));t=w.getClientRects();for(var s=!1,C=0;C<t.length;C++)if(y=t[C],M=(m?H:y.left)*F-u.left,x=y.right*F-u.left,B=y.top*I-u.top,
y=y.bottom*I-u.top,M<=a&&a<x&&(!k._wrapMode||B<=b&&b<=y)){s=!0;break}s?p=Q:R=Q}f+=p;y=p;M=p===h-1&&c.ignoreChars?l.length:Math.min(p+1,l.length);k._isRangeRects?(w.setStart(l,y),w.setEnd(l,M)):(w.moveToElementText(c),w.move("character",y),w.moveEnd("character",M-y));t=w.getClientRects();h=!1;0<t.length&&(y=t[0],M=(m?H:y.left)*F-u.left,x=y.right*F-u.left,h=a>M+(x-M)/2);c=f-r;l=n.getLine(q);F=l.charCodeAt(c);55296<=F&&56319>=F&&h?c<l.length&&(F=l.charCodeAt(c+1),56320<=F&&57343>=F&&(f+=1)):56320<=F&&
(57343>=F&&!h)&&0<c&&(F=l.charCodeAt(c-1),55296<=F&&56319>=F&&(f-=1));h&&f++}else{F=[];for(m=0;m<h;m++)F.push("\x3cspan\x3e"),m===h-1?F.push(l.data.substring(m)):F.push(l.data.substring(m,m+1)),F.push("\x3c/span\x3e");c.innerHTML=F.join("");for(F=c.firstChild;F;){y=F.getBoundingClientRect();M=y.left-u.left;x=y.right-u.left;if(M<=a&&a<x){a>M+(x-M)/2&&f++;break}f++;F=F.nextSibling}v._createdDiv||(c.innerHTML="",c.appendChild(l),c=k._getSelections()[0],(f<=c.start&&c.start<f+h||f<=c.end&&c.end<f+h)&&
k._updateDOMSelection())}return f}function c(d){if(d.ignore)return null;d=v._getClientRects(d,u);for(var e=0;e<d.length;e++){var n=d[e];if(n.left<=a&&a<n.right&&(!k._wrapMode||n.top<=b&&b<=n.bottom))return n}return null}var k=this.view,n=k._model,q=this.lineIndex,r=n.getLineStart(q),f=n.getLineEnd(q);if(r===f)return r;var g=this._ensureCreated(),u=this.getBoundingClientRect(),v=this,l,h;if(k._wrapMode){l=this.getClientRects();b<l[0].top&&(b=l[0].top);for(var F=0;F<l.length&&!(h=l[F],h.top<=b&&b<h.bottom);F++);
a<h.left&&(a=h.left);a>h.right&&(a=h.right-1)}else 0>a&&(a=0),a>u.right-u.left&&(a=u.right-u.left);var w,B;if(this._lastHitChild&&this._lastHitChild.parentNode){if(w=this._lastHitOffset,B=this._lastHitChild,h=c(B),!h){l=w;for(var F=w+this._nodeLength(B),x=B.previousSibling,m=B.nextSibling;x||m;){if(x){l-=this._nodeLength(x);if(h=c(x)){B=x;w=l;break}x=x.previousSibling}if(m){if(h=c(m)){B=m;w=F;break}F+=this._nodeLength(m);m=m.nextSibling}}}}else w=r,this.forEach(function(a){B=a;if(h=c(B))return!1;
w+=this._nodeLength(B);return!0});B&&h&&(this._lastHitChild=B,this._lastHitOffset=w,w=d(B,w,h));return Math.min(f,Math.max(r,w))},getNextOffset:function(a,b){if("line"===b.unit){var d=this.view._model,c=d.getLineAtOffset(a);if(0<b.count)return b.count--,d.getLineEnd(c);b.count++;return d.getLineStart(c)}return"wordend"===b.unit||"wordWS"===b.unit||"wordendWS"===b.unit?this._getNextOffset_W3C(a,b):e.isIE?this._getNextOffset_IE(a,b):this._getNextOffset_W3C(a,b)},_getNextOffset_W3C:function(a,b){function d(a){return 33<=
a&&47>=a||58<=a&&64>=a||91<=a&&94>=a||96===a||123<=a&&126>=a}function c(a){return 32===a||9===a}var k=this.view._model,e=k.getLineAtOffset(a),n=k.getLine(e),q=k.getLineStart(e),k=k.getLineEnd(e),e=n.length,r=a-q,f,g=0>b.count?-1:1;if("word"===b.unit||"wordend"===b.unit||"wordWS"===b.unit||"wordendWS"===b.unit)for(var u,v,l;0!==b.count;){if(0<b.count){if(r===e)return k;f=n.charCodeAt(r);u=d(f);v=!u&&!c(f);for(r++;r<e;){f=n.charCodeAt(r);if("wordWS"!==b.unit&&"wordendWS"!==b.unit){l=d(f);if("wordend"===
b.unit){if(!l&&u)break}else if(l&&!u)break;f=!l&&!c(f)}else f=!c(f);if("wordend"===b.unit||"wordendWS"===b.unit){if(!f&&v)break}else if(f&&!v)break;v=f;u=l;r++}}else{if(0===r)return q;r--;f=n.charCodeAt(r);u=d(f);for(v=!u&&!c(f);0<r;){f=n.charCodeAt(r-1);if("wordWS"!==b.unit&&"wordendWS"!==b.unit){l=d(f);if("wordend"===b.unit){if(l&&!u)break}else if(!l&&u)break;f=!l&&!c(f)}else f=!c(f);if("wordend"===b.unit||"wordendWS"===b.unit){if(f&&!v)break}else if(!f&&v)break;v=f;u=l;r--}}b.count-=g}else for(;0!==
b.count&&0<=r+g&&r+g<=e;)r+=g,f=n.charCodeAt(r),56320<=f&&57343>=f&&0<r&&(f=n.charCodeAt(r-1),55296<=f&&56319>=f&&(r+=g)),b.count-=g;return q+r},_getNextOffset_IE:function(a,b){var d=this._ensureCreated(),c=this.view._model,k=this.lineIndex,e=0,n;n=c.getLineStart(k);var q=c.getLine(k),r=c.getLineStart(k),f=d.ownerDocument,u=0>b.count?-1:1;if(a===c.getLineEnd(k)){for(d=d.lastChild;d&&d.ignoreChars===d.firstChild.length;)d=d.previousSibling;if(!d)return n;e=f.body.createTextRange();e.moveToElementText(d);
n=e.text.length;e.moveEnd(b.unit,u);e=a+e.text.length-n}else if(a===n&&0>b.count)e=n;else for(d=d.firstChild;d;){c=this._nodeLength(d);if(n+c>a){e=f.body.createTextRange();if(a===n&&0>b.count){for(n=d.previousSibling;n&&(!n.firstChild||!n.firstChild.length);)n=n.previousSibling;e.moveToElementText(n?n:d.previousSibling)}else e.moveToElementText(d),e.collapse(),e.moveEnd("character",a-n);n=e.text.length;e.moveEnd(b.unit,u);e=a+e.text.length-n;break}n=c+n;d=d.nextSibling}n=e-r;e=q.charCodeAt(n);56320<=
e&&57343>=e&&0<n&&(e=q.charCodeAt(n-1),55296<=e&&56319>=e&&(n+=u));b.count-=u;return n+r},updateLinks:function(){var a=this._ensureCreated();if(this.hasLink){var b=this;this.forEach(function(d){var c=d.viewStyle;c&&(c.tagName&&"a"===c.tagName.toLowerCase())&&a.replaceChild(b._createSpan(a,d.firstChild.data,c),d);return!0})}},destroy:function(){var a=this._createdDiv;a&&(a.parentNode.removeChild(a),this._createdDiv=null)}};x.prototype={addKeyMode:function(a,b){var d=this._keyModes;void 0!==b?d.splice(b,
0,a):d.push(a);a._modeAdded&&a._modeAdded()},addRuler:function(a,b){var d=this._rulers;if(void 0!==b){var c,k;for(k=c=0;c<d.length&&k<b;c++)a.getLocation()===d[c].getLocation()&&k++;d.splice(k,0,a);b=k}else d.push(a);this._createRuler(a,b);a.setView(this);this._update()},computeSize:function(){var a=0,b=0,d=this._model,c=this._clientDiv;if(!c)return{width:a,height:b};var k=c.style.width;e.isWebkit&&(c.style.width="0x7fffffffpx");for(var d=d.getLineCount(),n=0;n<d;n++){var q=this._getLine(n),r=q.getBoundingClientRect(),
a=Math.max(a,r.right-r.left),b=b+(r.bottom-r.top);q.destroy()}e.isWebkit&&(c.style.width=k);c=this._getViewPadding();a+=c.right+c.left+this._metrics.scrollWidth;b+=c.bottom+c.top+this._metrics.scrollWidth;return{width:a,height:b}},convert:function(a,b,d){if(!this._clientDiv)return a;var c=this._getScroll(),k=this._getViewPadding(),e=this._viewDiv.getBoundingClientRect();"document"===b&&(void 0!==a.x&&(a.x+=-c.x+e.left+k.left),void 0!==a.y&&(a.y+=-c.y+e.top+k.top));"document"===d&&(void 0!==a.x&&(a.x+=
c.x-e.left-k.left),void 0!==a.y&&(a.y+=c.y-e.top-k.top));return a},destroy:function(){for(var a=0;a<this._rulers.length;a++)this._rulers[a].setView(null);this.rulers=null;this._destroyView();this.onDestroy({type:"Destroy"});this._parent=null;this._model&&this._model.destroy&&this._model.destroy();this._actions=this._keyModes=this._doubleClickSelection=this._selection=this._theme=this._model=null},focus:function(){this._clientDiv&&(this._updateDOMSelection(),this._clientDiv.focus(),this._updateDOMSelection())},
hasFocus:function(){return this._hasFocus},getActionDescription:function(a){if(a=this._actions[a])return a.actionDescription},getActions:function(a){var b=[],d=this._actions,c;for(c in d)d.hasOwnProperty(c)&&(a||!d[c].defaultHandler)&&b.push(c);return b},getBottomIndex:function(a){return!this._clientDiv?0:this._getBottomIndex(a)},getBottomPixel:function(){return!this._clientDiv?0:this._getScroll().y+this._getClientHeight()},getCaretOffset:function(){return this._getSelection().getCaret()},getClientArea:function(){if(!this._clientDiv)return{x:0,
y:0,width:0,height:0};var a=this._getScroll();return{x:a.x,y:a.y,width:this._getClientWidth(),height:this._getClientHeight()}},getHorizontalPixel:function(){return!this._clientDiv?0:this._getScroll().x},getKeyBindings:function(a){for(var b=[],d=this._keyModes,c=0;c<d.length;c++)b=b.concat(d[c].getKeyBindings(a));return b},getKeyModes:function(){return this._keyModes.slice(0)},getLineHeight:function(a){return!this._clientDiv?0:this._getLineHeight(a)},getLineIndex:function(a){return!this._clientDiv?
0:this._getLineIndex(a)},isValidLineIndex:function(a){return!this._clientDiv?!1:0<=this._getLineIndex(a,!0)},getLinePixel:function(a){return!this._clientDiv?0:this._getLinePixel(a)},getLocationAtOffset:function(a){if(!this._clientDiv)return{x:0,y:0};var b=this._model;a=Math.min(Math.max(0,a),b.getCharCount());var b=b.getLineAtOffset(a),d=this._getLine(b);a=d.getBoundingClientRect(a);d.destroy();d=a.left;b=this._getLinePixel(b)+a.top;return{x:d,y:b}},getNextOffset:function(a,b){var d=new q(a,a,!1);
this._doMove(b,d);return d.getCaret()},getOptions:function(){var a;if(0===arguments.length)a=this._defaultOptions();else if(1===arguments.length){if(a=arguments[0],"string"===typeof a)return b(this["_"+a])}else{a={};for(var d in arguments)arguments.hasOwnProperty(d)&&(a[arguments[d]]=void 0)}for(var c in a)a.hasOwnProperty(c)&&(a[c]=b(this["_"+c]));return a},getModel:function(){return this._model},getOffsetAtLocation:function(a,b){if(!this._clientDiv)return 0;var d=this._getLineIndex(b),c=this._getLine(d),
d=c.getOffset(a,b-this._getLinePixel(d));c.destroy();return d},getLineAtOffset:function(a){return this.getModel().getLineAtOffset(a)},getLineStart:function(a){return this.getModel().getLineStart(a)},getRulers:function(){return this._rulers.slice(0)},getSelection:function(){return this._getSelection()},getSelections:function(){return this._getSelections()},getSelectionText:function(a){var b=[],d=this;this._getSelections().forEach(function(a){a.isEmpty()||b.push(d._getBaseText(a.start,a.end))});return b.join(void 0!==
a?a:this._model.getLineDelimiter())},getText:function(a,b){return this._model.getText(a,b)},getTopIndex:function(a){return!this._clientDiv?0:this._getTopIndex(a)},getTopPixel:function(){return!this._clientDiv?0:this._getScroll().y},invokeAction:function(a,b,d){if(this._clientDiv){if(a=this._actions[a]){a.actionDescription&&a.actionDescription.id&&g.logEvent("editor","action",a.actionDescription.id);if(!b&&a.handler&&a.handler(d))return!0;if(a.defaultHandler)return"boolean"===typeof a.defaultHandler(d)}return!1}},
isDestroyed:function(){return!this._clientDiv},onContextMenu:function(a){return this.dispatchEvent(a)},onDragStart:function(a){return this.dispatchEvent(a)},onDrag:function(a){return this.dispatchEvent(a)},onDragEnd:function(a){return this.dispatchEvent(a)},onDragEnter:function(a){return this.dispatchEvent(a)},onDragOver:function(a){return this.dispatchEvent(a)},onDragLeave:function(a){return this.dispatchEvent(a)},onDrop:function(a){return this.dispatchEvent(a)},onDestroy:function(a){return this.dispatchEvent(a)},
onSaving:function(a){return this.dispatchEvent(a)},onInputChanged:function(a){return this.dispatchEvent(a)},onLineStyle:function(a){return this.dispatchEvent(a)},onKeyDown:function(a){return this.dispatchEvent(a)},onKeyPress:function(a){return this.dispatchEvent(a)},onKeyUp:function(a){return this.dispatchEvent(a)},onModelChanged:function(a){return this.dispatchEvent(a)},onModelChanging:function(a){return this.dispatchEvent(a)},onModify:function(a){return this.dispatchEvent(a)},onMouseDown:function(a){return this.dispatchEvent(a)},
onMouseUp:function(a){return this.dispatchEvent(a)},onMouseMove:function(a){return this.dispatchEvent(a)},onMouseOver:function(a){return this.dispatchEvent(a)},onMouseOut:function(a){return this.dispatchEvent(a)},onTouchStart:function(a){return this.dispatchEvent(a)},onTouchMove:function(a){return this.dispatchEvent(a)},onTouchEnd:function(a){return this.dispatchEvent(a)},onOptions:function(a){return this.dispatchEvent(a)},onSelection:function(a){return this.dispatchEvent(a)},onScroll:function(a){return this.dispatchEvent(a)},
onVerify:function(a){return this.dispatchEvent(a)},onFocus:function(a){return this.dispatchEvent(a)},onBlur:function(a){return this.dispatchEvent(a)},redraw:function(){if(!(0<this._redrawCount)){var a=this._model.getLineCount();this.redrawRulers(0,a);this.redrawLines(0,a)}},redrawRulers:function(a,b){if(!(0<this._redrawCount))for(var d=this.getRulers(),c=0;c<d.length;c++)this.redrawLines(a,b,d[c])},redrawLines:function(a,b,d){if(!(0<this._redrawCount)&&(void 0===a&&(a=0),void 0===b&&(b=this._model.getLineCount()),
a!==b)){var c=this._clientDiv;if(c){if(d)for(c=this._getRulerParent(d).firstChild;c&&c._ruler!==d;)c=c.nextSibling;d?c.rulerChanged=!0:this._lineHeight&&this._resetLineHeight(a,b);if(!d||"page"===d.getOverview())for(c=c.firstChild;c;){var k=c.lineIndex;a<=k&&k<b&&(c.lineChanged=!0);c=c.nextSibling}!d&&(!this._wrapMode&&a<=this._maxLineIndex&&this._maxLineIndex<b)&&(this._checkMaxLineIndex=this._maxLineIndex,this._maxLineIndex=-1,this._maxLineWidth=0);this.dispatchEvent({type:"Redraw",startLine:a,
endLine:b,ruler:d});this._queueUpdate()}}},redrawRange:function(a,b){if(!(0<this._redrawCount)){var d=this._model;void 0===a&&(a=0);void 0===b&&(b=d.getCharCount());var c=d.getLineAtOffset(a),d=d.getLineAtOffset(Math.max(a,b-1))+1;this.redrawLines(c,d)}},removeKeyMode:function(a){for(var b=this._keyModes,d=0;d<b.length;d++)if(b[d]===a){b.splice(d,1);break}a._modeRemoved&&a._modeRemoved()},removeRuler:function(a){for(var b=this._rulers,d=0;d<b.length;d++)if(b[d]===a){b.splice(d,1);a.setView(null);
this._destroyRuler(a);this._update();break}},resize:function(){this._clientDiv&&this._handleResize(null)},setAction:function(a,b,d){if(a){var c=this._actions,k=c[a];k||(k=c[a]={});k.handler=b;void 0!==d&&(k.actionDescription=d)}},setKeyBinding:function(a,b){this._keyModes[0].setKeyBinding(a,b)},setCaretOffset:function(a,b,d){var c=this._model.getCharCount();a=Math.max(0,Math.min(a,c));a=new q(a,a,!1);this._setSelection(a,void 0===b||b,!0,d)},setHorizontalPixel:function(a){this._clientDiv&&(a=Math.max(0,
a),this._scrollView(a-this._getScroll().x,0))},setRedraw:function(a){a?0===--this._redrawCount&&this.redraw():this._redrawCount++},setModel:function(a){if(a!==this._model){a=a||new s.TextModel;this._model.removeEventListener("preChanging",this._modelListener.onChanging);this._model.removeEventListener("postChanged",this._modelListener.onChanged);var b=this._model.getLineCount(),d=this._model.getCharCount(),c=a.getLineCount(),k=a.getCharCount(),e={type:"ModelChanging",text:a.getText(),start:0,removedCharCount:d,
addedCharCount:k,removedLineCount:b,addedLineCount:c};this.onModelChanging(e);this._model=a;e={type:"ModelChanged",start:0,removedCharCount:d,addedCharCount:k,removedLineCount:b,addedLineCount:c};this.onModelChanged(e);this._model.addEventListener("preChanging",this._modelListener.onChanging);this._model.addEventListener("postChanged",this._modelListener.onChanged);this._reset();this._update()}},setOptions:function(a){var d=this._defaultOptions(),c;for(c in a)if(a.hasOwnProperty(c)){var e=a[c];if(!k(this["_"+
c],e)){var n=d[c]?d[c].update:null;n?n.call(this,e):this["_"+c]=b(e)}}this.onOptions({type:"Options",options:a})},setSelection:function(a,b,d,c){var k=a>b;if(k){var e=a;a=b;b=e}e=this._model.getCharCount();a=Math.max(0,Math.min(a,e));b=Math.max(0,Math.min(b,e));a=new q(a,b,k);this._setSelection(a,void 0===d||d,!0,c)},setSelections:function(a,b,d){a=this._rangesToSelections(a);this._setSelection(a,void 0===b||b,!0,d)},setText:function(a,b,d){var c="string"===typeof a,k=void 0===b&&void 0===d&&c;c?
(void 0===b&&(b=0),void 0===d&&(d=this._model.getCharCount()),a={text:a,selection:[new q(b,d,!1)]}):a.selection=this._rangesToSelections(a.selection);a._code=!0;k&&(this._variableLineHeight=!1);this._modifyContent(a,!k);k&&13>e.isFirefox&&this._fixCaret()},setTopIndex:function(a,b){this._clientDiv&&this._scrollViewAnimated(0,this._getLinePixel(Math.max(0,a))-this._getScroll().y,b)},setTopPixel:function(a,b){this._clientDiv&&this._scrollViewAnimated(0,Math.max(0,a)-this._getScroll().y,b)},showSelection:function(a,
b){return this._showCaret(a?!1:!0,b,a)},update:function(a,b){this._clientDiv&&((a||this._metrics.invalid)&&this._updateStyle(),void 0===b||b?this._update():this._queueUpdate())},_handleRootMouseDown:function(a){this._cancelCheckSelection();if(!this._ignoreEvent(a)){13>e.isFirefox&&1===a.which&&(this._clientDiv.contentEditable=!1,this._ignoreBlur=(this._overlayDiv||this._clientDiv).draggable=!0);var b=this._overlayDiv||this._clientDiv;9>e.isIE&&(b=this._viewDiv);for(var d=a.target?a.target:a.srcElement;d;){if(b===
d||d.className&&-1!==d.className.indexOf("textViewFind"))return;d=d.parentNode}a.preventDefault&&a.preventDefault();a.stopPropagation&&a.stopPropagation();if(!this._isW3CEvents){var c=this;this._getWindow().setTimeout(function(){c._clientDiv.focus()},0)}}},_handleRootMouseUp:function(a){this._ignoreEvent(a)||(13>e.isFirefox&&1===a.which&&(this._clientDiv.contentEditable=!0,(this._overlayDiv||this._clientDiv).draggable=!1),e.isFirefox&&1===a.which&&(this._fixCaret(),this._ignoreBlur=!1))},_handleBlur:function(){this._cancelCheckSelection();
if(!this._ignoreBlur){this._commitIME();this._hasFocus=!1;if(9>e.isIE&&!this._getSelections()[0].isEmpty()){var a=this._rootDiv,b=e.createElement(a.ownerDocument,"div");a.appendChild(b);a.removeChild(b)}this._cursorDiv&&(this._cursorDiv.style.display="none");if(this._domSelection)if(this._domSelection.forEach(function(a){a.update()}),a=this._getWindow(),b=this._parent.ownerDocument,a.getSelection){b=a.getSelection();for(a=b.anchorNode;a;){if(a===this._clientDiv){0<b.rangeCount&&b.removeAllRanges();
break}a=a.parentNode}}else if(b.selection){this._ignoreSelect=!1;for(a=b.selection.createRange().parentElement();a;){if(a===this._clientDiv){b.selection.empty();break}a=a.parentNode}this._ignoreSelect=!0}if(!this._ignoreFocus)this.onBlur({type:"Blur"})}},_handleCompositionStart:function(a){this._ignoreEvent(a)||(this._startIME(),this._mutationObserver&&(this._mutationObserver.disconnect(),this._mutationObserver=null))},_handleCompositionEnd:function(a){this._ignoreEvent(a)||this._commitIME(a.data)},
_handleContextMenu:function(a){if(!this._ignoreEvent(a)){e.isIE&&3===this._lastMouseButton&&this._updateDOMSelection();var b=!1;this.isListening("ContextMenu")?(b=this._createMouseEvent("ContextMenu",a),b.screenX=a.screenX,b.screenY=a.screenY,this.onContextMenu(b),b=b.defaultPrevented):e.isMac&&(e.isFirefox&&0===a.button)&&(b=!0);if(b)return a.preventDefault&&a.preventDefault(),!1;this._contextMenuOpen=!0;e.isFirefox&&(this._checkSelectionChange=!0,this._pollSelectionChange(!0))}},_handleCopy:function(a){this._cancelCheckSelection();
if(!this._ignoreEvent(a)&&!this._ignoreCopy&&this._doCopy(a))return a.preventDefault&&a.preventDefault(),!1},_handleCut:function(a){this._cancelCheckSelection();if(!this._ignoreEvent(a)&&this._doCut(a))return a.preventDefault&&a.preventDefault(),!1},_handleDataModified:function(a){this._ignoreEvent(a)||this._startIME()},_handleDblclick:function(a){this._ignoreEvent(a)||(this._lastMouseTime=a.timeStamp?a.timeStamp:(new Date).getTime(),2!==this._clickCount&&(this._clickCount=2,this._handleMouse(a)))},
_handleDragStart:function(a){if(!this._ignoreEvent(a)){if(13>e.isFirefox){var b=this;this._getWindow().setTimeout(function(){b._clientDiv.contentEditable=!0;b._clientDiv.draggable=!1;b._ignoreBlur=!1},0)}if(this.isListening("DragStart")&&-1!==this._dragOffset)this._isMouseDown=!1,this.onDragStart(this._createMouseEvent("DragStart",a)),this._dragOffset=-1;else return a.preventDefault&&a.preventDefault(),!1}},_handleDrag:function(a){if(!this._ignoreEvent(a)&&this.isListening("Drag"))this.onDrag(this._createMouseEvent("Drag",
a))},_handleDragEnd:function(a){if(!this._ignoreEvent(a)){this._dropTarget=!1;this._dragOffset=-1;if(this.isListening("DragEnd"))this.onDragEnd(this._createMouseEvent("DragEnd",a));13>e.isFirefox&&(this._fixCaret(),"none"===a.dataTransfer.dropEffect&&!a.dataTransfer.mozUserCancelled&&this._fixCaret())}},_handleDragEnter:function(a){if(!this._ignoreEvent(a)){var b=!0;this._dropTarget=!0;this.isListening("DragEnter")&&(b=!1,this.onDragEnter(this._createMouseEvent("DragEnter",a)));if(e.isWebkit||b)return a.preventDefault&&
a.preventDefault(),!1}},_handleDragOver:function(a){if(!this._ignoreEvent(a)){var b=!0;this.isListening("DragOver")&&(b=!1,this.onDragOver(this._createMouseEvent("DragOver",a)));if(e.isWebkit||b)return b&&(a.dataTransfer.dropEffect="none"),a.preventDefault&&a.preventDefault(),!1}},_handleDragLeave:function(a){if(!this._ignoreEvent(a)&&(this._dropTarget=!1,this.isListening("DragLeave")))this.onDragLeave(this._createMouseEvent("DragLeave",a))},_handleDrop:function(a){if(!this._ignoreEvent(a)){this._dropTarget=
!1;if(this.isListening("Drop"))this.onDrop(this._createMouseEvent("Drop",a));a.preventDefault&&a.preventDefault();return!1}},_handleFocus:function(){this._hasFocus=!0;e.isIOS&&void 0!==this._lastTouchOffset?(this.setCaretOffset(this._lastTouchOffset,!0),this._lastTouchOffset=void 0):this._updateDOMSelection();this._cursorDiv&&(this._cursorDiv.style.display="block");this._domSelection&&this._domSelection.forEach(function(a){a.update()});if(!this._ignoreFocus)this.onFocus({type:"Focus"})},_handleKeyDown:function(a){this._cancelCheckSelection();
if(!this._ignoreEvent(a)){if(this.isListening("KeyDown")){var b=this._createKeyEvent("KeyDown",a);this.onKeyDown(b);if(b.defaultPrevented){e.isFirefox&&(this._keyDownPrevented=!0);a.preventDefault();return}}b=!1;switch(a.keyCode){case 16:case 17:case 18:case 91:b=!0;break;default:this._setLinksVisible(!1)}if(229===a.keyCode){if(this._readonly)return a.preventDefault&&a.preventDefault(),!1;b=!0;e.isSafari&&e.isMac&&a.ctrlKey&&(b=!1,a.keyCode=129);b&&this._startIME()}else b||this._commitIME();if((e.isMac||
e.isLinux)&&4>e.isFirefox||12.16>e.isOpera)return this._keyDownEvent=a,!0;if(this._doAction(a))return a.preventDefault?(a.preventDefault(),a.stopPropagation()):(a.cancelBubble=!0,a.returnValue=!1,a.keyCode=0),!1}},_handleKeyPress:function(a){if(!this._ignoreEvent(a))if(this._keyDownPrevented)a.preventDefault&&(a.preventDefault(),a.stopPropagation()),this._keyDownPrevented=void 0;else{if(e.isMac&&e.isWebkit&&(63232<=a.keyCode&&63487>=a.keyCode||13===a.keyCode||8===a.keyCode)||((e.isMac||e.isLinux)&&
4>e.isFirefox||12.16>e.isOpera)&&this._doAction(this._keyDownEvent))return a.preventDefault&&a.preventDefault(),!1;var b=e.isMac?a.metaKey:a.ctrlKey;if(void 0!==a.charCode&&b)switch(a.charCode){case 99:case 118:case 120:return!0}if(this.isListening("KeyPress")&&(b=this._createKeyEvent("KeyPress",a),this.onKeyPress(b),b.defaultPrevented)){a.preventDefault();return}if(this._doAction(a))return a.preventDefault?(a.preventDefault(),a.stopPropagation()):(a.cancelBubble=!0,a.returnValue=!1,a.keyCode=0),
!1;b=!1;if(e.isMac){if(a.ctrlKey||a.metaKey)b=!0}else if(e.isFirefox){if(a.ctrlKey||a.altKey)b=!0}else a.ctrlKey^a.altKey&&(b=!0);if(!b&&(b=e.isOpera?a.which:void 0!==a.charCode?a.charCode:a.keyCode,31<b))return this._doContent(String.fromCharCode(b)),a.preventDefault&&a.preventDefault(),!1}},_handleDocKeyUp:function(a){(e.isMac?a.metaKey:a.ctrlKey)||this._setLinksVisible(!1)},_handleKeyUp:function(a){if(!this._ignoreEvent(a)){if(this.isListening("KeyUp")){var b=this._createKeyEvent("KeyUp",a);this.onKeyUp(b);
if(b.defaultPrevented){a.preventDefault();return}}this._handleDocKeyUp(a);13===a.keyCode&&this._commitIME()}},_handleLinkClick:function(a){if(!(e.isMac?a.metaKey:a.ctrlKey))return a.preventDefault&&a.preventDefault(),!1},_handleMouse:function(a){var b=this._getWindow(),d=!0,c=b;if(e.isIE||e.isFirefox&&!this._overlayDiv)c=this._clientDiv;if(this._overlayDiv){this._hasFocus&&(this._ignoreFocus=!0);var k=this;b.setTimeout(function(){k.focus();k._ignoreFocus=!1},0)}var b=a.shiftKey,n=a.altKey,r=e.isMac?
a.metaKey:a.ctrlKey;this._blockSelection=this._doubleClickSelection=null;1===this._clickCount?(d=(!e.isOpera||12.16<=e.isOpera)&&this._hasFocus&&this.isListening("DragStart"),(d=this._setSelectionTo(a.clientX,a.clientY,!0,b,r,d))&&this._setGrab(c)):(this._isW3CEvents&&this._setGrab(c),this._setSelectionTo(a.clientX,a.clientY,!0,b,r,!1),this._doubleClickSelection=q.editing(this._getSelections()));n&&(this._blockSelection=q.editing(this._getSelections()));return d},_handleMouseDown:function(a){if(!this._ignoreEvent(a)){if(this._linksVisible)if("A"!==
(a.target||a.srcElement).tagName)this._setLinksVisible(!1);else return;this._commitIME();var b=a.which;b||(4===a.button&&(b=2),2===a.button&&(b=3),1===a.button&&(b=1));var d=2!==b&&a.timeStamp?a.timeStamp:(new Date).getTime(),c=d-this._lastMouseTime,k=Math.abs(this._lastMouseX-a.clientX),n=Math.abs(this._lastMouseY-a.clientY),r=this._lastMouseButton===b;this._lastMouseX=a.clientX;this._lastMouseY=a.clientY;this._lastMouseTime=d;this._lastMouseButton=b;1===b&&(this._isMouseDown=!0,r&&c<=this._clickTime&&
k<=this._clickDist&&n<=this._clickDist?this._clickCount++:this._clickCount=1);if(this.isListening("MouseDown")&&(d=this._createMouseEvent("MouseDown",a),this.onMouseDown(d),d.defaultPrevented)){a.preventDefault();return}if(1===b&&this._handleMouse(a)&&(9<=e.isIE||e.isOpera||e.isChrome||e.isSafari||e.isFirefox&&!this._overlayDiv))this._hasFocus||this.focus(),a.preventDefault();e.isFirefox&&3===this._lastMouseButton&&this._updateDOMSelection()}},_handleMouseOver:function(a){if(!this._ignoreEvent(a)&&
!this._animation&&this.isListening("MouseOver"))this.onMouseOver(this._createMouseEvent("MouseOver",a))},_handleMouseOut:function(a){if(!this._ignoreEvent(a)&&!this._animation&&this.isListening("MouseOut"))this.onMouseOut(this._createMouseEvent("MouseOut",a))},_handleMouseMove:function(a){if(!this._animation){var b=this._isClientDiv(a);if(this.isListening("MouseMove")&&(b||this._isMouseDown)){var d=this._createMouseEvent("MouseMove",a);this.onMouseMove(d);if(d.defaultPrevented){a.preventDefault();
return}}if(!this._dropTarget){d=this._linksVisible||this._lastMouseMoveX!==a.clientX||this._lastMouseMoveY!==a.clientY;this._lastMouseMoveX=a.clientX;this._lastMouseMoveY=a.clientY;this._setLinksVisible(d&&!this._isMouseDown&&a.altKey&&(e.isMac?a.metaKey:a.ctrlKey));this._checkOverlayScroll();if(!this._isW3CEvents){if(0===a.button)return this._setGrab(null),!0;if(!this._isMouseDown&&1===a.button&&0!==(this._clickCount&1)&&b)return this._clickCount=2,this._handleMouse(a,this._clickCount)}if(this._isMouseDown&&
-1===this._dragOffset){b=a.clientX;a=a.clientY;var c=this._getViewPadding(),k=this._viewDiv.getBoundingClientRect(),n=this._getClientWidth(),r=this._getClientHeight(),d=k.left+c.left,q=k.top+c.top,n=k.left+c.left+n,c=k.top+c.top+r;a<q?this._doAutoScroll("up",b,a-q):a>c?this._doAutoScroll("down",b,a-c):b<d&&!this._wrapMode?this._doAutoScroll("left",b-d,a):b>n&&!this._wrapMode?this._doAutoScroll("right",b-n,a):(this._endAutoScroll(),this._setSelectionTo(b,a,!1,!0))}}}},_isClientDiv:function(a){var b=
this._overlayDiv||this._clientDiv;for(a=a.target?a.target:a.srcElement;a;){if(b===a)return!0;a=a.parentNode}return!1},_createKeyEvent:function(a,b){return{type:a,event:b,preventDefault:function(){this.defaultPrevented=!0}}},_createMouseEvent:function(a,b){var d=this.convert({x:b.clientX,y:b.clientY},"page","document");return{type:a,event:b,clickCount:this._clickCount,x:d.x,y:d.y,preventDefault:function(){this.defaultPrevented=!0}}},_createTouchEvent:function(a,b){var d=b.touches.length?this.convert({x:b.touches[0].clientX,
y:b.touches[0].clientY},"page","document"):{};return{type:a,event:b,touchCount:b.touches.length,x:d.x,y:d.y,preventDefault:function(){this.defaultPrevented=!0}}},_handleMouseUp:function(a){var b=a.which?0===a.button:1===a.button;if(this.isListening("MouseUp")&&(this._isClientDiv(a)||b&&this._isMouseDown)){var d=this._createMouseEvent("MouseUp",a);this.onMouseUp(d);if(d.defaultPrevented){a.preventDefault();this._isMouseDown=!1;return}}if(!this._linksVisible){if(b&&this._isMouseDown){var d=this._getSelections(),
c=q.editing(d);d.forEach(function(a){a._editing=!1});-1!==this._dragOffset&&(c.extend(this._dragOffset),c.collapse(),d=c,this._dragOffset=-1);this._setSelection(d,!1);this._isMouseDown=!1;this._endAutoScroll();this._isW3CEvents&&this._setGrab(null)}b&&e.isFirefox&&(this._updateDOMSelection(),a.preventDefault())}},_handleMouseWheel:function(a){if(!this._noScroll){var b=this._getLineHeight(),d=0,c=0;e.isIE||e.isOpera?c=-a.wheelDelta/40*b:e.isFirefox?"wheel"===a.type?a.deltaMode?(d=Math.max(-256,Math.min(256,
a.deltaX))*b,c=Math.max(-256,Math.min(256,a.deltaY))*b):(d=a.deltaX,c=a.deltaY):(b=e.isMac?3*a.detail:Math.max(-256,Math.min(256,a.detail))*b,a.axis===a.HORIZONTAL_AXIS?d=b:c=b):e.isMac?(c=a.timeStamp-this._wheelTimeStamp,this._wheelTimeStamp=a.timeStamp,d=0!==a.wheelDeltaX%120?1:40>c?40/(40-c):40,c=0!==a.wheelDeltaY%120?1:40>c?40/(40-c):40,d=Math.ceil(-a.wheelDeltaX/d),-1<d&&0>d&&(d=-1),0<d&&1>d&&(d=1),c=Math.ceil(-a.wheelDeltaY/c),-1<c&&0>c&&(c=-1),0<c&&1>c&&(c=1)):(d=-a.wheelDeltaX,c=8*(-a.wheelDeltaY/
120)*b);if(e.isSafari||e.isChrome&&e.isMac){for(b=a.target;b&&void 0===b.lineIndex;)b=b.parentNode;this._mouseWheelLine=b}b=this._getScroll();this._scrollView(d,c);d=this._getScroll();if(b.x!==d.x||b.y!==d.y)return a.preventDefault&&a.preventDefault(),!1}},_handlePaste:function(a){this._cancelCheckSelection();if(!this._ignoreEvent(a)&&!this._ignorePaste&&this._doPaste(a)){if(e.isIE){var b=this;this._ignoreFocus=!0;this._getWindow().setTimeout(function(){b._updateDOMSelection();b._ignoreFocus=!1},
0)}a.preventDefault&&a.preventDefault();return!1}},_handleResize:function(){var a=this._rootDiv.clientWidth,b=this._rootDiv.clientHeight;if(this._rootWidth!==a||this._rootHeight!==b)this._rootWidth!==a&&this._wrapMode&&this._resetLineHeight(),this._rootWidth=a,this._rootHeight=b,a=9>e.isIE,b=this._calculateMetrics(),k(b,this._metrics)||(this._variableLineHeight&&(this._variableLineHeight=!1,this._resetLineHeight()),this._metrics=b,a=!0),a?this._queueUpdate():this._update(),this.dispatchEvent({type:"Resize"})},
_handleRulerEvent:function(a){for(var b=a.target?a.target:a.srcElement,d=b.lineIndex;b&&!b._ruler;)void 0===d&&void 0!==b.lineIndex&&(d=b.lineIndex),b=b.parentNode;var c=b?b._ruler:null;if(void 0===d&&c&&"document"===c.getOverview()){var k=this._getClientHeight(),e=this._model.getLineCount(),n=this._getViewPadding(),d=this._viewDiv.getBoundingClientRect(),r=this._getLineHeight(),k=k+n.top+n.bottom-2*this._metrics.scrollWidth;r*e<k?n=n.top:(r=k/e,n=this._metrics.scrollWidth);d=Math.floor((a.clientY-
d.top-n)/r);0<=d&&d<e||(d=void 0)}if(c)switch(a.type){case "click":if(c.onClick)c.onClick(d,a);break;case "dblclick":if(c.onDblClick)c.onDblClick(d,a);break;case "mousemove":if(c.onMouseMove)c.onMouseMove(d,a);break;case "mouseover":if(c.onMouseOver)c.onMouseOver(d,a);break;case "mouseout":if(c.onMouseOut){for(e=a.relatedTarget;e&&e!==this._rootDiv;){if(e===b)return;e=e.parentNode}c.onMouseOut(d,a)}}},_handleScroll:function(){this._lastScrollTime=(new Date).getTime();var a=this._getScroll(!1),b=this._hScroll,
d=this._vScroll;if(b!==a.x||d!==a.y)this._hScroll=a.x,this._vScroll=a.y,this._commitIME(),this._update(d===a.y),this.onScroll({type:"Scroll",oldValue:{x:b,y:d},newValue:a})},_handleSelectStart:function(a){var b=this._contextMenuOpen;this._contextMenuOpen=!1;if(b)this._checkSelectionChange=!0;else if(this._ignoreSelect)return a&&a.preventDefault&&a.preventDefault(),!1},_getModelOffset:function(a,b){if(a){var d;d="DIV"===a.tagName?a:a.parentNode.parentNode;return!d._line?0:d._line.getModelOffset(a,
b)}},_updateSelectionFromDOM:function(){if(!e.isIOS&&!e.isAndroid&&!this._checkSelectionChange)return!1;var a=this._getWindow().getSelection(),b=this._getModelOffset(a.anchorNode,a.anchorOffset),d=this._getModelOffset(a.focusNode,a.focusOffset),c=this._getSelections()[0];if(void 0===b||void 0===d||c.start===b&&c.end===d)return!1;if(this._checkSelectionChange){var c=this._getLineNext(),k=this._getLinePrevious();if(a.anchorNode===c.firstChild.firstChild&&0===a.anchorOffset&&a.focusNode===k.firstChild.firstChild&&
0===a.focusOffset)return!1;if(a.anchorNode===c.firstChild.firstChild&&0===a.anchorOffset&&a.focusNode===k.lastChild.firstChild||a.anchorNode===this._clientDiv&&a.focusNode===this._clientDiv)b=0,d=this.getModel().getCharCount()}this._setSelection(new q(b,d),!1,!1);this._checkSelectionChange=!1;return!0},_cancelCheckSelection:function(){this._checkSelectionChange&&(this._checkSelectionChange=!1,this._cancelPollSelectionChange())},_cancelPollSelectionChange:function(){this._selPollTimer&&(this._getWindow().clearTimeout(this._selPollTimer),
this._selPollTimer=null)},_pollSelectionChange:function(a){var b=this,d=this._getWindow();this._cancelPollSelectionChange();this._selPollTimer=d.setTimeout(function(){b._selPollTimer=null;b._clientDiv&&!b._updateSelectionFromDOM()&&a&&b._pollSelectionChange(a)},100)},_handleSelectionChange:function(){-1===this._imeOffset&&(e.isAndroid?this._pollSelectionChange():this._updateSelectionFromDOM())},_handleTextInput:function(a){if(!this._ignoreEvent(a)){this._imeOffset=-1;var b=this._getWindow().getSelection();
if(b.anchorNode!==this._anchorNode||b.focusNode!==this._focusNode||b.anchorOffset!==this._anchorOffset||b.focusOffset!==this._focusOffset){for(var d=b.anchorNode;d&&void 0===d.lineIndex;)d=d.parentNode;if(d){var c=this._model,k=d.lineIndex,n=c.getLine(k),r=n,q=0,c=c.getLineStart(k);0<b.rangeCount&&(b.getRangeAt(0).deleteContents(),k=d.ownerDocument.createTextNode(a.data),b.getRangeAt(0).insertNode(k),q=this._getDOMText(d,k),r=q.text,q=q.offset,k.parentNode.removeChild(k));d.lineRemoved=!0;for(d=0;n.charCodeAt(d)===
r.charCodeAt(d)&&d<q;)d++;b=n.length-1;for(k=r.length-n.length;n.charCodeAt(b)===r.charCodeAt(b+k)&&b+k>=q+a.data.length;)b--;b++;n=r.substring(d,b+k);d+=c;b+=c;r=this._getSelections();q=r[0].start-d;c=r[0].end-b;r[0].start=d;r[0].end=b;for(d=1;d<r.length;d++)r[d].start-=q,r[d].end-=c;this._ignoreQueueUpdate=e.isSafari;this._modifyContent({text:n,selection:r,_ignoreDOMSelection:!0},!0);this._ignoreQueueUpdate=!1}}else this._doContent(a.data);a.preventDefault()}},_handleTouchStart:function(a){if(this.isListening("TouchStart")){var b=
this._createTouchEvent("TouchStart",a);this.onTouchStart(b);if(b.defaultPrevented){a.preventDefault();return}if(this._noScroll)return}this._commitIME();b=this._getWindow();this._touchScrollTimer&&(this._vScrollDiv.style.display="none",this._hScrollDiv.style.display="none",b.clearInterval(this._touchScrollTimer),this._touchScrollTimer=null);var d=a.touches;if(1===d.length){var d=d[0],c=d.clientX,k=d.clientY;this._touchStartX=c;this._touchStartY=k;if(e.isAndroid&&(k<d.pageY-b.pageYOffset||c<d.pageX-
b.pageXOffset))c=d.pageX-b.pageXOffset,k=d.pageY-b.pageYOffset;b=this.convert({x:c,y:k},"page","document");this._lastTouchOffset=this.getOffsetAtLocation(b.x,b.y);this._touchStartTime=a.timeStamp;this._touching=!0}},_handleTouchMove:function(a){if(this.isListening("TouchMove")){var b=this._createTouchEvent("TouchMove",a);this.onTouchMove(b);if(b.defaultPrevented){a.preventDefault();return}if(this._noScroll)return}b=a.touches;if(1===b.length){b=b[0];this._touchCurrentX=b.clientX;this._touchCurrentY=
b.clientY;if(!this._touchScrollTimer&&200>a.timeStamp-this._touchStartTime){this._vScrollDiv.style.display="block";this._wrapMode||(this._hScrollDiv.style.display="block");var d=this,c=this._getWindow();this._touchScrollTimer=c.setInterval(function(){var a=0,b=0;if(d._touching)a=d._touchStartX-d._touchCurrentX,b=d._touchStartY-d._touchCurrentY,d._touchSpeedX=a/10,d._touchSpeedY=b/10,d._touchStartX=d._touchCurrentX,d._touchStartY=d._touchCurrentY;else{if(0.1>Math.abs(d._touchSpeedX)&&0.1>Math.abs(d._touchSpeedY)){d._vScrollDiv.style.display=
"none";d._hScrollDiv.style.display="none";c.clearInterval(d._touchScrollTimer);d._touchScrollTimer=null;return}a=10*d._touchSpeedX;b=10*d._touchSpeedY;d._touchSpeedX*=0.95;d._touchSpeedY*=0.95}d._scrollView(a,b)},10)}this._touchScrollTimer&&a.preventDefault()}},_handleTouchEnd:function(a){if(this.isListening("TouchEnd")){var b=this._createTouchEvent("TouchEnd",a);this.onTouchEnd(b);if(b.defaultPrevented){a.preventDefault();return}if(this._noScroll)return}0===a.touches.length&&(this._touching=!1)},
_doAction:function(a){var b,d,c=this._keyModes;for(d=c.length-1;0<=d;d--)if(b=c[d],"function"===typeof b.match&&(b=b.match(a),void 0!==b))return this.invokeAction(b);return!1},_doMove:function(a,b){var d=this._model,c=b.getCaret(),k=d.getLineAtOffset(c);a.count||(a.count=1);for(;0!==a.count;){var e=d.getLineStart(k);if(0>a.count&&c===e)if(0<k)"character"===a.unit&&a.count++,k--,b.extend(d.getLineEnd(k));else break;else if(0<a.count&&c===d.getLineEnd(k))if(k+1<d.getLineCount())"character"===a.unit&&
a.count--,k++,b.extend(d.getLineStart(k));else break;else{var n=!1;a.expandTab&&("character"===a.unit&&0===(c-e)%this._tabSize)&&(e=d.getText(e,c),n=!/[^ ]/.test(e));n?(b.extend(c-this._tabSize),a.count+=0>a.count?1:-1):(e=this._getLine(k),b.extend(e.getNextOffset(c,a)),e.destroy())}c=b.getCaret()}return b},_doBackspace:function(a){var b=this,d=this._getSelections();d.forEach(function(d){d.isEmpty()&&(a.count||(a.count=1),a.count*=-1,a.expandTab=b._expandTab,b._doMove(a,d))});this._modifyContent({text:"",
selection:d},!0);return!0},_doCase:function(a){var b=this,d=this._getSelections(),c=[];d.forEach(function(d){b._doMove(a,d);d=b.getText(d.start,d.end);switch(a.type){case "lower":d=d.toLowerCase();break;case "capitalize":d=d.replace(/(?:^|\s)\S/g,function(a){return a.toUpperCase()});break;case "reverse":for(var k="",e=0;e<d.length;e++)var n=d[e],r=n.toLowerCase(),n=r!==n?r:n.toUpperCase(),k=k+n;d=k;break;default:d=d.toUpperCase()}c.push(d)});return this._modifyContent({text:c,selection:d,_ignoreDOMSelection:!0},
!0)},_doContent:function(a){var b=this,d=this._getSelections();d.forEach(function(a){if(b._overwriteMode&&a.isEmpty()){var d=b._model,c=d.getLineAtOffset(a.end);a.end<d.getLineEnd(c)&&(d=b._getLine(c),a.extend(d.getNextOffset(a.getCaret(),{unit:"character",count:1})),d.destroy())}});return this._modifyContent({text:a,selection:d,_ignoreDOMSelection:!0},!0)},_doCopy:function(a){var b=this.getSelectionText();return b?this._setClipboardText(b,a):!0},_doCursorNext:function(a){var b=this,d=this._getSelections();
d.forEach(function(d){!d.isEmpty()&&!a.select?d.start=d.end:b._doMove(a,d);a.select||d.collapse()});this._setSelection(d,!0);return!0},_doCursorPrevious:function(a){var b=this,d=this._getSelections();d.forEach(function(d){!d.isEmpty()&&!a.select?d.end=d.start:(a.count||(a.count=1),a.count*=-1,b._doMove(a,d));a.select||d.collapse()});this._setSelection(d,!0);return!0},_doCut:function(a){var b=this.getSelectionText();return b?(this._doContent(""),this._setClipboardText(b,a)):!0},_doDelete:function(a){var b=
this,d=this._getSelections();d.forEach(function(d){d.isEmpty()&&b._doMove(a,d)});this._modifyContent({text:"",selection:d},!0);return!0},_doEnd:function(a){var b=this._model,d=this,c=this._getSelections();c.forEach(function(c){if(a.ctrl)c.extend(b.getCharCount());else{var k=c.getCaret(),e=b.getLineAtOffset(k);if(d._wrapMode){var n=d._getLine(e),k=n.getLineIndex(k),k=k===n.getLineCount()-1?b.getLineEnd(e):n.getLineStart(k+1)-1;n.destroy()}else a.count&&0<a.count&&(e=Math.min(e+a.count-1,b.getLineCount()-
1)),k=b.getLineEnd(e);c.extend(k)}a.select||c.collapse()});this._setSelection(c,!0,!0,a.ctrl?function(){}:null);return!0},_doEnter:function(a){if(this._singleMode)return!0;var b=this._model,d=this._getSelections();this._doContent(b.getLineDelimiter());a&&a.noCursor&&(d.forEach(function(a){a.end=a.start}),this._setSelection(d,!0));return!0},_doEscape:function(){var a=this._getSelections();1<a.length&&this._setSelection(a[0],!0);return!0},_doHome:function(a){var b=this._model,d=this,c=this._getSelections();
c.forEach(function(c){if(a.ctrl)c.extend(0);else{var k=c.getCaret(),e=b.getLineAtOffset(k);d._wrapMode?(e=d._getLine(e),k=e.getLineIndex(k),k=e.getLineStart(k),e.destroy()):k=b.getLineStart(e);c.extend(k)}a.select||c.collapse()});this._setSelection(c,!0,!0,a.ctrl?function(){}:null);return!0},_doLineDown:function(a){var b=this._model,d=this,c=this._getSelections();c.forEach(function(c){var k=c.getCaret(),n=b.getLineAtOffset(k),r=d._getLine(n),q=c._columnX,f=1,u=!1;if(-1===q||a.wholeLine||a.select&&
e.isIE)q=a.wholeLine?b.getLineEnd(n+1):k,q=c._columnX=r.getBoundingClientRect(q).left;(k=r.getLineIndex(k))<r.getLineCount()-1?f=r.getClientRects(k+1).top+1:(k=b.getLineCount()-1,u=n===k,a.count&&0<a.count?n=Math.min(n+a.count,k):n++);k=!1;if(u){if(a.select||e.isMac||e.isLinux)c.extend(b.getCharCount()),k=!0}else r.lineIndex!==n&&(r.destroy(),r=d._getLine(n)),c.extend(r.getOffset(q,f)),k=!0;k&&(a.select||c.collapse());r.destroy()});d._setSelection(c,!0,!0,null,0,!1,!0);return!0},_doLineUp:function(a){var b=
this._model,d=this,c=this._getSelections();c.forEach(function(c){var k=c.getCaret(),n=b.getLineAtOffset(k),r=d._getLine(n),q=c._columnX,f=!1,u;if(-1===q||a.wholeLine||a.select&&e.isIE)q=a.wholeLine?b.getLineStart(n-1):k,q=c._columnX=r.getBoundingClientRect(q).left;0<(k=r.getLineIndex(k))?u=r.getClientRects(k-1).top+1:(f=0===n,f||(a.count&&0<a.count?n=Math.max(n-a.count,0):n--,u=d._getLineHeight(n)-1));k=!1;if(f){if(a.select||e.isMac||e.isLinux)c.extend(0),k=!0}else r.lineIndex!==n&&(r.destroy(),r=
d._getLine(n)),c.extend(r.getOffset(q,u)),k=!0;k&&(a.select||c.collapse());r.destroy()});d._setSelection(c,!0,!0,null,0,!1,!0);return!0},_doNoop:function(){return!0},_doPageDown:function(a){var b=this,d=this._model,c=this._getSelections(),k=d.getLineCount(),n=this._getScroll(),r=this._getClientHeight(),q=this._getLineHeight(),f=Math.floor(r/q),u,g,v;c.forEach(function(c){var l=c.getCaret(),h=d.getLineAtOffset(l);if(b._lineHeight){u=c._columnX;var w=b._getBoundsAtOffset(l);if(-1===u||a.select&&e.isIE)u=
c._columnX=w.left;l=b._getLineIndex(w.top+r);g=b._getLine(l);var h=b._getLinePixel(l),l=g.getOffset(u,w.top+r-h),H=g.getBoundingClientRect(l);g.destroy();c.extend(l);a.select||c.collapse();v=void 0!==v?Math.min(v,H.top+h-w.top):H.top+h-w.top}else if(h<k-1){w=Math.min(k-h-1,f);w=Math.max(1,w);u=c._columnX;if(-1===u||a.select&&e.isIE)g=b._getLine(h),u=c._columnX=g.getBoundingClientRect(l).left,g.destroy();g=b._getLine(h+w);c.extend(g.getOffset(u,0));g.destroy();a.select||c.collapse();c=k*q;l=n.y+w*
q;l+r>c&&(l=c-r);v=void 0!==v?Math.min(v,l-n.y):l-n.y}});this._setSelection(c,!0,!0,function(){},v,!1,!0);return!0},_doPageUp:function(a){var b=this,d=this._model,c=this._getSelections(),k=this._getScroll(),n=this._getClientHeight(),r=this._getLineHeight(),q=Math.floor(n/r),f,u,g;c.forEach(function(c){var v=c.getCaret(),l=d.getLineAtOffset(v);if(b._lineHeight){f=c._columnX;l=b._getBoundsAtOffset(v);if(-1===f||a.select&&e.isIE)f=c._columnX=l.left;v=b._getLineIndex(l.bottom-n);u=b._getLine(v);var h=
b._getLinePixel(v),v=u.getOffset(f,l.bottom-n-h),w=u.getBoundingClientRect(v);u.destroy();c.extend(v);a.select||c.collapse();g=void 0!==g?Math.max(g,w.top+h-l.top):w.top+h-l.top}else if(0<l){h=Math.max(1,Math.min(l,q));f=c._columnX;if(-1===f||a.select&&e.isIE)u=b._getLine(l),f=c._columnX=u.getBoundingClientRect(v).left,u.destroy();u=b._getLine(l-h);c.extend(u.getOffset(f,b._getLineHeight(l-h)-1));u.destroy();a.select||c.collapse();c=Math.max(0,k.y-h*r);g=void 0!==g?Math.max(g,c-k.y):c-k.y}});this._setSelection(c,
!0,!0,function(){},g,!1,!0);return!0},_doPaste:function(a){var b=this;return null!==this._getClipboardText(a,function(a){if(a.length){e.isLinux&&2===b._lastMouseButton&&(new Date).getTime()-b._lastMouseTime<=b._clickTime&&b._setSelectionTo(b._lastMouseX,b._lastMouseY,!0);var d=b._getSelections(),c=b._singleMode?"":b._model.getLineDelimiter();b._doContent(1<d.length&&d.length===a.length?a:a.join(c))}})},_doScroll:function(a){var b=a.type,d=this._model,c=d.getLineCount();a=this._getClientHeight();var k=
this._getLineHeight(),c=this._lineHeight?this._scrollHeight:c*k,n=this._getScroll().y,e;switch(b){case "textStart":e=0;break;case "textEnd":e=c-a;break;case "pageDown":e=n+a;break;case "pageUp":e=n-a;break;case "lineDown":e=n+k;break;case "lineUp":e=n-k;break;case "centerLine":b=this._getSelections()[0],e=d.getLineAtOffset(b.start),d=(d.getLineAtOffset(b.end)-e+1)*k,e=e*k-a/2+d/2}void 0!==e&&(e=Math.min(Math.max(0,e),c-a),this._scrollViewAnimated(0,e-n,function(){}));return!0},_doSelectAll:function(){this._setSelection(new q(0,
this._model.getCharCount()),!1);return!0},_doTab:function(){if(this._tabMode&&!this._readonly){var a="\t",b=this._getSelections();if(this._expandTab){var a=[],d=this._model,c=this._tabSize;b.forEach(function(b){b=b.getCaret();var k=d.getLineAtOffset(b),k=d.getLineStart(k);a.push(Array(c-(b-k)%c+1).join(" "))})}return this._modifyContent({text:a,selection:b,_ignoreDOMSelection:!0},!0)}},_doShiftTab:function(){if(this._tabMode&&!this._readonly)return!0},_doOverwriteMode:function(){if(!this._readonly)return this.setOptions({overwriteMode:!this.getOptions("overwriteMode")}),
!0},_doTabMode:function(){this._tabMode=!this._tabMode;return!0},_doWrapMode:function(){this.setOptions({wrapMode:!this.getOptions("wrapMode")});return!0},_autoScroll:function(){var a=this._model,b=this._getSelections(),d=q.editing(b,"down"===this._autoScrollDir),c=this.convert({x:this._autoScrollX,y:this._autoScrollY},"page","document"),k=d.getCaret(),n=a.getLineCount(),r=a.getLineAtOffset(k),f;if("up"===this._autoScrollDir||"down"===this._autoScrollDir)k=this._autoScrollY/this._getLineHeight(),
k=0>k?Math.floor(k):Math.ceil(k),f=Math.max(0,Math.min(n-1,r+k));else if("left"===this._autoScrollDir||"right"===this._autoScrollDir)f=this._getLineIndex(c.y),r=this._getLine(r),c.x+=r.getBoundingClientRect(k,!1).left,r.destroy();this._blockSelection?b=this._getBlockSelections(b,f,c):0===f&&(e.isMac||e.isLinux)?d.extend(0):f===n-1&&(e.isMac||e.isLinux)?d.extend(a.getCharCount()):(r=this._getLine(f),d.extend(r.getOffset(c.x,c.y-this._getLinePixel(f))),r.destroy());this._setSelection(b,!0)},_autoScrollTimer:function(){this._autoScroll();
var a=this;this._autoScrollTimerID=this._getWindow().setTimeout(function(){a._autoScrollTimer()},this._AUTO_SCROLL_RATE)},_calculateLineHeightTimer:function(a){if(this._lineHeight&&!this._calculateLHTimer){var b=this._model.getLineCount(),d=0;if(a){a=0;for(var c=(new Date).getTime(),k=0;d<b&&!(this._lineHeight[d]||(a++,k||(k=d),this._lineHeight[d]=this._calculateLineHeight(d)),d++,100<(new Date).getTime()-c););this.redrawRulers(0,b);this._queueUpdate()}a=this._getWindow();if(d!==b){var n=this;this._calculateLHTimer=
a.setTimeout(function(){n._calculateLHTimer=null;n._calculateLineHeightTimer(!0)},0)}else this._calculateLHTimer&&(a.clearTimeout(this._calculateLHTimer),this._calculateLHTimer=void 0)}},_calculateLineHeight:function(a){a=this._getLine(a);var b=a.getBoundingClientRect();a.destroy();return Math.max(1,b.bottom-b.top)},_calculateMetrics:function(){var a=this._clientDiv,b=a.ownerDocument,d=e.createElement(b,"div");d.style.lineHeight="normal";var c={type:"LineStyle",textView:this,0:0,lineText:this._model.getLine(0),
lineStart:0};this.onLineStyle(c);l(c.style,d);d.style.position="fixed";d.style.left="-1000px";var k=e.createElement(b,"span");k.appendChild(b.createTextNode(" "));d.appendChild(k);var q=e.createElement(b,"span");q.style.fontStyle="italic";q.appendChild(b.createTextNode(" "));d.appendChild(q);var f=e.createElement(b,"span");f.style.fontWeight="bold";f.appendChild(b.createTextNode(" "));d.appendChild(f);c=e.createElement(b,"span");c.style.fontWeight="bold";c.style.fontStyle="italic";c.appendChild(b.createTextNode(" "));
d.appendChild(c);a.appendChild(d);var u=d.getBoundingClientRect(),k=k.getBoundingClientRect(),q=q.getBoundingClientRect(),f=f.getBoundingClientRect(),c=c.getBoundingClientRect(),k=k.bottom-k.top,q=q.bottom-q.top,f=f.bottom-f.top,g=c.bottom-c.top,v=0,c=0>=u.bottom-u.top,u=Math.max(1,u.bottom-u.top);q>k&&(v=1);f>q&&(v=2);g>f&&(v=3);var h;0!==v&&(h={style:{}},0!==(v&1)&&(h.style.fontStyle="italic"),0!==(v&2)&&(h.style.fontWeight="bold"));k=n(d);a.removeChild(d);v=r(this._viewDiv);d=e.createElement(b,
"div");d.style.position="fixed";d.style.left="-1000px";d.style.paddingLeft=v.left+"px";d.style.paddingTop=v.top+"px";d.style.paddingRight=v.right+"px";d.style.paddingBottom=v.bottom+"px";d.style.width="100px";d.style.height="100px";v=e.createElement(b,"div");v.style.width="100%";v.style.height="100%";d.appendChild(v);a.appendChild(d);q=d.getBoundingClientRect();f=v.getBoundingClientRect();g=0;!this._singleMode&&!this._noScroll&&(d.style.overflow="hidden",v.style.height="200px",g=d.clientWidth,d.style.overflow=
"scroll",g-=d.clientWidth);a.removeChild(d);var v={left:f.left-q.left,top:f.top-q.top,right:q.right-f.right,bottom:q.bottom-f.bottom},w=0,B=f=0;if(!c){d=e.createElement(b,"div");d.style.position="fixed";d.style.left="-1000px";a.appendChild(d);d.innerHTML=Array(2).join("a");q=d.getBoundingClientRect();B=Math.ceil(q.right-q.left);if(this._wrapOffset||this._marginOffset)d.innerHTML=Array(this._wrapOffset+1+(e.isWebkit?0:1)).join(" "),q=d.getBoundingClientRect(),w=Math.ceil(q.right-q.left),d.innerHTML=
Array(this._marginOffset+1).join(" "),f=d.getBoundingClientRect(),f=Math.ceil(f.right-f.left);a.removeChild(d)}return{lineHeight:u,largestFontStyle:h,lineTrim:k,viewPadding:v,scrollWidth:g,wrapWidth:w,marginWidth:f,charWidth:B,invalid:c}},_cancelAnimation:function(){this._animation&&(this._animation.stop(),this._animation=null)},_clearSelection:function(a){var b=this._getSelections();b.forEach(function(b){"next"===a?b.start=b.end:b.end=b.start});this._setSelection(b,!0);return!0},_commitIME:function(a){if(-1!==
this._imeOffset){var b=this._model,d=b.getLineAtOffset(this._imeOffset),c=b.getLineStart(d),k=this._getLineNode(d);if(!a){this._scrollDiv.focus();this._clientDiv.focus();var n=this._getDOMText(k).text,b=b.getLine(d),c=this._imeOffset-c,b=c+n.length-b.length;c!==b&&(a=n.substring(c,b))}a&&(!this._doContent(a)&&!e.isWebkit)&&(k.lineRemoved=!0,this._queueUpdate());this._imeOffset=-1}},_createActions:function(){this.addKeyMode(new p.DefaultKeyMode(this));var b=this;this._actions={noop:{defaultHandler:function(){return b._doNoop()}},
lineUp:{defaultHandler:function(d){return b._doLineUp(a(d,{select:!1}))},actionDescription:{name:m.lineUp}},lineDown:{defaultHandler:function(d){return b._doLineDown(a(d,{select:!1}))},actionDescription:{name:m.lineDown}},lineStart:{defaultHandler:function(d){return b._doHome(a(d,{select:!1,ctrl:!1}))},actionDescription:{name:m.lineStart}},lineEnd:{defaultHandler:function(d){return b._doEnd(a(d,{select:!1,ctrl:!1}))},actionDescription:{name:m.lineEnd}},charPrevious:{defaultHandler:function(d){return b._doCursorPrevious(a(d,
{select:!1,unit:"character"}))},actionDescription:{name:m.charPrevious}},charNext:{defaultHandler:function(d){return b._doCursorNext(a(d,{select:!1,unit:"character"}))},actionDescription:{name:m.charNext}},pageUp:{defaultHandler:function(d){return b._doPageUp(a(d,{select:!1}))},actionDescription:{name:m.pageUp}},pageDown:{defaultHandler:function(d){return b._doPageDown(a(d,{select:!1}))},actionDescription:{name:m.pageDown}},scrollPageUp:{defaultHandler:function(d){return b._doScroll(a(d,{type:"pageUp"}))},
actionDescription:{name:m.scrollPageUp}},scrollPageDown:{defaultHandler:function(d){return b._doScroll(a(d,{type:"pageDown"}))},actionDescription:{name:m.scrollPageDown}},scrollLineUp:{defaultHandler:function(d){return b._doScroll(a(d,{type:"lineUp"}))},actionDescription:{name:m.scrollLineUp}},scrollLineDown:{defaultHandler:function(d){return b._doScroll(a(d,{type:"lineDown"}))},actionDescription:{name:m.scrollLineDown}},wordPrevious:{defaultHandler:function(d){return b._doCursorPrevious(a(d,{select:!1,
unit:"word"}))},actionDescription:{name:m.wordPrevious}},wordNext:{defaultHandler:function(d){return b._doCursorNext(a(d,{select:!1,unit:"word"}))},actionDescription:{name:m.wordNext}},textStart:{defaultHandler:function(d){return b._doHome(a(d,{select:!1,ctrl:!0}))},actionDescription:{name:m.textStart}},textEnd:{defaultHandler:function(d){return b._doEnd(a(d,{select:!1,ctrl:!0}))},actionDescription:{name:m.textEnd}},scrollTextStart:{defaultHandler:function(d){return b._doScroll(a(d,{type:"textStart"}))},
actionDescription:{name:m.scrollTextStart}},scrollTextEnd:{defaultHandler:function(d){return b._doScroll(a(d,{type:"textEnd"}))},actionDescription:{name:m.scrollTextEnd}},centerLine:{defaultHandler:function(d){return b._doScroll(a(d,{type:"centerLine"}))},actionDescription:{name:m.centerLine}},selectLineUp:{defaultHandler:function(d){return b._doLineUp(a(d,{select:!0}))},actionDescription:{name:m.selectLineUp}},selectLineDown:{defaultHandler:function(d){return b._doLineDown(a(d,{select:!0}))},actionDescription:{name:m.selectLineDown}},
selectWholeLineUp:{defaultHandler:function(d){return b._doLineUp(a(d,{select:!0,wholeLine:!0}))},actionDescription:{name:m.selectWholeLineUp}},selectWholeLineDown:{defaultHandler:function(d){return b._doLineDown(a(d,{select:!0,wholeLine:!0}))},actionDescription:{name:m.selectWholeLineDown}},selectLineStart:{defaultHandler:function(d){return b._doHome(a(d,{select:!0,ctrl:!1}))},actionDescription:{name:m.selectLineStart}},selectLineEnd:{defaultHandler:function(d){return b._doEnd(a(d,{select:!0,ctrl:!1}))},
actionDescription:{name:m.selectLineEnd}},selectCharPrevious:{defaultHandler:function(d){return b._doCursorPrevious(a(d,{select:!0,unit:"character"}))},actionDescription:{name:m.selectCharPrevious}},selectCharNext:{defaultHandler:function(d){return b._doCursorNext(a(d,{select:!0,unit:"character"}))},actionDescription:{name:m.selectCharNext}},selectPageUp:{defaultHandler:function(d){return b._doPageUp(a(d,{select:!0}))},actionDescription:{name:m.selectPageUp}},selectPageDown:{defaultHandler:function(d){return b._doPageDown(a(d,
{select:!0}))},actionDescription:{name:m.selectPageDown}},selectWordPrevious:{defaultHandler:function(d){return b._doCursorPrevious(a(d,{select:!0,unit:"word"}))},actionDescription:{name:m.selectWordPrevious}},selectWordNext:{defaultHandler:function(d){return b._doCursorNext(a(d,{select:!0,unit:"word"}))},actionDescription:{name:m.selectWordNext}},selectTextStart:{defaultHandler:function(d){return b._doHome(a(d,{select:!0,ctrl:!0}))},actionDescription:{name:m.selectTextStart}},selectTextEnd:{defaultHandler:function(d){return b._doEnd(a(d,
{select:!0,ctrl:!0}))},actionDescription:{name:m.selectTextEnd}},deletePrevious:{defaultHandler:function(d){return b._doBackspace(a(d,{unit:"character"}))},actionDescription:{name:m.deletePrevious}},deleteNext:{defaultHandler:function(d){return b._doDelete(a(d,{unit:"character"}))},actionDescription:{name:m.deleteNext}},deleteWordPrevious:{defaultHandler:function(d){return b._doBackspace(a(d,{unit:"word"}))},actionDescription:{name:m.deleteWordPrevious}},deleteWordNext:{defaultHandler:function(d){return b._doDelete(a(d,
{unit:"word"}))},actionDescription:{name:m.deleteWordNext}},deleteLineStart:{defaultHandler:function(d){return b._doBackspace(a(d,{unit:"line"}))},actionDescription:{name:m.deleteLineStart}},deleteLineEnd:{defaultHandler:function(d){return b._doDelete(a(d,{unit:"line"}))},actionDescription:{name:m.deleteLineEnd}},tab:{defaultHandler:function(d){return b._doTab(a(d,{}))},actionDescription:{name:m.tab}},shiftTab:{defaultHandler:function(d){return b._doShiftTab(a(d,{}))},actionDescription:{name:m.shiftTab}},
enter:{defaultHandler:function(d){return b._doEnter(a(d,{}))},actionDescription:{name:m.enter}},enterNoCursor:{defaultHandler:function(d){return b._doEnter(a(d,{noCursor:!0}))},actionDescription:{name:m.enterNoCursor}},escape:{defaultHandler:function(d){return b._doEscape(a(d,{}))},actionDescription:{name:m.escape}},selectAll:{defaultHandler:function(d){return b._doSelectAll(a(d,{}))},actionDescription:{name:m.selectAll}},copy:{defaultHandler:function(d){return b._doCopy(a(d,{}))},actionDescription:{name:m.copy}},
cut:{defaultHandler:function(d){return b._doCut(a(d,{}))},actionDescription:{name:m.cut}},paste:{defaultHandler:function(d){return b._doPaste(a(d,{}))},actionDescription:{name:m.paste}},uppercase:{defaultHandler:function(d){return b._doCase(a(d,{type:"upper"}))},actionDescription:{name:m.uppercase}},lowercase:{defaultHandler:function(d){return b._doCase(a(d,{type:"lower"}))},actionDescription:{name:m.lowercase}},capitalize:{defaultHandler:function(d){return b._doCase(a(d,{unit:"word",type:"capitalize"}))},
actionDescription:{name:m.capitalize}},reversecase:{defaultHandler:function(d){return b._doCase(a(d,{type:"reverse"}))},actionDescription:{name:m.reversecase}},toggleOverwriteMode:{defaultHandler:function(d){return b._doOverwriteMode(a(d,{}))},actionDescription:{name:m.toggleOverwriteMode}},toggleTabMode:{defaultHandler:function(d){return b._doTabMode(a(d,{}))},actionDescription:{name:m.toggleTabMode}},toggleWrapMode:{defaultHandler:function(d){return b._doWrapMode(a(d,{}))},actionDescription:{name:m.toggleWrapMode}}}},
_createRulerParent:function(a,b){var d=e.createElement(a,"div");d.className=b;d.tabIndex=-1;d.style.overflow="hidden";d.style.MozUserSelect="none";d.style.WebkitUserSelect="none";d.style.position="absolute";d.style.top="0px";d.style.bottom="0px";d.style.cursor="default";d.style.display="none";d.setAttribute("aria-hidden","true");this._rootDiv.appendChild(d);return d},_createRuler:function(a,b){if(this._clientDiv){var d=this._getRulerParent(a);if(d){if(d!==this._marginDiv||this._marginOffset)d.style.display=
"block";d.rulerWidth=void 0;var c=e.createElement(d.ownerDocument,"div");c._ruler=a;a.node=c;c.rulerChanged=!0;c.style.position="relative";c.style.cssFloat="left";c.style.styleFloat="left";c.style.outline="none";if(void 0===b||0>b||b>=d.children.length)d.appendChild(c);else{for(var k=d.firstChild;k&&0<b--;)k=k.nextSibling;d.insertBefore(c,k)}}}},_createSelectionDiv:function(){var a=e.createElement(this._parent.ownerDocument,"div");a.className="textviewSelection";a.style.position="absolute";a.style.borderWidth=
"0px";a.style.margin="0px";a.style.padding="0px";a.style.outline="none";a.style.width="0px";a.style.height="0px";a.style.zIndex="0";return a},_createView:function(){function a(){n._rootDiv&&(n.update(!0),n._metrics.invalid&&n._getWindow().setTimeout(function(){a()},100))}if(!this._clientDiv){for(var b=this._parent;b.hasChildNodes();)b.removeChild(b.lastChild);var d=b.ownerDocument,c=e.createElement(d,"div");this._rootDiv=c;c.tabIndex=-1;c.style.position="relative";c.style.overflow="hidden";c.style.width=
"100%";c.style.height="100%";c.style.overflow="hidden";c.style.WebkitTextSizeAdjust="100%";c.setAttribute("role","application");b.appendChild(c);this._leftDiv=this._createRulerParent(d,"textviewLeftRuler");b=e.createElement(d,"div");b.className="textviewScroll";this._viewDiv=b;b.tabIndex=-1;b.style.position="absolute";b.style.top="0px";b.style.bottom="0px";b.style.borderWidth="0px";b.style.margin="0px";b.style.outline="none";b.style.background="transparent";c.appendChild(b);var k=this._createRulerParent(d,
"textviewRightRuler");this._rightDiv=k;k.style.right="0px";this._innerRightDiv=k=this._createRulerParent(d,"textviewInnerRightRuler");k.style.zIndex="1";this._scrollDiv=k=e.createElement(d,"div");k.style.margin="0px";k.style.borderWidth="0px";k.style.padding="0px";b.appendChild(k);(this._marginDiv=this._createRulerParent(d,"textviewMarginRuler")).style.zIndex="4";!e.isIE&&!e.isIOS&&(this._clipDiv=b=e.createElement(d,"div"),b.style.position="absolute",b.style.overflow="hidden",b.style.margin="0px",
b.style.borderWidth="0px",b.style.padding="0px",b.style.background="transparent",c.appendChild(b),this._clipScrollDiv=k=e.createElement(d,"div"),k.style.position="absolute",k.style.height="1px",k.style.top="-1000px",k.style.background="transparent",b.appendChild(k));b=e.createElement(d,"div");b.className="textviewContent";this._clientDiv=b;b.tabIndex=0;b.style.position="absolute";b.style.borderWidth="0px";b.style.margin="0px";b.style.padding="0px";b.style.outline="none";b.style.zIndex="1";b.style.WebkitUserSelect=
"text";b.setAttribute("spellcheck","false");if(e.isIOS||e.isAndroid)b.style.WebkitTapHighlightColor="transparent";(this._clipDiv||c).appendChild(b);this._setFullSelection(this._fullSelection,!0);if(e.isIOS||e.isAndroid)this._vScrollDiv=k=e.createElement(d,"div"),k.style.position="absolute",k.style.borderWidth="1px",k.style.borderColor="white",k.style.borderStyle="solid",k.style.borderRadius="4px",k.style.backgroundColor="black",k.style.opacity="0.5",k.style.margin="0px",k.style.padding="0px",k.style.outline=
"none",k.style.zIndex="3",k.style.width="8px",k.style.display="none",c.appendChild(k),this._hScrollDiv=k=e.createElement(d,"div"),k.style.position="absolute",k.style.borderWidth="1px",k.style.borderColor="white",k.style.borderStyle="solid",k.style.borderRadius="4px",k.style.backgroundColor="black",k.style.opacity="0.5",k.style.margin="0px",k.style.padding="0px",k.style.outline="none",k.style.zIndex="3",k.style.height="8px",k.style.display="none",c.appendChild(k);e.isFirefox&&!b.setCapture&&(this._overlayDiv=
k=e.createElement(d,"div"),k.style.position=b.style.position,k.style.borderWidth=b.style.borderWidth,k.style.margin=b.style.margin,k.style.padding=b.style.padding,k.style.cursor="text",k.style.zIndex="2",(this._clipDiv||c).appendChild(k));b.contentEditable="true";b.setAttribute("role","textbox");b.setAttribute("aria-multiline","true");this._setWrapMode(this._wrapMode,!0);this._setReadOnly(this._readonly);this._setThemeClass(this._themeClass,!0);this._setTabSize(this._tabSize,!0);this._setMarginOffset(this._marginOffset,
!0);this._hookEvents();b=this._rulers;for(k=0;k<b.length;k++)this._createRuler(b[k]);this._update();var n=this;u(d,c,"textview",a)}},_defaultOptions:function(){return{parent:{value:void 0,update:null},model:{value:void 0,update:this.setModel},scrollAnimation:{value:0,update:null},readonly:{value:!1,update:this._setReadOnly},fullSelection:{value:!0,update:this._setFullSelection},tabMode:{value:!0,update:null},tabSize:{value:8,update:this._setTabSize},expandTab:{value:!1,update:null},singleMode:{value:!1,
update:this._setSingleMode},noScroll:{value:!1,update:this._setNoScroll},overwriteMode:{value:!1,update:this._setOverwriteMode},blockCursorVisible:{value:!1,update:this._setBlockCursor},marginOffset:{value:0,update:this._setMarginOffset},wrapOffset:{value:0,update:this._setWrapOffset},wrapMode:{value:!1,update:this._setWrapMode},wrappable:{value:!1,update:null},undoStack:{value:null,update:this._setUndoStack},theme:{value:c.TextTheme.getTheme(),update:this._setTheme},themeClass:{value:void 0,update:this._setThemeClass}}},
_destroyRuler:function(a){var b=this._getRulerParent(a);if(b)for(var d=b.firstChild;d;){if(d._ruler===a){d._ruler=void 0;b.removeChild(d);if(0===b.children.length&&(b!==this._marginDiv||!this._marginOffset))b.style.display="none";b.rulerWidth=void 0;break}d=d.nextSibling}},_destroyView:function(){if(this._clientDiv){this._setGrab(null);this._unhookEvents();var a=this._getWindow();this._autoScrollTimerID&&(a.clearTimeout(this._autoScrollTimerID),this._autoScrollTimerID=null);this._updateTimer&&(a.clearTimeout(this._updateTimer),
this._updateTimer=null);this._calculateLHTimer&&(a.clearTimeout(this._calculateLHTimer),this._calculateLHTimer=null);this._cursorTimer&&(a.clearInterval(this._cursorTimer),this._cursorTimer=null);a=this._rootDiv;a.parentNode.removeChild(a);this._hScrollDiv=this._vScrollDiv=this._cursorDiv=this._marginDiv=this._innerRightDiv=this._rightDiv=this._leftDiv=this._overlayDiv=this._clientDiv=this._clipScrollDiv=this._clipDiv=this._viewDiv=this._scrollDiv=this._rootDiv=this._clipboardDiv=this._domSelection=
null}},_doAutoScroll:function(a,b,d){this._autoScrollDir=a;this._autoScrollX=b;this._autoScrollY=d;this._autoScrollTimerID||this._autoScrollTimer()},_endAutoScroll:function(){this._autoScrollTimerID&&this._getWindow().clearTimeout(this._autoScrollTimerID);this._autoScrollTimerID=this._autoScrollDir=void 0},_fixCaret:function(){var a=this._clientDiv;if(a){var b=this._hasFocus;this._ignoreFocus=!0;b&&a.blur();a.contentEditable=!1;a.contentEditable=!0;b&&a.focus();this._ignoreFocus=!1}},_getBaseText:function(a,
b){var d=this._model;d.getBaseModel&&(a=d.mapOffset(a),b=d.mapOffset(b),d=d.getBaseModel());return d.getText(a,b)},_getBottomIndex:function(a){var b=this._bottomChild;if(a&&this._getClientHeight()>this._getLineHeight()){a=b.getBoundingClientRect();var d=this._clientDiv.getBoundingClientRect();a.bottom>d.bottom&&(b=this._getLinePrevious(b)||b)}return b.lineIndex},_getBlockSelections:function(a,b,d){var c=this._model;a=a.filter(function(a){return!a._editing});var k=c.getLineAtOffset(this._blockSelection.getAnchor()),
n;b>k?n=b:(n=k,k=b);for(b=k;b<=n;b++){var e=this._getLine(b),k=e.getOffset(d.x,1),r=e.getOffset(this._blockSelection._docX,1);e.destroy();k===r&&k===c.getLineEnd(b)||(e=k<r,k=new q(e?k:r,e?r:k,e),k._editing=!0,a.push(k))}return a},_getBoundsAtOffset:function(a){var b=this._getLine(this._model.getLineAtOffset(a));a=b.getBoundingClientRect(a);var d=this._getLinePixel(b.lineIndex);a.top+=d;a.bottom+=d;b.destroy();return a},_getClientHeight:function(){var a=this._getViewPadding();return Math.max(0,this._viewDiv.clientHeight-
a.top-a.bottom)},_getInnerRightWidth:function(){var a=this._innerRightDiv.rulerWidth;void 0===a&&(a=this._innerRightDiv.getBoundingClientRect(),this._innerRightDiv.rulerWidth=a=a.right-a.left);return a},_getClientWidth:function(){var a=this._getViewPadding(),b=this._getInnerRightWidth();return Math.max(0,this._viewDiv.clientWidth-a.left-a.right-b)},_getClipboardText:function(a,b){function c(a){var k=[];d(a,function(a){k.push(a)},null);b&&b(k);return k}var k=this._getWindow(),n=k.clipboardData;!n&&
a&&(n=a.clipboardData);if(n)return c(n.getData(e.isIE?"Text":"text/plain"));if(e.isFirefox){this._ignoreFocus=!0;var r=this._clipboardDiv,n=this._rootDiv.ownerDocument;r||(this._clipboardDiv=r=e.createElement(n,"div"),r.style.position="fixed",r.style.whiteSpace="pre",r.style.left="-1000px",this._rootDiv.appendChild(r));r.innerHTML="\x3cpre contenteditable\x3d''\x3e\x3c/pre\x3e";r.firstChild.focus();var q=this,f=function(){var a=q._getTextFromElement(r);r.innerHTML="";return c(a)},u=!1;this._ignorePaste=
!0;if(!e.isLinux||2!==this._lastMouseButton)try{u=n.execCommand("paste",!1,null)}catch(g){u=1<r.childNodes.length||r.firstChild&&0<r.firstChild.childNodes.length}this._ignorePaste=!1;if(!u){if(a)return k.setTimeout(function(){q.focus();f();q._ignoreFocus=!1},0),null;this.focus();this._ignoreFocus=!1;return""}this.focus();this._ignoreFocus=!1;return f()}return""},_getDOMText:function(a,b){return a._line.getText(b)},_getTextFromElement:function(a){var b=a.ownerDocument,d=b.defaultView;if(!d.getSelection)return a.innerText||
a.textContent;b=b.createRange();b.selectNode(a);a=d.getSelection();var d=[],c;for(c=0;c<a.rangeCount;c++)d.push(a.getRangeAt(c));this._ignoreSelect=!0;a.removeAllRanges();a.addRange(b);b=a.toString();a.removeAllRanges();for(c=0;c<d.length;c++)a.addRange(d[c]);this._ignoreSelect=!1;return b},_getViewPadding:function(){return this._metrics.viewPadding},_getLine:function(a){var b=this._getLineNode(a);return b&&!b.lineChanged&&!b.lineRemoved?b._line:new B(this,a)},_getLineHeight:function(a,b){if(void 0!==
a&&this._lineHeight){var d=this._lineHeight[a];if(d)return d;if(b||void 0===b)return this._lineHeight[a]=this._calculateLineHeight(a)}return this._metrics.lineHeight},_getLineNode:function(a){for(var b=this._clientDiv.firstChild;b;){if(a===b.lineIndex)return b;b=b.nextSibling}},_getLineNext:function(a){for(a=a?a.nextSibling:this._clientDiv.firstChild;a&&(-1===a.lineIndex||!a._line);)a=a.nextSibling;return a},_getLinePrevious:function(a){for(a=a?a.previousSibling:this._clientDiv.lastChild;a&&(-1===
a.lineIndex||!a._line);)a=a.previousSibling;return a},_getLinePixel:function(a){a=Math.min(Math.max(0,a),this._model.getLineCount());if(this._lineHeight){var b=this._getTopIndex(),d=-this._topIndexY+this._getScroll().y;if(a>b)for(;b<a;b++)d+=this._getLineHeight(b);else for(b-=1;b>=a;b--)d-=this._getLineHeight(b);return d}return this._getLineHeight()*a},_getLineIndex:function(a,b){var d,c=0,k=this._model.getLineCount();if(this._lineHeight){var c=this._getTopIndex(),n=-this._topIndexY+this._getScroll().y;
if(a!==n)if(a<n)for(;a<n&&0<c;)a+=this._getLineHeight(--c);else for(d=this._getLineHeight(c);a-d>=n&&c<k-1;)a-=d,d=this._getLineHeight(++c)}else d=this._getLineHeight(),c=Math.floor(a/d);return b&&(0===k||0>c||c>k-1)?-1:Math.max(0,Math.min(k-1,c))},_getRulerParent:function(a){switch(a.getLocation()){case "left":return this._leftDiv;case "right":return this._rightDiv;case "innerRight":return this._innerRightDiv;case "margin":return this._marginDiv}return null},_getScroll:function(a){(void 0===a||a)&&
this._cancelAnimation();a=this._viewDiv;return{x:a.scrollLeft,y:a.scrollTop}},_getSelection:function(){return(Array.isArray(this._selection)?this._selection[0]:this._selection).clone()},_getSelections:function(){return(Array.isArray(this._selection)?this._selection:[this._selection]).map(function(a){return a.clone()})},_getTopIndex:function(a){var b=this._topChild;if(a&&this._getClientHeight()>this._getLineHeight()){a=b.getBoundingClientRect();var d=this._getViewPadding(),c=this._viewDiv.getBoundingClientRect();
a.top<c.top+d.top&&(b=this._getLineNext(b)||b)}return b.lineIndex},_hookEvents:function(){var a=this;this._modelListener={onChanging:function(b){a._onModelChanging(b)},onChanged:function(b){a._onModelChanged(b)}};this._model.addEventListener("preChanging",this._modelListener.onChanging);this._model.addEventListener("postChanged",this._modelListener.onChanged);this._themeListener={onChanged:function(){a._setThemeClass(a._themeClass)}};this._theme.addEventListener("ThemeChanged",this._themeListener.onChanged);
var b=this._handlers=[],d=this._clientDiv,c=this._viewDiv,k=this._rootDiv,n=this._overlayDiv||d,r=d.ownerDocument,q=this._getWindow(),f=e.isIE?r:q;b.push({target:q,type:"resize",handler:function(b){return a._handleResize(b?b:q.event)}});b.push({target:d,type:"blur",handler:function(b){return a._handleBlur(b?b:q.event)}});b.push({target:d,type:"focus",handler:function(b){return a._handleFocus(b?b:q.event)}});b.push({target:c,type:"focus",handler:function(){d.focus()}});b.push({target:c,type:"scroll",
handler:function(b){return a._handleScroll(b?b:q.event)}});b.push({target:d,type:"textInput",handler:function(b){return a._handleTextInput(b?b:q.event)}});b.push({target:d,type:"keydown",handler:function(b){return a._handleKeyDown(b?b:q.event)}});b.push({target:d,type:"keypress",handler:function(b){return a._handleKeyPress(b?b:q.event)}});b.push({target:d,type:"keyup",handler:function(b){return a._handleKeyUp(b?b:q.event)}});e.isIE&&b.push({target:r,type:"keyup",handler:function(b){return a._handleDocKeyUp(b?
b:q.event)}});b.push({target:d,type:"contextmenu",handler:function(b){return a._handleContextMenu(b?b:q.event)}});b.push({target:d,type:"copy",handler:function(b){return a._handleCopy(b?b:q.event)}});b.push({target:d,type:"cut",handler:function(b){return a._handleCut(b?b:q.event)}});b.push({target:d,type:"paste",handler:function(b){return a._handlePaste(b?b:q.event)}});b.push({target:r,type:"selectionchange",handler:function(b){return a._handleSelectionChange(b?b:q.event)}});if(e.isIOS||e.isAndroid)b.push({target:d,
type:"touchstart",handler:function(b){return a._handleTouchStart(b?b:q.event)}}),b.push({target:d,type:"touchmove",handler:function(b){return a._handleTouchMove(b?b:q.event)}}),b.push({target:d,type:"touchend",handler:function(b){return a._handleTouchEnd(b?b:q.event)}});else{b.push({target:d,type:"selectstart",handler:function(b){return a._handleSelectStart(b?b:q.event)}});b.push({target:d,type:"mousedown",handler:function(b){return a._handleMouseDown(b?b:q.event)}});b.push({target:d,type:"mouseover",
handler:function(b){return a._handleMouseOver(b?b:q.event)}});b.push({target:d,type:"mouseout",handler:function(b){return a._handleMouseOut(b?b:q.event)}});b.push({target:f,type:"mouseup",handler:function(b){return a._handleMouseUp(b?b:q.event)}});b.push({target:f,type:"mousemove",handler:function(b){return a._handleMouseMove(b?b:q.event)}});b.push({target:k,type:"mousedown",handler:function(b){return a._handleRootMouseDown(b?b:q.event)}});b.push({target:k,type:"mouseup",handler:function(b){return a._handleRootMouseUp(b?
b:q.event)}});b.push({target:n,type:"dragstart",handler:function(b){return a._handleDragStart(b?b:q.event)}});b.push({target:n,type:"drag",handler:function(b){return a._handleDrag(b?b:q.event)}});b.push({target:n,type:"dragend",handler:function(b){return a._handleDragEnd(b?b:q.event)}});b.push({target:n,type:"dragenter",handler:function(b){return a._handleDragEnter(b?b:q.event)}});b.push({target:n,type:"dragover",handler:function(b){return a._handleDragOver(b?b:q.event)}});b.push({target:n,type:"dragleave",
handler:function(b){return a._handleDragLeave(b?b:q.event)}});b.push({target:n,type:"drop",handler:function(b){return a._handleDrop(b?b:q.event)}});b.push({target:this._clientDiv,type:26<e.isFirefox?"wheel":e.isFirefox?"DOMMouseScroll":"mousewheel",handler:function(b){return a._handleMouseWheel(b?b:q.event)}});this._clipDiv&&b.push({target:this._clipDiv,type:26<e.isFirefox?"wheel":e.isFirefox?"DOMMouseScroll":"mousewheel",handler:function(b){return a._handleMouseWheel(b?b:q.event)}});if(e.isFirefox&&
(!e.isWindows||15<=e.isFirefox))(c=q.MutationObserver||q.MozMutationObserver)?(this._mutationObserver=new c(function(b){a._handleDataModified(b)}),this._mutationObserver.observe(d,{subtree:!0,characterData:!0})):b.push({target:this._clientDiv,type:"DOMCharacterDataModified",handler:function(b){return a._handleDataModified(b?b:q.event)}});if(e.isFirefox&&(!e.isWindows||15<=e.isFirefox)||e.isIE)b.push({target:this._clientDiv,type:"compositionstart",handler:function(b){return a._handleCompositionStart(b?
b:q.event)}}),b.push({target:this._clientDiv,type:"compositionend",handler:function(b){return a._handleCompositionEnd(b?b:q.event)}});this._overlayDiv&&(b.push({target:this._overlayDiv,type:"mousedown",handler:function(b){return a._handleMouseDown(b?b:q.event)}}),b.push({target:this._overlayDiv,type:"mouseover",handler:function(b){return a._handleMouseOver(b?b:q.event)}}),b.push({target:this._overlayDiv,type:"mouseout",handler:function(b){return a._handleMouseOut(b?b:q.event)}}),b.push({target:this._overlayDiv,
type:"contextmenu",handler:function(b){return a._handleContextMenu(b?b:q.event)}}));this._isW3CEvents||b.push({target:this._clientDiv,type:"dblclick",handler:function(b){return a._handleDblclick(b?b:q.event)}})}this._hookRulerEvents(this._leftDiv,b);this._hookRulerEvents(this._rightDiv,b);this._hookRulerEvents(this._innerRightDiv,b);this._hookRulerEvents(this._marginDiv,b);for(c=0;c<b.length;c++)k=b[c],C(k.target,k.type,k.handler,k.capture)},_hookRulerEvents:function(a,b){if(a){var d=this,c=this._getWindow();
e.isIE&&b.push({target:a,type:"selectstart",handler:function(){return!1}});b.push({target:a,type:26<e.isFirefox?"wheel":e.isFirefox?"DOMMouseScroll":"mousewheel",handler:function(a){return d._handleMouseWheel(a?a:c.event)}});b.push({target:a,type:"click",handler:function(a){d._handleRulerEvent(a?a:c.event)}});b.push({target:a,type:"dblclick",handler:function(a){d._handleRulerEvent(a?a:c.event)}});b.push({target:a,type:"mousemove",handler:function(a){d._handleRulerEvent(a?a:c.event)}});b.push({target:a,
type:"mouseover",handler:function(a){d._handleRulerEvent(a?a:c.event)}});b.push({target:a,type:"mouseout",handler:function(a){d._handleRulerEvent(a?a:c.event)}})}},_getWindow:function(){return this._parent.ownerDocument.defaultView||this._parent.ownerDocument.parentWindow},_ignoreEvent:function(a){for(a=a.target;a&&a!==this._clientDiv;){if(a.ignore)return!0;a=a.parentNode}return!1},_init:function(a){var b=a.parent;"string"===typeof b&&(b=(a.document||document).getElementById(b));if(!b)throw Error("no parent");
a.parent=b;a.model=a.model||new s.TextModel;var d=this._defaultOptions(),c;for(c in d)d.hasOwnProperty(c)&&(this["_"+c]=void 0!==a[c]?a[c]:d[c].value);this._keyModes=[];this._rulers=[];this._selection=[new q(0,0,!1)];this._linksVisible=!1;this._maxLineWidth=this._redrawCount=0;this._maxLineIndex=-1;this._ignoreSelect=!0;this._hasFocus=this._ignoreFocus=!1;this._dragOffset=-1;this._isRangeRects=(!e.isIE||9<=e.isIE)&&"function"===typeof b.ownerDocument.createRange().getBoundingClientRect;this._isW3CEvents=
b.addEventListener;this._autoScrollTimerID=this._autoScrollY=this._autoScrollX=null;this._AUTO_SCROLL_RATE=50;this._mouseUpClosure=this._moseMoveClosure=this._grabControl=null;this._clickCount=this._lastMouseTime=this._lastMouseY=this._lastMouseX=0;this._clickTime=250;this._clickDist=5;this._isMouseDown=!1;this._doubleClickSelection=null;this._vScroll=this._hScroll=0;this._imeOffset=-1;this._createActions();this._createView()},_checkOverlayScroll:function(){if(e.isMac&&e.isWebkit&&!this._metrics.invalid&&
0===this._metrics.scrollWidth){var a=this._viewDiv,b=this._isOverOverlayScroll();a.style.pointerEvents=b.vertical||b.horizontal?"":"none"}},_isOverOverlayScroll:function(){if(!(200>(new Date).getTime()-this._lastScrollTime))return{};var a=this._viewDiv.getBoundingClientRect(),b=this._lastMouseMoveX,d=this._lastMouseMoveY;return{vertical:a.top<=d&&d<a.bottom&&a.right-15<=b&&b<a.right,horizontal:a.bottom-15<=d&&d<a.bottom&&a.left<=b&&b<a.right}},_startUndo:function(){if(this._undoStack){var a=this;
this._compoundChange=this._undoStack.startCompoundChange({end:function(){a._compoundChange=null}})}},_endUndo:function(){this._undoStack&&this._undoStack.endCompoundChange()},_modifyContent:function(a,b){if(this._readonly&&!a._code)return!1;a.type="Verify";var d=a.start=a.selection[0].start,c=a.end=a.selection[0].end;this.onVerify(a);d!==a.start&&(a.selection[0].start=a.start);c!==a.end&&(a.selection[0].end=a.end);if(null===a.text||void 0===a.text)return!1;1<a.selection.length&&this.setRedraw(!1);
(d=this._compoundChange)?q.compare(this._getSelections(),d.owner.selection)||(this._endUndo(),1<a.selection.length&&this._startUndo()):1<a.selection.length&&this._startUndo();var k=this._model;try{a._ignoreDOMSelection&&(this._ignoreDOMSelection=!0);var n=0,e=0;a.selection.forEach(function(d){d.start+=n;d.end+=n;var c=Array.isArray(a.text)?a.text[e]:a.text;k.setText(c,d.start,d.end);n+=d.start-d.end+c.length;d.setCaret(b?d.start+c.length:d.start);e++})}finally{a._ignoreDOMSelection&&(this._ignoreDOMSelection=
!1)}this._setSelection(a.selection,!0);if(d=this._compoundChange)d.owner.selection=a.selection;1<a.selection.length&&this.setRedraw(!0);this.onModify({type:"Modify"});return!0},_onModelChanged:function(a){a.type="ModelChanged";this.onModelChanged(a);a.type="Changed";var b=a.start,d=a.addedCharCount,c=a.removedCharCount,k=a.addedLineCount,n=a.removedLineCount,e=this._getSelections();e.forEach(function(a){a.end>b&&(a.end>b&&a.start<b+c?a.setCaret(b+d):(a.start+=d-c,a.end+=d-c))});this._setSelection(e,
!1,!1);for(var e=this._model.getLineAtOffset(b),q=this._getLineNext();q;){var r=q.lineIndex;e<=r&&r<=e+n&&(e===r&&!q.modelChangedEvent&&!q.lineRemoved?(q.modelChangedEvent=a,q.lineChanged=!0):(q.lineRemoved=!0,q.lineChanged=!1,q.modelChangedEvent=null));r>e+n&&(q.lineIndex=r+k-n,q._line.lineIndex=q.lineIndex);q=this._getLineNext(q)}this._lineHeight&&(a=[e,n].concat(Array(k)),Array.prototype.splice.apply(this._lineHeight,a));!this._wrapMode&&(e<=this._maxLineIndex&&this._maxLineIndex<=e+n)&&(this._checkMaxLineIndex=
this._maxLineIndex,this._maxLineIndex=-1,this._maxLineWidth=0);this._update()},_onModelChanging:function(a){a.type="ModelChanging";this.onModelChanging(a);a.type="Changing"},_queueUpdate:function(){if(!this._updateTimer&&!this._ignoreQueueUpdate){var a=this;this._updateTimer=this._getWindow().setTimeout(function(){a._updateTimer=null;a._update()},0)}},_rangesToSelections:function(a){var b=[],d=this._model.getCharCount();a.forEach(function(a){var c;if(a instanceof q)c=a.clone();else{c=a.start;a=a.end;
var k=c>a;if(k){var n=c;c=a;a=n}c=Math.max(0,Math.min(c,d));a=Math.max(0,Math.min(a,d));c=new q(c,a,k)}b.push(c)});return b},_resetLineHeight:function(a,b){if(this._wrapMode||this._variableLineHeight){if(void 0!==a&&void 0!==b)for(var d=a;d<b;d++)this._lineHeight[d]=void 0;else d=this._model.getLineCount(),this._lineHeight=Array(d);this._calculateLineHeightTimer()}else this._lineHeight=null},_resetLineWidth:function(){var a=this._clientDiv;if(a)for(a=a.firstChild;a;)a.lineWidth=void 0,a=a.nextSibling},
_reset:function(){this._maxLineIndex=-1;this._maxLineWidth=0;this._bottomChild=this._topChild=null;this._topIndexY=0;this._variableLineHeight=!1;this._resetLineHeight();this._setSelection(new q(0,0,!1),!1,!1);this._viewDiv&&(this._viewDiv.scrollLeft=0,this._viewDiv.scrollTop=0);var a=this._clientDiv;if(a){for(a=a.firstChild;a;)a.lineRemoved=!0,a=a.nextSibling;13>e.isFirefox&&this._fixCaret()}},_scrollViewAnimated:function(a,b,d){var c=this._getWindow();if(d&&this._scrollAnimation){var k=this;this._animation=
new E({window:c,duration:this._scrollAnimation,curve:[b,0],onAnimate:function(a){a=b-Math.floor(a);k._scrollView(0,a);b-=a},onEnd:function(){k._animation=null;k._scrollView(a,b);d&&c.setTimeout(d,0)}});this._animation.play()}else this._scrollView(a,b),d&&c.setTimeout(d,0)},_scrollView:function(a,b){this._ensureCaretVisible=!1;var d=this._viewDiv;a&&(d.scrollLeft+=a);b&&(d.scrollTop+=b)},_setClipboardText:function(a,b){var c,k=this._getWindow(),n=k.clipboardData;!n&&b&&(n=b.clipboardData);if(n&&(c=
[],d(a,function(a){c.push(a)},function(){c.push(e.platformDelimiter)}),n.setData(e.isIE?"Text":"text/plain",c.join(""))||21<e.isFirefox))return!0;var q=this._parent.ownerDocument,r=e.createElement(q,"pre");r.style.position="fixed";r.style.left="-1000px";d(a,function(a){r.appendChild(q.createTextNode(a))},function(){r.appendChild(e.createElement(q,"br"))});r.appendChild(q.createTextNode(" "));this._clientDiv.appendChild(r);n=q.createRange();n.setStart(r.firstChild,0);n.setEndBefore(r.lastChild);var f=
k.getSelection();0<f.rangeCount&&f.removeAllRanges();f.addRange(n);var u=this,n=function(){r&&r.parentNode===u._clientDiv&&u._clientDiv.removeChild(r);u._updateDOMSelection()},f=!1;this._ignoreCopy=!0;try{f=q.execCommand("copy",!1,null)}catch(g){}this._ignoreCopy=!1;if(!f&&b)return k.setTimeout(n,0),!1;n();return!0},_setGrab:function(a){a!==this._grabControl&&(a?(a.setCapture&&a.setCapture(),this._grabControl=a):(this._grabControl.releaseCapture&&this._grabControl.releaseCapture(),this._grabControl=
null))},_setLinksVisible:function(a){if(this._linksVisible!==a){this._linksVisible=a;e.isIE&&a&&(this._hadFocus=this._hasFocus);var b=this._clientDiv;b.contentEditable=!a;this._hadFocus&&!a&&b.focus();this._overlayDiv&&(this._overlayDiv.style.zIndex=a?"-1":"1");for(a=this._getLineNext();a;)a._line.updateLinks(),a=this._getLineNext(a);this._updateDOMSelection()}},_setSelection:function(a,b,d,c,k,n,e){if(a){void 0===d&&(d=!0);var r=this._getSelections();a=Array.isArray(a)?a:n?r.concat([a]):[a];this._selection=
q.merge(a);e||a.forEach(function(a){a._columnX=-1});!1!==b&&this._showCaret(!1,c,b,k);d&&this._updateDOMSelection();q.compare(r,a)||(b={type:"Selection",oldValue:q.convert(r),newValue:q.convert(a)},this.onSelection(b))}},_setSelectionTo:function(a,b,d,c,k,n){var e=this._model,r=this._getSelections(),f=this.convert({x:a,y:b},"page","document");b=this._getLineIndex(f.y);a=this._getLine(b);var u=a.getOffset(f.x,f.y-this._getLinePixel(b));if(n&&!c&&q.contains(r,u))return this._dragOffset=u,a.destroy(),
!1;this._blockSelection?r=this._getBlockSelections(r,b,f):(d?c?(d=r[r.length-1],d._editing=!0):(d=new q(0,0),d._editing=!0,k?r.push(d):r=[d],d._docX=f.x):d=q.editing(r),1===this._clickCount?(d.extend(u),c||d.collapse()):(0===(this._clickCount&1)?this._doubleClickSelection?u>=this._doubleClickSelection.start?(c=this._doubleClickSelection.start,e=a.getNextOffset(u,{unit:"wordend",count:1})):(c=a.getNextOffset(u,{unit:"word",count:-1}),e=this._doubleClickSelection.end):(c=a.getNextOffset(u,{unit:"word",
count:-1}),e=a.getNextOffset(c,{unit:"wordend",count:1})):this._doubleClickSelection?(k=e.getLineAtOffset(this._doubleClickSelection.start),b>=k?(c=e.getLineStart(k),e=e.getLineEnd(b)):(c=e.getLineStart(b),e=e.getLineEnd(k))):(c=e.getLineStart(b),e=e.getLineEnd(b)),d.setCaret(c),d.extend(e)));this._setSelection(r,!0,!0,null,!1);a.destroy();return!0},_setFullSelection:function(a,b){this._fullSelection=a;e.isWebkit&&(this._fullSelection=a=!0);if(!this._domSelection){this._domSelection=[];var d=this._getWindow(),
c=this;this._cursorVisible=!0;this._cursorTimer=d.setInterval(function(){c._cursorVisible=!c._cursorVisible;c._domSelection.forEach(function(a){a.update()})},500)}b||this._updateDOMSelection()},_setBlockCursor:function(a){this._blockCursorVisible=a;this._updateBlockCursorVisible()},_setOverwriteMode:function(a){this._overwriteMode=a;this._updateBlockCursorVisible()},_updateBlockCursorVisible:function(){if(this._blockCursorVisible||this._overwriteMode){if(!this._cursorDiv){var a=this._viewDiv,b=e.createElement(a.ownerDocument,
"div");b.className="textviewBlockCursor";this._cursorDiv=b;b.tabIndex=-1;b.style.zIndex="2";b.style.color="transparent";b.style.position="absolute";b.style.pointerEvents="none";b.innerHTML="\x26nbsp;";a.appendChild(b);this._updateDOMSelection()}}else this._cursorDiv&&(this._cursorDiv.parentNode.removeChild(this._cursorDiv),this._cursorDiv=null)},_setMarginOffset:function(a,b){this._marginOffset=a;this._marginDiv.style.display=a?"block":"none";b||(this._metrics=this._calculateMetrics(),this._queueUpdate())},
_setWrapOffset:function(a,b){this._wrapOffset=a;b||(this._metrics=this._calculateMetrics(),this._queueUpdate())},_setReadOnly:function(a){this._readonly=a;this._clientDiv.setAttribute("aria-readonly",a?"true":"false")},_setSingleMode:function(a,b){this._singleMode=a;this._updateOverflow();this._updateStyle(b)},_setNoScroll:function(a,b){this._noScroll=a;this._updateOverflow();this._updateStyle(b)},_setTabSize:function(a,b){this._tabSize=a;this._customTabSize=void 0;var d=this._clientDiv;e.isOpera?
d&&(d.style.OTabSize=this._tabSize+""):537.1<=e.isWebkit?d&&(d.style.tabSize=this._tabSize+""):4<=e.isFirefox?d&&(d.style.MozTabSize=this._tabSize+""):8!==this._tabSize&&(this._customTabSize=this._tabSize);b||(this.redrawLines(),this._resetLineWidth())},_setTheme:function(a){this._theme&&this._theme.removeEventListener("ThemeChanged",this._themeListener.onChanged);(this._theme=a)&&this._theme.addEventListener("ThemeChanged",this._themeListener.onChanged);this._setThemeClass(this._themeClass)},_setThemeClass:function(a,
b){this._themeClass=a;var d="textview",c=this._theme.getThemeClass();c&&(d+=" "+c);this._themeClass&&c!==this._themeClass&&(d+=" "+this._themeClass);this._rootDiv.className=d;this._updateStyle(b)},_setUndoStack:function(a){this._undoStack=a},_setWrapMode:function(a,b){this._wrapMode=a&&this._wrappable;var d=this._clientDiv;this._wrapMode?(d.style.whiteSpace="pre-wrap",d.style.wordWrap="break-word"):(d.style.whiteSpace="pre",d.style.wordWrap="normal");this._updateOverflow();b||(this.redraw(),this._resetLineWidth());
this._resetLineHeight()},_showCaret:function(a,b,d,c){if(this._clientDiv&&!(0<this._redrawCount)&&!this._ignoreDOMSelection){var k=this._model,n=this._getSelections(),e=q.editing(n,"down"===this._autoScrollDir),r=this._getScroll(),n=e.getCaret(),f=e.start,u=e.end,g=k.getLineAtOffset(f),v=k.getLineAtOffset(u),l=Math.max(Math.max(f,k.getLineStart(v)),u-1),k=this._getClientWidth(),h=this._getClientHeight(),w=k/4,I=this._getBoundsAtOffset(n===f?f:l),B=I.left,x=I.right,m=I.top,p=I.bottom,s=0,C="object"===
typeof d;if((a||C)&&!e.isEmpty())I=this._getBoundsAtOffset(n===u?f:l),s=(I.bottom>p?I.bottom:p)-(I.top<m?I.top:m),a&&(I.top===m?n===f?x=B+Math.min(I.right-B,k):B=x-Math.min(x-I.left,k):n===f?p=m+Math.min(I.bottom-m,h):m=p-Math.min(p-I.top,h));a=0;B<r.x&&(a=Math.min(B-r.x,-w));x>r.x+k&&(a=Math.max(x-r.x-k,w));e=0;m<r.y?e=m-r.y:p>r.y+h&&(e=p-r.y-h);c&&(0<c?0<e&&(e=Math.max(e,c)):0>e&&(e=Math.min(e,c)));c=C&&"always"===d.scrollPolicy;if(0!==a||0!==e||c)return C?(c=0<e,0===e&&(e=m-r.y),r=d.viewAnchor,
m=d.selectionAnchor,d=Math.min(Math.max(0,d.viewAnchorOffset||0)),e="top"===r?e+Math.floor(c?(1-d)*h:-d*h):"bottom"===r?e+Math.floor(c?d*h:-(1-d)*h):"center"===r?e+Math.floor(c?h/2+d*h:h/2-(1-d)*h):e+Math.floor(c?d*h:-d*h),g!==v&&("top"===m&&n!==f?e+=Math.floor(-s):"bottom"===m&&n!==u?e+=Math.floor(s):"center"===m&&(e+=Math.floor(s/2)))):0!==e&&"number"===typeof d&&(0>d&&(d=0),1<d&&(d=1),e+=Math.floor(0<e?d*h:-d*h)),this._scrollViewAnimated(a,e,b),h!==this._getClientHeight()||k!==this._getClientWidth()?
this._showCaret():this._ensureCaretVisible=!0,!0;b&&b();return!1}},_startIME:function(){if(-1===this._imeOffset){var a=this._getSelections();this._modifyContent({text:"",selection:a},!0);this._imeOffset=a[0].start}},_unhookEvents:function(){this._model.removeEventListener("preChanging",this._modelListener.onChanging);this._model.removeEventListener("postChanged",this._modelListener.onChanged);this._theme.removeEventListener("ThemeChanged",this._themeListener.onChanged);this._modelListener=null;for(var a=
0;a<this._handlers.length;a++){var b=this._handlers[a];z(b.target,b.type,b.handler)}this._handlers=null;this._mutationObserver&&this._mutationObserver.disconnect()},_updateDOMSelection:function(){if(!(0<this._redrawCount)&&!this._ignoreDOMSelection&&this._clientDiv){var a=this._getSelections(),b=this._domSelection,d;if(b.length<a.length)for(d=b.length;d<a.length;d++)b.push(new v(this));else b.length>a.length&&b.splice(a.length).forEach(function(a){a.destroy()});for(d=0;d<b.length;d++)b[d].setPrimary(0===
d),b[d].setSelection(a[d])}},_update:function(a){if(!(0<this._redrawCount)){this._updateTimer&&(this._getWindow().clearTimeout(this._updateTimer),this._updateTimer=null,a=!1);var b=this._clientDiv,d=this._viewDiv;if(b){this._metrics.invalid&&(this._ignoreQueueUpdate=!0,this._updateStyle(),this._ignoreQueueUpdate=!1);var c=this._model,k=this._getScroll(!1),n=this._getViewPadding(),r=c.getLineCount(),q=this._getLineHeight(),f=!1,u=!1,g=!1,v=this._metrics.scrollWidth;this._wrapMode&&(b.style.width=(this._metrics.wrapWidth||
this._getClientWidth())+"px");var l,h,w,I,x=0,m=0,p;if(this._lineHeight){for(;m<r;){p=this._getLineHeight(m);if(x+p>k.y)break;x+=p;m++}l=m;h=Math.max(0,l-1);w=c=k.y-x;0<l&&(c+=this._getLineHeight(l-1))}else I=Math.max(0,k.y)/q,l=Math.floor(I),h=Math.max(0,l-1),c=Math.round((I-h)*q),w=Math.round((I-l)*q);this._topIndexY=w;I=this._rootDiv;var s=I.clientWidth,C=I.clientHeight;if(a){q=0;this._leftDiv&&(l=this._leftDiv.getBoundingClientRect(),q=l.right-l.left);l=this._getClientWidth();I=this._getClientHeight();
u=l;this._wrapMode?this._metrics.wrapWidth&&(u=this._metrics.wrapWidth):u=Math.max(this._maxLineWidth,u);for(;m<r;)p=this._getLineHeight(m,!1),x+=p,m++;r=x}else{I=this._getClientHeight();w=Math.min(l+Math.floor((I+w)/q),r-1);var k=Math.min(w+1,r-1),z;for(p=b.firstChild;p;){z=p.lineIndex;var E=p.nextSibling;if(!(h<=z&&z<=k)||p.lineRemoved||-1===p.lineIndex)this._mouseWheelLine===p?(p.style.display="none",p.lineIndex=-1):b.removeChild(p);p=E}p=this._getLineNext();var E=d.ownerDocument,O=E.createDocumentFragment();
for(z=h;z<=k;z++)!p||p.lineIndex>z?(new B(this,z)).create(O,null):(O.firstChild&&(b.insertBefore(O,p),O=E.createDocumentFragment()),p&&p.lineChanged&&(p=(new B(this,z)).create(O,p),p.lineChanged=!1),p=this._getLineNext(p));O.firstChild&&b.insertBefore(O,p);e.isWebkit&&!this._wrapMode&&(b.style.width="0x7fffffffpx");p=this._getLineNext();z=I+c;for(O=!1;p;)h=p.lineWidth,void 0===h&&(E=p._line.getBoundingClientRect(),h=p.lineWidth=Math.ceil(E.right-E.left),E=E.bottom-E.top,this._lineHeight?this._lineHeight[p.lineIndex]=
E:0!==q&&(0!==E&&Math.ceil(q)!==Math.ceil(E))&&(this._variableLineHeight=!0,this._lineHeight=[],this._lineHeight[p.lineIndex]=E)),this._lineHeight&&!O&&(z-=this._lineHeight[p.lineIndex],0>z&&(w=p.lineIndex,O=!0)),this._wrapMode||(h>=this._maxLineWidth&&(this._maxLineWidth=h,this._maxLineIndex=p.lineIndex),this._checkMaxLineIndex===p.lineIndex&&(this._checkMaxLineIndex=-1)),p.lineIndex===l&&(this._topChild=p),p.lineIndex===w&&(this._bottomChild=p),p=this._getLineNext(p);-1!==this._checkMaxLineIndex&&
(z=this._checkMaxLineIndex,this._checkMaxLineIndex=-1,0<=z&&z<r&&(q=new B(this,z),E=q.getBoundingClientRect(),h=E.right-E.left,h>=this._maxLineWidth&&(this._maxLineWidth=h,this._maxLineIndex=z),q.destroy()));for(;m<r;)p=this._getLineHeight(m,m<=w),x+=p,m++;r=x;this._updateRuler(this._leftDiv,l,k,C);this._updateRuler(this._rightDiv,l,k,C);this._updateRuler(this._innerRightDiv,l,k,C);this._updateRuler(this._marginDiv,l,k,C);q=0;this._leftDiv&&(l=this._leftDiv.getBoundingClientRect(),q=l.right-l.left);
x=0;this._rightDiv&&(k=this._rightDiv.getBoundingClientRect(),x=k.right-k.left);d.style.left=q+"px";d.style.right=x+"px";k=this._scrollDiv;k.style.height=r+(e.isWebkit?0:n.bottom)+"px";l=this._getClientWidth();!this._singleMode&&(!this._wrapMode&&!this._noScroll)&&(m=f=I,(w="scroll"===d.style.overflowX)?f+=v:m-=v,h=p=l,(z="scroll"===d.style.overflowY)?p+=v:h-=v,I=f,l=p,r>I&&(g=!0,l=h),this._maxLineWidth>l&&(u=!0,I=m,r>I&&(g=!0,l=h)),w!==u&&(d.style.overflowX=u?"scroll":"hidden"),z!==g&&(d.style.overflowY=
g?"scroll":"hidden"),f=w!==u||z!==g);g=l;this._wrapMode?this._metrics.wrapWidth&&(g=this._metrics.wrapWidth):g=Math.max(this._maxLineWidth+this._getInnerRightWidth(),g);u=g;if((!e.isIE||9<=e.isIE)&&this._maxLineWidth>l)g+=n.right+n.left;k.style.width=g+"px";this._clipScrollDiv&&(this._clipScrollDiv.style.width=g+"px");k=this._getScroll(!1);if(g=this._innerRightDiv)g.style.right=x+("scroll"===d.style.overflowY?this._metrics.scrollWidth:0)+"px",g.style.bottom=("scroll"===d.style.overflowX?v:0)+"px"}this._scrollHeight=
r;this._vScrollDiv&&(g=I-8,x=Math.max(15,Math.ceil(Math.min(1,g/(r+n.top+n.bottom))*g)),this._vScrollDiv.style.left=q+l-8+"px",this._vScrollDiv.style.top=Math.floor(Math.max(0,k.y*g/r))+"px",this._vScrollDiv.style.height=x+"px");!this._wrapMode&&this._hScrollDiv&&(g=l-8,x=Math.max(15,Math.ceil(Math.min(1,g/(this._maxLineWidth+n.left+n.right))*g)),this._hScrollDiv.style.left=q+Math.floor(Math.max(0,Math.floor(k.x*g/this._maxLineWidth)))+"px",this._hScrollDiv.style.top=I-9+"px",this._hScrollDiv.style.width=
x+"px");m=k.x;x=this._clipDiv;g=this._overlayDiv;if(w=this._marginDiv)w.style.left=-m+q+this._metrics.marginWidth+n.left+"px",w.style.bottom=("scroll"===d.style.overflowX?v:0)+"px";x?(x.scrollLeft=m,x.scrollTop=0,d=q+n.left,v=n.top,a=l,q=I,m=0,w=-c,0===k.x&&(d-=n.left,a+=n.left,m=n.left),k.x+l===u&&(a+=n.right),0===k.y&&(v-=n.top,q+=n.top,w+=n.top),k.y+I===r&&(q+=n.bottom),x.style.left=d+"px",x.style.top=v+"px",x.style.right=s-a-d+"px",x.style.bottom=C-q-v+"px",b.style.left=m+"px",b.style.top=w+"px",
b.style.width=u+"px",b.style.height=I+c+"px",g&&(g.style.left=b.style.left,g.style.top=b.style.top,g.style.width=b.style.width,g.style.height=b.style.height)):(d=m,v=c,s=m+l,C=c+I,0===d&&(d-=n.left),0===v&&(v-=n.top),s===u&&(s+=n.right),k.y+I===r&&(C+=n.bottom),b.style.clip="rect("+v+"px,"+s+"px,"+C+"px,"+d+"px)",b.style.left=-m+q+n.left+"px",b.style.width=(this._wrapMode||e.isWebkit?u:l+m)+"px",a||(b.style.top=-c+n.top+"px",b.style.height=I+c+"px"),g&&(g.style.clip=b.style.clip,g.style.left=b.style.left,
g.style.width=b.style.width,a||(g.style.top=b.style.top,g.style.height=b.style.height)));this._updateDOMSelection();f&&(b=this._ensureCaretVisible,this._ensureCaretVisible=!1,b&&this._showCaret(),this._queueUpdate())}}},_updateOverflow:function(){var a=this._viewDiv;this._noScroll?a.style.overflow="hidden":this._wrapMode?(a.style.overflowX="hidden",a.style.overflowY="scroll"):a.style.overflow="hidden"},_updateRuler:function(a,b,d,c){if(a)for(var k=this._parent.ownerDocument,n=this._getLineHeight(),
r=this._getViewPadding(),q=a.firstChild;q;){var f=q._ruler,u=f.getOverview();q.rulerChanged&&(l(f.getRulerStyle(),q),a.rulerWidth=void 0);if("fixed"!==u){var g=n;"page"===u&&(g+=this._topIndexY);q.style.top=-g+"px";q.style.height=c+g+"px";var v,h=q.firstChild;h?(v=h,h=h.nextSibling):(v=e.createElement(k,"div"),v.style.visibility="hidden",q.appendChild(v));var w;if(q.rulerChanged&&v){g=-1;if(w=f.getWidestAnnotation())l(w.style,v),w.html&&(v.innerHTML=w.html);v.lineIndex=g;v.style.height=n+r.top+"px"}var F,
I;if("page"===u){for(f=f.getAnnotations(b,d+1);h;)g=h.lineIndex,w=h.nextSibling,(!(b<=g&&g<=d)||h.lineChanged)&&q.removeChild(h),h=w;h=q.firstChild.nextSibling;I=k.createDocumentFragment();for(g=b;g<=d;g++)if(!h||h.lineIndex>g){F=e.createElement(k,"div");if(w=f[g])l(w.style,F),w.html&&(F.innerHTML=w.html),F.annotation=w;F.lineIndex=g;F.style.height=this._getLineHeight(g)+"px";I.appendChild(F)}else I.firstChild&&(q.insertBefore(I,h),I=k.createDocumentFragment()),h&&(h=h.nextSibling);I.firstChild&&
q.insertBefore(I,h)}else{w=this._getClientHeight();g=this._model.getLineCount();h=w+r.top+r.bottom-2*this._metrics.scrollWidth;n*g<h?(u=n,v=r.top):(u=h/g,v=this._metrics.scrollWidth);if(q.rulerChanged){for(w=q.childNodes.length;1<w;)q.removeChild(q.lastChild),w--;f=f.getAnnotations(0,g);I=k.createDocumentFragment();for(var B in f)g=B>>>0,0>g||(F=e.createElement(k,"div"),w=f[B],l(w.style,F),F.style.position="absolute",F.style.top=v+n+Math.floor(g*u)+"px",w.html&&(F.innerHTML=w.html),F.annotation=w,
F.lineIndex=g,I.appendChild(F));q.appendChild(I)}else if(q._oldTrackHeight!==h)for(F=q.firstChild?q.firstChild.nextSibling:null;F;)F.style.top=this._metrics.scrollWidth+n+Math.floor(F.lineIndex*u)+"px",F=F.nextSibling;q._oldTrackHeight=h}}q.rulerChanged=!1;q=q.nextSibling}},_updateStyleSheet:function(){var a="";e.isWebkit&&0<this._metrics.scrollWidth&&(a+="\n.textview ::-webkit-scrollbar-corner {background: #eeeeee;}");if(a){var b=this._clientDiv.ownerDocument,d=b.getElementById("_textviewStyle");
if(d)d.removeChild(d.firstChild),d.appendChild(b.createTextNode(a));else{d=e.createElement(b,"style");d.id="_textviewStyle";var c=b.getElementsByTagName("head")[0]||b.documentElement;d.appendChild(b.createTextNode(a));c.insertBefore(d,c.firstChild)}}},_updateStyle:function(a){!a&&e.isIE&&(this._rootDiv.style.lineHeight="normal");var b=this._metrics=this._calculateMetrics();this._variableLineHeight&&(this._variableLineHeight=!1,this._resetLineHeight());this._rootDiv.style.lineHeight=e.isIE?b.lineHeight-
(b.lineTrim.top+b.lineTrim.bottom)+"px":"normal";this._updateStyleSheet();if(e.isMac&&e.isWebkit){var d=this._viewDiv;!b.invalid&&0===b.scrollWidth?(d.style.pointerEvents="none",d.style.zIndex="2"):(d.style.pointerEvents="",d.style.zIndex="")}a||(this.redraw(),this._resetLineWidth())}};h.EventTarget.addMixin(x.prototype);return{TextView:x}});
define("orion/editor/projectionTextModel",["orion/editor/textModel","orion/editor/eventTarget"],function(m,s){function p(h){this._model=h;this._projections=[];var c=this;this._listener={onChanged:function(f){c._onChanged(f)},onChanging:function(f){c._onChanging(f)}};h.addEventListener("postChanged",this._listener.onChanged);h.addEventListener("preChanging",this._listener.onChanging)}p.prototype={destroy:function(){this._model&&(this._model.removeEventListener("postChanged",this._listener.onChanged),
this._model.removeEventListener("preChanging",this._listener.onChanging),this._model=null)},addProjection:function(h){if(h){var c=this._model,f=this._projections;h._lineIndex=c.getLineAtOffset(h.start);h._lineCount=c.getLineAtOffset(h.end)-h._lineIndex;var e=h.text;e||(e="");h._model="string"===typeof e?new m.TextModel(e,c.getLineDelimiter()):e;var c=this.mapOffset(h.start,!0),e=h.end-h.start,g=h._lineCount,l=h._model.getCharCount(),b=h._model.getLineCount()-1,a={type:"Changing",text:h._model.getText(),
start:c,removedCharCount:e,addedCharCount:l,removedLineCount:g,addedLineCount:b};this.onChanging(a);a=this._binarySearch(f,h.start);f.splice(a,0,h);this.onChanged({type:"Changed",start:c,removedCharCount:e,addedCharCount:l,removedLineCount:g,addedLineCount:b})}},getProjections:function(){return this._projections.slice(0)},getBaseModel:function(){return this._model},mapOffset:function(h,c){var f=this._projections,e=0,g,l;if(c){for(g=0;g<f.length;g++){l=f[g];if(l.start>h)break;if(l.end>h)return-1;e+=
l._model.getCharCount()-(l.end-l.start)}return h+e}for(g=0;g<f.length;g++){l=f[g];if(l.start>h-e)break;var b=l._model.getCharCount();if(l.start+b>h-e)return-1;e+=b-(l.end-l.start)}return h-e},removeProjection:function(h){this._removeProjection(h)},_removeProjection:function(h,c){var f,e=0;for(f=0;f<this._projections.length;f++){var g=this._projections[f];if(g===h){h=g;break}e+=g._model.getCharCount()-(g.end-g.start)}if(f<this._projections.length){var g=this._model,e=h.start+e,l=h.end-h.start,b=h._lineCount,
a=h._model.getCharCount(),k=h._model.getLineCount()-1;c||(g={type:"Changing",text:g.getText(h.start,h.end),start:e,removedCharCount:a,addedCharCount:l,removedLineCount:k,addedLineCount:b},this.onChanging(g));this._projections.splice(f,1);if(!c)this.onChanged({type:"Changed",start:e,removedCharCount:a,addedCharCount:l,removedLineCount:k,addedLineCount:b})}},_binarySearch:function(h,c){for(var f=h.length,e=-1,g;1<f-e;)g=Math.floor((f+e)/2),c<=h[g].start?f=g:e=g;return f},getCharCount:function(){for(var h=
this._model.getCharCount(),c=this._projections,f=0;f<c.length;f++)var e=c[f],h=h+(e._model.getCharCount()-(e.end-e.start));return h},getLine:function(h,c){if(0>h)return null;var f=this._model,e=this._projections,g=0,l=[],b=0,a,k,d;for(a=0;a<e.length;a++){d=e[a];if(d._lineIndex>=h-g)break;k=d._model.getLineCount()-1;if(d._lineIndex+k>=h-g){b=h-(d._lineIndex+g);if(b<k)return d._model.getLine(b,c);l.push(d._model.getLine(k))}b=d.end;g+=k-d._lineCount}for(b=Math.max(b,f.getLineStart(h-g));a<e.length;a++){d=
e[a];if(d._lineIndex>h-g)break;l.push(f.getText(b,d.start));k=d._model.getLineCount()-1;if(d._lineIndex+k>h-g)return l.push(d._model.getLine(0,c)),l.join("");l.push(d._model.getText());b=d.end;g+=k-d._lineCount}e=f.getLineEnd(h-g,c);b<e&&l.push(f.getText(b,e));return l.join("")},getLineAtOffset:function(h){for(var c=this._model,f=this._projections,e=0,g=0,l=0;l<f.length;l++){var b=f[l];if(b.start>h-e)break;var a=b._model.getCharCount();if(b.start+a>h-e){f=h-(b.start+e);g+=b._model.getLineAtOffset(f);
e+=f;break}g+=b._model.getLineCount()-1-b._lineCount;e+=a-(b.end-b.start)}return c.getLineAtOffset(h-e)+g},getLineCount:function(){for(var h=this._projections,c=this._model.getLineCount(),f=0;f<h.length;f++)var e=h[f],c=c+(e._model.getLineCount()-1-e._lineCount);return c},getLineDelimiter:function(){return this._model.getLineDelimiter()},getLineEnd:function(h,c){if(0>h)return-1;for(var f=this._model,e=this._projections,g=0,l=0,b=0;b<e.length;b++){var a=e[b];if(a._lineIndex>h-g)break;var k=a._model.getLineCount()-
1;if(a._lineIndex+k>h-g)return a._model.getLineEnd(h-(a._lineIndex+g),c)+a.start+l;l+=a._model.getCharCount()-(a.end-a.start);g+=k-a._lineCount}return f.getLineEnd(h-g,c)+l},getLineStart:function(h){if(0>h)return-1;for(var c=this._model,f=this._projections,e=0,g=0,l=0;l<f.length;l++){var b=f[l];if(b._lineIndex>=h-e)break;var a=b._model.getLineCount()-1;if(b._lineIndex+a>=h-e)return b._model.getLineStart(h-(b._lineIndex+e))+b.start+g;g+=b._model.getCharCount()-(b.end-b.start);e+=a-b._lineCount}return c.getLineStart(h-
e)+g},getText:function(h,c){void 0===h&&(h=0);var f=this._model,e=this._projections,g=0,l=[],b,a,k;for(b=0;b<e.length;b++){a=e[b];if(a.start>h-g)break;k=a._model.getCharCount();if(a.start+k>h-g){if(void 0!==c&&a.start+k>c-g)return a._model.getText(h-(a.start+g),c-(a.start+g));l.push(a._model.getText(h-(a.start+g)));h=a.end+g+k-(a.end-a.start)}g+=k-(a.end-a.start)}var d=h-g;if(void 0!==c){for(;b<e.length;b++){a=e[b];if(a.start>c-g)break;l.push(f.getText(d,a.start));k=a._model.getCharCount();if(a.start+
k>c-g)return l.push(a._model.getText(0,c-(a.start+g))),l.join("");l.push(a._model.getText());d=a.end;g+=k-(a.end-a.start)}l.push(f.getText(d,c-g))}else{for(;b<e.length;b++)a=e[b],l.push(f.getText(d,a.start)),l.push(a._model.getText()),d=a.end;l.push(f.getText(d))}return l.join("")},_onChanged:function(h){h=this._change;var c=h.baseStart,f=h.baseEnd,e,g,l=this._projections;for(e=0;e<l.length&&!(g=l[e],g.end>c);e++);var b=e;for(e=0;e<l.length&&!(g=l[e],g.start>=f);e++);var a=e,k=this._model,c=h.baseText.length-
(f-c);for(e=a;e<l.length;e++)g=l[e],g.start+=c,g.end+=c,g._lineIndex=k.getLineAtOffset(g.start);g=l.splice(b,a-b);for(e=0;e<g.length;e++)g[e].annotation&&g[e].annotation._expand();this.onChanged({type:"Changed",start:h.start,removedCharCount:h.removedCharCount,addedCharCount:h.addedCharCount,removedLineCount:h.removedLineCount,addedLineCount:h.addedLineCount});this._change=void 0},_onChanging:function(h){var c=!!this._change,f=this._change||{},e=h.start,g=e+h.removedCharCount;f.baseStart=e;f.baseEnd=
g;f.baseText=h.text;f.addedLineCount=h.addedLineCount;if(!c){this._change=f;f.text=h.text;var l=this._projections,b,a,k;h=function(d){for(b=a=0;a<l.length;a++){k=l[a];if(k.start>d)break;if(k.end>d)return-1;b+=k._model.getCharCount()-(k.end-k.start)}return d+b};f.start=h(e);-1===f.start&&(f.text=this._model.getText(k.start,e)+f.text,f.addedLineCount+=this._model.getLineAtOffset(e)-this._model.getLineAtOffset(k.start),f.start=k.start+b);f.end=h(g);-1===f.end&&(f.text+=this._model.getText(g,k.end),f.addedLineCount+=
this._model.getLineAtOffset(k.end)-this._model.getLineAtOffset(g),f.end=k.start+b)}f.addedCharCount=f.text.length;f.removedCharCount=f.end-f.start;f.removedLineCount=this.getLineAtOffset(f.end)-this.getLineAtOffset(f.start);this.onChanging({type:"Changing",text:f.text,start:f.start,removedCharCount:f.removedCharCount,addedCharCount:f.addedCharCount,removedLineCount:f.removedLineCount,addedLineCount:f.addedLineCount})},onChanging:function(h){return this.dispatchEvent(h)},onChanged:function(h){return this.dispatchEvent(h)},
setLineDelimiter:function(h){this._model.setLineDelimiter(h)},setText:function(h,c,f){function e(d){for(l=b=0;b<g.length;b++){a=g[b];if(a.start>d-l)break;var c=a._model.getCharCount();if(a.start+c>d-l)return-1;l+=c-(a.end-a.start)}return d-l}this._change={text:h||"",start:c||0,end:void 0===f?this.getCharCount():f};var g=this._projections,l,b,a,k,d;h=e(this._change.start);-1===h&&(k={projection:a,start:this._change.start-(a.start+l)},h=a.end);c=e(this._change.end);-1===c&&(d={projection:a,end:this._change.end-
(a.start+l)},c=a.start);k&&d&&k.projection===d.projection?a._model.setText(this._change.text,k.start,d.end):(this._model.setText(this._change.text,h,c),k&&(a=k.projection,a._model.setText("",k.start)),d&&(a=d.projection,a._model.setText("",0,d.end),a.start=a.end,a._lineCount=0));this._change=void 0}};s.EventTarget.addMixin(p.prototype);return{ProjectionTextModel:p}});
define("orion/editor/annotations",["i18n!orion/editor/nls/messages","orion/editor/eventTarget"],function(m,s){function p(){}function h(a,b,d){this.start=a;this.end=b;this._projectionModel=d;this.html=this._expandedHTML;this.style=this._expandedStyle;this.expanded=!0}function c(a,b){var d=a.lastIndexOf("."),d=a.substring(d+1),c={title:m[d],style:{styleClass:"annotation "+d},html:"\x3cdiv class\x3d'annotationHTML "+d+"'\x3e\x3c/div\x3e",overviewStyle:{styleClass:"annotationOverview "+d}};b?c.lineStyle=
{styleClass:"annotationLine "+d}:c.rangeStyle={styleClass:"annotationRange "+d};p.registerType(a,c)}function f(){}function e(a,b,d,c,n){var e;void 0===c&&(c=-1);void 0===n&&(n=a.length);for(;1<n-c;)if(e=Math.floor((n+c)/2),b<=a[e].start)n=e;else if(d&&b<a[e].end){n=e;break}else c=e;return n}function g(a){this._annotations=[];var b=this;this._listener={onChanged:function(a){b._onChanged(a)}};this.setTextModel(a)}function l(a,b){this._view=a;this._annotationModel=b;var d=this;this._listener={onDestroy:function(a){d._onDestroy(a)},
onLineStyle:function(a){d._onLineStyle(a)},onChanged:function(a){d._onAnnotationModelChanged(a)}};a.addEventListener("Destroy",this._listener.onDestroy);a.addEventListener("postLineStyle",this._listener.onLineStyle);b.addEventListener("Changed",this._listener.onChanged)}h.prototype={_expandedHTML:"\x3cdiv class\x3d'annotationHTML expanded'\x3e\x3c/div\x3e",_expandedStyle:{styleClass:"annotation expanded"},_collapsedHTML:"\x3cdiv class\x3d'annotationHTML collapsed'\x3e\x3c/div\x3e",_collapsedStyle:{styleClass:"annotation collapsed"},
_collapse:function(){if(!this.expanded)return!1;this.expanded=!1;this.html=this._collapsedHTML;this.style=this._collapsedStyle;this._annotationModel&&this._annotationModel.modifyAnnotation(this);return!0},_expand:function(){if(this.expanded)return!1;this.expanded=!0;this.html=this._expandedHTML;this.style=this._expandedStyle;this._annotationModel&&this._annotationModel.modifyAnnotation(this);return!0},_collapseImpl:function(a){if(this._collapse()){a&&this._forEachOverlaping(function(a){a.expanded||
(a._expandImpl(!1),a._recollapse=!0)});a=this._projectionModel;var b=a.getBaseModel();this._projection={annotation:this,start:b.getLineStart(b.getLineAtOffset(this.start)+1),end:b.getLineEnd(b.getLineAtOffset(this.end),!0)};a.addProjection(this._projection)}},_expandImpl:function(a){this._expand()&&(this._projectionModel._removeProjection(this._projection,!this._annotationModel),a&&this._forEachOverlaping(function(a){a._recollapse&&(a._collapseImpl(!1),a._recollapse=!1)}))},_forEachOverlaping:function(a){if(this._annotationModel)for(var b=
this._annotationModel.getAnnotations(this.start,this.end);b.hasNext();){var d=b.next();d!==this&&d.type===p.ANNOTATION_FOLDING&&a.call(this,d)}},collapse:function(){this._recollapse=!1;this._collapseImpl(!0)},expand:function(){this._recollapse=!1;this._expandImpl(!0)}};p.ANNOTATION_ERROR="orion.annotation.error";p.ANNOTATION_WARNING="orion.annotation.warning";p.ANNOTATION_TASK="orion.annotation.task";p.ANNOTATION_BREAKPOINT="orion.annotation.breakpoint";p.ANNOTATION_BOOKMARK="orion.annotation.bookmark";
p.ANNOTATION_FOLDING="orion.annotation.folding";p.ANNOTATION_CURRENT_BRACKET="orion.annotation.currentBracket";p.ANNOTATION_MATCHING_BRACKET="orion.annotation.matchingBracket";p.ANNOTATION_CURRENT_LINE="orion.annotation.currentLine";p.ANNOTATION_CURRENT_SEARCH="orion.annotation.currentSearch";p.ANNOTATION_MATCHING_SEARCH="orion.annotation.matchingSearch";p.ANNOTATION_READ_OCCURRENCE="orion.annotation.readOccurrence";p.ANNOTATION_WRITE_OCCURRENCE="orion.annotation.writeOccurrence";p.ANNOTATION_SELECTED_LINKED_GROUP=
"orion.annotation.selectedLinkedGroup";p.ANNOTATION_CURRENT_LINKED_GROUP="orion.annotation.currentLinkedGroup";p.ANNOTATION_LINKED_GROUP="orion.annotation.linkedGroup";p.ANNOTATION_BLAME="orion.annotation.blame";p.ANNOTATION_CURRENT_BLAME="orion.annotation.currentBlame";p.ANNOTATION_DIFF_ADDED="orion.annotation.diffAdded";p.ANNOTATION_DIFF_DELETED="orion.annotation.diffDeleted";p.ANNOTATION_DIFF_MODIFIED="orion.annotation.diffModified";var b={};p.registerType=function(a,c){var d=c;"function"!==typeof d&&
(d=function(a,b,d){this.start=a;this.end=b;void 0!==d&&(this.title=d)},d.prototype=c);d.prototype.type=a;b[a]=d;return a};p.createAnnotation=function(a,b,d,c){return new (this.getType(a))(b,d,c)};p.getType=function(a){return b[a]};c(p.ANNOTATION_ERROR);c(p.ANNOTATION_WARNING);c(p.ANNOTATION_TASK);c(p.ANNOTATION_BREAKPOINT);c(p.ANNOTATION_BOOKMARK);c(p.ANNOTATION_CURRENT_BRACKET);c(p.ANNOTATION_MATCHING_BRACKET);c(p.ANNOTATION_CURRENT_SEARCH);c(p.ANNOTATION_MATCHING_SEARCH);c(p.ANNOTATION_READ_OCCURRENCE);
c(p.ANNOTATION_WRITE_OCCURRENCE);c(p.ANNOTATION_SELECTED_LINKED_GROUP);c(p.ANNOTATION_CURRENT_LINKED_GROUP);c(p.ANNOTATION_LINKED_GROUP);c(p.ANNOTATION_CURRENT_LINE,!0);c(p.ANNOTATION_BLAME,!0);c(p.ANNOTATION_CURRENT_BLAME,!0);c(p.ANNOTATION_DIFF_ADDED);c(p.ANNOTATION_DIFF_DELETED);c(p.ANNOTATION_DIFF_MODIFIED);p.registerType(p.ANNOTATION_FOLDING,h);f.addMixin=function(a){var b=f.prototype,d;for(d in b)b.hasOwnProperty(d)&&(a[d]=b[d])};f.prototype={addAnnotationType:function(a,b){this._annotationTypes||
(this._annotationTypes=[]);var d=b-1;void 0==b||!(0<=d&&d<this._annotationTypes.length)?this._annotationTypes.push(a):this._annotationTypes.splice(d,0,a)},getAnnotationTypePriority:function(a){if(this._annotationTypes)for(var b=0;b<this._annotationTypes.length;b++)if(this._annotationTypes[b]===a)return b+1;return 0},getAnnotationsByType:function(a,b,d){a=a.getAnnotations(b,d);for(d=[];a.hasNext();)b=a.next(),0!==this.getAnnotationTypePriority(b.type)&&d.push(b);var c=this;d.sort(function(a,b){return c.getAnnotationTypePriority(a.type)-
c.getAnnotationTypePriority(b.type)});return d},isAnnotationTypeVisible:function(a){return 0!==this.getAnnotationTypePriority(a)},removeAnnotationType:function(a){if(this._annotationTypes)for(var b=0;b<this._annotationTypes.length;b++)if(this._annotationTypes[b]===a){this._annotationTypes.splice(b,1);break}}};g.prototype={addAnnotation:function(a){if(a){var b=this._annotations,d=e(b,a.start);b.splice(d,0,a);a._annotationModel=this;this.onChanged({type:"Changed",added:[a],removed:[],changed:[]})}},
getTextModel:function(){return this._model},getAnnotations:function(a,b){var d=this._annotations,c,n=0,e;e=void 0===a&&void 0===b?function(){return n<d.length?d[n++]:null}:function(){for(;n<d.length;){var c=d[n++];if(a===c.start||(a>c.start?a<c.end:c.start<b))return c;if(c.start>=b)break}return null};c=e();return{next:function(){var a=c;a&&(c=e());return a},hasNext:function(){return null!==c}}},modifyAnnotation:function(a){if(a&&!(0>this._getAnnotationIndex(a)))this.onChanged({type:"Changed",added:[],
removed:[],changed:[a]})},onChanged:function(a){return this.dispatchEvent(a)},removeAnnotations:function(a){var b=this._annotations,d,c;if(a){d=[];for(c=b.length-1;0<=c;c--){var n=b[c];n.type===a&&(b.splice(c,1),d.splice(0,0,n),n._annotationModel=null)}}else d=b;this.onChanged({type:"Changed",removed:d,added:[],changed:[]})},removeAnnotation:function(a){if(a){var b=this._getAnnotationIndex(a);0>b||(a._annotationModel=null,a={type:"Changed",removed:this._annotations.splice(b,1),added:[],changed:[]},
this.onChanged(a))}},replaceAnnotations:function(a,b){var d=this._annotations,c,n,f,q=[];if(a)for(c=a.length-1;0<=c;c--)f=a[c],n=this._getAnnotationIndex(f),0>n||(f._annotationModel=null,d.splice(n,1),q.splice(0,0,f));b||(b=[]);for(c=0;c<b.length;c++)f=b[c],n=e(d,f.start),f._annotationModel=this,d.splice(n,0,f);this.onChanged({type:"Changed",removed:q,added:b,changed:[]})},setTextModel:function(a){this._model&&this._model.removeEventListener("Changed",this._listener.onChanged);(this._model=a)&&this._model.addEventListener("Changed",
this._listener.onChanged)},_getAnnotationIndex:function(a){for(var b=this._annotations,d=e(b,a.start);d<b.length&&b[d].start===a.start;){if(b[d]===a)return d;d++}return-1},_onChanged:function(a){var b=a.start,d=a.addedCharCount,c=a.removedCharCount,n=this._annotations,e=b+c;if(0<n.length){a={type:"Changed",added:[],removed:[],changed:[],textModelChangedEvent:a};d-=c;for(c=0;c<n.length;c++){var q=n[c];q.start>=e?(q._oldStart=q.start,q._oldEnd=q.end,q.start+=d,q.end+=d,a.changed.push(q)):q.end<=b||
(q.start<b&&e<q.end?(q._oldStart=q.start,q._oldEnd=q.end,q.end+=d,a.changed.push(q)):(n.splice(c,1),a.removed.push(q),q._annotationModel=null,q.expand&&q.expand(),c--))}if(0<a.added.length||0<a.removed.length||0<a.changed.length)this.onChanged(a)}}};s.EventTarget.addMixin(g.prototype);l.prototype={destroy:function(){var a=this._view;a&&(a.removeEventListener("Destroy",this._listener.onDestroy),a.removeEventListener("LineStyle",this._listener.onLineStyle),this.view=null);(a=this._annotationModel)&&
a.removeEventListener("Changed",this._listener.onChanged)},_mergeStyle:function(a,b){if(b){a||(a={});a.styleClass=a.styleClass&&b.styleClass&&a.styleClass!==b.styleClass?a.styleClass+(" "+b.styleClass):b.styleClass;var d;b.tagName&&!a.tagName&&(a.tagName=b.tagName);if(b.style)for(d in a.style||(a.style={}),b.style)a.style[d]||(a.style[d]=b.style[d]);if(b.attributes)for(d in a.attributes||(a.attributes={}),b.attributes)a.attributes[d]||(a.attributes[d]=b.attributes[d])}return a},_mergeStyleRanges:function(a,
b){a||(a=[]);for(var d,c=e(a,b.start,!0);c<a.length&&b;c++){var n=a[c];if(b.end<=n.start)break;if(!(b.start>=n.end)){d=this._mergeStyle({},n.style);d=this._mergeStyle(d,b.style);var f=[];f.push(c,1);b.start<n.start&&f.push({start:b.start,end:n.start,style:b.style});b.start>n.start&&f.push({start:n.start,end:b.start,style:n.style});f.push({start:Math.max(n.start,b.start),end:Math.min(n.end,b.end),style:d});b.end<n.end&&f.push({start:b.end,end:n.end,style:n.style});b=b.end>n.end?{start:n.end,end:b.end,
style:b.style}:null;Array.prototype.splice.apply(a,f)}}b&&(d=this._mergeStyle({},b.style),a.splice(c,0,{start:b.start,end:b.end,style:d}));return a},_onAnnotationModelChanged:function(a){function b(a,d){e.getBaseModel&&(a=e.mapOffset(a,!0),d=e.mapOffset(d,!0));-1!==a&&-1!==d&&c.redrawRange(a,d)}function d(a,d){for(var c=0;c<a.length;c++)if(n.isAnnotationTypeVisible(a[c].type)){var e=a[c];b(e.start,e.end);d&&(void 0!==e._oldStart&&e._oldEnd)&&b(e._oldStart,e._oldEnd)}}var c=this._view;if(c){var n=
this,e=c.getModel();d(a.added);d(a.removed);d(a.changed,!0)}},_onDestroy:function(a){this.destroy()},_onLineStyle:function(a){var b=this._annotationModel,d=a.textView.getModel(),c=b.getTextModel(),n=a.lineStart,e=a.lineStart+a.lineText.length;c!==d&&(n=d.mapOffset(n),e=d.mapOffset(e));for(b=b.getAnnotations(n,e);b.hasNext();)if(n=b.next(),this.isAnnotationTypeVisible(n.type)){if(n.rangeStyle){var e=n.start,q=n.end;c!==d&&(e=d.mapOffset(e,!0),q=d.mapOffset(q,!0));a.ranges=this._mergeStyleRanges(a.ranges,
{start:e,end:q,style:n.rangeStyle})}n.lineStyle&&(a.style=this._mergeStyle({},a.style),a.style=this._mergeStyle(a.style,n.lineStyle))}}};f.addMixin(l.prototype);return{FoldingAnnotation:h,AnnotationType:p,AnnotationTypeList:f,AnnotationModel:g,AnnotationStyler:l}});
define("orion/PageUtil",[],function(){var m=/^http[s]?/i;return{hash:function(){var m=window.location.href.split("#")[1];return m?"#"+m:""},matchResourceParameters:function(m){m=m||window.location.toString();var p={resource:""},h=m.indexOf("#");if(-1!==h&&(m=m.substring(h+1),0!==m.length)){m=m.split(",");p.resource=decodeURIComponent(m[0]);for(h=1;h<m.length;h++){var c=/([^=]*)(=?)(.*)/.exec(m[h]),f=decodeURIComponent(c[1]||""),c=decodeURIComponent(c[3]||"");""!==f&&"resource"!==f&&(p[f]=c)}}return p},
validateURLScheme:function(s,p){var h=s;if(-1===s.indexOf("://")){var c=document.createElement("a");c.href=s;h=c.href}c=!1;if(c=p?p.some(function(c){return RegExp("^"+c+":","i").test(h)}):m.test(h))return s;console.log("Illegal URL Scheme: '"+s+"'");return""}}});
define("orion/URITemplate",[],function(){function m(a){this._text=a}function s(a){return a.replace("%25","%")}function p(a,c){if("U"===c)return encodeURIComponent(a).replace(/[!'()*]/g,function(a){return"%"+a.charCodeAt(0).toString(16).toUpperCase()});if("U+R"===c)return encodeURI(a).replace(/%5B/g,"[").replace(/%5D/g,"]").replace(b,s);if("U+R-,"===c)return encodeURI(a).replace(/%5B/g,"[").replace(/%5D/g,"]").replace(/,/g,"%2C");throw Error("Unknown allowed character set: "+c);}function h(a,b,d){for(var c=
[],e=0;e<a.length;e++)"undefined"!==typeof a[e]&&c.push(p(a[e],b));return c.join(d)}function c(a,b,d,c){for(var e=Object.keys(a),f=[],q=0;q<e.length;q++)"undefined"!==typeof a[e[q]]&&f.push(p(e[q],b)+d+p(a[e[q]],b));return f.join(c)}function f(a){if(0===a.length)throw Error("Invalid Expression: 0 length expression");(this._operator=g[a[0]])?a=a.substring(1):this._operator=g.NUL;for(var b=[],d=a.split(","),c=0;c<d.length;c++){var e=d[c].match(l);if(null===e)throw Error("Bad VarSpec: "+a);b.push({name:e[1],
explode:!!e[2],prefix:e[3]?parseInt(e[3],10):-1})}this._varSpecList=b}function e(a){for(var b=[],d=0,c=a.indexOf("{",d);-1!==c;){b.push(new m(a.substring(d,c)));d=a.indexOf("}",c+1);if(-1===d)throw Error("Invalid template: "+a);b.push(new f(a.substring(c+1,d)));d+=1;c=a.indexOf("{",d)}b.push(new m(a.substring(d)));this._templateComponents=b}var g={NUL:{first:"",sep:",",named:!1,ifemp:"",allow:"U"},"+":{first:"",sep:",",named:!1,ifemp:"",allow:"U+R"},".":{first:".",sep:",",named:!1,ifemp:"",allow:"U"},
"/":{first:"/",sep:"/",named:!1,ifemp:"",allow:"U"},";":{first:";",sep:";",named:!0,ifemp:"",allow:"U"},"?":{first:"?",sep:"\x26",named:!0,ifemp:"\x3d",allow:"U"},"\x26":{first:"\x26",sep:"\x26",named:!0,ifemp:"\x3d",allow:"U"},"#":{first:"#",sep:",",named:!1,ifemp:"",allow:"U+R"},",":{first:"",sep:",",named:!1,ifemp:"",allow:"U+R-,"}},l=/^((?:(?:[a-zA-Z0-9_])|(?:%[0-9A-F][0-9A-F]))(?:(?:[a-zA-Z0-9_.])|(?:%[0-9A-F][0-9A-F]))*)(?:(\*)|:([0-9]+))?$/,b=/%25[0-9A-F][0-9A-F]/g;m.prototype={expand:function(a){return encodeURI(this._text)}};
f.prototype={expand:function(a){for(var b=[],d=0;d<this._varSpecList.length;d++){var e=this._varSpecList[d],n=e.name,f=a[n],q=typeof f;if("undefined"!==q&&null!==f){var g=0===b.length?this._operator.first:this._operator.sep;if("string"===q)this._operator.named&&(g+=p(n,"U+R"),g+=0===f.length?this._operator.ifemp:"\x3d"),-1!==e.prefix&&e.prefix<f.length&&(f=f.substring(0,e.prefix)),g+=p(f,this._operator.allow);else if(Array.isArray(f)){if(0===f.length)continue;e.explode?g+=h(f,this._operator.allow,
this._operator.sep):(e=h(f,this._operator.allow,","),this._operator.named&&(g+=p(n,"U+R"),g+=0===e.length?this._operator.ifemp:"\x3d"),g+=e)}else if("object"===q){if(0===Object.keys(f).length)continue;e.explode?g+=c(f,this._operator.allow,"\x3d",this._operator.sep):(e=c(f,this._operator.allow,",",","),this._operator.named&&(g+=p(n,"U+R"),g+=0===e.length?this._operator.ifemp:"\x3d"),g+=e)}else throw Error("bad param type: "+n+" : "+q);b.push(g)}}return b.join("")}};e.prototype={expand:function(a){for(var b=
[],d=0;d<this._templateComponents.length;d++)b.push(this._templateComponents[d].expand(a));return b.join("")}};return e});define("orion/i18nUtil",["require","orion/Deferred"],function(m,s){return{formatMessage:function(m){var h=/\$\{([^\}]+)\}/g,c=arguments;return 2===c.length&&c[1]&&"object"===typeof c[1]?m.replace(h,function(f,e){return c[1][e]}):m.replace(h,function(f,e){return c[(e<<0)+1]})}}});
define("orion/objects",[],function(){function m(m){for(var p=Object.prototype.hasOwnProperty,h=1,c=arguments.length;h<c;h++){var f=arguments[h],e;for(e in f)p.call(f,e)&&(m[e]=f[e])}return m}return{clone:function(s){if(Array.isArray(s))return Array.prototype.slice.call(s);var p=Object.create(Object.getPrototypeOf(s));m(p,s);return p},mixin:m,toArray:function(m){return Array.isArray(m)?m:[m]}}});
(function(){function m(a){if("string"!==typeof a)throw new TypeError;}function s(a){return a?a.split("\x26"):[]}function p(a){return 0===a.length?"":a.join("\x26")}function h(a){var b=/([^=]*)(?:=?)(.*)/.exec(a);a=b[1]?decodeURIComponent(b[1]):"";b=b[2]?decodeURIComponent(b[2]):"";return[a,b]}function c(a){var b=encodeURIComponent(a[0]);a[1]&&(b+="\x3d"+encodeURIComponent(a[1]));return b}function f(a,b){var d="",c=[],k=0;return{next:function(){d!==a.query&&(d=a.query,c=s(d));if(k<c.length){var e=
h(c[k++]);switch(b){case "keys":return e[0];case "values":return e[1];case "keys+values":return[e[0],e[1]];default:throw new TypeError;}}throw A;}}}function e(a){Object.defineProperty(this,"_url",{get:function(){return a._url}})}function g(a){return a?/[1-9]\d*$/.exec(a)[0]:""}function l(a){var b=[];a.split("/").forEach(function(a){".."===a?b.pop():"."!==a&&b.push(a)});return b.join("/")}function b(a){return a.replace(/\s/g,function(a){return"%"+a.charCodeAt(0).toString(16)})}function a(a,d){if("string"!==
typeof a)throw new TypeError;a=b(a);var c=n.exec(a);if(!c)return null;var k={};k.scheme=c[1]||"";if(k.scheme&&!q.test(k.scheme))return null;var e=c[2];if(e&&(e=u.exec(e),k.userinfo=e[1],k.host=e[2],k.port=e[3],k.port&&!v.test(k.port)))return null;k.path=c[3];k.query=c[4];k.fragment=c[5];!k.scheme&&d&&(k.scheme=d.scheme,!k.host&&d.host&&(k.userinfo=d.userinfo,k.host=d.host,k.port=d.port,k.pathRelative=!0));k.pathRelative&&(k.path?"/"!==k.path[0]&&(c=/^(.*\/)[^\/]*$/.exec(d.path)[1]||"/",k.path=c+k.path):
k.path=d.path);k.scheme&&(k.scheme=k.scheme.toLowerCase());k.port&&(k.port=g(k.port));k.host&&k.path&&(k.path=l(k.path));return k}function k(b,d){var c;if(d){d=d.href||d;c=a(d);if(!c||!c.scheme)throw new SyntaxError;Object.defineProperty(this,"_baseURL",{value:c})}c=a(b,c);if(!c)throw new SyntaxError;Object.defineProperty(this,"_input",{value:b,writable:!0});Object.defineProperty(this,"_url",{value:c,writable:!0});var k=new e(this);Object.defineProperty(this,"query",{get:function(){return this._url?
k:null},enumerable:!0})}try{var d;if("function"===typeof window.URL&&0!==window.URL.length&&"http:"===(d=new window.URL("http://www.w3.org?q")).protocol&&d.query)return}catch(r){}var n=/^(?:([^:\/?#]+):)?(?:\/\/([^\/?#]*))?([^?#]*)(?:\?([^#]*))?(?:#(.*))?$/,u=/^(?:(.*)@)?(\[[^\]]*\]|[^:]*)(?::(.*))?$/,q=/^([a-zA-Z](?:[a-zA-Z0-9+-.])*)$/,v=/^\d*$/,w=/^(\[[^\]\/?#\s]*\]|[^:\/?#\s]*)$/,B=/^(\[[^\]\/?#\s]*\]|[^:\/?#\s]*)(?::(\d*))?$/,x=/^([^?#\s]*)$/,C=/^([^\s]*)$/,z=/^\S*$/,E=/([^:]*):?(.*)/,A="undefined"!==
typeof StopIteration?StopIteration:Error("Stop Iteration"),D={"ftp:":"21","gopher:":"70","http:":"80","https:":"443","ws:":"80","wss:":"443"};Object.defineProperties(e.prototype,{get:{value:function(a){m(a);var b;s(this._url.query).some(function(d){d=h(d);if(d[0]===a)return b=d[1],!0});return b},enumerable:!0},set:{value:function(a,b){m(a);m(b);var d=s(this._url.query);d.some(function(k,e){var n=h(k);if(n[0]===a)return n[1]=b,d[e]=c(n),!0})||d.push(c([a,b]));this._url.query=p(d)},enumerable:!0},has:{value:function(a){m(a);
return s(this._url.query).some(function(b){if(h(b)[0]===a)return!0})},enumerable:!0},"delete":{value:function(a){m(a);var b=s(this._url.query),d=b.filter(function(b){return h(b)[0]!==a});return d.length!==b.length?(this._url.query=p(d),!0):!1},enumerable:!0},clear:{value:function(){this._url.query=""},enumerable:!0},forEach:{value:function(a,b){if("function"!==typeof a)throw new TypeError;var d=f(this._url,"keys+values");try{for(;;){var c=d.next();a.call(b,c[1],c[0],this)}}catch(k){if(k!==A)throw k;
}},enumerable:!0},keys:{value:function(){return f(this._url,"keys")},enumerable:!0},values:{value:function(){return f(this._url,"values")},enumerable:!0},items:{value:function(){return f(this._url,"keys+values")}},size:{get:function(){return s(this._url.query).length},enumerable:!0},getAll:{value:function(a){m(a);var b=[];s(this._url.query).forEach(function(d){d=h(d);d[0]===a&&b.push(d[1])});return b},enumerable:!0},append:{value:function(a,b){m(a);m(b);var d=s(this._url.query);d.push(c([a,b]));this._url.query=
p(d)},enumerable:!0}});Object.defineProperties(k.prototype,{href:{get:function(){var a;if(this._url){a=this._url;var b=a.scheme?a.scheme+":":"";a.host&&(b+="//",a.userinfo&&(b+=a.userinfo+"@"),b+=a.host,a.port&&(b+=":"+a.port));b+=a.path;a.query&&(b+="?"+a.query);a.fragment&&(b+="#"+a.fragment);a=b}else a=this._input;return a},set:function(b){m(b);this._input=b;this._url=a(this._input,this._baseURL)},enumerable:!0},origin:{get:function(){return this._url&&this._url.host?this.protocol+"//"+this.host:
""},enumerable:!0},protocol:{get:function(){return this._url?this._url.scheme+":":":"},set:function(a){m(a);if(this._url&&(a=":"===a.slice(-1)?a.substring(0,a.length-1):a,""===a||q.test(a)))this._url.scheme=a.toLowerCase()},enumerable:!0},_userinfo:{get:function(){return this._url?this._url.userinfo:""},set:function(a){m(a);this._url&&(this._url.userinfo=a)}},username:{get:function(){if(!this._url)return"";var a=E.exec(this._userinfo);return decodeURIComponent(a[1]||"")},set:function(a){m(a);if(this._url){var b=
E.exec(this._userinfo);a=[encodeURIComponent(a||"")];b[2]&&a.push(b[2]);this._userinfo=a.join(":")}},enumerable:!0},password:{get:function(){if(!this._url)return"";var a=E.exec(this._userinfo);return decodeURIComponent(a[2]||"")},set:function(a){m(a);if(this._url){var b=[E.exec(this._userinfo)[1]||""];a&&b.push(encodeURIComponent(a));this._userinfo=b.join(":")}},enumerable:!0},host:{get:function(){var a="";this._url&&this._url.host&&(a+=this._url.host,this._url.port&&(a+=":"+this._url.port));return a},
set:function(a){m(a);if(this._url&&(a=B.exec(a)))this._url.host=a[1],this._url.port=g(a[2])},enumerable:!0},hostname:{get:function(){return this._url?this._url.host:""},set:function(a){m(a);this._url&&w.exec(a)&&(this._url.host=a)},enumerable:!0},port:{get:function(){var a=this._url?this._url.port||"":"";a&&a===D[this.protocol]&&(a="");return a},set:function(a){m(a);this._url&&v.exec(a)&&(this._url.port=g(a))},enumerable:!0},pathname:{get:function(){return this._url?this._url.path:""},set:function(a){m(a);
this._url&&x.exec(a)&&(this._url.host&&(a&&"/"!==a[0])&&(a="/"+a),this._url.path=a?l(a):"")},enumerable:!0},search:{get:function(){return this._url&&this._url.query?"?"+this._url.query:""},set:function(a){m(a);this._url&&(a&&"?"===a[0]&&(a=a.substring(1)),C.exec(a)&&(this._url.query=a))},enumerable:!0},hash:{get:function(){return this._url&&this._url.fragment?"#"+this._url.fragment:""},set:function(a){m(a);this._url&&(a&&"#"===a[0]&&(a=a.substring(1)),z.exec(a)&&(this._url.fragment=a))},enumerable:!0}});
if((d=window.URL||window.webkitURL)&&d.createObjectURL)Object.defineProperty(k,"createObjectURL",{value:d.createObjectURL.bind(d),enumerable:!1}),Object.defineProperty(k,"revokeObjectURL",{value:d.revokeObjectURL.bind(d),enumerable:!1});window.URL=k})();define("orion/URL-shim",function(){});
define("orion/PageLinks","require orion/Deferred orion/PageUtil orion/URITemplate orion/i18nUtil orion/objects orion/URL-shim".split(" "),function(m,s,p,h,c,f){function e(){if(m.toUrl){var a=new URL(m.toUrl("orion/"),window.location.href);return(new URL("../",a)).href.slice(0,-1)}return(new URL("/",window.location.href)).href.slice(0,-1)}function g(a){var b={};a.getPropertyKeys().forEach(function(d){"objectClass"!==d&&("service.names"!==d&&"service.id"!==d&&"__plugin__"!==d)&&(b[d]=a.getProperty(d))});
return b}function l(a,b){var d=a.getServiceReferences(b||"orion.page.link"),c=p.matchResourceParameters(window.location.href),k={OrionHome:e(),Location:c.resource},f=[];d.forEach(function(a){a=g(a);if(a.uriTemplate&&(a.nls||a.name)){var b=(new h(a.uriTemplate)).expand(k),b=p.validateURLScheme(b);a.href=b;a.textContent=a.name||a.nameKey;f.push((new s).resolve(a))}});return s.all(f)}function b(a){var b=this.categories=Object.create(null);a.forEach(function(a){b[a.id]=a})}function a(a){this.allPageLinks=
a;this.allPageLinks.sort(k)}function k(a,b){var d=a.textContent&&a.textContent.toLowerCase(),c=b.textContent&&b.textContent.toLowerCase();return d<c?-1:d>c?1:0}var d;f.mixin(b.prototype,{getCategoryIDs:function(){return Object.keys(this.categories)},getCategory:function(a){return this.categories[a]||null}});f.mixin(a.prototype,{createLinkElements:function(){return this.allPageLinks.map(function(a){var b=a.href;a=a.textContent;var d=document.createElement("a");d.href=b;d.target="_self";d.classList.add("targetSelector");
d.textContent=a;return d})},getAllLinks:function(){return this.allPageLinks}});return{getCategoriesInfo:function(a){var c;return!d?(c=[],a.getServiceReferences("orion.page.link.category").forEach(function(b){var d=g(b);if(d.id&&(d.name||d.nameKey))d.service=a.getService(b),d.textContent=d.name,c.push((new s).resolve(d))}),s.all(c).then(function(a){return d=new b(a)})):(new s).resolve(d)},getPageLinksInfo:function(b,d){return l(b,d).then(function(b){return new a(b)})},getOrionHome:e}});
define("orion/webui/littlelib",["orion/util"],function(m){function s(a,b){b||(b=document);return b.querySelectorAll(a)}function p(a){var b=a.tabIndex;0===b&&m.isIE&&!{a:!0,body:!0,button:!0,frame:!0,iframe:!0,img:!0,input:!0,isindex:!0,object:!0,select:!0,textarea:!0}[a.nodeName.toLowerCase()]&&!a.attributes.tabIndex&&(b=-1);return b}function h(a){if(0<=p(a))return a;if(a.hasChildNodes())for(var b=0;b<a.childNodes.length;b++){var d=h(a.childNodes[b]);if(d)return d}return null}function c(a){if(0<=
p(a))return a;if(a.hasChildNodes())for(var b=a.childNodes.length-1;0<=b;b--){var d=c(a.childNodes[b]);if(d)return d}return null}function f(a,b){if(3===a.nodeType){var d=e.exec(a.nodeValue);d&&1<d.length&&b(a,d)}if(a.hasChildNodes())for(d=0;d<a.childNodes.length;d++)f(a.childNodes[d],b)}var e=/\$\{([^\}]+)\}/,g=null,l={BKSPC:8,TAB:9,ENTER:13,ESCAPE:27,SPACE:32,PAGEUP:33,PAGEDOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,INSERT:45,DEL:46},b=Object.create(null);Object.keys(l).forEach(function(a){b[l[a]]=
a});return{$:function(a,b){b||(b=document);return b.querySelector(a)},$$:s,$$array:function(a,b){return Array.prototype.slice.call(s(a,b))},node:function(a){var b=a;"string"===typeof a&&(b=document.getElementById(a));return b},contains:function(a,b){if(!a||!b)return!1;if(a===b)return!0;var d=a.compareDocumentPosition(b);return Boolean(d&16)},bounds:function(a){a=a.getBoundingClientRect();var b=Math.max(document.documentElement.scrollLeft,document.body.scrollLeft),d=Math.max(document.documentElement.scrollTop,
document.body.scrollTop);return{left:a.left+b,top:a.top+d,width:a.width,height:a.height}},empty:function(a){for(;a.hasChildNodes();)a.removeChild(a.firstChild)},firstTabbable:h,lastTabbable:c,stop:function(a){window.document.all&&(a.keyCode=0);a.preventDefault&&(a.preventDefault(),a.stopPropagation())},processTextNodes:function(a,b){f(a,function(a,c){a.parentNode.replaceChild(document.createTextNode(b[c[1]]||c[1]),a)})},processDOMNodes:function(a,b){f(a,function(a,c){var e=b[c[1]];if(e){var f=document.createRange(),
q=c.index;f.setStart(a,q);f.setEnd(a,q+c[0].length);f.deleteContents();f.insertNode(e)}})},addAutoDismiss:function(a,b){function d(a){g.forEach(function(b){var d=!1,c=b.excludeNodes.some(function(b){return document.body.contains(b)?(d=!0,b.contains(a.target)):!1});if(d&&!c)try{b.dismiss(a)}catch(k){"undefined"!==typeof console&&console&&console.error(k&&k.message)}});g=g.filter(function(a){return a.excludeNodes.some(function(a){return document.body.contains(a)})})}null===g&&(g=[],document.addEventListener("click",
d,!0),m.isIOS&&document.addEventListener("touchend",function(a){function b(){a.target.removeEventListener("click",b)}0===a.touches.length&&a.target.addEventListener("click",b)},!1));g.push({excludeNodes:a,dismiss:b})},setFramesEnabled:function(a){for(var b=document.getElementsByTagName("iframe"),d=0;d<b.length;d++)b[d].parentNode.style.pointerEvents=a?"":"none"},getOffsetParent:function(a){a=a.parentNode;for(var b=document.documentElement;a&&a!==b;){var d=window.getComputedStyle(a,null);if(!d)break;
d=d.getPropertyValue("overflow-y");if("auto"===d||"scroll"===d)break;a=a.parentNode}return a},removeAutoDismiss:function(a){g=g.filter(function(b){return a!==b.dismiss})},keyName:function(a){return b[a]||null},KEY:l,createNodes:function(a,b){var d=b,c=null;void 0===d&&(d=document.createElement("div"));d.innerHTML=a;return c=1<d.children.length?d.children:d.firstChild}}});
define("orion/editor/tooltip","i18n!orion/editor/nls/messages orion/editor/textView orion/editor/projectionTextModel orion/Deferred orion/editor/util orion/PageLinks orion/URITemplate orion/webui/littlelib orion/util".split(" "),function(m,s,p,h,c,f,e,g,l){function b(a){this._view=a;a=a.getOptions("parent");this._create(a?a.ownerDocument:document)}b.getTooltip=function(a){a._tooltip||(a._tooltip=new b(a));return a._tooltip};b.prototype={_create:function(a){if(!this._tooltipDiv){var b=this._tooltipDiv=
l.createElement(a,"div");b.tabIndex=0;b.className="textviewTooltip";b.setAttribute("aria-live","assertive");b.setAttribute("aria-atomic","true");this._tooltipDiv.style.visibility="hidden";var d=this._tooltipContents=l.createElement(a,"div");b.appendChild(d);a.body.appendChild(b);var e=this;c.addEventListener(a,"mousedown",this._mouseDownHandler=function(a){e.isVisible()&&(c.contains(b,a.target||a.srcElement)||e.hide())},!0);c.addEventListener(a,"mousemove",this._mouseMoveHandler=function(a){e.isVisible()&&
e.OKToHide(a.clientX,a.clientY)&&e.hide()},!0);c.addEventListener(b,"mouseover",function(a){e._inTooltip=!0},!1);c.addEventListener(b,"mouseout",function(a){e._inTooltip=!1},!1);c.addEventListener(b,"keydown",function(a){27===a.keyCode&&e.hide()},!1);this._view.addEventListener("Destroy",function(){e.destroy()})}},_getWindow:function(){var a=this._tooltipDiv.ownerDocument;return a.defaultView||a.parentWindow},destroy:function(){if(this._tooltipDiv){this.hide();var a=this._tooltipDiv.parentNode;a&&
a.removeChild(this._tooltipDiv);a=this._tooltipDiv.ownerDocument;c.removeEventListener(a,"mousedown",this._mouseDownHandler,!0);c.removeEventListener(a,"mousemove",this._mouseMoveHandler,!0);this._tooltipDiv=null}},_hasFocus:function(){var a=this._tooltipDiv;return!a?!1:c.contains(a,a.ownerDocument.activeElement)},_setContentRange:function(a,b){this._contentRangeStart=a;this._contentRangeEnd=b;var d=this._view,c=d.getLineAtOffset(a),e=d.getLineAtOffset(b);c!==e&&(a=d.getLineStart(c),b=d.getModel().getLineEnd(c));
c=d.getLineHeight(c);e=d.getLocationAtOffset(a);d=d.getLocationAtOffset(b);d={x:e.x,y:e.y,width:d.x-e.x,height:c};d=this._view.convert(d,"document","page");this._hoverArea={left:d.x,top:d.y,width:d.width,height:d.height}},_isInRect:function(a,b,d){if(!a)return!1;d=d>=a.top&&d<=a.top+a.height;return b>=a.left&&b<=a.left+a.width&&d},hide:function(){this.isVisible()&&(this.hover&&this.hover.clearQuickFixes(),this._hasFocus()&&this._view.focus(),this._contentsView&&(this._contentsView.destroy(),this._contentsView=
null),this._tooltipContents&&(this._tooltipContents.innerHTML=""),this._tooltipDiv.style.visibility="hidden",this._tooltipDiv.style.left="auto",this._tooltipDiv.style.right="auto",this._tooltipDiv.style.top="auto",this._tooltipDiv.style.bottom="auto",this._tooltipDiv.style.width="auto",this._tooltipDiv.style.height="auto",this._hoverInfo&&this._hoverInfo.forEach(function(a){a.cancel()}),this._tipRect=this._hoverRect=this._hoverInfo=this._preventTooltipClose=this._hoverArea=this._position=this._offsetY=
this._offsetX=this._target=void 0)},isVisible:function(){return this._tooltipDiv&&"visible"===this._tooltipDiv.style.visibility},OKToHover:function(a,b){return!this.isVisible()?!0:this._preventTooltipClose&&this._preventTooltipClose()||this._hasFocus()?!1:!this._isInRect(this._hoverArea,a,b)},OKToHide:function(a,b){return!this.isVisible()||this._preventTooltipClose&&this._preventTooltipClose()||this._hasFocus()?!1:!this._isInRect(this._hoverRect,a,b)},show:function(a,b){if(a){var d=this._tooltipDiv,
c=this._tooltipContents;if(d&&c&&!this._isInRect(this._hoverArea,a.clientX,a.clientY)&&!this._isInRect(this._tipRect,a.clientX,a.clientY)){var e=a.getTooltipInfo();if(e){this.isVisible()&&this.hide();this._position=e.position;this._hoverArea=e.hoverArea;this._offsetX=e.offsetX;this._offsetY=e.offsetY;this._target=a;d.style.left=d.style.right=d.style.width=d.style.height=c.style.width=c.style.height="auto";var f=d.ownerDocument,q=f.documentElement,v=e.contents;v instanceof Array&&(v=this._getAnnotationContents(v,
e.context));if(this.hover&&void 0!==e.offset&&!v){var l=Object.create(null);e.context&&(l=e.context);l.offset=e.offset;this._hoverInfo=this.hover.computeHoverInfo(l)}if("string"===typeof v)c.innerHTML=v;else if(this._isNode(v))c.appendChild(v);else if(v instanceof p.ProjectionTextModel){this._offsetX=-1;this._offsetY=-3;var m=this._view,l=m.getOptions();l.wrapMode=!1;l.parent=c;var x=l.themeClass;x?((x=x.replace("tooltipTheme",""))&&(x=" "+x),x="tooltipTheme"+x):x="tooltipTheme";l.themeClass=x;l=
this._contentsView=new s.TextView(l);l.addEventListener("LineStyle",function(a){m.onLineStyle(a)});l.setModel(v);x=l.computeSize();c.style.width=x.width+"px";c.style.height=x.height+"px";l.resize()}else if(!this._hoverInfo||!this._hoverInfo.length)return;e.width&&(d.style.width=e.width+"px");e.height&&(d.style.height=e.height+"px",d.style.overflowY="auto");l=parseInt(this._getNodeStyle(d,"padding-top","0"),10);l+=parseInt(this._getNodeStyle(d,"border-top-width","0"),10);l=e.y-l;d.style.top=l+"px";
d.style.maxHeight=q.clientHeight-l-10+"px";d.style.opacity="1";e.preventTooltipClose&&(this._preventTooltipClose=e.preventTooltipClose);var C=this;this._hoverInfo&&this._hoverInfo.forEach(function(a){h.when(a,function(a){a&&C._renderContent(f,c,a)&&(C._showTooltip(b,d),a=g.bounds(d),C._setHoverRect(C._hoverArea,a))},function(a){"undefined"!==typeof console&&(console.log("Error computing hover tooltip"),console.log(a&&a.stack))})});v&&this._showTooltip(b,d)}}}},_showTooltip:function(a,b){if(!this.isVisible()){if(!this._hoverArea){var d=
this._view.getOffsetAtLocation(this._target.x,this._target.y);if(0<=d){var c=this._view.getNextOffset(d,{unit:"word",count:-1}),d=this._view.getNextOffset(d,{unit:"word",count:0});this._setContentRange(c,d)}else this._hoverArea={left:this._target.clientX-8,top:this._target.clientY-8,width:16,height:16}}c=this._tooltipDiv;d=g.bounds(c);this._position||(this._position="below");this._offsetX||(this._offsetX=0);this._offsetY||(this._offsetY=0);var e={width:d.width,height:d.height};switch(this._position){case "left":e.left=
this._hoverArea.left-(d.width+this._offsetX);e.top=this._hoverArea.top+this._offsetY;break;case "right":e.left=this._hoverArea.left+this._hoverArea.width+this._offsetX;e.top=this._hoverArea.top+this._offsetY;break;case "above":e.left=this._hoverArea.left+this._offsetX;e.top=this._hoverArea.top-(d.height+this._offsetY);break;case "below":e.left=this._hoverArea.left+this._offsetX,e.top=this._hoverArea.top+this._hoverArea.height+this._offsetY}c.style.left=e.left+"px";c.style.top=e.top+"px";this._setHoverRect(this._hoverArea,
e);this._tooltipDiv.style.visibility="visible";!0===a&&this._setInitialFocus(b)}},_setHoverRect:function(a,b){var d=Math.min(a.left,b.left),c=Math.min(a.top,b.top),e=Math.max(a.left+a.width,b.left+b.width),f=Math.max(a.top+a.height,b.top+b.height);this._tipRect=b;this._hoverRect={left:d,top:c,width:e-d,height:f-c}},_setInitialFocus:function(a){var b=g.$("button",a);if(b)b.focus();else if(b=g.$("a",a)){b.focus();var d=this;b.addEventListener("click",function(){d.hide()})}else(a=g.firstTabbable(a))&&
a.focus()},_renderContent:function(a,b,d){if("undefined"===typeof d.content&&"undefined"===typeof d.uriTemplate)return!1;var c=l.createElement(a,"div");if(d.title){var e=l.createElement(a,"div");e.innerHTML=this.hover.renderMarkDown?this.hover.renderMarkDown(d.title):d.title;c.appendChild(e)}e=l.createElement(a,"div");switch(d.type){case "delegatedUI":case "html":d.content&&(a=document.createElement("iframe"),a.id="HtmlHover",a.name="HTML Hover",a.type="text/html",a.sandbox="allow-scripts allow-same-origin allow-forms",
a.style.border="none",a.style.width="auto",a.style.height="auto",a.srcdoc=d.content,d.width&&(a.style.width=d.width),d.height&&(a.style.height=d.height),c.appendChild(a));break;case "markdown":this.hover.renderMarkDown&&(e.innerHTML=this.hover.renderMarkDown(d.content));break;default:e.appendChild(a.createTextNode(d.content))}c.appendChild(e);b.appendChild(c);return!0},_getAnnotationContents:function(a,b){function d(a,b){var d=C.getLineStart(C.getLineAtOffset(a)),c=C.getLineEnd(C.getLineAtOffset(b),
!0);return C.getText(d,c)}function e(a,b){var k=a.title,n=l.createElement(h,"div");n.className="tooltipRow";if(a.html){var q=l.createElement(h,"div");q.className="tooltipImage";q.innerHTML=a.html;q.lastChild&&c.addEventListener(q.lastChild,"click",function(){var b=a.start,d=a.end;x.getBaseModel&&(b=x.mapOffset(b,!0),d=x.mapOffset(d,!0));B.setSelection(b,d,1/3,function(){g.hide()})},!1);n.appendChild(q)}k||(k=d(a.start,a.end));"function"===typeof k&&(k=a.title());"string"===typeof k&&(q=l.createElement(h,
"span"),q.className="tooltipTitle",q.appendChild(h.createTextNode(k)),k=q);n.appendChild(k);b&&g.hover.renderQuickFixes(a,n);g._hoverArea||g._setContentRange(a.start,a.end);return n}for(var n,f=[],q=0;q<a.length;q++)n=a[q],""!==n.title&&!n.groupAnnotation&&f.push(n);a=f;if(0===a.length)return null;var g=this,h=this._tooltipDiv.ownerDocument,B=this._view,x=B.getModel(),C=x.getBaseModel?x.getBaseModel():x;(f=g.hover?!0:!1)&&(b&&b.source&&0<=b.source.indexOf("ruler"))&&(f=!1);if(1===a.length){n=a[0];
if(void 0!==n.title)return n=e(n,f),n.firstChild&&((f=n.firstChild.className)&&(f+=" "),n.firstChild.className=f+"single"),n;if(b&&b.source&&"editor"===b.source)return null;var f=new p.ProjectionTextModel(C),q=C.getLineStart(C.getLineAtOffset(n.start)),z=C.getCharCount();n.end!==z&&f.addProjection({start:n.end,end:z});0<q&&f.addProjection({start:0,end:q});return f}q=l.createElement(h,"div");n=l.createElement(h,"em");n.appendChild(h.createTextNode(m.multipleAnnotations));q.appendChild(n);for(z=0;z<
a.length;z++)n=a[z],(n=e(n,f))&&q.appendChild(n);return q},_getNodeStyle:function(a,b,d){return c.getNodeStyle(a,b,d)},_isNode:function(a){return"object"===typeof Node?a instanceof Node:a&&"object"===typeof a&&"number"===typeof a.nodeType&&"string"===typeof a.nodeName}};return{Tooltip:b}});
define("orion/editor/rulers","i18n!orion/editor/nls/messages orion/editor/textView orion/editor/annotations orion/editor/tooltip orion/objects orion/webui/littlelib orion/editor/util orion/util".split(" "),function(m,s,p,h,c,f,e,g){function l(a,b,d){this._location=a||"left";this._overview=b||"page";this._rulerStyle=d;this._view=null}function b(a,b,d,c){l.call(this,b,d,c);var e=this;this._listener={onTextModelChanged:function(a){e._onTextModelChanged(a)},onAnnotationModelChanged:function(a){e._onAnnotationModelChanged(a)}};
this.setAnnotationModel(a)}function a(a,d,c,e,k){b.call(this,a,d,"page",c);this._oddStyle=e||{style:{backgroundColor:"white"}};this._evenStyle=k||{style:{backgroundColor:"white"}};this._numOfDigits=0;this._firstLine=1}function k(a,d,c){b.call(this,a,d,"page",c)}function d(a,d,c){b.call(this,a,d,"document",c)}function r(a,b,d){k.call(this,a,b,d)}l.prototype={getLocation:function(){return this._location},getOverview:function(){return this._overview},getRulerStyle:function(){return this._rulerStyle},
getView:function(){return this._view},setView:function(a){this._onTextModelChanged&&this._view&&this._view.removeEventListener("ModelChanged",this._listener.onTextModelChanged);this._view=a;this._onTextModelChanged&&this._view&&this._view.addEventListener("ModelChanged",this._listener.onTextModelChanged)}};b.prototype=c.mixin(new l,{getAnnotations:function(a,b){var d=this._annotationModel;if(!d)return[];var c=this._view.getModel(),e=c.getLineStart(a),k=c.getLineEnd(b-1),f=c;c.getBaseModel&&(f=c.getBaseModel(),
e=c.mapOffset(e),k=c.mapOffset(k));for(var r=[],d=this.getAnnotationsByType(d,e,k),e=0;e<d.length;e++)for(var k=d[e],g=f.getLineAtOffset(k.start),l=f.getLineAtOffset(Math.max(k.start,k.end-1)),h=g;h<=l;h++){var m=h;if(c!==f){m=f.getLineStart(h);m=c.mapOffset(m,!0);if(-1===m)continue;m=c.getLineAtOffset(m)}if(a<=m&&m<b){var p=this._mergeAnnotation(r[m],k,h-g,l-g+1);p&&(r[m]=p)}}if(!this._multiAnnotation&&this._multiAnnotationOverlay)for(var s in r)r[s]._multiple&&(r[s].html+=this._multiAnnotationOverlay.html);
return r},getAnnotationModel:function(){return this._annotationModel},getWidestAnnotation:function(){return null},setAnnotationModel:function(a){this._annotationModel&&this._annotationModel.removEventListener("Changed",this._listener.onAnnotationModelChanged);(this._annotationModel=a)&&this._annotationModel.addEventListener("Changed",this._listener.onAnnotationModelChanged)},setMultiAnnotation:function(a){this._multiAnnotation=a},setMultiAnnotationOverlay:function(a){this._multiAnnotationOverlay=
a},onClick:function(a,b){if(void 0!==a){var d=this._view,c=d.getModel(),e=c.getLineStart(a),k=c.getLineEnd(a,!0),f=d.getSelection().start,d=d.getSelection().end,r=this._annotationModel,g,l,m;if(r){c.getBaseModel&&(e=c.mapOffset(e),k=c.mapOffset(k),f=c.mapOffset(f),d=c.mapOffset(d));var p=this;l=(g=this._findNextAnnotation(r,e,k,f,d,function(a){return p.isAnnotationTypeVisible(a)}))?g.start:e;m=g?g.end:e;c.getBaseModel&&(l=c.mapOffset(l,!0),m=c.mapOffset(m,!0));g&&void 0!==g.groupId&&(this._currentClickGroup=
this._currentClickGroup===g.groupId?null:g.groupId,this._setCurrentGroup(a))}this._view.setSelection(m,l,1/3,function(){});(c=h.Tooltip.getTooltip(this._view))&&(g&&"left"===this.getLocation()?c.show({clientX:b.clientX,clientY:b.clientY,getTooltipInfo:function(){return p._getOnClickTooltipInfo(g)}},!1):c.hide())}},onDblClick:function(a,b){},onMouseMove:function(a,b){var d=h.Tooltip.getTooltip(this._view);if(d&&!(d.isVisible()&&this._tooltipLineIndex===a)&&(this._tooltipLineIndex=a,!(b.clientX===this._lastMouseX&&
b.clientY===this._lastMouseY))){this._lastMouseX=b.clientX;this._lastMouseY=b.clientY;this._hoverTimeout&&(window.clearTimeout(this._hoverTimeout),this._hoverTimeout=null);this._curElementBounds=f.bounds(b.target?b.target:b.srcElement);var c=this;c._hoverTimeout=window.setTimeout(function(){c._hoverTimeout=null;d.OKToHover(b.clientX,b.clientY)&&d.show({clientX:b.clientX,clientY:b.clientY,getTooltipInfo:function(){return c._getTooltipInfo(c._tooltipLineIndex,this.clientY)}})},175)}},onMouseOver:function(a,
b){this.onMouseMove(a,b);this._currentClickGroup||this._setCurrentGroup(a)},onMouseOut:function(a,b){this._currentClickGroup||this._setCurrentGroup(-1);this._hoverTimeout&&(window.clearTimeout(this._hoverTimeout),this._hoverTimeout=null)},_findNextAnnotation:function(a,b,d,c,e,k){var f=null,r,g=b;if(0<=c&&0<=e&&c>=b&&c<d)for(var g=c,l=a.getAnnotations(c,e);!r&&l.hasNext();)if(b=l.next(),!k||k(b.type))b.start===c&&b.end===e&&(r=b);a=a.getAnnotations(g,d);for(var h;a.hasNext();)if(b=a.next(),!k||k(b.type)){f||
(f=b);if(!r){f=b;break}if(h&&(r.start!==b.start||r.end!==b.end)){h=!1;f=b;break}r&&r===b&&(h=!0)}h&&(f=null);return f},_getTooltipInfo:function(a,b){if(void 0!==a){var d=this._view,c=d.getModel(),e=this._annotationModel,k=[];if(e){var k=c.getLineStart(a),r=c.getLineEnd(a);c.getBaseModel&&(k=c.mapOffset(k),r=c.mapOffset(r));k=this.getAnnotationsByType(e,k,r)}e=this._getTooltipContents(a,k);if(!e)return null;c=this._curElementBounds;"string"===typeof e&&(c.top=b,c.height=1);k=this.getLocation();e={contents:e,
position:"left"===k?"right":"left",hoverArea:c,context:{source:"ruler"+k}};d=f.bounds(d._clientDiv);e.offsetX=d.left-(c.left+c.width);e.offsetY=c.height;"left"===e.position&&(e.offsetX=20);return e}},_getOnClickTooltipInfo:function(a){var b=this._view,d=this._curElementBounds,c="left"===this.getLocation()?"right":"left";a={contents:[a],position:c,hoverArea:d};b=f.bounds(b._clientDiv);a.offsetX=b.left-(d.left+d.width);a.offsetY=d.height;"left"===a.position&&(a.offsetX=20);return a},_getTooltipContents:function(a,
b){return b},_onAnnotationModelChanged:function(a){function b(a){for(var k=0;k<a.length;k++)if(e.isAnnotationTypeVisible(a[k].type)){var n=a[k].start,f=a[k].end;c.getBaseModel&&(n=c.mapOffset(n,!0),f=c.mapOffset(f,!0));-1!==n&&-1!==f&&d.redrawLines(c.getLineAtOffset(n),c.getLineAtOffset(Math.max(n,f-1))+1,e)}}var d=this._view;if(d){var c=d.getModel(),e=this,k=c.getLineCount();a.textModelChangedEvent?(a=a.textModelChangedEvent.start,c.getBaseModel&&(a=c.mapOffset(a,!0)),a=c.getLineAtOffset(a),d.redrawLines(a,
k,e)):(b(a.added),b(a.removed),b(a.changed))}},_mergeAnnotation:function(a,b,d,c){a||(a={});0===d&&(a.html&&b.html?(b.html!==a.html&&(!a._multiple&&this._multiAnnotation)&&(a.html=this._multiAnnotation.html),a._multiple=!0):a.html=b.html);a.style=this._mergeStyle(a.style,b.style);return a},_mergeStyle:function(a,b){if(b){a||(a={});a.styleClass=a.styleClass&&b.styleClass&&a.styleClass!==b.styleClass?a.styleClass+(" "+b.styleClass):b.styleClass;var d;if(b.style)for(d in a.style||(a.style={}),b.style)void 0===
a.style[d]&&(a.style[d]=b.style[d]);if(b.attributes)for(d in a.attributes||(a.attributes={}),b.attributes)void 0===a.attributes[d]&&(a.attributes[d]=b.attributes[d])}return a},_setCurrentGroup:function(a){var b=this._annotationModel,d=null,c=b.getTextModel(),e,k=this._currentGroupAnnotation;if(-1!==a){var f=c.getLineStart(a),r=c.getLineEnd(a);c.getBaseModel&&(f=c.mapOffset(f),r=c.mapOffset(r));for(e=b.getAnnotations(f,r);e.hasNext();)if(c=e.next(),this.isAnnotationTypeVisible(c.type)&&c.start<=f&&
c.end>=r&&void 0!==c.groupId){d=c;break}if(k&&d&&k.groupId===d.groupId)return}this._currentGroupAnnotation=null;k&&b.removeAnnotations(k.groupType);if(d&&-1!==a){this._currentGroupAnnotation=d;e=b.getAnnotations();for(a=[];e.hasNext();)c=e.next(),delete c.groupAnnotation,c.groupId===d.groupId&&(c=c.createGroupAnnotation(),a.push(c));b.replaceAnnotations(null,a)}}});p.AnnotationTypeList.addMixin(b.prototype);a.prototype=new b;a.prototype.getAnnotations=function(a,d){for(var c=b.prototype.getAnnotations.call(this,
a,d),e=this._view.getModel(),k=a;k<d;k++){var f=k-this._firstLine&1?this._oddStyle:this._evenStyle,r=k;e.getBaseModel&&(r=e.getLineStart(r),r=e.getBaseModel().getLineAtOffset(e.mapOffset(r)));c[k]||(c[k]={});c[k].html=this._firstLine+r+"";c[k].style||(c[k].style=f)}return c};a.prototype.getWidestAnnotation=function(){var a=this._view.getModel().getLineCount();return this.getAnnotations(a-1,a)[a-1]};a.prototype.setFirstLine=function(a){this._firstLine=void 0!==a?a:1};a.prototype._onTextModelChanged=
function(a){var b=a.start;a=this._view.getModel();var d=a.getBaseModel?a.getBaseModel().getLineCount():a.getLineCount(),d=(this._firstLine+d-1+"").length;this._numOfDigits!==d&&(this._numOfDigits=d,b=a.getLineAtOffset(b),this._view.redrawLines(b,a.getLineCount(),this))};k.prototype=new b;d.prototype=new b;d.prototype.getRulerStyle=function(){var a={style:{lineHeight:"1px",fontSize:"1px"}};return a=this._mergeStyle(a,this._rulerStyle)};d.prototype._getTooltipContents=function(a,d){if(0===d.length){var c=
this._view.getModel(),e=a;c.getBaseModel&&(e=c.getLineStart(e),e=c.getBaseModel().getLineAtOffset(c.mapOffset(e)));return g.formatMessage(m.line,e+1)}return b.prototype._getTooltipContents.call(this,a,d)};d.prototype._mergeAnnotation=function(a,b,d,c){if(0===d)return a||(a={html:"\x26nbsp;",style:{style:{height:3*c+"px"}}},a.style=this._mergeStyle(a.style,b.overviewStyle)),a};r.prototype=new k;r.prototype.onClick=function(a,b){if(void 0!==a){var d=this._annotationModel;if(d){var c=this._view.getModel(),
e=c.getLineStart(a),k=c.getLineEnd(a,!0);c.getBaseModel&&(e=c.mapOffset(e),k=c.mapOffset(k),c=c.getBaseModel());for(var f,d=d.getAnnotations(e,k);!f&&d.hasNext();)k=d.next(),this.isAnnotationTypeVisible(k.type)&&c.getLineAtOffset(k.start)===c.getLineAtOffset(e)&&(f=k);f&&((c=h.Tooltip.getTooltip(this._view))&&c.hide(),f.expanded?f.collapse():f.expand())}}};r.prototype._getTooltipContents=function(a,b){if(0<b.length){var d=this._view.getModel(),c=d.getLineStart(a);d.getBaseModel&&(c=d.mapOffset(c),
d=d.getBaseModel());for(var c=d.getLineAtOffset(c),e=0;e<b.length;e++){var f=b[e];if(this.isAnnotationTypeVisible(f.type)&&d.getLineAtOffset(f.start)===c){if(b[e].expanded)break;return k.prototype._getTooltipContents.call(this,a,[f])}}}return null};r.prototype._onAnnotationModelChanged=function(a){function b(a){for(f=0;f<a.length;f++)if(e.isAnnotationTypeVisible(a[f].type)){var d=a[f].start;c.getBaseModel&&(d=c.mapOffset(d,!0));-1!==d&&(g=Math.min(g,c.getLineAtOffset(d)))}}if(a.textModelChangedEvent)k.prototype._onAnnotationModelChanged.call(this,
a);else{var d=this._view;if(d){var c=d.getModel(),e=this,f,r=c.getLineCount(),g=r;b(a.added);b(a.removed);b(a.changed);a=d.getRulers();for(f=0;f<a.length;f++)d.redrawLines(g,r,a[f])}}};p=function(a,b){l.call(this,a,"fixed",b)};p.prototype=c.mixin(new l,{setView:function(a){this._destroy();l.prototype.setView.call(this,a);this._create()},_create:function(){function a(b){var d=b.themeClass;d?((d=d.replace("textviewZoom",""))&&(d=" "+d),d="textviewZoom"+d):d="textviewZoom";b.themeClass=d;b.noScroll=
!0;b.readonly=!0;return b}function b(){var a=r._metrics.viewPadding,d=r._metrics.viewPadding,c=r.getLineHeight(),e=h.getLineHeight(),k=r.getModel().getLineCount(),c=r._lineHeight?r._scrollHeight:k*c,e=h._lineHeight?h._scrollHeight:k*e,k=e/c,f=r.getClientArea().height+a.top+a.bottom,d=h.getClientArea().height+d.top+d.bottom;return{zoomFactor:k,documentHeight:c,zoomDocumentHeight:e,clientHeight:f,zoomClientHeight:d,scrollWidth:r._metrics.scrollWidth,windowHeight:f*k,padding:a}}function d(a){a=a||{y:r.getTopPixel()};
var c=b();h.setTopPixel(a.y*(c.zoomFactor+(c.windowHeight-c.clientHeight-c.scrollWidth)/c.documentHeight));a=a.y*c.zoomFactor;c=c.clientHeight*c.zoomFactor;y.top=a;y.bottom=a+c;a=h.convert({y:a},"document","page").y;a-=y.node.getBoundingClientRect().top;p.style.top=a+"px";p.style.height=c-D+"px"}function c(a){a.wrapMode&&!a.wrapOffset&&r._metrics.charWidth?(a=g.createElement(m,"div"),a.style.position="fixed",a.style.left="-1000px",h._clientDiv.appendChild(a),a.innerHTML=Array(Math.ceil(r.getClientArea().width/
r._metrics.charWidth)+1).join("a"),a=a.getBoundingClientRect(),a=Math.min(150,Math.ceil(a.right-a.left))+"px"):a="";var b=y.node.style.width;y.node.style.width=a;return b!==a}function k(a,b,d){d||y.top<=a.y&&a.y<=y.bottom?(y.mouseDown=!0,y.delta=b-p.getBoundingClientRect().top+y.node.getBoundingClientRect().top):(a=h.getOffsetAtLocation(a.x,a.y),r.setSelection(a,a,0.5,function(){}))}function f(a){if(y.mouseDown){var d=b();a=Math.min(d.zoomClientHeight-d.windowHeight,Math.max(0,a-y.delta));r.setTopPixel(a*
(d.documentHeight-d.clientHeight)/Math.min(d.zoomDocumentHeight,d.zoomClientHeight-d.windowHeight))}}var r=this.getView();if(r){var l=a(r.getOptions());l.parent=this.node;var h=this._zoomView=new s.TextView(l);h._clientDiv.contentEditable=!1;h.setModel(r.getModel());var m=r.getOptions("parent").ownerDocument,p=this._windowDiv=g.createElement(m,"div");p.className="rulerZoomWindow";this.node.appendChild(p);var D=parseInt(e.getNodeStyle(p,"border-top-width",0))+parseInt(e.getNodeStyle(p,"border-bottom-width",
0)),y=this;r.addEventListener("Scroll",this._scrollListener=function(a){d(a.newValue)});r.addEventListener("Resize",this._resizeListener=function(){c(h.getOptions());d()});r.addEventListener("Redraw",this._redrawListener=function(a){a.ruler||h.redrawLines(a.startLine,a.endLine)});r.addEventListener("Options",this._optionsListener=function(b){b=a(b.options);h.setOptions(b);c(h.getOptions())});h.addEventListener("LineStyle",this._lineListener=function(a){r.onLineStyle(a)});g.isIOS||g.isAndroid?(p.addEventListener("touchstart",
function(a){1===a.touches.length&&(k(a,a.touches[0].clientY,!0),a.preventDefault())}),p.addEventListener("touchend",function(a){0===a.touches.length&&(y.mouseDown=!1)}),p.addEventListener("touchmove",function(a){1===a.touches.length&&f(a.touches[0].clientY)}),h.addEventListener("TouchStart",function(a){1===a.touchCount&&(k(a,a.event.touches[0].clientY),a.preventDefault())})):(p.style.pointerEvents="none",h.addEventListener("MouseDown",function(a){var b=a.event;(b.which?0===b.button:1===b.button)&&
k(a,b.clientY);a.preventDefault()}),h.addEventListener("MouseUp",function(a){y.mouseDown=!1;a.preventDefault()}),h.addEventListener("MouseMove",function(a){f(a.event.clientY);a.preventDefault()}));(m.defaultView||m.parentWindow).setTimeout(function(){d()},0)}},_destroy:function(){var a=this.getView();a&&(a.removeEventListener("Scroll",this._scrollListener),this._scrollListener=null,a.removeEventListener("Resize",this._resizeListener),this._resizeListener=null,a.removeEventListener("Redraw",this._redrawListener),
this._redrawListener=null,a.removeEventListener("Options",this._optionsListener),this._optionsListener=null);if(a=this._zoomView)a.removeEventListener("LineStyle",this._lineListener),a.setModel(null),a.destroy(),this._zoomView=null}});return{BaseRuler:l,Ruler:b,AnnotationRuler:k,LineNumberRuler:a,OverviewRuler:d,FoldingRuler:r,ZoomRuler:p}});
define("orion/editor/undoStack",[],function(){function m(h,c,f,e,g){this.model=h;this.offset=c;this.text=f;this.previousText=e;this.type=g}function s(h){this.owner=h;this.changes=[]}function p(h,c){this.size=void 0!==c?c:100;this.reset();var f=this;this._listener={onChanging:function(c){f._onChanging(c)},onDestroy:function(c){f._onDestroy(c)}};if(h.getModel){var e=h.getModel();e.getBaseModel&&(e=e.getBaseModel());this.model=e;this.setView(h)}else this.shared=!0,this.model=h;this.model.addEventListener("Changing",
this._listener.onChanging)}m.prototype={getRedoChanges:function(){return[{start:this.offset,end:this.offset+this.previousText.length,text:this.text}]},getUndoChanges:function(){return[{start:this.offset,end:this.offset+this.text.length,text:this.previousText}]},undo:function(h,c){this._doUndoRedo(this.offset,this.previousText,this.text,h,c);return!0},redo:function(h,c){this._doUndoRedo(this.offset,this.text,this.previousText,h,c);return!0},merge:function(h,c,f,e,g){if(e===this.type){if(1===e&&h===
this.offset+this.text.length)return this.text+=c,!0;if(-1===e&&g===this.offset)return this.offset=h,this.previousText=f+this.previousText,!0;if(-1===e&&h===this.offset)return this.previousText+=f,!0}return!1},_doUndoRedo:function(h,c,f,e,g){this.model.setText(c,h,h+f.length);g&&e&&(f=e.getModel(),f!==this.model&&(h=f.mapOffset(h,!0)),e.setSelection(h,h+c.length))}};s.prototype={getRedoChanges:function(){for(var h=[],c=0;c<this.changes.length;c++)h=h.concat(this.changes[c].getRedoChanges());return h},
getUndoChanges:function(){for(var h=[],c=this.changes.length-1;0<=c;c--)h=h.concat(this.changes[c].getUndoChanges());return h},add:function(h){this.changes.push(h)},end:function(h){h&&(this.endSelection=h.getSelections());(h=this.owner)&&h.end&&h.end()},undo:function(h,c){1<this.changes.length&&h&&h.setRedraw(!1);for(var f=this.changes.length-1;0<=f;f--)this.changes[f].undo(h,!1);c&&h&&h.setSelections(this.startSelection);1<this.changes.length&&h&&h.setRedraw(!0);(f=this.owner)&&f.undo&&f.undo();
return 0<this.changes.length},redo:function(h,c){1<this.changes.length&&h&&h.setRedraw(!1);for(var f=0;f<this.changes.length;f++)this.changes[f].redo(h,!1);c&&h&&h.setSelections(this.endSelection);(1<this.changes.length,h)&&h.setRedraw(!0);(f=this.owner)&&f.redo&&f.redo();return 0<this.changes.length},merge:function(h,c,f,e,g,l){var b=this.changes.length;return 0<b&&this===l?this.changes[b-1].merge(h,c,f,e,g):!1},start:function(h){h&&(this.startSelection=h.getSelections());(h=this.owner)&&h.start&&
h.start()}};p.prototype={destroy:function(){this._onDestroy()},add:function(h){this.compoundChange?this.compoundChange.add(h):(this.stack.splice(this.index,this.stack.length-this.index,h),this.index++,this.stack.length>this.size&&(this.stack.shift(),this.index--))},markClean:function(){this._commitUndo();if(this.cleanChange=this.stack[this.index-1])this.cleanChange.type=2},isClean:function(){return this.cleanChange===this.stack[this.index-1]},canUndo:function(){return 0<this.index},canRedo:function(){return 0<
this.stack.length-this.index},endCompoundChange:function(){this.compoundChange&&this.compoundChange.end(this.view);this.compoundChange=void 0},getSize:function(){return{undo:this.index,redo:this.stack.length-this.index}},getRedoChanges:function(){this._commitUndo();for(var h=[],c=this.index;c<this.stack.length;c++)h=h.concat(this.stack[c].getRedoChanges());return h},getUndoChanges:function(){this._commitUndo();for(var h=[],c=this.index;0<=c;c--)h=h.concat(this.stack[c].getUndoChanges());return h},
undo:function(){this._commitUndo();var h;h=!1;this._ignoreUndo=!0;do{if(0>=this.index)break;h=this.stack[--this.index]}while(!(h=h.undo(this.view,!0)));this._ignoreUndo=!1;return h},redo:function(){this._commitUndo();var h;h=!1;this._ignoreUndo=!0;do{if(this.index>=this.stack.length)break;h=this.stack[this.index++]}while(!(h=h.redo(this.view,!0)));this._ignoreUndo=!1;return h},reset:function(){this.index=0;this.cleanChange=void 0;this.stack=[];this._ignoreUndo=!1;this._compoundChange=void 0},setView:function(h){this.view!==
h&&(this.view&&h.removeEventListener("Destroy",this._listener.onDestroy),(this.view=h)&&h.addEventListener("Destroy",this._listener.onDestroy))},startCompoundChange:function(h){this._commitUndo();h=new s(h);this.add(h);this.compoundChange=h;this.compoundChange.start(this.view);return this.compoundChange},_commitUndo:function(){this.endCompoundChange()},_onDestroy:function(h){(!h||!this.shared)&&this.model.removeEventListener("Changing",this._listener.onChanging);this.view&&(this.view.removeEventListener("Destroy",
this._listener.onDestroy),this.view=null)},_onChanging:function(h){if(!this._ignoreUndo){var c=h.text,f=h.start,e=h.addedCharCount,g=h.removedCharCount;h=f+g;var l=0;0===e&&1===g?l=-1:1===e&&0===g&&(l=1);e=this.stack.length;g=this.model.getText(f,h);(!(0<e&&this.index===e)||!this.stack[e-1].merge(f,c,g,l,h,this.compoundChange))&&this.add(new m(this.model,f,c,g,l))}}};return{UndoStack:p}});
define("orion/editor/textDND",["orion/util"],function(m){function s(m,h){this._view=m;this._undoStack=h;this._dragSelection=null;this._dropOffset=-1;this._dropText=null;var c=this;this._listener={onDragStart:function(f){c._onDragStart(f)},onDragEnd:function(f){c._onDragEnd(f)},onDragEnter:function(f){c._onDragEnter(f)},onDragOver:function(f){c._onDragOver(f)},onDrop:function(f){c._onDrop(f)},onDestroy:function(f){c._onDestroy(f)}};m.addEventListener("DragStart",this._listener.onDragStart);m.addEventListener("DragEnd",
this._listener.onDragEnd);m.addEventListener("DragEnter",this._listener.onDragEnter);m.addEventListener("DragOver",this._listener.onDragOver);m.addEventListener("Drop",this._listener.onDrop);m.addEventListener("Destroy",this._listener.onDestroy)}s.prototype={destroy:function(){var m=this._view;m&&(m.removeEventListener("DragStart",this._listener.onDragStart),m.removeEventListener("DragEnd",this._listener.onDragEnd),m.removeEventListener("DragEnter",this._listener.onDragEnter),m.removeEventListener("DragOver",
this._listener.onDragOver),m.removeEventListener("Drop",this._listener.onDrop),m.removeEventListener("Destroy",this._listener.onDestroy),this._view=null)},_onDestroy:function(m){this.destroy()},_onDragStart:function(m){var h=this._view,c=h.getSelectionText();c&&(this._dragSelection=h.getSelections(),m.event.dataTransfer.effectAllowed="copyMove",m.event.dataTransfer.setData("Text",c))},_onDragEnd:function(p){if(this._dragSelection){var h=this._view,c=p.event.dataTransfer.dropEffect;if(!m.isFirefox&&
("none"!==c||this._dropText))c=p.event.dataTransfer.dropEffect=this._dropEffect;this._undoStack&&this._undoStack.startCompoundChange();(p="move"===c)&&h.setText({text:"",selection:this._dragSelection});if(this._dropText){var c=this._dropText,f=this._dropOffset;p&&this._dragSelection.forEach(function(c){f>=c.end?f-=c.end-c.start:f>=c.start&&(f=c.start)});h.setText(c,f,f);h.setSelection(f,f+c.length);this._dropText=null;this._dropOffset=-1}this._undoStack&&this._undoStack.endCompoundChange();this._dragSelection=
null}},_onDragEnter:function(m){this._onDragOver(m)},_onDragOver:function(p){var h=p.event.dataTransfer.types,c=!this._view.getOptions("readonly");c&&h&&(c=h.contains?h.contains("text/plain")||h.contains("Text"):-1!==h.indexOf("text/plain")||-1!==h.indexOf("Text"));c?m.isFirefox||(this._dropEffect=p.event.dataTransfer.dropEffect=(m.isMac?p.event.altKey:p.event.ctrlKey)?"copy":"move"):p.event.dataTransfer.dropEffect="none"},_onDrop:function(p){var h=this._view,c=p.event.dataTransfer.getData("Text");
c&&(m.isFirefox||(p.event.dataTransfer.dropEffect=this._dropEffect),p=h.getOffsetAtLocation(p.x,p.y),this._dragSelection?(this._dropOffset=p,this._dropText=c):(h.setText(c,p,p),h.setSelection(p,p+c.length)))}};return{TextDND:s}});
define("orion/editor/editor","i18n!orion/editor/nls/messages orion/editor/eventTarget orion/editor/tooltip orion/editor/annotations orion/objects orion/util".split(" "),function(m,s,p,h,c,f){function e(b){b=b||{};this._domNode=b.domNode;this._model=b.model;this._undoStack=b.undoStack;this._statusReporter=b.statusReporter;this._title=null;var a=this;this._listener={onChanged:function(b){a.onChanged(b)}};this._model&&this._model.addEventListener("Changed",this._listener.onChanged);this.checkDirty()}
function g(b){b=b||{};e.call(this,b);this._textViewFactory=b.textViewFactory;this._undoStackFactory=b.undoStackFactory;this._textDNDFactory=b.textDNDFactory;this._annotationFactory=b.annotationFactory;this._zoomRulerFactory=b.zoomRulerFactory;this._foldingRulerFactory=b.foldingRulerFactory;this._lineNumberRulerFactory=b.lineNumberRulerFactory;this._contentAssistFactory=b.contentAssistFactory;this._keyBindingFactory=b.keyBindingFactory;this._hoverFactory=b.hoverFactory;this._contentAssist=this._foldingRuler=
this._zoomRuler=this._overviewRuler=this._lineNumberRuler=this._annotationRuler=this._annotationModel=this._annotationStyler=null}var l=h.AnnotationType;e.prototype={destroy:function(){this.uninstall();this._statusReporter=this._domNode=null;this._model&&this._model.removeEventListener("Changed",this._listener.onChanged)},checkDirty:function(){this.setDirty(this._undoStack&&!this._undoStack.isClean())},focus:function(){},getModel:function(){return this._model},getText:function(b,a){return this.getModel().getText(b,
a)},getTitle:function(){return this._title},getUndoStack:function(){return this._undoStack},install:function(){this.installed=!0},isDirty:function(){return this._dirty},markClean:function(){this.getUndoStack().markClean();this.setDirty(!1)},onDirtyChanged:function(b){return this.dispatchEvent(b)},onInputChanged:function(b){return this.dispatchEvent(b)},onChanged:function(b){this.checkDirty()},reportStatus:function(b,a,c){this._statusReporter&&this._statusReporter(b,a,c)},resize:function(){},setDirty:function(b){this._dirty!==
b&&(this._dirty=b,this.onDirtyChanged({type:"DirtyChanged"}))},_setModelText:function(b){this._model&&this._model.setText(b)},setInput:function(b,a,c,d){this._title=b;d||(a?this.reportStatus(a,"error"):null!==c&&(void 0!==c&&"string"===typeof c)&&this._setModelText(c),this._undoStack&&this._undoStack.reset());this.checkDirty();this.onInputChanged({type:"InputChanged",title:b,message:a,contents:c,contentsSaved:d})},setText:function(b,a,c){this.getModel().setText(b,a,c)},uninstall:function(){this.installed=
!1}};s.EventTarget.addMixin(e.prototype);g.prototype=new e;c.mixin(g.prototype,{destroy:function(){e.prototype.destroy.call(this);this._textViewFactory=this._undoStackFactory=this._textDNDFactory=this._annotationFactory=this._foldingRulerFactory=this._lineNumberRulerFactory=this._contentAssistFactory=this._keyBindingFactory=this._hoverFactory=this._zoomRulerFactory=null},getAnnotationModel:function(){return this._annotationModel},getAnnotationRuler:function(){return this._annotationRuler},getAnnotationStyler:function(){return this._annotationStyler},
getContentAssist:function(){return this._contentAssist},getFoldingRuler:function(){return this._foldingRuler},getLineNumberRuler:function(){return this._lineNumberRuler},getTooltip:function(){return p.Tooltip.getTooltip(this._textView)},getZoomRuler:function(){return this._zoomRuler},getModel:function(){if(!this._textView)return null;var b=this._textView.getModel();b.getBaseModel&&(b=b.getBaseModel());return b},getOverviewRuler:function(){return this._overviewRuler},getTextView:function(){return this._textView},
getKeyModes:function(){return this._textView.getKeyModes()},getSourceCodeActions:function(){return this._sourceCodeActions},getLinkedMode:function(){return this._linkedMode},getTextActions:function(){return this._textActions},focus:function(){this._textView&&this._textView.focus()},resize:function(){this._textView&&this._textView.resize()},setAnnotationRulerVisible:function(b,a){if(this._annotationRulerVisible!==b||a)if(this._annotationRulerVisible=b,this._annotationRuler){var c=this._textView;b?
c.addRuler(this._annotationRuler,0):c.removeRuler(this._annotationRuler)}},setFoldingRulerVisible:function(b,a){if(this._foldingRulerVisible!==b||a)if(this._foldingRulerVisible=b,this._foldingRuler){var c=this._textView;c.getModel().getBaseModel&&(b?c.addRuler(this._foldingRuler):c.removeRuler(this._foldingRuler))}},setLineNumberRulerVisible:function(b,a){if(this._lineNumberRulerVisible!==b||a)if(this._lineNumberRulerVisible=b,this._lineNumberRuler){var c=this._textView;b?c.addRuler(this._lineNumberRuler,
!this._annotationRulerVisible?0:1):c.removeRuler(this._lineNumberRuler)}},setOverviewRulerVisible:function(b,a){if(this._overviewRulerVisible!==b||a)if(this._overviewRulerVisible=b,this._overviewRuler){var c=this._textView;b?c.addRuler(this._overviewRuler):c.removeRuler(this._overviewRuler)}},setZoomRulerVisible:function(b,a){if(this._zoomRulerVisible!==b||a)if(this._zoomRulerVisible=b,this._zoomRuler){var c=this._textView;b?c.addRuler(this._zoomRuler):c.removeRuler(this._zoomRuler)}},mapOffset:function(b,
a){var c=this._textView.getModel();c.getBaseModel&&(b=c.mapOffset(b,a));return b},getLineAtOffset:function(b){return this.getModel().getLineAtOffset(this.mapOffset(b))},getLineStart:function(b){return this.getModel().getLineStart(b)},getCaretOffset:function(){return this.mapOffset(this._textView.getCaretOffset())},getSelection:function(){var b=this._textView,a=b.getSelection(),b=b.getModel();b.getBaseModel&&(a.start=b.mapOffset(a.start),a.end=b.mapOffset(a.end));return a},getSelections:function(){var b=
this._textView,a=b.getModel(),b=b.getSelections();b.forEach(function(b){a.getBaseModel&&(b.start=a.mapOffset(b.start),b.end=a.mapOffset(b.end))});return b},_expandOffset:function(b){var a=this._textView.getModel(),c=this._annotationModel;if(c&&a.getBaseModel)for(b=c.getAnnotations(b,b+1);b.hasNext();)a=b.next(),a.type===l.ANNOTATION_FOLDING&&a.expand&&a.expand()},setCaretOffset:function(b,a,c){var d=this._textView,e=d.getModel();e.getBaseModel&&(this._expandOffset(b),b=e.mapOffset(b,!0));d.setCaretOffset(b,
a,c)},setText:function(b,a,c){var d=this._textView,e=d.getModel();e.getBaseModel&&(void 0!==a&&(this._expandOffset(a),a=e.mapOffset(a,!0)),void 0!==c&&(this._expandOffset(c),c=e.mapOffset(c,!0)));d.setText(b,a,c)},setSelection:function(b,a,c,d){var e=this._textView,f=e.getModel();f.getBaseModel&&(this._expandOffset(b),this._expandOffset(a),b=f.mapOffset(b,!0),a=f.mapOffset(a,!0));e.setSelection(b,a,c,d)},setSelections:function(b,a,c){var d=this,e=this._textView,f=e.getModel();b.forEach(function(a){var b=
a.start,c=a.end;f.getBaseModel&&(d._expandOffset(b),d._expandOffset(c),b=f.mapOffset(b,!0),c=f.mapOffset(c,!0));a.start=b;a.end=c});e.setSelections(b,a,c)},moveSelection:function(b,a,c,d){var e=this._textView;this.setSelection(b,a||b,1/3,function(){(void 0===d||d)&&e.focus();c&&c()})},_getTooltipInfo:function(b,a){var c=this._textView,d=this.getAnnotationModel();if(!d)return null;var e=this._annotationStyler;if(!e||!c.isValidLineIndex(a))return null;c=c.getOffsetAtLocation(b,a);if(-1===c)return null;
for(var c=this.mapOffset(c),d=e.getAnnotationsByType(d,c,c+1),e=[],f=0;f<d.length;f++)d[f].rangeStyle&&e.push(d[f]);return{contents:e,offset:c,position:"below",context:{source:"editor"}}},_highlightCurrentLine:function(b,a){function c(a){var b={};return a&&a.some(function(a){if(a&&a.isEmpty())b[g.getLineAtOffset(a.start).toString()]=!0;else return!0;return!1})?{}:b}function d(a,b){for(var d in a)if(!b[d])return!0;return!1}var e=this._annotationModel;if(e){var f=this._textView;if(!f.getOptions("singleMode")){a=
Array.isArray(a)?a:[a];b=Array.isArray(b)?b:[b];var g=f.getModel(),f=c(a),q=c(b);if(d(f,q)||d(q,f)){var f=this._currentLineAnnotations,h=[],w;for(w in q){var m=w>>0,q=g.getLineStart(m),m=g.getLineEnd(m);g.getBaseModel&&(q=g.mapOffset(q),m=g.mapOffset(m));q=l.createAnnotation(l.ANNOTATION_CURRENT_LINE,q,m);h.push(q)}this._currentLineAnnotations=h;e.replaceAnnotations(f,h)}}}},installTextView:function(){this.install()},install:function(){if(!this._textView){this._textView=this._textViewFactory();this._undoStackFactory&&
(this._undoStack=this._undoStackFactory.createUndoStack(this),this._textView.setOptions({undoStack:this._undoStack}),this.checkDirty());this._textDNDFactory&&(this._textDND=this._textDNDFactory.createTextDND(this,this._undoStack));this._contentAssistFactory&&(this._contentAssist=this._contentAssistFactory.createContentAssistMode(this).getContentAssist());var b=p.Tooltip.getTooltip(this._textView);this._hoverFactory&&(this._hover=this._hoverFactory.createHover(this),b.hover=this._hover);var a=this,
c=this._textView,d=this;this._listener={onModelChanged:function(a){d.checkDirty()},onMouseOver:function(a){d._listener.onMouseMove(a)},onMouseDown:function(a){d._listener.mouseDown=!0},onMouseUp:function(a){d._listener.mouseDown=!1},onMouseMove:function(a){b&&!d._listener.mouseDown&&!(a.event.clientX===d._listener.lastMouseX&&a.event.clientY===d._listener.lastMouseY)&&(d._listener.lastMouseX=a.event.clientX,d._listener.lastMouseY=a.event.clientY,d._hoverTimeout&&(window.clearTimeout(d._hoverTimeout),
d._hoverTimeout=null),d._hoverTimeout=window.setTimeout(function(){d._hoverTimeout=null;d._listener&&b.OKToHover(d._listener.lastMouseX,d._listener.lastMouseY)&&b.show({clientX:d._listener.lastMouseX,clientY:d._listener.lastMouseY,x:a.x,y:a.y,getTooltipInfo:function(){return d._getTooltipInfo(this.x,this.y)}})},175))},onMouseOut:function(a){},onScroll:function(a){b&&b.hide()},onSelection:function(a){b&&b.hide();d._updateCursorStatus();d._highlightCurrentLine(a.newValue,a.oldValue)}};c.addEventListener("ModelChanged",
this._listener.onModelChanged);c.addEventListener("Selection",this._listener.onSelection);c.addEventListener("MouseOver",this._listener.onMouseOver);c.addEventListener("MouseOut",this._listener.onMouseOut);c.addEventListener("MouseDown",this._listener.onMouseDown);c.addEventListener("MouseUp",this._listener.onMouseUp);c.addEventListener("MouseMove",this._listener.onMouseMove);c.addEventListener("Scroll",this._listener.onScroll);if(this._keyBindingFactory){var f;if(f="function"===typeof this._keyBindingFactory?
this._keyBindingFactory(this,this.getKeyModes(),this._undoStack,this._contentAssist):this._keyBindingFactory.createKeyBindings(a,this._undoStack,this._contentAssist))this._textActions=f.textActions,this._linkedMode=f.linkedMode,this._sourceCodeActions=f.sourceCodeActions}f=function(b,d){if(void 0!==b&&-1!==b){for(var c=this.getView().getModel(),e=this.getAnnotationModel(),k=a.mapOffset(c.getLineStart(b)),c=a.mapOffset(c.getLineEnd(b)),f=e.getAnnotations(k,c),n=null;f.hasNext();){var r=f.next();if(r.type===
l.ANNOTATION_BOOKMARK){n=r;break}}n?e.removeAnnotation(n):(n=l.createAnnotation(l.ANNOTATION_BOOKMARK,k,c,a.getText(k,c)),e.addAnnotation(n))}};if(this._annotationFactory){var n=c.getModel();n.getBaseModel&&(n=n.getBaseModel());if(this._annotationModel=this._annotationFactory.createAnnotationModel(n))if(n=this._annotationStyler=this._annotationFactory.createAnnotationStyler(c,this._annotationModel))n.addAnnotationType(l.ANNOTATION_CURRENT_SEARCH),n.addAnnotationType(l.ANNOTATION_MATCHING_SEARCH),
n.addAnnotationType(l.ANNOTATION_ERROR),n.addAnnotationType(l.ANNOTATION_WARNING),n.addAnnotationType(l.ANNOTATION_MATCHING_BRACKET),n.addAnnotationType(l.ANNOTATION_CURRENT_BRACKET),n.addAnnotationType(l.ANNOTATION_CURRENT_LINE),n.addAnnotationType(l.ANNOTATION_READ_OCCURRENCE),n.addAnnotationType(l.ANNOTATION_WRITE_OCCURRENCE),n.addAnnotationType(l.ANNOTATION_SELECTED_LINKED_GROUP),n.addAnnotationType(l.ANNOTATION_CURRENT_LINKED_GROUP),n.addAnnotationType(l.ANNOTATION_LINKED_GROUP),n.addAnnotationType("orion.annotation.highlightError");
var n=this._annotationFactory.createAnnotationRulers(this._annotationModel),g=this._annotationRuler=n.annotationRuler;g&&(g.onDblClick=f,g.setMultiAnnotationOverlay({html:"\x3cdiv class\x3d'annotationHTML overlay'\x3e\x3c/div\x3e"}),g.addAnnotationType(l.ANNOTATION_ERROR),g.addAnnotationType(l.ANNOTATION_WARNING),g.addAnnotationType(l.ANNOTATION_TASK),g.addAnnotationType(l.ANNOTATION_BOOKMARK),g.addAnnotationType(l.ANNOTATION_DIFF_ADDED),g.addAnnotationType(l.ANNOTATION_DIFF_DELETED),g.addAnnotationType(l.ANNOTATION_DIFF_MODIFIED));
this.setAnnotationRulerVisible(this._annotationRulerVisible||void 0===this._annotationRulerVisible,!0);if(g=this._overviewRuler=n.overviewRuler)g.addAnnotationType(l.ANNOTATION_CURRENT_SEARCH),g.addAnnotationType(l.ANNOTATION_MATCHING_SEARCH),g.addAnnotationType(l.ANNOTATION_READ_OCCURRENCE),g.addAnnotationType(l.ANNOTATION_WRITE_OCCURRENCE),g.addAnnotationType(l.ANNOTATION_CURRENT_BLAME),g.addAnnotationType(l.ANNOTATION_ERROR),g.addAnnotationType(l.ANNOTATION_WARNING),g.addAnnotationType(l.ANNOTATION_TASK),
g.addAnnotationType(l.ANNOTATION_BOOKMARK),g.addAnnotationType(l.ANNOTATION_MATCHING_BRACKET),g.addAnnotationType(l.ANNOTATION_CURRENT_BRACKET),g.addAnnotationType(l.ANNOTATION_CURRENT_LINE),g.addAnnotationType(l.ANNOTATION_DIFF_ADDED),g.addAnnotationType(l.ANNOTATION_DIFF_DELETED),g.addAnnotationType(l.ANNOTATION_DIFF_MODIFIED);this.setOverviewRulerVisible(this._overviewRulerVisible||void 0===this._overviewRulerVisible,!0)}this._zoomRulerFactory&&(this._zoomRuler=this._zoomRulerFactory.createZoomRuler(this._annotationModel),
this.setZoomRulerVisible(this._zoomRulerVisible||void 0===this._zoomRulerVisible,!0));this._lineNumberRulerFactory&&(this._lineNumberRuler=this._lineNumberRulerFactory.createLineNumberRuler(this._annotationModel),this._lineNumberRuler.addAnnotationType(l.ANNOTATION_CURRENT_BLAME),this._lineNumberRuler.addAnnotationType(l.ANNOTATION_BLAME),this._lineNumberRuler.addAnnotationType(l.ANNOTATION_DIFF_ADDED),this._lineNumberRuler.addAnnotationType(l.ANNOTATION_DIFF_MODIFIED),this._lineNumberRuler.addAnnotationType(l.ANNOTATION_DIFF_DELETED),
this._lineNumberRuler.onDblClick=f,this.setLineNumberRulerVisible(this._lineNumberRulerVisible||void 0===this._lineNumberRulerVisible,!0));this._foldingRulerFactory&&(this._foldingRuler=this._foldingRulerFactory.createFoldingRuler(this._annotationModel),this._foldingRuler.addAnnotationType(l.ANNOTATION_FOLDING),this.setFoldingRulerVisible(this._foldingRulerVisible||void 0===this._foldingRulerVisible,!0));this.dispatchEvent({type:"TextViewInstalled",textView:c});e.prototype.install.call(this)}},uninstallTextView:function(){this.uninstall()},
uninstall:function(){var b=this._textView;b&&(b.destroy(),this._annotationModel&&this._annotationModel.setTextModel(null),this._textView=this._undoStack=this._textDND=this._contentAssist=this._listener=this._annotationModel=this._annotationStyler=this._annotationRuler=this._overviewRuler=this._zoomRuler=this._lineNumberRuler=this._foldingRuler=this._currentLineAnnotations=this._title=null,this._dirty=!1,this._foldingRulerVisible=this._overviewRulerVisible=this._zoomRulerVisible=this._lineNumberRulerVisible=
this._annotationRulerVisible=void 0,this.dispatchEvent({type:"TextViewUninstalled",textView:b}),e.prototype.uninstall.call(this))},_updateCursorStatus:function(){for(var b=this.getKeyModes(),a=0;a<b.length;a++){var c=b[a];if(c.isActive()&&c.isStatusActive&&c.isStatusActive())return}b=this.getModel();a=this.getSelections();1<a.length?b=f.formatMessage(m.multiSelections,a.length):(a=a[0].getCaret(),c=b.getLineAtOffset(a),b=b.getLineStart(c),b=f.formatMessage(m.lineColumn,c+1,a-b+1));this.reportStatus(b)},
showAnnotations:function(b,a,c,d){var e=this._annotationModel;if(e){for(var f=[],g=[],q=e.getTextModel(),h=e.getAnnotations(),w;h.hasNext();)w=h.next(),-1!==a.indexOf(w.type)&&w.creatorID===this&&f.push(w);if(b)for(a=0;a<b.length;a++)if(w=b[a]){if(c)w=c(w);else{var m;w.lineStart&&w.lineEnd?(h=q.getLineStart(w.lineStart),m=q.getLineCount()===w.lineEnd?q.getLineEnd(w.lineEnd-1):q.getLineStart(w.lineEnd)):"number"===typeof w.line?(m=q.getLineStart(w.line-1),h=m+w.start-1,m=m+w.end-1):(h=w.start,m=w.end);
var p=d(w);if(!p)continue;w=l.createAnnotation(p,h,m,w.description)}w.id=b[a].id;w.creatorID=this;g.push(w)}e.replaceAnnotations(f,g)}},showProblems:function(b){this.showAnnotations(b,[l.ANNOTATION_ERROR,l.ANNOTATION_WARNING,l.ANNOTATION_TASK],null,function(a){switch(a.severity){case "error":return l.ANNOTATION_ERROR;case "warning":return l.ANNOTATION_WARNING;case "task":return l.ANNOTATION_TASK}return null})},showOccurrences:function(b){this.showAnnotations(b,[l.ANNOTATION_READ_OCCURRENCE,l.ANNOTATION_WRITE_OCCURRENCE],
null,function(a){return a.readAccess?l.ANNOTATION_READ_OCCURRENCE:l.ANNOTATION_WRITE_OCCURRENCE})},showBlame:function(b){var a=this._blameRGB,e=this.getTextView().getOptions("parent").ownerDocument;if(!a){var d=f.createElement(e,"div");d.className="annotation blame";e.body.appendChild(d);var r=(e.defaultView||e.parentWindow).getComputedStyle(d).getPropertyValue("background-color");d.parentNode.removeChild(d);var d=r.indexOf("("),n=r.indexOf(")"),r=r.substring(d+1,n);this._blameRGB=a=r.split(",").slice(0,
3)}var g=function(){var a=h.AnnotationType.createAnnotation(this.groupType,this.start,this.end,this.title);a.style=c.mixin({},a.style);a.style.style=c.mixin({},a.style.style);a.style.style.backgroundColor="";this.groupAnnotation=a;a.blame=this.blame;a.html=this.html;a.creatorID=this.creatorID;return a},q=function(){var a=f.createElement(e,"div");a.className="tooltipTitle";var b=this.blame.Message.indexOf("\n");-1===b&&(b=this.blame.Message.length);var d=f.createElement(e,"a");d.href=this.blame.CommitLink;
d.appendChild(e.createTextNode(this.blame.Message.substring(0,b)));a.appendChild(d);a.appendChild(f.createElement(e,"br"));a.appendChild(e.createTextNode(f.formatMessage(m.committerOnTime,this.blame.AuthorName,this.blame.Time)));return a},v=this.getModel();this.showAnnotations(b,[l.ANNOTATION_BLAME,l.ANNOTATION_CURRENT_BLAME],function(b){var d=v.getLineStart(b.Start-1),e=v.getLineEnd(b.End-1,!0),d=h.AnnotationType.createAnnotation(l.ANNOTATION_BLAME,d,e,q),e=a.slice(0);e.push(b.Shade);d.style=c.mixin({},
d.style);d.style.style=c.mixin({},d.style.style);d.style.style.backgroundColor="rgba("+e.join()+")";d.groupId=b.Name;d.groupType=l.ANNOTATION_CURRENT_BLAME;d.createGroupAnnotation=g;d.html='\x3cimg class\x3d"annotationHTML blame" src\x3d"'+b.AuthorImage+'"/\x3e';d.blame=b;return d})},showDiffAnnotations:function(b){this.showAnnotations(b,[l.ANNOTATION_DIFF_ADDED,l.ANNOTATION_DIFF_MODIFIED,l.ANNOTATION_DIFF_DELETED],null,function(a){return"added"===a.type?l.ANNOTATION_DIFF_ADDED:"modified"===a.type?
l.ANNOTATION_DIFF_MODIFIED:l.ANNOTATION_DIFF_DELETED})},showSelection:function(b,a,c,d,e){"number"===typeof b?("number"!==typeof a&&(a=b),this.moveSelection(b,a)):"number"===typeof c&&(b=this.getModel().getLineStart(c-1),"number"===typeof d&&(b+=d),"number"!==typeof e&&(e=0),this.moveSelection(b,b+e))},_setModelText:function(b){this._textView&&(this._textView.setText(b),this._textView.getModel().setLineDelimiter("auto"),this._highlightCurrentLine(this._textView.getSelections()))},setInput:function(b,
a,c,d,f){e.prototype.setInput.call(this,b,a,c,d);this._textView&&(!d&&!f)&&this._textView.focus()},onGotoLine:function(b,a,c,d){if(this._textView){var e=this.getModel();b=Math.max(0,Math.min(b,e.getLineCount()-1));var f=e.getLineStart(b),g=0;void 0===c&&(c=0);"string"===typeof a?(b=e.getLine(b).indexOf(a),-1!==b&&(g=b,c=g+a.length)):(g=a,a=e.getLineEnd(b)-f,g=Math.min(g,a),c=Math.min(c,a));this.moveSelection(f+g,f+c,d)}}});return{BaseEditor:e,Editor:g}});
define("orion/editor/find","i18n!orion/editor/nls/messages orion/keyBinding orion/editor/keyModes orion/editor/annotations orion/regex orion/objects orion/util".split(" "),function(m,s,p,h,c,f,e){function g(a){var b=a.getTextView();p.KeyMode.call(this,b);this.editor=a;this._active=!1;this._success=!0;this._ignoreSelection=!1;this._prefix="";b.setAction("incrementalFindCancel",function(){this.setActive(!1);return!0}.bind(this));b.setAction("incrementalFindBackspace",function(){return this._backspace()}.bind(this));
var d=this;this._listener={onVerify:function(a){var b=d.editor,e=b.getModel(),k=b.mapOffset(a.start),b=b.mapOffset(a.end),e=e.getText(k,b);if((e=d._prefix.match(RegExp("^"+c.escape(e),"i")))&&0<e.length)d._prefix+=a.text,d._success=!0,d._status(),d.find(d._forward,!0),a.text=null},onSelection:function(){d._ignoreSelection||d.setActive(!1)}}}function l(a,b,d){if(a){this._editor=a;this._undoStack=b;this._showAll=!0;this._visible=!1;this._wrap=this._caseInsensitive=!0;this._wholeWord=!1;this._incremental=
!0;this._regex=!1;this._findAfterReplace=!0;this._reverse=this._hideAfterFind=!1;this._timer=this._end=this._start=void 0;this._lastString="";var c=this;this._listeners={onEditorFocus:function(a){c._removeCurrentAnnotation(a)}};this.setOptions(d)}}var b={};g.prototype=new p.KeyMode;f.mixin(g.prototype,{createKeyBindings:function(){var a=s.KeyBinding,b=[];b.push({actionID:"incrementalFindBackspace",keyBinding:new a(8)});b.push({actionID:"incrementalFindCancel",keyBinding:new a(13)});b.push({actionID:"incrementalFindCancel",
keyBinding:new a(27)});b.push({actionID:"incrementalFindReverse",keyBinding:new a(38)});b.push({actionID:"incrementalFind",keyBinding:new a(40)});b.push({actionID:"incrementalFindReverse",keyBinding:new a("k",!0,!0)});b.push({actionID:"incrementalFind",keyBinding:new a("k",!0)});return b},find:function(a,b){this._forward=a;if(!this.isActive())return this.setActive(!0),!1;var d=this._prefix;if(0===d.length)return!1;var c=this.editor,e=c.getModel(),e=a?this._success?b?this._start:c.getCaretOffset()+
1:0:this._success?b?this._start:c.getCaretOffset():e.getCharCount()-1;(d=c.getModel().find({string:d,start:e,reverse:!a,caseInsensitive:d.toLowerCase()===d}).next())?(b||(this._start=e),this._ignoreSelection=this._success=!0,c.moveSelection(a?d.start:d.end,a?d.end:d.start),this._ignoreSelection=!1):this._success=!1;this._status();return!0},isActive:function(){return this._active},isStatusActive:function(){return this.isActive()},setActive:function(a){this._active!==a&&(this._active=a,this._prefix=
"",this._success=!0,a=this.editor.getTextView(),this._start=this.editor.getCaretOffset(),this.editor.setCaretOffset(this._start),this._active?(a.addEventListener("Verify",this._listener.onVerify),a.addEventListener("Selection",this._listener.onSelection),a.addKeyMode(this)):(a.removeEventListener("Verify",this._listener.onVerify),a.removeEventListener("Selection",this._listener.onSelection),a.removeKeyMode(this)),this._status())},_backspace:function(){var a=this._prefix,a=this._prefix=a.substring(0,
a.length-1);return 0===a.length?(this._ignoreSelection=this._success=!0,this.editor.setCaretOffset(this.editor.getSelection().start),this._ignoreSelection=!1,this._status(),!0):this.find(this._forward,!0)},_status:function(){if(this.isActive()){var a;a=this._forward?this._success?m.incrementalFindStr:m.incrementalFindStrNotFound:this._success?m.incrementalFindReverseStr:m.incrementalFindReverseStrNotFound;a=e.formatMessage(a,this._prefix);this.editor.reportStatus(a,this._success?"":"error")}else this.editor.reportStatus("")}});
b.IncrementalFind=g;l.prototype={find:function(a,b,d){this.setOptions({reverse:!a});var c=this.getFindString(),e;b&&(c=b.findString||c,e=b.count);a=this.getOptions();this.setOptions(b);b=d?this._startOffset:this.getStartOffset();if((e=this._doFind(c,b,e))&&!d)this._startOffset=e.start;this.setOptions(a);this._hideAfterFind&&this.hide();return e},getStartOffset:function(){return void 0!==this._start?this._start:this._reverse?this._editor.getSelection().start-1:this._editor.getCaretOffset()},getFindString:function(){var a=
this._editor.getSelection(),a=this._editor.getText(a.start,a.end);this._regex&&(a=c.escape(a));return a||this._lastString},getOptions:function(){return{showAll:this._showAll,caseInsensitive:this._caseInsensitive,wrap:this._wrap,wholeWord:this._wholeWord,incremental:this._incremental,regex:this._regex,findAfterReplace:this._findAfterReplace,hideAfterFind:this._hideAfterFind,reverse:this._reverse,findCallback:this._findCallback,start:this._start,end:this._end}},getReplaceString:function(){return""},
hide:function(){this._visible=!1;this._savedOptions&&(this.setOptions(this._savedOptions.pop()),0===this._savedOptions.length&&(this._savedOptions=null));this._removeAllAnnotations();var a=this._editor.getTextView();a&&(a.removeEventListener("Focus",this._listeners.onEditorFocus),a.focus())},_processReplaceString:function(a){var b=a;if(this._regex){for(var b="",d=!1,c=this._editor.getModel().getLineDelimiter(),e=0;e<a.length;e++){var f=a.substring(e,e+1);if(d){switch(f){case "R":b+=c;break;case "r":b+=
"\r";break;case "n":b+="\n";break;case "t":b+="\t";break;case "\\":b+="\\";break;default:b+="\\"+f}d=!1}else"\\"===f?d=!0:b+=f}d&&(b+="\\")}return b},isVisible:function(){return this._visible},replace:function(){var a=this.getFindString();if(a){var b=this._editor,d=this._processReplaceString(this.getReplaceString()),c=b.getSelection().start;if(b=b.getModel().find({string:a,start:c,reverse:!1,wrap:this._wrap,regex:this._regex,wholeWord:this._wholeWord,caseInsensitive:this._caseInsensitive}).next())this.startUndo(),
this._doReplace(b.start,b.end,a,d),this.endUndo()}this._findAfterReplace&&a&&this._doFind(a,this.getStartOffset())},replaceAll:function(){var a=this.getFindString();if(a){this._replacingAll=!0;var b=this._editor,d=b.getTextView();b.reportStatus(m.replacingAll);var c=this._processReplaceString(this.getReplaceString()),f=this;window.setTimeout(function(){for(var g=0,q=0;;){var l=f._doFind(a,g,null,!0);if(!l)break;q++;1===q&&(d.setRedraw(!1),f.startUndo());f._doReplace(l.start,l.end,a,c);g=f.getStartOffset()}0<
q&&(f.endUndo(),d.setRedraw(!0));0<g?b.reportStatus(e.formatMessage(m.replacedMatches,q)):b.reportStatus(m.nothingReplaced,"error");f._replacingAll=!1},100)}},setOptions:function(a){if(a){if((!0===a.showAll||!1===a.showAll)&&this._showAll!==a.showAll)if(this._showAll=a.showAll,this.isVisible())if(this._showAll)this._markAllOccurrences();else{var b=this._editor.getAnnotationModel();b&&b.removeAnnotations(h.AnnotationType.ANNOTATION_MATCHING_SEARCH)}if(!0===a.caseInsensitive||!1===a.caseInsensitive)this._caseInsensitive=
a.caseInsensitive;if(!0===a.wrap||!1===a.wrap)this._wrap=a.wrap;if(!0===a.wholeWord||!1===a.wholeWord)this._wholeWord=a.wholeWord;if(!0===a.incremental||!1===a.incremental)this._incremental=a.incremental;if(!0===a.regex||!1===a.regex)this._regex=a.regex;if(!0===a.findAfterReplace||!1===a.findAfterReplace)this._findAfterReplace=a.findAfterReplace;if(!0===a.hideAfterFind||!1===a.hideAfterFind)this._hideAfterFind=a.hideAfterFind;if(!0===a.reverse||!1===a.reverse)this._reverse=a.reverse;a.hasOwnProperty("findCallback")&&
(this._findCallback=a.findCallback);a.hasOwnProperty("start")&&(this._start=a.start);a.hasOwnProperty("end")&&(this._end=a.end)}},show:function(a){this._visible=!0;a&&(this._savedOptions||(this._savedOptions=[]),this._savedOptions.push(this.getOptions()),this.setOptions(a));this._startOffset=this._editor.getSelection().start;this._editor.getTextView().addEventListener("Focus",this._listeners.onEditorFocus);var b=this;window.setTimeout(function(){b._incremental&&b.find(!0,null,!0)},0)},startUndo:function(){this._undoStack&&
this._undoStack.startCompoundChange()},endUndo:function(){this._undoStack&&this._undoStack.endCompoundChange()},_find:function(a,b,d){return this._editor.getModel().find({string:a,start:b,end:this._end,reverse:this._reverse,wrap:d?!1:this._wrap,regex:this._regex,wholeWord:this._wholeWord,caseInsensitive:this._caseInsensitive})},_doFind:function(a,b,d,c){d=d||1;var e=this._editor;if(!a)return this._removeAllAnnotations(),null;this._lastString=a;var f,q;if(this._regex)try{q=this._find(a,b,c)}catch(g){e.reportStatus(g.message,
"error");return}else q=this._find(a,b,c);for(a=0;a<d&&q.hasNext();a++)f=q.next();if(!this._replacingAll){f?this._editor.reportStatus(""):this._editor.reportStatus(m.notFound,"error");if(this.isVisible()){d=h.AnnotationType.ANNOTATION_CURRENT_SEARCH;if(q=e.getAnnotationModel())q.removeAnnotations(d),f&&q.addAnnotation(h.AnnotationType.createAnnotation(d,f.start,f.end));if(this._showAll){this._timer&&window.clearTimeout(this._timer);var l=this;this._timer=window.setTimeout(function(){l._markAllOccurrences();
l._timer=null},500)}}this._findCallback?this._findCallback(f):f&&e.moveSelection(f.start,f.end,null,!1)}return f},_doReplace:function(a,b,d,c){var e=this._editor;this._regex&&(c=e.getText(a,b).replace(RegExp(d,this._caseInsensitive?"i":""),c));e.setText(c,a,b);e.setSelection(a,a+c.length,!0)},_markAllOccurrences:function(){var a=this._editor.getAnnotationModel();if(a){for(var b=h.AnnotationType.ANNOTATION_MATCHING_SEARCH,d=a.getAnnotations(),c=[],e;d.hasNext();){var f=d.next();f.type===b&&c.push(f)}if(this.isVisible()){d=
this.getFindString();d=this._editor.getModel().find({string:d,regex:this._regex,wholeWord:this._wholeWord,caseInsensitive:this._caseInsensitive});for(e=[];d.hasNext();)f=d.next(),e.push(h.AnnotationType.createAnnotation(b,f.start,f.end))}a.replaceAnnotations(c,e)}},_removeAllAnnotations:function(){var a=this._editor.getAnnotationModel();a&&(a.removeAnnotations(h.AnnotationType.ANNOTATION_CURRENT_SEARCH),a.removeAnnotations(h.AnnotationType.ANNOTATION_MATCHING_SEARCH))},_removeCurrentAnnotation:function(a){(a=
this._editor.getAnnotationModel())&&a.removeAnnotations(h.AnnotationType.ANNOTATION_CURRENT_SEARCH)}};b.Find=l;return b});
define("orion/editor/findUI",["i18n!orion/editor/nls/messages","orion/editor/find","orion/objects","orion/editor/util","orion/util"],function(m,s,p,h,c){function f(c,f,l){s.Find.call(this,c,f,l)}f.prototype=new s.Find;p.mixin(f.prototype,{getFindString:function(){var c=this._findInput;return!c?s.Find.prototype.getFindString.call(this):c.value},getReplaceString:function(){var c=this._replaceInput;return!c?s.Find.prototype.getReplaceString(this):c.value},hide:function(){var c=this.isVisible();s.Find.prototype.hide.call(this);
c&&(this._rootDiv.className="textViewFind")},show:function(c){s.Find.prototype.show.call(this,c);var f=c.findString;c=c.replaceString;var l=this._findInput;l||(this._create(),l=this._findInput);f&&(l.value=f);c&&(this._replaceInput.value=c);var b=this;window.setTimeout(function(){b._rootDiv.className="textViewFind show";l.select();l.focus()},0)},_create:function(){var e=this,f=this._editor.getTextView(),l=f.getOptions("parent").ownerDocument,b=c.createElement(l,"div");b.className="textViewFind";h.addEventListener(b,
"keydown",function(a){e._handleKeyDown(a)});this._rootDiv=b;this._createContents(l,b);f._rootDiv.insertBefore(b,f._rootDiv.firstChild)},_createContents:function(e,f){var l=this,b=c.createElement(e,"input");b.className="textViewFindInput";this._findInput=b;b.type="text";b.placeholder=m.findWith;h.addEventListener(b,"input",function(a){return l._handleInput(a)});f.appendChild(b);b=c.createElement(e,"span");l._createButton(e,b,m.next,function(){l.find(!0)});l._createButton(e,b,m.previous,function(){l.find(!1)});
f.appendChild(b);l._editor.getTextView().getOptions("readonly")||(b=c.createElement(e,"input"),b.className="textViewReplaceInput",this._replaceInput=b,b.type="text",b.placeholder=m.replaceWith,f.appendChild(b),b=c.createElement(e,"span"),l._createButton(e,b,m.replace,function(){l.replace()}),l._createButton(e,b,m.replaceAll,function(){l.replaceAll()}),f.appendChild(b));b=c.createElement(e,"span");l._createButton(e,b,m.regex,function(a){l._toggle("regex",a.target)},this._regex,m.regexTooltip);l._createButton(e,
b,m.caseInsensitive,function(a){l._toggle("caseInsensitive",a.target)},this._caseInsensitive,m.caseInsensitiveTooltip);l._createButton(e,b,m.wholeWord,function(a){l._toggle("wholeWord",a.target)},this._wholeWord,m.wholeWordTooltip);f.appendChild(b);b=l._createButton(e,f,"",function(){l.hide()});b.className="textViewFindCloseButton";b.title=m.closeTooltip},_createButton:function(c,f,l,b,a,k){var d=c.createElement("button");this._checked(a,d);k&&(d.title=k);h.addEventListener(d,"click",function(a){b.call(this,
a)},!1);l&&d.appendChild(c.createTextNode(l));f.appendChild(d);return d},_toggle:function(c,f){var l={};l[c]=!this["_"+c];this.setOptions(l);this._checked(l[c],f)},_checked:function(c,f){f.className="textViewFindButton";c&&(f.className+=" checked")},_handleInput:function(){this._incremental&&this.find(!0,null,!0);return!0},_handleKeyDown:function(e){var f,l=(c.isMac?e.metaKey:e.ctrlKey)&&!e.altKey&&!e.shiftKey;l&&70===e.keyCode&&(f=!0);if((c.isMac?e.metaKey:e.ctrlKey)&&!e.altKey&&75===e.keyCode||
13===e.keyCode)13===e.keyCode?this.find(this._reverse?e.shiftKey:!e.shiftKey):this.find(!e.shiftKey),f=!0;l&&82===e.keyCode&&(this.replace(),f=!0);27===e.keyCode&&(this.hide(),f=!0);return f?(e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault(),e.cancelBubble=!0,!1):!0}});return{FindUI:f}});
define("orion/editor/actions","i18n!orion/editor/nls/messages orion/keyBinding orion/editor/annotations orion/editor/tooltip orion/editor/find orion/editor/findUI orion/util".split(" "),function(m,s,p,h,c,f,e){function g(a,b,c,e){function k(a,b,d){g.setText(a,b,d);f+=b-d+a.length}var f=0,g=a.editor,l=g.getSelections();!e&&(b||1<l.length)&&a.startUndo();l.forEach(function(a){a.start+=f;a.end+=f;c(a,k)});g.setSelections(l);!e&&(b||1<l.length)&&a.endUndo()}function l(a,b,e){this.editor=a;this.undoStack=
b;this._incrementalFind=new c.IncrementalFind(a);this._find=e?e:new f.FindUI(a,b);this._lastEditLocation=null;this.init()}function b(a,b,c,e){this.editor=a;this.undoStack=b;this.contentAssist=c;this.linkedMode=e;this.contentAssist&&this.contentAssist.addEventListener("ProposalApplied",this.contentAssistProposalApplied.bind(this));this.init()}var a=p.AnnotationType,k={};l.prototype={init:function(){var a=this.editor.getTextView();this._lastEditListener={onModelChanged:function(a){this.editor.isDirty()&&
(this._lastEditLocation=a.start+a.addedCharCount)}.bind(this)};a.addEventListener("ModelChanged",this._lastEditListener.onModelChanged);a.setAction("undo",function(a){if(this.undoStack){var b=1;a&&a.count&&(b=a.count);for(;0<b;)this.undoStack.undo(),--b;return!0}return!1}.bind(this),{name:m.undo});a.setAction("redo",function(a){if(this.undoStack){var b=1;a&&a.count&&(b=a.count);for(;0<b;)this.undoStack.redo(),--b;return!0}return!1}.bind(this),{name:m.redo});a.setKeyBinding(new s.KeyBinding("f",!0),
"find");a.setAction("find",function(){if(this._find){var a=this.editor.getSelection();this._find.show({findString:this.editor.getText(a.start,a.end)});return!0}return!1}.bind(this),{name:m.find});a.setKeyBinding(new s.KeyBinding("k",!0),"findNext");a.setAction("findNext",function(a){return this._find?(this._find.find(!0,a),!0):!1}.bind(this),{name:m.findNext});a.setKeyBinding(new s.KeyBinding("k",!0,!0),"findPrevious");a.setAction("findPrevious",function(a){return this._find?(this._find.find(!1,a),
!0):!1}.bind(this),{name:m.findPrevious});a.setKeyBinding(new s.KeyBinding("j",!0),"incrementalFind");a.setAction("incrementalFind",function(){this._incrementalFind&&this._incrementalFind.find(!0);return!0}.bind(this),{name:m.incrementalFind});a.setKeyBinding(new s.KeyBinding("j",!0,!0),"incrementalFindReverse");a.setAction("incrementalFindReverse",function(){this._incrementalFind&&this._incrementalFind.find(!1);return!0}.bind(this),{name:m.incrementalFindReverse});a.setAction("tab",function(){return this.indentLines()}.bind(this));
a.setAction("shiftTab",function(){return this.unindentLines()}.bind(this),{name:m.unindentLines});a.setKeyBinding(new s.KeyBinding(38,!1,!1,!0),"moveLinesUp");a.setAction("moveLinesUp",function(){return this.moveLinesUp()}.bind(this),{name:m.moveLinesUp});a.setKeyBinding(new s.KeyBinding(40,!1,!1,!0),"moveLinesDown");a.setAction("moveLinesDown",function(){return this.moveLinesDown()}.bind(this),{name:m.moveLinesDown});a.setKeyBinding(new s.KeyBinding(38,!0,!1,!0),"copyLinesUp");a.setAction("copyLinesUp",
function(){return this.copyLinesUp()}.bind(this),{name:m.copyLinesUp});a.setKeyBinding(new s.KeyBinding(40,!0,!1,!0),"copyLinesDown");a.setAction("copyLinesDown",function(){return this.copyLinesDown()}.bind(this),{name:m.copyLinesDown});a.setKeyBinding(new s.KeyBinding("d",!0,!1,!1),"deleteLines");a.setAction("deleteLines",function(a){return this.deleteLines(a)}.bind(this),{name:m.deleteLines});a.setKeyBinding(new s.KeyBinding("l",!e.isMac,!1,!1,e.isMac),"gotoLine");a.setAction("gotoLine",function(){return this.gotoLine()}.bind(this),
{name:m.gotoLine});a.setKeyBinding(new s.KeyBinding(190,!0),"nextAnnotation");a.setAction("nextAnnotation",function(){return this.nextAnnotation(!0)}.bind(this),{name:m.nextAnnotation});a.setKeyBinding(new s.KeyBinding(188,!0),"previousAnnotation");a.setAction("previousAnnotation",function(){return this.nextAnnotation(!1)}.bind(this),{name:m.prevAnnotation});a.setKeyBinding(new s.KeyBinding("e",!0,!1,!0,!1),"expand");a.setAction("expand",function(){return this.expandAnnotation(!0)}.bind(this),{name:m.expand});
a.setKeyBinding(new s.KeyBinding("c",!0,!1,!0,!1),"collapse");a.setAction("collapse",function(){return this.expandAnnotation(!1)}.bind(this),{name:m.collapse});a.setKeyBinding(new s.KeyBinding("e",!0,!0,!0,!1),"expandAll");a.setAction("expandAll",function(){return this.expandAnnotations(!0)}.bind(this),{name:m.expandAll});a.setKeyBinding(new s.KeyBinding("c",!0,!0,!0,!1),"collapseAll");a.setAction("collapseAll",function(){return this.expandAnnotations(!1)}.bind(this),{name:m.collapseAll});a.setKeyBinding(new s.KeyBinding("q",
!e.isMac,!1,!1,e.isMac),"lastEdit");a.setAction("lastEdit",function(){return this.gotoLastEdit()}.bind(this),{name:m.lastEdit})},copyLinesDown:function(){var a=this.editor;if(a.getTextView().getOptions("readonly"))return!1;var b=a.getModel();g(this,!1,function(a,d){var c=b.getLineAtOffset(a.start),e=b.getLineAtOffset(a.end>a.start?a.end-1:a.end),k=b.getLineStart(c),c=b.getLineEnd(e,!0),f=b.getLineCount(),g="",k=b.getText(k,c);e===f-1&&(k=(g=b.getLineDelimiter())+k);d(k,c,c);a.start=c+g.length;a.end=
c+k.length});return!0},copyLinesUp:function(){var a=this.editor;if(a.getTextView().getOptions("readonly"))return!1;var b=a.getModel();g(this,!1,function(a,d){var c=b.getLineAtOffset(a.start),e=b.getLineAtOffset(a.end>a.start?a.end-1:a.end),c=b.getLineStart(c),k=b.getLineEnd(e,!0),f=b.getLineCount(),g="",k=b.getText(c,k);e===f-1&&(k+=g=b.getLineDelimiter());d(k,c,c);a.start=c;a.end=c+k.length-g.length});return!0},deleteLines:function(a){var b=this.editor;if(b.getTextView().getOptions("readonly"))return!1;
var c=1;a&&a.count&&(c=a.count);var e=b.getModel();g(this,!1,function(a,b){var d=e.getLineAtOffset(a.start),k=e.getLineStart(d),d=a.start!==a.end||1===c?e.getLineAtOffset(a.end>a.start?a.end-1:a.end):Math.min(d+c-1,e.getLineCount()-1),d=e.getLineEnd(d,!0);b("",k,d);a.start=a.end=k});return!0},expandAnnotation:function(a){var b=this.editor,c=b.getAnnotationModel();if(!c)return!0;var e=b.getModel(),k=b.getCaretOffset(),f=e.getLineAtOffset(k),k=e.getLineStart(f),f=e.getLineEnd(f,!0);e.getBaseModel&&
(k=e.mapOffset(k),f=e.mapOffset(f),e.getBaseModel());for(var g,c=c.getAnnotations(k,f);!g&&c.hasNext();)e=c.next(),e.type===p.AnnotationType.ANNOTATION_FOLDING&&(g=e);g&&a!==g.expanded&&(a?g.expand():(b.setCaretOffset(g.start),g.collapse()));return!0},expandAnnotations:function(a){var b=this.editor,c=b.getTextView(),b=b.getAnnotationModel();if(!b)return!0;var e=b.getAnnotations();for(c.setRedraw(!1);e.hasNext();)b=e.next(),b.type===p.AnnotationType.ANNOTATION_FOLDING&&a!==b.expanded&&(a?b.expand():
b.collapse());c.setRedraw(!0);return!0},indentLines:function(){var a=this.editor,b=a.getTextView();if(b.getOptions("readonly"))return!1;if(b.getOptions("tabMode")){var c=a.getModel(),e=0,k=a.getSelections();1<k.length&&this.startUndo();if(k.some(function(f){f.start+=e;f.end+=e;var g=c.getLineAtOffset(f.start),l=c.getLineAtOffset(f.end>f.start?f.end-1:f.end);if(g!==l||1<k.length){var h=[];h.push("");for(var m=g;m<=l;m++)h.push(c.getLine(m,!0));var m=c.getLineStart(g),p=c.getLineEnd(l,!0),s=b.getOptions("tabSize",
"expandTab"),s=s.expandTab?Array(s.tabSize+1).join(" "):"\t",h=h.join(s);a.setText(h,m,p);var A=m===f.start?f.start:f.start+s.length,g=f.end+(l-g+1)*s.length;e+=m-p+h.length;f.start=A;f.end=g}else return!0;return!1}))return!1;a.setSelections(k);1<k.length&&this.endUndo();return!0}},gotoLastEdit:function(){"number"===typeof this._lastEditLocation&&this.editor.showSelection(this._lastEditLocation);return!0},gotoLine:function(){var a=this.editor,b=a.getModel().getLineAtOffset(a.getCaretOffset());if(b=
prompt(m.gotoLinePrompty,b+1))b=parseInt(b,10),a.onGotoLine(b-1,0);return!0},moveLinesDown:function(){var a=this.editor;if(a.getTextView().getOptions("readonly"))return!1;var b=a.getModel();g(this,!0,function(a,d){var c=b.getLineAtOffset(a.start),e=b.getLineAtOffset(a.end>a.start?a.end-1:a.end),k=b.getLineCount();if(e!==k-1){var c=b.getLineStart(c),f=b.getLineEnd(e,!0),g=b.getLineEnd(e+1,!0)-(f-c),l=0;e!==k-2?e=b.getText(c,f):(k=b.getLineEnd(e),e=b.getText(k,f)+b.getText(c,k),l+=f-k);d("",c,f);d(e,
g,g);a.start=g+l;a.end=g+l+e.length}});return!0},moveLinesUp:function(){var a=this.editor;if(a.getTextView().getOptions("readonly"))return!1;var b=a.getModel();g(this,!0,function(a,d){var c=b.getLineAtOffset(a.start);if(0!==c){var e=b.getLineAtOffset(a.end>a.start?a.end-1:a.end),k=b.getLineCount(),f=b.getLineStart(c-1),g=b.getLineStart(c),l=b.getLineEnd(e,!0),h=b.getText(g,l),m=0;e===k-1&&(e=b.getLineEnd(c-1),c=b.getLineEnd(c-1,!0),h+=b.getText(e,c),g=e,m=c-e);d("",g,l);d(h,f,f);a.start=f;a.end=f+
h.length-m}});return!0},nextAnnotation:function(b){function c(b){return!!b.lineStyle||b.type===a.ANNOTATION_MATCHING_BRACKET||b.type===a.ANNOTATION_CURRENT_BRACKET||!f.isAnnotationTypeVisible(b.type)}var e=this.editor,k=e.getAnnotationModel();if(!k)return!0;var f=e.getOverviewRuler()||e.getAnnotationStyler();if(!f)return!0;for(var g=e.getModel(),l=e.getCaretOffset(),m=k.getAnnotations(b?l:0,b?g.getCharCount():l),p=null;m.hasNext();){var s=m.next();if(b){if(s.start<=l)continue}else if(s.start>=l)continue;
if(!c(s)&&(p=s,b))break}if(p){for(var z=[p],m=k.getAnnotations(p.start,p.start);m.hasNext();)s=m.next(),s!==p&&!c(s)&&z.push(s);var E=e.getTextView(),A=g.getLineAtOffset(p.start),D=h.Tooltip.getTooltip(E);if(!D)return e.moveSelection(p.start),!0;e.moveSelection(p.start,p.start,function(){D.setTarget({getTooltipInfo:function(){var a=E.convert({x:E.getLocationAtOffset(p.start).x,y:E.getLocationAtOffset(g.getLineStart(A)).y},"document","page");return{contents:z,x:a.x,y:a.y+Math.floor(1.33*E.getLineHeight(A))}}},
0)})}return!0},unindentLines:function(){var a=this.editor,b=a.getTextView();if(b.getOptions("readonly"))return!1;if(b.getOptions("tabMode")){var c=a.getModel();g(this,!1,function(a,d){for(var e=c.getLineAtOffset(a.start),k=c.getLineAtOffset(a.end>a.start?a.end-1:a.end),f=b.getOptions("tabSize"),g=Array(f+1).join(" "),l=[],h=0,m=0,p=e;p<=k;p++){var s=c.getLine(p,!0);if(c.getLineStart(p)!==c.getLineEnd(p))if(0===s.indexOf("\t"))s=s.substring(1),h++;else if(0===s.indexOf(g))s=s.substring(f),h+=f;else return!0;
p===e&&(m=h);l.push(s)}e=c.getLineStart(e);f=c.getLineEnd(k,!0);k=c.getLineStart(k);l=l.join("");d(l,e,f);m=e===a.start?a.start:a.start-m;h=Math.max(m,a.end-h+(a.end===k+1&&a.start!==a.end?1:0));a.start=m;a.end=h});return!0}},startUndo:function(){this.undoStack&&this.undoStack.startCompoundChange()},endUndo:function(){this.undoStack&&this.undoStack.endCompoundChange()}};k.TextActions=l;b.prototype={init:function(){var a=this.editor.getTextView();a.setAction("lineStart",function(){return this.lineStart()}.bind(this));
a.setAction("enter",function(){return this.autoIndent()}.bind(this));a.setKeyBinding(new s.KeyBinding("t",!0,!1,!0),"trimTrailingWhitespaces");a.setAction("trimTrailingWhitespaces",function(){return this.trimTrailingWhitespaces()}.bind(this),{name:m.trimTrailingWhitespaces});a.setKeyBinding(new s.KeyBinding(191,!0),"toggleLineComment");a.setAction("toggleLineComment",function(){return this.toggleLineComment()}.bind(this),{name:m.toggleLineComment});a.setKeyBinding(new s.KeyBinding(191,!0,!e.isMac,
!1,e.isMac),"addBlockComment");a.setAction("addBlockComment",function(){return this.addBlockComment()}.bind(this),{name:m.addBlockComment});a.setKeyBinding(new s.KeyBinding(220,!0,!e.isMac,!1,e.isMac),"removeBlockComment");a.setAction("removeBlockComment",function(){return this.removeBlockComment()}.bind(this),{name:m.removeBlockComment});a.setKeyBinding(new s.KeyBinding("[",!1,!1,!1,!1,"keypress"),"autoPairSquareBracket");a.setAction("autoPairSquareBracket",function(){return this.autoPairBrackets("[",
"]")}.bind(this));a.setKeyBinding(new s.KeyBinding("]",!1,!1,!1,!1,"keypress"),"skipClosingSquareBracket");a.setAction("skipClosingSquareBracket",function(){return this.skipClosingBracket("]")}.bind(this));a.setKeyBinding(new s.KeyBinding("\x3c",!1,!1,!1,!1,"keypress"),"autoPairAngleBracket");a.setAction("autoPairAngleBracket",function(){return this.autoPairBrackets("\x3c","\x3e")}.bind(this));a.setKeyBinding(new s.KeyBinding("\x3e",!1,!1,!1,!1,"keypress"),"skipClosingAngleBracket");a.setAction("skipClosingAngleBracket",
function(){return this.skipClosingBracket("\x3e")}.bind(this));a.setKeyBinding(new s.KeyBinding("(",!1,!1,!1,!1,"keypress"),"autoPairParentheses");a.setAction("autoPairParentheses",function(){return this.autoPairBrackets("(",")")}.bind(this));a.setKeyBinding(new s.KeyBinding(")",!1,!1,!1,!1,"keypress"),"skipClosingParenthesis");a.setAction("skipClosingParenthesis",function(){return this.skipClosingBracket(")")}.bind(this));a.setKeyBinding(new s.KeyBinding("{",!1,!1,!1,!1,"keypress"),"autoPairBraces");
a.setAction("autoPairBraces",function(){return this.autoPairBrackets("{","}")}.bind(this));a.setKeyBinding(new s.KeyBinding("}",!1,!1,!1,!1,"keypress"),"skipClosingBrace");a.setAction("skipClosingBrace",function(){return this.skipClosingBracket("}")}.bind(this));a.setKeyBinding(new s.KeyBinding("'",!1,!1,!1,!1,"keypress"),"autoPairSingleQuotation");a.setAction("autoPairSingleQuotation",function(){return this.autoPairQuotations("'")}.bind(this));a.setKeyBinding(new s.KeyBinding('"',!1,!1,!1,!1,"keypress"),
"autoPairDblQuotation");a.setAction("autoPairDblQuotation",function(){return this.autoPairQuotations('"')}.bind(this));a.setAction("deletePrevious",function(){return this.deletePrevious()}.bind(this))},autoIndent:function(){function a(b,d){if(b.start===b.end){for(var c=e.getLineAtOffset(b.start),g=e.getLine(c,!1),n=e.getLineStart(c),r=0,s=b.start-n,L;r<s&&(32===(L=g.charCodeAt(r))||9===L);)r++;var n=g.substring(0,r),K=g.substring(0,s),J=g.substring(s),t;if(p.smartIndentation&&123===g.charCodeAt(t=
K.trimRight().length-1))return c=s-t-1,J=J.length-J.trimLeft().length,g=125===g.charCodeAt(s+J)?f+n+k+f+n:f+n+k,d(g,b.start-c,b.end+J),b.start=b.end=b.start+f.length+n.length+k.length-c,!0;if(p.autoCompleteComments&&!m.test(K)&&(l.test(K)||h.test(K))){if(r=l.exec(K)){g=f+n+" * ";g=m.test(J)?g+J.substring(0,J.length-2).trim():g+J.trim();if(e.getLineCount()===c+1||!h.test(e.getLine(c+1)))g+=f+n+" */";d(g,b.start,b.end+J.length);b.start=b.end=b.start+f.length+n.length+3;return!0}if(r=h.exec(K))for(c-=
1;0<=c;c--){r=e.getLine(c,!1);if(l.test(r))return m.test(J)||47===g.charCodeAt(s)?(g=f+n+"*"+J,n=b.start+f.length+n.length+1):(g=f+n+"* "+J,n=b.start+f.length+n.length+2),d(g,b.start,b.end+J.length),b.start=b.end=n,!0;if(!h.test(r))break}}else{if(m.test(K)&&32===n.charCodeAt(n.length-1))return g=f+n.substring(0,n.length-1),d(g,b.start,b.end),b.start=b.end=b.start+g.length,!0;if(0<r){for(r=s;r<g.length&&(32===(L=g.charCodeAt(r++))||9===L);)b.end++;g=e.getLineDelimiter()+n;d(g,b.start,b.end);b.start=
b.end=b.start+g.length;return!0}}}return!1}var b=this.editor,c=b.getTextView();if(c.getOptions("readonly")||c.getOptions("singleMode"))return!1;var e=b.getModel(),b=c.getOptions("tabSize","expandTab"),k=b.expandTab?Array(b.tabSize+1).join(" "):"\t",f=e.getLineDelimiter(),l=/^[\s]*\/\*[\*]*[\s]*$/,h=/^[\s]*\*/,m=/\*\/[\s]*$/,p=this;g(this,!0,function(b,c){a(b,c)||(c(f,b.start,b.end),b.start=b.end=b.start+f.length)});return!0},addBlockComment:function(){var a=this.editor;if(a.getTextView().getOptions("readonly"))return!1;
var b=a.getModel(),c=/\/\*|\*\//g,e=this;g(this,!1,function(a,d){var k=e._findEnclosingComment(b,a.start,a.end);if(!(void 0!==k.commentStart&&void 0!==k.commentEnd)&&(k=b.getText(a.start,a.end),0!==k.length)){var f=k.length,k=k.replace(c,""),g=k.length;d("/*"+k+"*/",a.start,a.end);a.start+=2;a.end+=2+(g-f)}});return!0},autoPairBrackets:function(a,b){if("["===a&&!this.autoPairSquareBrackets||"{"===a&&!this.autoPairBraces||"("===a&&!this.autoPairParentheses||"\x3c"===a&&!this.autoPairAngleBrackets)return!1;
var c=this.editor;if(c.getTextView().getOptions("readonly"))return!1;var e=/^$|[)}\]>]/,k=c.getModel();g(this,!1,function(c,f){var g=c.start===k.getCharCount()?"":k.getText(c.start,c.start+1).trim();c.start===c.end&&e.test(g)?(g=a+b,f(g,c.start,c.start),c.start=c.end=c.start+1):c.start!==c.end?(g=a+k.getText(c.start,c.end)+b,f(g,c.start,c.end),c.start+=1,c.end+=1):(f(a,c.start,c.end),c.start=c.end=c.start+a.length)});return!0},autoPairQuotations:function(a){if(!this.autoPairQuotation)return!1;var b=
this.editor;if(b.getTextView().getOptions("readonly"))return!1;var c=/^"$|^'$/,e=/\w/,k=/^$|[)}\]>]/,f=b.getModel();g(this,!1,function(b,g){function l(){g(a,b.start,b.end);b.start=b.end=b.start+a.length}var r=0===b.start?"":f.getText(b.start-1,b.start).trim(),h=b.start===f.getCharCount()?"":f.getText(b.start,b.start+1).trim();b.start!==b.end?(r=f.getText(b.start,b.end),c.test(r)?l():(g(a+r+a,b.start,b.end),b.start+=1,b.end+=1)):h===a?b.start=b.end=b.start+1:r===a||c.test(h)||e.test(r)||!k.test(h)?
l():(g(a+a,b.start,b.end),b.start=b.end=b.start+a.length)});return!0},contentAssistProposalApplied:function(a){function b(){return"number"===typeof c.escapePosition?c.escapePosition:a.data.start+c.proposal.length}var c=a.data.proposal;if(c.positions&&0<c.positions.length&&this.linkedMode){for(var e=[],k=0;k<c.positions.length;++k)e[k]={positions:[{offset:c.positions[k].offset,length:c.positions[k].length}]};this.linkedMode.enterLinkedMode({groups:e,escapePosition:b()})}else c.groups&&0<c.groups.length&&
this.linkedMode?this.linkedMode.enterLinkedMode({groups:c.groups,escapePosition:b()}):"number"===typeof c.escapePosition&&this.editor.getTextView().setCaretOffset(c.escapePosition);return!0},deletePrevious:function(){var a=this.editor;if(a.getTextView().getOptions("readonly"))return!1;var b=a.getModel();g(this,!1,function(a,c){if(a.start===a.end){var d=0===a.start?"":b.getText(a.start-1,a.start),e=a.start===b.getCharCount()?"":b.getText(a.start,a.start+1);("("===d&&")"===e||"["===d&&"]"===e||"{"===
d&&"}"===e||"\x3c"===d&&"\x3e"===e||'"'===d&&'"'===e||"'"===d&&"'"===e)&&c("",a.start,a.start+1)}},!0);return!1},_findEnclosingComment:function(a,b,c){var e=a.getLineAtOffset(b),k=a.getLineAtOffset(c),f,g,l,h,m,p;for(f=e;0<=f&&!(g=a.getLine(f),l=f===e?b-a.getLineStart(e):g.length,h=g.lastIndexOf("/*",l),g=g.lastIndexOf("*/",l),g>h);f--)if(-1!==h){m=a.getLineStart(f)+h;break}for(f=k;f<a.getLineCount()&&!(g=a.getLine(f),l=f===k?c-a.getLineStart(k):0,h=g.indexOf("/*",l),g=g.indexOf("*/",l),-1!==h&&h<
g);f++)if(-1!==g){p=a.getLineStart(f)+g;break}return{commentStart:m,commentEnd:p}},lineStart:function(){var a=this.editor.getModel();g(this,!1,function(b){var c=b.getCaret(),e=a.getLineAtOffset(c),k=a.getLineStart(e),e=a.getLine(e),f;for(f=0;f<e.length;f++){var g=e.charCodeAt(f);if(!(32===g||9===g))break}f+=k;c!==f?b.setCaret(f):b.setCaret(k)});return!0},removeBlockComment:function(){var a=this.editor;if(a.getTextView().getOptions("readonly"))return!1;var b=a.getModel(),c=this;g(this,!1,function(a,
d){var e=b.getText(a.start,a.end),k,f,g;for(g=0;g<e.length;g++)if("/*"===e.substring(g,g+2)){k=a.start+g;break}for(;g<e.length;g++)if("*/"===e.substring(g,g+2)){f=a.start+g;break}void 0!==k&&void 0!==f?(e=b.getText(k+2,f),d(e,k,f+2),a.start=k,a.end=f):(k=c._findEnclosingComment(b,a.start,a.end),void 0===k.commentStart||void 0===k.commentEnd||(e=b.getText(k.commentStart+2,k.commentEnd),d(e,k.commentStart,k.commentEnd+2),a.start-=2,a.end-=2))});return!0},toggleLineComment:function(){var a=this.editor,
b=a.getTextView();if(b.getOptions("readonly"))return!1;var c=this.lineComment||"//",e=a.getModel();b.setRedraw(!1);g(this,!0,function(a,b){for(var d=e.getLineAtOffset(a.start),k=e.getLineAtOffset(a.end>a.start?a.end-1:a.end),f=!0,g=[],l,r=d;r<=k;r++){var h=e.getLine(r,!0);l=h.indexOf(c);g.push(l);if(!f||-1===l)f=!1;else if(0!==l){for(f=0;f<l;f++){var m=h.charCodeAt(f);if(!(32===m||9===m))break}f=f===l}}r=c.length;h=e.getLineStart(d);if(f){for(f=g.length-1;0<=f;f--)l=g[f]+e.getLineStart(d+f),b("",
l,l+r);l=e.getLineStart(k);g=h===a.start?a.start:a.start-r;d=a.end-r*(k-d+1)+(a.end===l+1?r:0)}else{for(f=g.length-1;0<=f;f--)l=e.getLineStart(d+f),b(c,l,l);g=h===a.start?a.start:a.start+r;d=a.end+r*(k-d+1)}a.start=g;a.end=d});b.setRedraw(!0);return!0},trimTrailingWhitespaces:function(){var a=this.editor,b=a.getModel(),c=a.getSelections();a.getTextView().setRedraw(!1);this.startUndo();for(var e=/(\s+$)/,f=b.getLineCount(),k=0;k<f;k++){var g=b.getLine(k);if(g=e.exec(g)){var l=b.getLineStart(k),h=g[0].length,
m=l+g.index;b.setText("",m,m+h);c.forEach(function(a){a.start>m&&(a.start=Math.max(m,a.start-h));a.start!==a.end&&a.end>m&&(a.end=Math.max(m,a.end-h))})}}this.endUndo();a.setSelections(c,!1);a.getTextView().setRedraw(!0)},startUndo:function(){this.undoStack&&this.undoStack.startCompoundChange()},skipClosingBracket:function(a){var b=this.editor;if(b.getTextView().getOptions("readonly"))return!1;var c=b.getModel(),e=b.getSelections();return 1===e.length&&e[0].start===e[0].end&&(e[0].start===c.getCharCount()?
"":c.getText(e[0].start,e[0].start+1))===a?(e[0].start=e[0].end=e[0].start+1,b.setSelections(e),!0):!1},endUndo:function(){this.undoStack&&this.undoStack.endCompoundChange()},setAutoPairParentheses:function(a){this.autoPairParentheses=a},setAutoPairBraces:function(a){this.autoPairBraces=a},setAutoPairSquareBrackets:function(a){this.autoPairSquareBrackets=a},setAutoPairAngleBrackets:function(a){this.autoPairAngleBrackets=a},setAutoPairQuotations:function(a){this.autoPairQuotation=a},setAutoCompleteComments:function(a){this.autoCompleteComments=
a},setLineComment:function(a){this.lineComment=a},setSmartIndentation:function(a){this.smartIndentation=a}};k.SourceCodeActions=b;String.prototype.trimLeft||(String.prototype.trimLeft=function(){return this.replace(/^\s+/g,"")});String.prototype.trimRight||(String.prototype.trimRight=function(){return this.replace(/\s+$/g,"")});return k});
define("orion/editor/templates",[],function(){function m(m,h,c,f){this.prefix=m;this.description=h;this.template=c;this.name=f;this._parse()}function s(m,h){this._keywords=m||[];this._templates=[];this.addTemplates(h||[])}m.prototype={getProposal:function(m,h,c){m=h-m.length;h={};var f,e=void 0!==c.delimiter?c.delimiter:"\n";c.indentation&&(e+=c.indentation);var g=void 0!==c.tab?c.tab:"\t",l=0,b=this.variables,a=this.segments;c=[];for(var k=0;k<a.length;k++){var d=a[k],r=b[d];if(void 0!==r)switch(d){case "${tab}":d=
g;break;case "${delimiter}":d=e;break;case "${cursor}":d="";f=l;break;default:var n=h[d];n||(n=h[d]={data:r.data,positions:[]});d=r.substitution;n.data&&n.data.values&&(d=n.data.values[0]);n.positions.push({offset:m+l,length:d.length})}c.push(d);l+=d.length}var e=[],u;for(u in h)h.hasOwnProperty(u)&&e.push(h[u]);c=c.join("");void 0===f&&(f=c.length);return{proposal:c,name:this.name,description:this.description,groups:e,escapePosition:m+f,style:"noemphasis"}},match:function(m){return 0===this.prefix.indexOf(m)},
_parse:function(){var m=this.template,h=[],c={},f,e=0,m=m.replace(/\n/g,"${delimiter}"),m=m.replace(/\t/g,"${tab}");m.replace(/\$\{((?:[^\\}]+|\\.))*\}/g,function(g,l,b){var a=g.substring(2,g.length-1);l=g;var k=a,d=null,r=k.indexOf(":");-1!==r&&(k=k.substring(0,r),l="${"+k+"}",d=JSON.parse(a.substring(r+1).replace("\\}","}").trim()));(a=c[l])||(a=c[l]={});a.substitution=k;d&&(a.data=d);(f=m.substring(e,b))&&h.push(f);h.push(l);e=b+g.length;return k});(f=m.substring(e,m.length))&&h.push(f);this.segments=
h;this.variables=c}};s.prototype={addTemplates:function(p){for(var h=this.getTemplates(),c=0;c<p.length;c++)h.push(new m(p[c].prefix,p[c].description,p[c].template,p[c].name))},initialize:function(){},computeProposals:function(m,h,c){var f=this.getPrefix(m,h,c),e=[];this.isValid(f,m,h,c)&&(e=e.concat(this.getTemplateProposals(f,h,c)),e=e.concat(this.getKeywordProposals(f)));return e},getKeywords:function(){return this._keywords},getKeywordProposals:function(m){var h=[],c=this.getKeywords();if(c){for(var f=
0;f<c.length;f++)0===c[f].indexOf(m)&&h.push({proposal:c[f].substring(m.length),description:c[f],style:"noemphasis_keyword"});0<h.length&&h.splice(0,0,{proposal:"",description:"Keywords",style:"noemphasis_title_keywords",unselectable:!0})}return h},getPrefix:function(m,h,c){return c.prefix},getTemplates:function(){return this._templates},getTemplateProposals:function(m,h,c){for(var f=[],e=this.getTemplates(),g=0;g<e.length;g++){var l=e[g];l.match(m)&&(l=l.getProposal(m,h,c),this.removePrefix(m,l),
f.push(l))}0<f.length&&(f.sort(function(b,a){return b.name<a.name?-1:b.name>a.name?1:0}),f.splice(0,0,{proposal:"",description:"Templates",style:"noemphasis_title",unselectable:!0}));return f},removePrefix:function(m,h){if(!(h.overwrite=h.proposal.substring(0,m.length)!==m))h.proposal=h.proposal.substring(m.length)},isValid:function(m,h,c,f){return!0}};return{Template:m,TemplateContentAssist:s}});
define("orion/editor/linkedMode","i18n!orion/editor/nls/messages orion/keyBinding orion/editor/keyModes orion/editor/annotations orion/editor/templates orion/objects orion/util".split(" "),function(m,s,p,h,c,f){function e(c,b,a){var e=c.getTextView();p.KeyMode.call(this,e);this.editor=c;this.undoStack=b;this.contentAssist=a;this.linkedModeModel=null;e.setAction("linkedModeEnter",function(){this.exitLinkedMode(!0);return!0}.bind(this));e.setAction("linkedModeCancel",function(){this.exitLinkedMode(!1);
return!0}.bind(this));e.setAction("linkedModeNextGroup",function(){var a=this.linkedModeModel;this.selectLinkedGroup((a.selectedGroupIndex+1)%a.groups.length);return!0}.bind(this));e.setAction("linkedModePreviousGroup",function(){var a=this.linkedModeModel;this.selectLinkedGroup(0<a.selectedGroupIndex?a.selectedGroupIndex-1:a.groups.length-1);return!0}.bind(this));this.linkedModeListener={onActivating:function(a){this._groupContentAssistProvider&&(this.contentAssist.setProviders([this._groupContentAssistProvider]),
this.contentAssist.setProgress(null))}.bind(this),onModelChanged:function(a){if(!this.ignoreVerify){for(var b=this.editor.mapOffset(a.start),c=this.linkedModeModel,e,f;c;)if(e=this._getPositionChanged(c,b,b+a.removedCharCount),f=e.position,void 0===f||f.model!==c)this.exitLinkedMode(!1),c=this.linkedModeModel;else break;if(c){c=0;a=a.addedCharCount-a.removedCharCount;e=e.positions;for(var k,g=0;g<e.length;++g){k=e[g];f=k.position;var l=f.offset<=b&&b<=f.offset+f.length;l&&!k.ansestor?(f.offset+=c,
f.length+=a,c+=a):(f.offset+=c,k.ansestor&&l&&(f.length+=a));k.escape&&(k.model.escapePosition=f.offset)}this._updateAnnotations(e)}}}.bind(this),onVerify:function(a){if(!this.ignoreVerify){for(var b=this.editor,c=b.mapOffset(a.start),e=this.editor.mapOffset(a.end),f=this.linkedModeModel,k,g;f;)if(k=this._getPositionChanged(f,c,e),g=k.position,void 0===g||g.model!==f)this.exitLinkedMode(!1),f=this.linkedModeModel;else break;if(f){var l=this._compoundChange;l?l.owner.model===f&&l.owner.group===g.group||
(this.endUndo(),this.startUndo()):this.startUndo();f.selectedGroupIndex=g.group;var l=0,h=a.text.length-(e-c);k=k.positions;for(var m,c=c-g.position.offset,p=e-g.position.offset,s=0;s<k.length;++s)m=k[s],e=m.position,m.oldOffset=e.offset,m.model===f&&m.group===g.group?(e.offset+=l,e.length+=h,l+=h):(e.offset+=l,m.ansestor&&(e.length+=g.count*h)),m.escape&&(m.model.escapePosition=e.offset);this.ignoreVerify=!0;for(s=k.length-1;0<=s;s--)m=k[s],m.model===f&&m.group===g.group&&b.setText(a.text,m.oldOffset+
c,m.oldOffset+p);this.ignoreVerify=!1;a.text=null;this._updateAnnotations(k)}}}.bind(this)}}var g={};e.prototype=new p.KeyMode;f.mixin(e.prototype,{createKeyBindings:function(){var c=s.KeyBinding,b=[];b.push({actionID:"linkedModeEnter",keyBinding:new c(13)});b.push({actionID:"linkedModeCancel",keyBinding:new c(27)});b.push({actionID:"linkedModeNextGroup",keyBinding:new c(9)});b.push({actionID:"linkedModePreviousGroup",keyBinding:new c(9,!1,!0)});return b},enterLinkedMode:function(c){if(!this.linkedModeModel){var b=
this.editor.getTextView();b.addKeyMode(this);b.addEventListener("Verify",this.linkedModeListener.onVerify);b.addEventListener("ModelChanged",this.linkedModeListener.onModelChanged);this.contentAssist.addEventListener("Activating",this.linkedModeListener.onActivating);this.editor.reportStatus(m.linkedModeEntered,null,!0)}this._sortedPositions=null;this.linkedModeModel&&(c.previousModel=this.linkedModeModel,c.parentGroup=this.linkedModeModel.selectedGroupIndex,this.linkedModeModel.nextModel=c);this.linkedModeModel=
c;this.selectLinkedGroup(0)},exitLinkedMode:function(c){if(this.isActive()){this._compoundChange&&(this.endUndo(),this._compoundChange=null);this._sortedPositions=null;var b=this.linkedModeModel;this.linkedModeModel=b.previousModel;b.parentGroup=b.previousModel=void 0;this.linkedModeModel&&(this.linkedModeModel.nextModel=void 0);if(!this.linkedModeModel){var a=this.editor,e=a.getTextView();e.removeKeyMode(this);e.removeEventListener("Verify",this.linkedModeListener.onVerify);e.removeEventListener("ModelChanged",
this.linkedModeListener.onModelChanged);e=this.contentAssist;e.removeEventListener("Activating",this.linkedModeListener.onActivating);e.offset=void 0;this.editor.reportStatus(m.linkedModeExited,null,!0);c&&"number"===typeof b.escapePosition&&a.setCaretOffset(b.escapePosition,!1)}this.selectLinkedGroup(0)}},startUndo:function(){if(this.undoStack){var c=this,b=this.linkedModeModel;this._compoundChange=this.undoStack.startCompoundChange({model:b,group:b.selectedGroupIndex,end:function(){c._compoundChange=
null}})}},endUndo:function(){this.undoStack&&this.undoStack.endCompoundChange()},isActive:function(){return!!this.linkedModeModel},isStatusActive:function(){return!!this.linkedModeModel},selectLinkedGroup:function(e){var b=this.linkedModeModel;if(b){b.selectedGroupIndex=e;e=b.groups[e];var a=e.positions[0],f=this.editor;f.setSelection(a.offset,a.offset+a.length);if(b=this.contentAssist)b.offset=void 0,e.data&&"link"===e.data.type&&e.data.values?((this._groupContentAssistProvider=new c.TemplateContentAssist(e.data.values)).getPrefix=
function(){var b=f.getSelection();return b.start===b.end&&(b=f.getCaretOffset(),a.offset<=b&&b<=a.offset+a.length)?f.getText(a.offset,b):""},b.offset=a.offset,b.deactivate(),b.activate()):this._groupContentAssistProvider&&(this._groupContentAssistProvider=null,b.deactivate())}this._updateAnnotations()},_getModelPositions:function(c,b,a){for(var e=b.groups,d=0;d<e.length;d++)for(var f=e[d].positions,g=0;g<f.length;g++){var h=f[g];a&&(h={offset:h.offset+a,length:h.length});h={index:g,group:d,count:f.length,
model:b,position:h};c.push(h);b.nextModel&&b.nextModel.parentGroup===d&&(h.ansestor=!0,this._getModelPositions(c,b.nextModel,(a||0)+f[g].offset-f[0].offset))}},_getSortedPositions:function(c){var b=this._sortedPositions;if(!b){for(b=[];c.previousModel;)c=c.previousModel;for(this._getModelPositions(b,c);c;)"number"===typeof c.escapePosition&&b.push({escape:!0,model:c,position:{offset:c.escapePosition,length:0}}),c=c.nextModel;b.sort(function(a,b){return a.position.offset-b.position.offset});this._sortedPositions=
b}return b},_getPositionChanged:function(c,b,a){var e;c=this._getSortedPositions(c);for(var d=c.length-1;0<=d;d--){var f=c[d].position;if(f.offset<=b&&a<=f.offset+f.length){e=c[d];break}}return{position:e,positions:c}},_updateAnnotations:function(c){var b=this.editor.getAnnotationModel();if(b){for(var a=[],e=[],d=b.getAnnotations(),f;d.hasNext();)switch(f=d.next(),f.type){case h.AnnotationType.ANNOTATION_LINKED_GROUP:case h.AnnotationType.ANNOTATION_CURRENT_LINKED_GROUP:case h.AnnotationType.ANNOTATION_SELECTED_LINKED_GROUP:a.push(f)}if(d=
this.linkedModeModel){c=c||this._getSortedPositions(d);for(var g=0;g<c.length;g++)if(f=c[g],f.model===d&&!f.escape){var m=h.AnnotationType.ANNOTATION_LINKED_GROUP;f.group===d.selectedGroupIndex&&(m=0===f.index?h.AnnotationType.ANNOTATION_SELECTED_LINKED_GROUP:h.AnnotationType.ANNOTATION_CURRENT_LINKED_GROUP);f=f.position;f=h.AnnotationType.createAnnotation(m,f.offset,f.offset+f.length,"");e.push(f)}}b.replaceAnnotations(a,e)}}});g.LinkedMode=e;return g});
define("orion/editor/factories","orion/editor/actions orion/editor/undoStack orion/editor/rulers orion/editor/annotations orion/editor/textDND orion/editor/linkedMode orion/util".split(" "),function(m,s,p,h,c,f,e){function g(){}function l(){}function b(){}function a(){}function k(){}function d(){}function r(){}var n={};g.prototype={createKeyBindings:function(a,b,c,d){d=new m.TextActions(a,b,d);var e=new f.LinkedMode(a,b,c);a=new m.SourceCodeActions(a,b,c,e);return{textActions:d,linkedMode:e,sourceCodeActions:a}}};
n.KeyBindingsFactory=g;l.prototype={createUndoStack:function(a){a=a.getTextView();return new s.UndoStack(a,200)}};n.UndoFactory=l;b.prototype={createLineNumberRuler:function(a){return new p.LineNumberRuler(a,"left",{styleClass:"ruler lines"},{styleClass:"rulerLines odd"},{styleClass:"rulerLines even"})}};n.LineNumberRulerFactory=b;a.prototype={createFoldingRuler:function(a){return new p.FoldingRuler(a,"left",{styleClass:"ruler folding"})}};n.FoldingRulerFactory=a;k.prototype={createZoomRuler:function(a){return new p.ZoomRuler(e.isIOS||
e.isAndroid?"right":"innerRight",{styleClass:"ruler zoom"})}};n.ZoomRulerFactory=k;d.prototype={createAnnotationModel:function(a){return new h.AnnotationModel(a)},createAnnotationStyler:function(a,b){return new h.AnnotationStyler(a,b)},createAnnotationRulers:function(a){var b=new p.AnnotationRuler(a,"left",{styleClass:"ruler annotations"});a=new p.OverviewRuler(a,"right",{styleClass:"ruler overview"});return{annotationRuler:b,overviewRuler:a}}};n.AnnotationFactory=d;r.prototype={createTextDND:function(a,
b){return new c.TextDND(a.getTextView(),b)}};n.TextDNDFactory=r;return n});define("orion/editor/editorFeatures",["orion/editor/factories","orion/editor/actions","orion/editor/linkedMode","orion/objects"],function(m,s,p,h){return h.mixin({},m,s,p)});
define("orion/editor/contentAssist","i18n!orion/editor/nls/messages orion/keyBinding orion/editor/keyModes orion/editor/eventTarget orion/Deferred orion/objects orion/editor/tooltip orion/editor/util orion/util orion/webui/littlelib orion/metrics".split(" "),function(m,s,p,h,c,f,e,g,l,b,a){function k(a){this.textView=a;this.state=n.INACTIVE;this.clearProviders();var b=this;this._textViewListeners={onModelChanging:function(a){(this._latestModelChangingEvent=a)&&this._updateFilterText(a)}.bind(this),
onSelection:function(a){this.isDeactivatingChange(this._latestModelChangingEvent,a)?this.setState(n.INACTIVE):this.isActive()&&(this.state===n.ACTIVE&&this.setState(n.FILTERING),this.filterProposals());this._latestModelChangingEvent=null}.bind(this),onScroll:function(a){this.setState(n.INACTIVE)}.bind(this)};a.setKeyBinding(l.isMac?new s.KeyBinding(" ",!1,!1,!1,!0):new s.KeyBinding(" ",!0),"contentAssist");a.setKeyBinding(l.isMac?new s.KeyBinding(" ",!1,!1,!0,!0):new s.KeyBinding(" ",!0,!1,!0),"contentAssist");
a.setAction("contentAssist",function(){a.getOptions("readonly")||b.activate();return!0},{name:m.contentAssist})}function d(a,b){var c=a.textView;p.KeyMode.call(this,c);this.contentAssist=a;this.widget=b;this.proposals=[];var d=this;this.contentAssist.addEventListener("ProposalsComputed",function(a){d.proposals=a.data.proposals;if(0===d.proposals.length)d.selectedIndex=-1,d.cancel();else{for(d.selectedIndex=0;d.proposals[d.selectedIndex]&&d.proposals[d.selectedIndex].unselectable;)d.selectedIndex++;
if(d.proposals[d.selectedIndex]){if(d.widget){var b=!0;if(a.autoApply){for(a=d.selectedIndex+1;d.proposals[a]&&d.proposals[a].unselectable;)a++;d.proposals[a]||(b=!1,d.contentAssist.apply(d.proposals[d.selectedIndex]))}b&&(d.widget.show(),d.widget.selectNode(d.selectedIndex))}}else d.selectedIndex=-1,d.cancel()}});c.setAction("contentAssistApply",function(){return this.enter()}.bind(this));c.setAction("contentAssistCancel",function(){return this.cancel()}.bind(this));c.setAction("contentAssistNextProposal",
function(){return this.lineDown()}.bind(this));c.setAction("contentAssistPreviousProposal",function(){return this.lineUp()}.bind(this));c.setAction("contentAssistNextPage",function(){return this.pageDown()}.bind(this));c.setAction("contentAssistPreviousPage",function(){return this.pageUp()}.bind(this));c.setAction("contentAssistHome",function(){this.widget&&this.widget.scrollIndex(0,!0);return this.lineDown(0)}.bind(this));c.setAction("contentAssistEnd",function(){return this.lineUp(this.proposals.length-
1)}.bind(this));c.setAction("contentAssistTab",function(){return this.tab()}.bind(this));this.widget&&(this.widget.setContentAssistMode(this),this.widget.createAccessible())}function r(a,b){this.contentAssist=a;this.textView=this.contentAssist.getTextView();this.isShowing=this.textViewListenerAdded=!1;var c=this.textView.getOptions("parent").ownerDocument;this.parentNode="string"===typeof b?c.getElementById(b):b;if(!this.parentNode){this.parentNode=l.createElement(c,"div");this.parentNode.className=
"contentassist";var d=c.getElementsByTagName("body")[0];if(d)d.appendChild(this.parentNode);else throw Error("parentNode is required");}g.addEventListener(this.parentNode,"scroll",this.onScroll.bind(this));var e=this;this.textViewListener={onMouseDown:function(a){(a.event.target||a.event.srcElement).parentElement!==e.parentNode&&e.contentAssist.deactivate()}};this.contentAssist.addEventListener("Deactivating",function(a){e.hide()});this.scrollListener=function(a){e.isShowing&&e.position()};g.addEventListener(c,
"scroll",this.scrollListener)}var n={INACTIVE:1,ACTIVE:2,FILTERING:3},u={selected:"selected",hr:"proposal-hr",emphasis:"proposal-emphasis",noemphasis:"proposal-noemphasis",noemphasis_keyword:"proposal-noemphasis-keyword",noemphasis_title:"proposal-noemphasis-title",noemphasis_title_keywords:"proposal-noemphasis-title-keywords",dfault:"proposal-default"};k.prototype={apply:function(b){if(!b)return!1;var c=this.textView,d=c.getSelection(),e=this._initialCaretOffset,f=e,k=d=Math.max(d.start,d.end),g=
c.getModel();g.getBaseModel&&(f=g.mapOffset(f),k=g.mapOffset(k),g=g.getBaseModel());b.overwrite&&(e="string"===typeof b.prefix?f-b.prefix.length:this.getPrefixStart(g,f));f={proposal:b,start:f,end:k};this.setState(n.INACTIVE);c.setText("string"===typeof b?b:b.proposal,e,d);if(b.additionalEdits)for(d=0;d<b.additionalEdits.length;d++)e=b.additionalEdits[d],c.setText(e.text,e.offset,e.offset+e.length);this.dispatchEvent({type:"ProposalApplied",data:f});a.logEvent("contentAssist","apply");return!0},activate:function(b,
c){this.state===n.INACTIVE&&(a.logEvent("contentAssist","activate",void 0,c?0:1),this._autoTriggered=c?!0:!1,this.setState(n.ACTIVE,b))},deactivate:function(){this.setState(n.INACTIVE)},getTextView:function(){return this.textView},isActive:function(){return this.state===n.ACTIVE||this.state===n.FILTERING},isDeactivatingChange:function(a,b){var c=!1;(Array.isArray(b.newValue)?b.newValue:[b.newValue])[0].start<this._initialCaretOffset||!a?c=!0:a&&(c=0<a.removedLineCount||0<a.addedLineCount);return c},
setState:function(a,b){var c;a===n.ACTIVE?(c="Activating",this._mode&&this._mode.setActive(!0)):a===n.INACTIVE&&(c="Deactivating",this._mode&&this._mode.setActive(!1));c&&this.dispatchEvent({type:c,providers:b});this.state=a;this.onStateChange(a)},setMode:function(a){this._mode=a},onStateChange:function(a){a===n.INACTIVE?(this._removeTextViewListeners(),this._filterText="",this._initialCaretOffset=-1,this._computedProposals=null):a===n.ACTIVE&&(this._filterText="",this._addTextViewListeners(),this.computeProposals())},
computeProposals:function(){var a=this.textView.getCaretOffset(),b=this.textView.getSelection(),b=Math.min(b.start,b.end);this._initialCaretOffset=Math.min(a,b);this._computedProposals=null;this._computeProposals(this._initialCaretOffset).then(function(a){if(this.isActive()){var b=this._flatten(a);b&&(Array.isArray(b)&&0<b.length)&&(this._computedProposals=a);this.dispatchEvent({type:"ProposalsComputed",data:{proposals:b},autoApply:!this._autoTriggered});this._computedProposals&&this._filterText&&
this.filterProposals(!0)}}.bind(this))},getPrefixStart:function(a,b){for(var c=b;0<c&&/[A-Za-z0-9_]/.test(a.getText(c-1,c));)c--;return c},handleError:function(a){"undefined"!==typeof console&&(console.log("Error retrieving content assist proposals"),console.log(a&&a.stack))},initialize:function(){this._providers.forEach(function(a){a=a.provider;"function"===typeof a.initialize&&a.initialize()})},_computeProposals:function(a){var b=this._providers,d=this.textView,e=d.getSelection(),k=d.getModel(),
g=a;k.getBaseModel&&(g=k.mapOffset(g),e.start=k.mapOffset(e.start),e.end=k.mapOffset(e.end),k=k.getBaseModel());a=k.getLine(k.getLineAtOffset(g));for(var l=0;l<a.length&&/\s/.test(a.charAt(l));)l++;var l=a.substring(0,l),d=d.getOptions("tabSize","expandTab"),d=d.expandTab?Array(d.tabSize+1).join(" "):"\t",n={line:a,offset:g,prefix:k.getText(this.getPrefixStart(k,g),g),selection:e,delimiter:k.getLineDelimiter(),tab:d,indentation:l},r=this,b=b.map(function(a){a=a.provider;var b;try{var d,e;if(d=a.computeContentAssist){var l=
r.editorContextProvider,q=l.getEditorContext();n=f.mixin(n,l.getOptions());e=d.apply(a,[q,n])}else if(d=a.getProposals||a.computeProposals)e=d.apply(a,[k.getText(),g,n]);b=r.progress?r.progress.progress(e,"Generating content assist proposal"):e}catch(h){return(new c).reject(h)}return c.when(b)});return c.all(b,this.handleError)},filterProposals:function(a){if(this._computedProposals&&(this._latestModelChangingEvent||a)){a=this.textView.getModel();a.getBaseModel&&(a=a.getBaseModel());a=this.getPrefixStart(a,
this._initialCaretOffset);var b=this.textView.getText(a,this._initialCaretOffset),c=b,d=[];this._computedProposals.forEach(function(a){a&&Array.isArray(a)&&(a=a.filter(function(a){if(!a)return!1;c="string"===typeof a.prefix?a.prefix:b;if(u[a.style]===u.hr||u[a.style]===u.noemphasis_title)return!0;var d="";if(a.overwrite){if(a.name)d=a.name;else if(a.proposal)d=a.proposal;else return!1;return 0===d.indexOf(c+this._filterText)}return a.name||a.proposal?(d=!1,a.name&&(d=0===a.name.indexOf(c+this._filterText)),
!d&&a.proposal&&(d=0===a.proposal.indexOf(this._filterText)),d):"string"===typeof a?0===a.indexOf(this._filterText):!1},this),0<a.length&&d.push(a))},this);a=[];d&&(d=this._removeExtraUnselectableElements(d),a=this._flatten(d));this.dispatchEvent({type:"ProposalsComputed",data:{proposals:a},autoApply:!1})}},_removeExtraUnselectableElements:function(a){return a.map(function(a){return a.filter(function(b,c){var d=!0;if(u[b.style]===u.hr)0===c||a.length-1===c?d=!1:u.hr===u[a[c-1].style]&&(d=!1);else if(u[b.style]===
u.noemphasis_title){var e=a[c+1];e?u[e.style]===u.noemphasis_title&&(d=!1):d=!1}return d})})},setEditorContextProvider:function(a){this.editorContextProvider=a},_generateProviderId:function(){this._idcount?this._idcount++:this._idcount=0;return"ContentAssistGeneratedID_"+this._idcount},setAutoTriggerEnabled:function(a){this._autoTriggerEnabled=a;this._updateAutoTriggerListenerState()},setProviders:function(a){var b=this;this.setProviderInfoArray(a.map(function(a){return a.id?a:{provider:a,id:b._generateProviderId()}}))},
setProviderInfoArray:function(a){this.clearProviders();this._providers=a;this._charTriggersInstalled=a.some(function(a){return a.charTriggers});this._updateAutoTriggerListenerState()},getProviders:function(){return this._providers.slice()},clearProviders:function(){this._providers=[];this._charTriggersInstalled=!1;this._updateAutoTriggerListenerState()},setProgress:function(a){this.progress=a},setStyleAccessor:function(a){this._styleAccessor=a},_flatten:function(a){return a.reduce(function(a,b){var c=
a,d=null;b&&Array.isArray(b)&&(d=b.filter(function(a){return a}));if(d&&Array.isArray(d)&&0<d.length){var c=d,e=a,f=d[0].style;f&&0===u[f].indexOf(u.noemphasis)&&(c=a,e=d);0<c.length&&(d=c[c.length-1].style)&&u.hr!==u[d]&&(c=c.concat({proposal:"",name:"",description:"---------------------------------",style:"hr",unselectable:!0}));c=c.concat(e)}return c},[])},_triggerListener:function(){var a=this.textView.getCaretOffset(),b=null,c=[];if(this._charTriggersInstalled){var d=this.textView.getText(a-
1,a);this._providers.forEach(function(e){var f=e.charTriggers;if(f&&f.test(d)){var f=!1,k=e.excludedStyles;this._styleAccessor&&k&&(b||(b=this._styleAccessor.getStyles(a-1)),f=b.some(function(a){return k.test(a.style)}));f||c.push(e)}},this);0<c.length&&this.activate(c,!0)}},_updateAutoTriggerListenerState:function(){this._boundTriggerListener||(this._boundTriggerListener=this._triggerListener.bind(this));if(this._triggerListenerInstalled){if(!this._autoTriggerEnabled||!this._charTriggersInstalled)this.textView.removeEventListener("Modify",
this._boundTriggerListener),this._triggerListenerInstalled=!1}else this._autoTriggerEnabled&&this._charTriggersInstalled&&(this.textView.addEventListener("Modify",this._boundTriggerListener),this._triggerListenerInstalled=!0)},_addTextViewListeners:function(){this._textViewListenersAdded||(this.textView.addEventListener("ModelChanging",this._textViewListeners.onModelChanging),this.textView.addEventListener("Scroll",this._textViewListeners.onScroll),this.textView.addEventListener("Selection",this._textViewListeners.onSelection),
this._textViewListenersAdded=!0)},_removeTextViewListeners:function(){this._textViewListenersAdded&&(this._latestModelChangingEvent=null,this.textView.removeEventListener("ModelChanging",this._textViewListeners.onModelChanging),this.textView.removeEventListener("Scroll",this._textViewListeners.onScroll),this.textView.removeEventListener("Selection",this._textViewListeners.onSelection),this._textViewListenersAdded=!1)},_updateFilterText:function(a){var b=a.removedCharCount;b&&(this._filterText=this._filterText.substring(0,
this._filterText.length-b));if(a=a.text)this._filterText=this._filterText.concat(a)}};h.EventTarget.addMixin(k.prototype);d.prototype=new p.KeyMode;f.mixin(d.prototype,{createKeyBindings:function(){var a=s.KeyBinding,c=[];c.push({actionID:"contentAssistApply",keyBinding:new a(13)});c.push({actionID:"contentAssistCancel",keyBinding:new a(27)});c.push({actionID:"contentAssistNextProposal",keyBinding:new a(40)});c.push({actionID:"contentAssistPreviousProposal",keyBinding:new a(38)});c.push({actionID:"contentAssistNextPage",
keyBinding:new a(34)});c.push({actionID:"contentAssistPreviousPage",keyBinding:new a(33)});c.push({actionID:"contentAssistHome",keyBinding:new a(b.KEY.HOME)});c.push({actionID:"contentAssistEnd",keyBinding:new a(b.KEY.END)});c.push({actionID:"contentAssistTab",keyBinding:new a(9)});return c},cancel:function(){this.getContentAssist().deactivate()},getContentAssist:function(){return this.contentAssist},getProposals:function(){return this.proposals},isActive:function(){return this.getContentAssist().isActive()},
setActive:function(a){a?this.contentAssist.textView.addKeyMode(this):this.contentAssist.textView.removeKeyMode(this)},lineUp:function(a,b){return this.selectNew(a,b,!1)},lineDown:function(a,b){return this.selectNew(a,b,!0)},selectNew:function(a,b,c){if(c){if(void 0===a&&(a=this.selectedIndex+1),a>=this.proposals.length){if(b)return!0;a=0}}else if(void 0===a&&(a=this.selectedIndex-1),0>a){if(b)return!0;a=this.proposals.length-1}for(var d=a;this.proposals[a]&&this.proposals[a].unselectable;){if(c){if(a++,
a>=this.proposals.length){if(b)return!0;a=0}}else if(a--,0>a){if(b)return!0;a=this.proposals.length-1}if(a===d){a=-1;break}}this.selectedIndex=a;this.widget&&this.widget.selectNode(a);this._showTooltip();return!0},_showTooltip:function(){var a=e.Tooltip.getTooltip(this.contentAssist.textView),c=this;a.hide(0);a.show({getTooltipInfo:function(){var a=b.bounds(c.widget.parentNode),d="right";a.left+a.width>=document.documentElement.clientWidth&&(d="left");return{context:{proposal:c.proposals[c.selectedIndex]},
offset:0,hoverArea:a,position:d,offsetX:10,width:350,height:a.height-10,preventTooltipClose:function(){return c.widget&&c.widget.isShowing?!0:!1}}}},!1)},_hideTooltip:function(){e.Tooltip.getTooltip(this.contentAssist.textView).hide(0)},pageUp:function(){if(this.widget){var a=this.widget.getTopIndex();a===this.selectedIndex&&(this.widget.scrollIndex(a,!1),a=this.widget.getTopIndex());return 0===a?this.lineDown(a,!0):this.lineUp(a,!0)}return this.lineUp()},pageDown:function(){if(this.widget){var a=
this.widget.getBottomIndex();a===this.selectedIndex&&(this.widget.scrollIndex(a,!0),a=this.widget.getBottomIndex());return this.lineDown(a,!0)}return this.lineDown()},enter:function(){return this.contentAssist.apply(this.proposals[this.selectedIndex]||null)},tab:function(){return this.widget?(this.widget.parentNode.focus(),!0):!1}});r.prototype={onClick:function(a){a||(a=window.event);this.contentAssist.apply(this.getProposal(a.target||a.srcElement));this.textView.focus()},onScroll:function(a){this.previousCloneNode&&
!this.preserveCloneThroughScroll&&(this._removeCloneNode(),this.previousSelectedNode.classList.add(u.selected));this.preserveCloneThroughScroll=!1},createDiv:function(a,b,c){var d=b.ownerDocument,e=l.createElement(d,"div");e.id="contentoption"+c;e.setAttribute("role","option");e.className=u[a.style]?u[a.style]:u.dfault;"hr"===a.style?a=l.createElement(d,"hr"):(a=this._createDisplayNode(e,a,c),e.contentAssistProposalIndex=c);e.appendChild(a);b.appendChild(e)},createAccessible:function(){var a=this._contentAssistMode,
c=this;g.addEventListener(this.parentNode,"keydown",function(d){d||(d=window.event);d.preventDefault&&d.preventDefault();return d.keyCode===b.KEY.ESCAPE?a.cancel():d.keyCode===b.KEY.UP?a.lineUp():d.keyCode===b.KEY.DOWN?a.lineDown():d.keyCode===b.KEY.ENTER?a.enter():d.keyCode===b.KEY.PAGEDOWN?a.pageDown():d.keyCode===b.KEY.PAGEUP?a.pageUp():d.keyCode===b.KEY.HOME?(c.scrollIndex(0,!0),a.lineDown(0)):d.keyCode===b.KEY.END?a.lineUp(a.getProposals().length-1):!1})},_createDisplayNode:function(a,b,c){var d=
a=null;if("string"===typeof b)d=b;else if(b.description&&"string"===typeof b.description)if(b.name&&"string"===typeof b.name){var e=this._createNameNode(b.name);e.contentAssistProposalIndex=c;a=document.createElement("span");a.appendChild(e);b=document.createTextNode(b.description);a.appendChild(b)}else d=b.description;else d=b.proposal;d&&(a=this._createNameNode(d));a.contentAssistProposalIndex=c;return a},_createNameNode:function(a){var b=document.createElement("span");b.classList.add("proposal-name");
b.appendChild(document.createTextNode(a));return b},getProposal:function(a){var b=null;a=a.contentAssistProposalIndex;void 0!==a&&(b=this._contentAssistMode.getProposals()[a]||null);return b},getTopIndex:function(){for(var a=this.parentNode.childNodes,b=0;b<a.length;b++)if(a[b].offsetTop>=this.parentNode.scrollTop)return b;return 0},getBottomIndex:function(){for(var a=this.parentNode.childNodes,b=0;b<a.length;b++){var c=a[b];if(c.offsetTop+c.offsetHeight>this.parentNode.scrollTop+this.parentNode.clientHeight)return Math.max(0,
b-1)}return a.length-1},scrollIndex:function(a,b){this.parentNode.childNodes[a].scrollIntoView(b);this.preserveCloneThroughScroll=!0},selectNode:function(a){var c=null;this._hideTimeout&&(window.clearTimeout(this._hideTimeout),this._hideTimeout=null);this._fadeTimer&&(window.clearTimeout(this._fadeTimer),this._fadeTimer=null);this.previousSelectedNode&&(this.previousSelectedNode.classList.remove(u.selected),this.previousSelectedNode=null,this.previousCloneNode&&this._removeCloneNode());if(-1!==a){c=
this.parentNode.childNodes[a];c.classList.add(u.selected);this.parentNode.setAttribute("aria-activedescendant",c.id);c.focus();c.offsetTop<this.parentNode.scrollTop?(c.scrollIntoView(!0),this.preserveCloneThroughScroll=!0):c.offsetTop+c.offsetHeight>this.parentNode.scrollTop+this.parentNode.clientHeight&&(c.scrollIntoView(!1),this.preserveCloneThroughScroll=!0);var d=b.bounds(c.firstChild||c),e=this.parentNode.clientWidth?this.parentNode.clientWidth:b.bounds(this.parentNode);a=window.getComputedStyle(this.parentNode);
var f=window.getComputedStyle(c),f=parseInt(a.paddingLeft)+parseInt(a.paddingRight)+parseInt(f.paddingLeft)+parseInt(f.paddingRight);if(d.width>=e-f){f=parseInt(a.top);e=c.cloneNode(!0);e.classList.add("cloneProposal");e.style.top=f+c.offsetTop-this.parentNode.scrollTop+"px";e.style.left=a.left;e.setAttribute("id",e.id+"_clone");d=d.left+d.width-parseInt(document.documentElement.clientWidth);0<d&&(a=parseInt(a.left)-d,0>a&&(a=0),e.style.left=a+"px");var k=document.createElement("div");k.id="clone_contentassist";
k.classList.add("contentassist");k.classList.add("cloneWrapper");k.appendChild(e);k.onclick=this.parentNode.onclick;this.parentNode.parentNode.insertBefore(k,this.parentNode);var g=function(a){a.contentAssistProposalIndex=c.contentAssistProposalIndex;if(a.hasChildNodes())for(var b=0;b<a.childNodes.length;b++)g(a.childNodes[b])};g(k);var l=this;this._hideTimeout=window.setTimeout(function(){l._hideTimeout=null;c.classList.add(u.selected);var a=1;l._fadeTimer=window.setInterval(function(){!l.previousCloneNode||
0.01>=a?(l._removeCloneNode(),window.clearInterval(l._fadeTimer),l._fadeTimer=null):(k.style.opacity=a,k.style.filter="alpha(opacity\x3d"+100*a+")",a-=0.1*a)},50)},1500);c.classList.remove(u.selected);this.previousCloneNode=k}}this.previousSelectedNode=c},setContentAssistMode:function(a){this._contentAssistMode=a},show:function(){var a=this._contentAssistMode.getProposals();if(0===a.length)this.hide();else{this.parentNode.innerHTML="";for(var b=0;b<a.length;b++)this.createDiv(a[b],this.parentNode,
b);this.position();this.parentNode.onclick=this.onClick.bind(this);this.isShowing=!0;this._contentAssistMode._showTooltip();this.textViewListenerAdded||(this.textView.addEventListener("MouseDown",this.textViewListener.onMouseDown),this.textViewListenerAdded=!0)}},hide:function(){this.parentNode.ownerDocument.activeElement===this.parentNode&&this.textView.focus();this.parentNode.style.display="none";this.parentNode.onclick=null;this.isShowing=!1;this._contentAssistMode._hideTooltip();this.textViewListenerAdded&&
(this.textView.removeEventListener("MouseDown",this.textViewListener.onMouseDown),this.textViewListenerAdded=!1);this.previousSelectedNode&&(this.previousSelectedNode=null,this.previousCloneNode&&this._removeCloneNode())},position:function(){var a=this.contentAssist,b=this.textView;if(void 0!==a.offset){var a=a.offset,c=b.getModel();c.getBaseModel&&(a=c.mapOffset(a,!0))}else a=this.textView.getCaretOffset();a=b.getLocationAtOffset(a);a.y+=b.getLineHeight();this.textView.convert(a,"document","page");
this.parentNode.style.position="fixed";this.parentNode.style.left=a.x+"px";this.parentNode.style.top=a.y+"px";this.parentNode.style.display="block";this.parentNode.scrollTop=0;c=this.parentNode.ownerDocument;b=c.documentElement.clientWidth;c=c.documentElement.clientHeight-a.y;if(this.parentNode.offsetHeight>c){var d=a.y-this.textView.getLineHeight();this.parentNode.offsetHeight>d?c>d?this.parentNode.style.maxHeight=c+"px":(this.parentNode.style.maxHeight=d+"px",this.parentNode.style.top="0"):(this.parentNode.style.top=
a.y-this.parentNode.offsetHeight-this.textView.getLineHeight()+"px",this.parentNode.style.maxHeight=d+"px")}else this.parentNode.style.maxHeight=c+"px";a.x+this.parentNode.offsetWidth>b?(a=b-this.parentNode.offsetWidth,0>a&&(a=0),this.parentNode.style.left=a+"px",this.parentNode.style.maxWidth=b-a):this.parentNode.style.maxWidth=b+a.x+"px"},_removeCloneNode:function(){this.parentNode.parentNode.contains(this.previousCloneNode)&&this.parentNode.parentNode.removeChild(this.previousCloneNode);this.previousCloneNode=
null}};return{ContentAssist:k,ContentAssistMode:d,ContentAssistWidget:r}});
define("orion/editor/stylers/lib/syntax",[],function(){return{id:"orion.lib",grammars:[{id:"orion.lib",repository:{brace_open:{match:"{",name:"punctuation.section.block.begin"},brace_close:{match:"}",name:"punctuation.section.block.end"},bracket_open:{match:"\\[",name:"punctuation.section.bracket.begin"},bracket_close:{match:"\\]",name:"punctuation.section.bracket.end"},parenthesis_open:{match:"\\(",name:"punctuation.section.parens.begin"},parenthesis_close:{match:"\\)",name:"punctuation.section.parens.end"},
doc_block:{begin:{match:"/\\*\\*",literal:"/**"},end:{match:"\\*/",literal:"*/"},name:"comment.block.documentation",patterns:[{match:"@(?:(?!\\*/)\\S)*",name:"meta.documentation.annotation"},{match:"\x3c[^\\s\x3e]*\x3e",name:"meta.documentation.tag"},{match:"(\\b)(TODO)(\\b)(((?!\\*/).)*)",name:"meta.annotation.task.todo",captures:{2:{name:"keyword.other.documentation.task"},4:{name:"comment.block"}}}]},number_decimal:{match:"\\b-?(?:\\.\\d+|\\d+\\.?\\d*)(?:[eE][+-]?\\d+)?\\b",name:"constant.numeric.number"},
number_hex:{match:"\\b0[xX][0-9A-Fa-f]+\\b",name:"constant.numeric.hex"},string_doubleQuote:{match:'"(?:\\\\.|[^"])*"?',name:"string.quoted.double"},string_singleQuote:{match:"'(?:\\\\.|[^'])*'?",name:"string.quoted.single"},todo_comment_singleLine:{match:"(\\b)(TODO)(\\b)(.*)",name:"meta.annotation.task.todo",captures:{2:{name:"keyword.other.documentation.task"},4:{name:"comment.line"}}}}},{id:"orion.c-like",repository:{comment_singleLine:{match:{match:"//.*",literal:"//"},name:"comment.line.double-slash",
patterns:[{include:"orion.lib#todo_comment_singleLine"}]},comment_block:{begin:{match:"/\\*",literal:"/*"},end:{match:"\\*/",literal:"*/"},name:"comment.block",patterns:[{match:"(\\b)(TODO)(\\b)(((?!\\*/).)*)",name:"meta.annotation.task.todo",captures:{2:{name:"keyword.other.documentation.task"},4:{name:"comment.block"}}}]}}}],keywords:[]}});
define("orion/editor/stylers/text_css/syntax",["orion/editor/stylers/lib/syntax"],function(m){var s="alignment-adjust alignment-baseline animation-delay animation-direction animation-duration animation-iteration-count animation-name animation-play-state animation-timing-function animation appearance azimuth backface-visibility background-attachment background-clip background-color background-image background-origin background-position background-repeat background-size background baseline-shift binding bleed bookmark-label bookmark-level bookmark-state bookmark-target border-bottom-color border-bottom-left-radius border-bottom-right-radius border-bottom-style border-bottom-width border-bottom border-collapse border-color border-image-outset border-image-repeat border-image-slice border-image-source border-image-width border-image border-left-color border-left-style border-left-width border-left border-radius border-right-color border-right-style border-right-width border-right border-spacing border-style border-top-color border-top-left-radius border-top-right-radius border-top-style border-top-width border-top border-width border bottom box-align box-decoration-break box-direction box-flex-group box-flex box-lines box-ordinal-group box-orient box-pack box-shadow box-sizing break-after break-before break-inside caption-side clear clip color-profile color column-count column-fill column-gap column-rule-color column-rule-style column-rule-width column-rule column-span column-width columns content counter-increment counter-reset crop cue-after cue-before cue cursor direction display dominant-baseline drop-initial-after-adjust drop-initial-after-align drop-initial-before-adjust drop-initial-before-align drop-initial-size drop-initial-value elevation empty-cells fit-position fit flex-align flex-flow flex-inline-pack flex-order flex-pack float-offset float font-family font-size font-size-adjust font-stretch font-style font-variant font-weight font grid-columns grid-rows hanging-punctuation height hyphenate-after hyphenate-before hyphenate-character hyphenate-lines hyphenate-resource hyphens icon image-orientation image-rendering image-resolution inline-box-align left letter-spacing line-height line-stacking-ruby line-stacking-shift line-stacking-strategy line-stacking list-style-image list-style-position list-style-type list-style margin-bottom margin-left margin-right margin-top margin mark-after mark-before mark marker-offset marks marquee-direction marquee-loop marquee-play-count marquee-speed marquee-style max-height max-width min-height min-width move-to nav-down nav-index nav-left nav-right nav-up opacity orphans outline-color outline-offset outline-style outline-width outline overflow-style overflow-x overflow-y overflow padding-bottom padding-left padding-right padding-top padding page-break-after page-break-before page-break-inside page-policy page pause-after pause-before pause perspective-origin perspective phonemes pitch-range pitch play-during position presentation-level punctuation-trim quotes rendering-intent resize rest-after rest-before rest richness right rotation-point rotation ruby-align ruby-overhang ruby-position ruby-span size speak-header speak-numeral speak-punctuation speak speech-rate stress string-set table-layout target-name target-new target-position target text-align-last text-align text-decoration text-emphasis text-height text-indent text-justify text-outline text-shadow text-transform text-wrap top transform-origin transform-style transform transition-delay transition-duration transition-property transition-timing-function transition unicode-bidi vertical-align visibility voice-balance voice-duration voice-family voice-pitch-range voice-pitch voice-rate voice-stress voice-volume volume white-space-collapse white-space widows width word-break word-spacing word-wrap z-index".split(" "),p=
[];p.push.apply(p,m.grammars);p.push({id:"orion.css",contentTypes:["text/css"],patterns:[{begin:"'(?:\\\\.|[^\\\\'])*\\\\$",end:"^(?:$|(?:\\\\.|[^\\\\'])*('|[^\\\\]$))",name:"string.quoted.single.css"},{begin:'"(?:\\\\.|[^\\\\"])*\\\\$',end:'^(?:$|(?:\\\\.|[^\\\\"])*("|[^\\\\]$))',name:"string.quoted.double.css"},{include:"orion.lib#string_doubleQuote"},{include:"orion.lib#string_singleQuote"},{include:"orion.c-like#comment_block"},{include:"orion.lib#brace_open"},{include:"orion.lib#brace_close"},
{include:"orion.lib#bracket_open"},{include:"orion.lib#bracket_close"},{include:"orion.lib#parenthesis_open"},{include:"orion.lib#parenthesis_close"},{include:"orion.lib#number_decimal"},{include:"#number_hex"},{match:"(?i)\\b-?(?:\\.\\d+|\\d+\\.?\\d*)(?:%|em|ex|ch|rem|vw|vh|vmin|vmax|in|cm|mm|pt|pc|px|deg|grad|rad|turn|s|ms|Hz|kHz|dpi|dpcm|dppx)?\\b",name:"constant.numeric.value.css"},{match:"(?:-webkit-|-moz-|-ms-|-o-|\\b)(?:"+s.join("|")+")\\b",name:"support.type.propertyName.css"}],repository:{number_hex:{match:"#[0-9A-Fa-f]+\\b",
name:"constant.numeric.hex.css"}}});return{id:p[p.length-1].id,grammars:p,keywords:s}});
define("webtools/util",[],function(){return{punc:"\n\t\r (){}[]:;,.+\x3d-*^\x26@!%~`'\"/\\",findWord:function(m,s){if(m&&s){for(var p=-1<this.punc.indexOf(m.charAt(s)),h=p?s-1:s;0<=h&&!(-1<this.punc.indexOf(m.charAt(h)));)h--;for(var c=h,h=s;h<=m.length&&!(-1<this.punc.indexOf(m.charAt(h)));)h++;if(!((c===s||p&&c===s-1)&&h===s))return c===s?m.substring(c,h):m.substring(c+1,h)}return null},findToken:function(m,s){if(null!=m&&-1<m&&s&&0<s.length){var p=0,h=s.length-1,c,f=0;c=s[0];if(m>=c.range[0]&&
m<c.range[1])return c.index=0,c;c=s[h];if(m>=c.range[0])return c.index=h,c;for(;p<=h;){f=Math.floor((p+h)/2);c=s[f];if(m<c.range[0])h=f-1;else if(m>c.range[1])p=f+1;else if(m===c.range[1])if(s[f+1].range[0]===c.range[1])p=f+1;else return c.index=f,c;else if(m>=c.range[0]&&m<c.range[1])return c.index=f,c;if(p===h){c=s[p];if(m>=c.range[0]&&m<=c.range[1])return c.index=p,c;break}}}return null},findStyleBlocks:function(m,s){var p=[],h=null,c=/<\s*style(?:type\s*=\s*"([^"]*)"|[^>]|\n)*>((?:.|\r?\n)*?)<\s*\/style(?:[^>]|\n)*>/ig,
f=this.findHtmlCommentBlocks(m,s);a:for(;null!=(h=c.exec(m));){var e=h[2];if(!(1>e.length)&&(h=h.index+h[0].indexOf("\x3e")+1,null==s||h<=s&&h+e.length>=s)){for(var g=0;g<f.length;g++)if(f[g].start<=h&&f[g].end>=h)continue a;p.push({text:e,offset:h})}}return p},findHtmlCommentBlocks:function(m,s){for(var p=[],h=null,c=/\x3c!--((?:.|\r?\n)*?)--\x3e/ig;null!=(h=c.exec(m));){var f=h[1];1>f.length||(null==s||h.index<=s&&h.index+f.length>=h.index)&&p.push({text:f,start:h.index,end:h.index+f.length})}return p}}});
define("javascript/compilationUnit",["orion/objects","orion/Deferred"],function(m,s){function p(h,c,f){this._blocks=h;this._metadata=c;this._ec=f}m.mixin(p.prototype,{_init:function(){var h=0;this._source="";for(var c=0;c<this._blocks.length;c++){for(var f=this._blocks[c],h=f.offset-h;0<h;)this._source+=" ",h--;this._source+=f.text;h=this._source.length}},getSource:function(){return this._source},validOffset:function(h){if(!this._blocks||1>this._blocks.length||0>h)return!1;for(var c=0;c<this._blocks.length;c++){var f=
this._blocks[c],e=f.offset;if(h>=e&&h<=e+f.text.length)return!0}return!1},getEditorContext:function(){var h=Object.create(null),c=this;h.getText=function(){c._source||c._init();return(new s).resolve(c._source)};h.getFileMetadata=function(){return(new s).resolve(c._metadata)};h.setText=function(f,e,g){return c._ec?c._ec.setText(f,e,g):(new s).resolve(null)};return h}});return p});
define("csslint",[],function(){var m=m||{};return function(){function s(c,f){this.messages=[];this.stats=[];this.lines=c;this.ruleset=f}var p={};(function(){function c(){this._listeners={}}function f(b){this._input=b;this._col=this._line=1;this._cursor=0}function e(b,a,c){this.col=c;this.line=a;this.message=b}function g(b,a,c,d){this.col=c;this.line=a;this.text=b;this.type=d}function l(b,a){this._reader=b?new f(b.toString()):null;this._token=null;this._tokenData=a;this._lt=[];this._ltIndex=0;this._ltIndexCache=
[]}c.prototype={constructor:c,addListener:function(b,a){this._listeners[b]||(this._listeners[b]=[]);this._listeners[b].push(a)},fire:function(b){"string"==typeof b&&(b={type:b});"undefined"!=typeof b.target&&(b.target=this);if("undefined"==typeof b.type)throw Error("Event object missing 'type' property.");if(this._listeners[b.type])for(var a=this._listeners[b.type].concat(),c=0,d=a.length;c<d;c++)a[c].call(this,b)},removeListener:function(b,a){if(this._listeners[b])for(var c=this._listeners[b],d=
0,e=c.length;d<e;d++)if(c[d]===a){c.splice(d,1);break}}};f.prototype={constructor:f,getCol:function(){return this._col},getLine:function(){return this._line},getCursor:function(){return this._cursor},eof:function(){return this._cursor==this._input.length},peek:function(b){var a=null;this._cursor<this._input.length&&(a=this._input.charAt(this._cursor+("undefined"==typeof b?1:b)-1));return a},read:function(){var b=null;if(this._cursor<this._input.length){"\n"==this._input.charAt(this._cursor)?(this._line++,
this._col=1):this._col++;var a=this._cursor++,b=this._input.charAt(a);this._input.charCodeAt(a)}return b},mark:function(){this._bookmark={cursor:this._cursor,line:this._line,col:this._col}},reset:function(){this._bookmark&&(this._cursor=this._bookmark.cursor,this._line=this._bookmark.line,this._col=this._bookmark.col,delete this._bookmark)},readTo:function(b){for(var a="",c;a.length<b.length||a.lastIndexOf(b)!=a.length-b.length;)if(c=this.read())a+=c;else throw Error('Expected "'+b+'" at line '+this._line+
", col "+this._col+".");return a},readWhile:function(b){for(var a="",c=this.read();null!==c&&b(c);)a+=c,c=this.read();return a},readMatch:function(b){var a=this._input.substring(this._cursor),c=null;"string"==typeof b?0===a.indexOf(b)&&(c=this.readCount(b.length)):b instanceof RegExp&&b.test(a)&&(c=this.readCount(RegExp.lastMatch.length));return c},readCount:function(b){for(var a="";b--;)a+=this.read();return a}};e.prototype=Error();g.fromToken=function(b){return new g(b.value,b.startLine,b.startCol)};
g.prototype={constructor:g,valueOf:function(){return this.toString()},toString:function(){return this.text}};l.createTokenData=function(b){var a=[],c={};b=b.concat([]);var d=0,e=b.length+1;b.UNKNOWN=-1;for(b.unshift({name:"EOF"});d<e;d++)a.push(b[d].name),b[b[d].name]=d,b[d].text&&(c[b[d].text]=d);b.name=function(b){return a[b]};b.type=function(a){return c[a]};return b};l.prototype={constructor:l,tokens:[],match:function(b,a){b instanceof Array||(b=[b]);for(var c=this.get(a),d=0,e=b.length;d<e;)if(c==
b[d++])return!0;this.unget();return!1},mustMatch:function(b,a){var c;b instanceof Array||(b=[b]);if(!this.match.apply(this,arguments))throw c=this.LT(1),new e("Expected "+this._tokenData[b[0]].name+" at line "+c.startLine+", col "+c.startCol+".",c.startLine,c.startCol);},advance:function(b,a){for(;0!==this.LA(0)&&!this.match(b,a);)this.get();return this.LA(0)},get:function(b){var a=this._tokenData,c=0,d,e;if(this._lt.length&&0<=this._ltIndex&&this._ltIndex<this._lt.length){c++;this._token=this._lt[this._ltIndex++];
for(e=a[this._token.type];void 0!==e.channel&&b!==e.channel&&this._ltIndex<this._lt.length;)this._token=this._lt[this._ltIndex++],e=a[this._token.type],c++;if((void 0===e.channel||b===e.channel)&&this._ltIndex<=this._lt.length)return this._ltIndexCache.push(c),this._token.type}d=this._getToken();-1<d.type&&!a[d.type].hide&&(d.channel=a[d.type].channel,this._token=d,this._lt.push(d),this._ltIndexCache.push(this._lt.length-this._ltIndex+c),5<this._lt.length&&this._lt.shift(),5<this._ltIndexCache.length&&
this._ltIndexCache.shift(),this._ltIndex=this._lt.length);return(e=a[d.type])&&(e.hide||void 0!==e.channel&&b!==e.channel)?this.get(b):d.type},LA:function(b){var a=b,c;if(0<b){if(5<b)throw Error("Too much lookahead.");for(;a;)c=this.get(),a--;for(;a<b;)this.unget(),a++}else if(0>b)if(this._lt[this._ltIndex+b])c=this._lt[this._ltIndex+b].type;else throw Error("Too much lookbehind.");else c=this._token.type;return c},LT:function(b){this.LA(b);return this._lt[this._ltIndex+b-1]},peek:function(){return this.LA(1)},
token:function(){return this._token},tokenName:function(b){return 0>b||b>this._tokenData.length?"UNKNOWN_TOKEN":this._tokenData[b].name},tokenType:function(b){return this._tokenData[b]||-1},unget:function(){if(this._ltIndexCache.length)this._ltIndex-=this._ltIndexCache.pop(),this._token=this._lt[this._ltIndex-1];else throw Error("Too much lookahead.");}};p.util={StringReader:f,SyntaxError:e,SyntaxUnit:g,EventTarget:c,TokenStreamBase:l}})();(function(){function c(a,b,c){y.call(this,a,b,c,g.COMBINATOR_TYPE);
this.type="unknown";/^\s+$/.test(a)?this.type="descendant":"\x3e"==a?this.type="child":"+"==a?this.type="adjacent-sibling":"~"==a&&(this.type="sibling")}function f(a,b){y.call(this,"("+a+(null!==b?":"+b:"")+")",a.startLine,a.startCol,g.MEDIA_FEATURE_TYPE);this.name=a;this.value=b}function e(a,b,c,d,e){y.call(this,(a?a+" ":"")+(b?b:"")+(b&&0<c.length?" and ":"")+c.join(" and "),d,e,g.MEDIA_QUERY_TYPE);this.modifier=a;this.mediaType=b;this.features=c}function g(a){E.call(this);this.options=a||{};this._tokenStream=
null}function l(a,b,c,d){y.call(this,a,c,d,g.PROPERTY_NAME_TYPE);this.hack=b}function b(a,b,c){y.call(this,a.join(" "),b,c,g.PROPERTY_VALUE_TYPE);this.parts=a}function a(a){this._i=0;this._parts=a.parts;this._marks=[];this.value=a}function k(a,b,c){y.call(this,a,b,c,g.PROPERTY_VALUE_PART_TYPE);this.type="unknown";if(/^([+\-]?[\d\.]+)([a-z]+)$/i.test(a))switch(this.type="dimension",this.value=+RegExp.$1,this.units=RegExp.$2,this.units.toLowerCase()){case "em":case "rem":case "ex":case "px":case "cm":case "mm":case "in":case "pt":case "pc":case "ch":case "vh":case "vw":case "vm":this.type=
"length";break;case "deg":case "rad":case "grad":this.type="angle";break;case "ms":case "s":this.type="time";break;case "hz":case "khz":this.type="frequency";break;case "dpi":case "dpcm":this.type="resolution"}else/^([+\-]?[\d\.]+)%$/i.test(a)?(this.type="percentage",this.value=+RegExp.$1):/^([+\-]?[\d\.]+)%$/i.test(a)?(this.type="percentage",this.value=+RegExp.$1):/^([+\-]?\d+)$/i.test(a)?(this.type="integer",this.value=+RegExp.$1):/^([+\-]?[\d\.]+)$/i.test(a)?(this.type="number",this.value=+RegExp.$1):
/^#([a-f0-9]{3,6})/i.test(a)?(this.type="color",a=RegExp.$1,3==a.length?(this.red=parseInt(a.charAt(0)+a.charAt(0),16),this.green=parseInt(a.charAt(1)+a.charAt(1),16),this.blue=parseInt(a.charAt(2)+a.charAt(2),16)):(this.red=parseInt(a.substring(0,2),16),this.green=parseInt(a.substring(2,4),16),this.blue=parseInt(a.substring(4,6),16))):/^rgb\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/i.test(a)?(this.type="color",this.red=+RegExp.$1,this.green=+RegExp.$2,this.blue=+RegExp.$3):/^rgb\(\s*(\d+)%\s*,\s*(\d+)%\s*,\s*(\d+)%\s*\)/i.test(a)?
(this.type="color",this.red=255*+RegExp.$1/100,this.green=255*+RegExp.$2/100,this.blue=255*+RegExp.$3/100):/^rgba\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*([\d\.]+)\s*\)/i.test(a)?(this.type="color",this.red=+RegExp.$1,this.green=+RegExp.$2,this.blue=+RegExp.$3,this.alpha=+RegExp.$4):/^rgba\(\s*(\d+)%\s*,\s*(\d+)%\s*,\s*(\d+)%\s*,\s*([\d\.]+)\s*\)/i.test(a)?(this.type="color",this.red=255*+RegExp.$1/100,this.green=255*+RegExp.$2/100,this.blue=255*+RegExp.$3/100,this.alpha=+RegExp.$4):/^hsl\(\s*(\d+)\s*,\s*(\d+)%\s*,\s*(\d+)%\s*\)/i.test(a)?
(this.type="color",this.hue=+RegExp.$1,this.saturation=+RegExp.$2/100,this.lightness=+RegExp.$3/100):/^hsla\(\s*(\d+)\s*,\s*(\d+)%\s*,\s*(\d+)%\s*,\s*([\d\.]+)\s*\)/i.test(a)?(this.type="color",this.hue=+RegExp.$1,this.saturation=+RegExp.$2/100,this.lightness=+RegExp.$3/100,this.alpha=+RegExp.$4):/^url\(["']?([^\)"']+)["']?\)/i.test(a)?(this.type="uri",this.uri=RegExp.$1):/^([^\(]+)\(/i.test(a)?(this.type="function",this.name=RegExp.$1,this.value=a):/^["'][^"']*["']/.test(a)?(this.type="string",this.value=
eval(a)):H[a.toLowerCase()]?(this.type="color",a=H[a.toLowerCase()].substring(1),this.red=parseInt(a.substring(0,2),16),this.green=parseInt(a.substring(2,4),16),this.blue=parseInt(a.substring(4,6),16)):/^[\,\/]$/.test(a)?(this.type="operator",this.value=a):/^[a-z\-\u0080-\uFFFF][a-z0-9\-\u0080-\uFFFF]*$/i.test(a)&&(this.type="identifier",this.value=a)}function d(a,b,c){y.call(this,a.join(" "),b,c,g.SELECTOR_TYPE);this.parts=a;this.specificity=m.calculate(this)}function h(a,b,c,d,e){y.call(this,c,
d,e,g.SELECTOR_PART_TYPE);this.elementName=a;this.modifiers=b}function n(a,b,c,d){y.call(this,a,c,d,g.SELECTOR_SUB_PART_TYPE);this.type=b;this.args=[]}function m(a,b,c,d){this.a=a;this.b=b;this.c=c;this.d=d}function q(a){return null!==a&&/\d/.test(a)}function v(a){return null!==a&&/\s/.test(a)}function s(a){return null!==a&&J.test(a)}function B(a){return null!==a&&/[a-z_\u0080-\uFFFF\\]/i.test(a)}function x(a){return null!==a&&(B(a)||/[0-9\-\\]/.test(a))}function C(a){A.call(this,a,t);this.tokens=
[]}function z(a,b,c){this.col=c;this.line=b;this.message=a}var E=p.util.EventTarget,A=p.util.TokenStreamBase,D=p.util.SyntaxError,y=p.util.SyntaxUnit,H={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",
crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",
forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightpink:"#ffb6c1",
lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370d8",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",
moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#d87093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",
seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32",activeBorder:"Active window border.",activecaption:"Active window caption.",appworkspace:"Background color of multiple document interface.",
background:"Desktop background.",buttonface:"The face background color for 3-D elements that appear 3-D due to one layer of surrounding border.",buttonhighlight:"The color of the border facing the light source for 3-D elements that appear 3-D due to one layer of surrounding border.",buttonshadow:"The color of the border away from the light source for 3-D elements that appear 3-D due to one layer of surrounding border.",buttontext:"Text on push buttons.",captiontext:"Text in caption, size box, and scrollbar arrow box.",
graytext:"Grayed (disabled) text. This color is set to #000 if the current display driver does not support a solid gray color.",highlight:"Item(s) selected in a control.",highlighttext:"Text of item(s) selected in a control.",inactiveborder:"Inactive window border.",inactivecaption:"Inactive window caption.",inactivecaptiontext:"Color of text in an inactive caption.",infobackground:"Background color for tooltip controls.",infotext:"Text color for tooltip controls.",menu:"Menu background.",menutext:"Text in menus.",
scrollbar:"Scroll bar gray area.",threeddarkshadow:"The color of the darker (generally outer) of the two borders away from the light source for 3-D elements that appear 3-D due to two concentric layers of surrounding border.",threedface:"The face background color for 3-D elements that appear 3-D due to two concentric layers of surrounding border.",threedhighlight:"The color of the lighter (generally outer) of the two borders facing the light source for 3-D elements that appear 3-D due to two concentric layers of surrounding border.",
threedlightshadow:"The color of the darker (generally inner) of the two borders facing the light source for 3-D elements that appear 3-D due to two concentric layers of surrounding border.",threedshadow:"The color of the lighter (generally inner) of the two borders away from the light source for 3-D elements that appear 3-D due to two concentric layers of surrounding border.",window:"Window background.",windowframe:"Window frame.",windowtext:"Text in windows."};p.util.Colors=H;c.prototype=new y;c.prototype.constructor=
c;f.prototype=new y;f.prototype.constructor=f;e.prototype=new y;e.prototype.constructor=e;g.DEFAULT_TYPE=0;g.COMBINATOR_TYPE=1;g.MEDIA_FEATURE_TYPE=2;g.MEDIA_QUERY_TYPE=3;g.PROPERTY_NAME_TYPE=4;g.PROPERTY_VALUE_TYPE=5;g.PROPERTY_VALUE_PART_TYPE=6;g.SELECTOR_TYPE=7;g.SELECTOR_PART_TYPE=8;g.SELECTOR_SUB_PART_TYPE=9;g.prototype=function(){var a=new E,q,m={ast:Object.create(null),_aststack:[],startNode:function(a,b,c){var d=Object.create(null);d.type=a;d.range=[-1,-1];null!==b&&(void 0!==b&&-1<b)&&(d.range[0]=
b);this.addToParent(d,c);"StyleSheet"!==d.type&&this.setNodeStart(this.ast,b);this._aststack.push(d);return d},endNode:function(a,b){a.range[1]=b;this._aststack.pop();return a},setNodeStart:function(a,b){0>a.range[0]&&(a.range[0]=b)},addToParent:function(a,b){if("string"===typeof b&&0<this._aststack.length){var c=this._aststack[this._aststack.length-1];Array.isArray(c[b])?c[b].push(a):c[b]=a}},idNode:function(a,b){var c=Object.create(null);c.type=a;c.range=b.range;return c},constructor:g,DEFAULT_TYPE:0,
COMBINATOR_TYPE:1,MEDIA_FEATURE_TYPE:2,MEDIA_QUERY_TYPE:3,PROPERTY_NAME_TYPE:4,PROPERTY_VALUE_TYPE:5,PROPERTY_VALUE_PART_TYPE:6,SELECTOR_TYPE:7,SELECTOR_PART_TYPE:8,SELECTOR_SUB_PART_TYPE:9,_stylesheet:function(){var a=this._tokenStream,b,c,d;this.fire("startstylesheet");this.ast=this.startNode("StyleSheet");this.ast.body=[];this._charset();for(this._skipCruft();a.peek()==t.IMPORT_SYM;)this._import(),this._skipCruft();for(;a.peek()==t.NAMESPACE_SYM;)this._namespace(!0),this._skipCruft();for(d=a.peek();d>
t.EOF;){try{switch(d){case t.MEDIA_SYM:this._media();this._skipCruft();break;case t.PAGE_SYM:this._page();this._skipCruft();break;case t.FONT_FACE_SYM:this._font_face();this._skipCruft();break;case t.KEYFRAMES_SYM:this._keyframes();this._skipCruft();break;case t.VIEWPORT_SYM:this._viewport();this._skipCruft();break;case t.UNKNOWN_SYM:a.get();if(this.options.strict)throw new D("Unknown @ rule.",a.LT(0).startLine,a.LT(0).startCol);this.fire({type:"error",error:null,message:"Unknown @ rule: "+a.LT(0).value+
".",line:a.LT(0).startLine,col:a.LT(0).startCol});for(b=0;a.advance([t.LBRACE,t.RBRACE])==t.LBRACE;)b++;for(;b;)a.advance([t.RBRACE]),b--;break;case t.S:this._readWhitespace();break;default:if(!this._ruleset())switch(d){case t.CHARSET_SYM:throw c=a.LT(1),this._charset(!1),new D("@charset not allowed here.",c.startLine,c.startCol);case t.IMPORT_SYM:throw c=a.LT(1),this._import(!1),new D("@import not allowed here.",c.startLine,c.startCol);case t.NAMESPACE_SYM:throw c=a.LT(1),this._namespace(!1),new D("@namespace not allowed here.",
c.startLine,c.startCol);default:a.get(),this._unexpectedToken(a.token())}}}catch(e){if(e instanceof D&&!this.options.strict)this.fire({type:"error",error:e,message:e.message,line:e.line,col:e.col});else throw e;}d=a.peek()}d!=t.EOF&&this._unexpectedToken(a.token());this.endNode(this.ast,a.curr().range[1]);this.fire("endstylesheet")},_charset:function(a){var b=this._tokenStream,c,d,e;if(b.match(t.CHARSET_SYM)){var f=this.startNode("Charset",b.curr().range[0],"body");d=b.token().startLine;e=b.token().startCol;
this._readWhitespace();b.mustMatch(t.STRING);c=b.token();c=c.value;this._readWhitespace();b.mustMatch(t.SEMICOLON);this.endNode(f,b.curr().range[1]);!1!==a&&this.fire({type:"charset",charset:c,line:d,col:e})}},_import:function(a){var b=this._tokenStream,c,d,e=[];b.mustMatch(t.IMPORT_SYM);d=b.token();var f=this.startNode("Import",b.curr().range[0],"body");this._readWhitespace();b.mustMatch([t.STRING,t.URI]);c=b.token();f.uri=this.idNode("Uri",b.curr());c=c.value.replace(/(?:url\()?["']([^"']+)["']\)?/,
"$1");this._readWhitespace();e=this._media_query_list();b.mustMatch(t.SEMICOLON);this._readWhitespace();!1!==a&&this.fire({type:"import",uri:c,media:e,line:d.startLine,col:d.startCol});this.endNode(f,b.curr().range[1])},_namespace:function(a){var b=this._tokenStream,c,d,e,f;b.mustMatch(t.NAMESPACE_SYM);var k=this.startNode("Namespace",b.curr().range[0],"body");c=b.token().startLine;d=b.token().startCol;this._readWhitespace();b.match(t.IDENT)&&(e=b.token().value,k.prefix=e,this._readWhitespace());
b.mustMatch([t.STRING,t.URI]);k.uri=this.idNode("Uri",b.curr());f=b.token().value.replace(/(?:url\()?["']([^"']+)["']\)?/,"$1");this._readWhitespace();b.mustMatch(t.SEMICOLON);this._readWhitespace();!1!==a&&this.fire({type:"namespace",prefix:e,uri:f,line:c,col:d});this.endNode(k,b.curr().range[1])},_media:function(){var a=this._tokenStream,b,c,d;a.mustMatch(t.MEDIA_SYM);var e=this.startNode("Media",a.curr().range[0],"body");b=a.token().startLine;c=a.token().startCol;this._readWhitespace();d=this._media_query_list();
a.mustMatch(t.LBRACE);this._readWhitespace();for(this.fire({type:"startmedia",media:d,line:b,col:c});;)if(a.peek()==t.PAGE_SYM)this._page();else if(a.peek()==t.FONT_FACE_SYM)this._font_face();else if(!this._ruleset())break;a.mustMatch(t.RBRACE);this._readWhitespace();this.fire({type:"endmedia",media:d,line:b,col:c});this.endNode(e,a.curr().range[1])},_media_query_list:function(){var a=this._tokenStream,b=[];this._readWhitespace();var c=this.startNode("MediaQueryList");c.queries=[];if(a.peek()==t.IDENT||
a.peek()==t.LPAREN)c.range[0]=a.curr().range[0],b.push(this._media_query());for(;a.match(t.COMMA);)this._readWhitespace(),b.push(this._media_query());this.endNode(c,a.curr().range[1]);-1<c.range[0]&&this.addToParent(c,"mediaqueries");return b},_media_query:function(){var a=this._tokenStream,b=null,c=null,d=null,f=[],k=this.startNode("MediaQuery");k.expressions=[];a.match(t.IDENT)&&(c=a.token().value.toLowerCase(),"only"!=c&&"not"!=c?(a.unget(),c=null):(d=a.token(),this.setNodeStart(k,a.curr().range[0])));
this._readWhitespace();a.peek()==t.IDENT?(b=this._media_type(),null===d&&(d=a.token(),this.setNodeStart(k,a.curr().range[0]))):a.peek()==t.LPAREN&&(null===d&&(d=a.LT(1)),f.push(this._media_expression()));if(null===b&&0===f.length)return this.endNode(k),null;for(this._readWhitespace();a.match(t.IDENT);)"and"!=a.token().value.toLowerCase()&&this._unexpectedToken(a.token()),this._readWhitespace(),f.push(this._media_expression());this.addToParent(this.endNode(k,a.curr().range[1]),"queries");return new e(c,
b,f,d.startLine,d.startCol)},_media_type:function(){return this._media_feature()},_media_expression:function(){var a=this._tokenStream,b=null,c,d=null;a.mustMatch(t.LPAREN);var e=this.startNode("MediaExpression",a.curr().range[0]),b=this._media_feature();e.feature=this.idNode("MediaFeature",a.curr());this._readWhitespace();a.match(t.COLON)&&(this._readWhitespace(),c=a.LT(1),d=this._expression());a.mustMatch(t.RPAREN);this._readWhitespace();this.addToParent(this.endNode(e,a.curr().range[1]),"expressions");
return new f(b,d?new y(d,c.startLine,c.startCol):null)},_media_feature:function(){var a=this._tokenStream;a.mustMatch(t.IDENT);var b=a.curr(),c=this.startNode("MediaFeature",b.range[0],"mediafeature");c.value=b.value;this.endNode(c,b.range[1]);return y.fromToken(a.token())},_page:function(){var a=this._tokenStream,b,c,d=null,e=null;a.mustMatch(t.PAGE_SYM);var f=this.startNode("Page",a.curr().range[0],"body");f.declarations=[];b=a.token().startLine;c=a.token().startCol;this._readWhitespace();a.match(t.IDENT)&&
(d=a.token().value,f.id=this.idNode("id",a.curr()),"auto"===d.toLowerCase()&&this._unexpectedToken(a.token()));a.peek()==t.COLON&&(e=this._pseudo_page(),f.pseudo=this.idNode("PseudoPage",a.curr()));this._readWhitespace();this.fire({type:"startpage",id:d,pseudo:e,line:b,col:c});this._readDeclarations(!0,!0);this.fire({type:"endpage",id:d,pseudo:e,line:b,col:c});this.endNode(f,toeknStream.curr().range[1])},_margin:function(){var a=this._tokenStream,b,c,d=this._margin_sym();if(d){var e=this.startNode("Margin",
a.curr().range[0],"body");e.declarations=[];b=a.token().startLine;c=a.token().startCol;this.fire({type:"startpagemargin",margin:d,line:b,col:c});this._readDeclarations(!0);this.fire({type:"endpagemargin",margin:d,line:b,col:c});this.endNode(e,a.curr().range[1]);return!0}return!1},_margin_sym:function(){var a=this._tokenStream;return a.match([t.TOPLEFTCORNER_SYM,t.TOPLEFT_SYM,t.TOPCENTER_SYM,t.TOPRIGHT_SYM,t.TOPRIGHTCORNER_SYM,t.BOTTOMLEFTCORNER_SYM,t.BOTTOMLEFT_SYM,t.BOTTOMCENTER_SYM,t.BOTTOMRIGHT_SYM,
t.BOTTOMRIGHTCORNER_SYM,t.LEFTTOP_SYM,t.LEFTMIDDLE_SYM,t.LEFTBOTTOM_SYM,t.RIGHTTOP_SYM,t.RIGHTMIDDLE_SYM,t.RIGHTBOTTOM_SYM])?y.fromToken(a.token()):null},_pseudo_page:function(){var a=this._tokenStream;a.mustMatch(t.COLON);a.mustMatch(t.IDENT);return a.token().value},_font_face:function(){var a=this._tokenStream,b,c;a.mustMatch(t.FONT_FACE_SYM);var d=this.startNode("FontFace",a.curr().range[0],"body");d.declarations=[];b=a.token().startLine;c=a.token().startCol;this._readWhitespace();this.fire({type:"startfontface",
line:b,col:c});this._readDeclarations(!0);this.endNode(d,a.curr().range[1]);this.fire({type:"endfontface",line:b,col:c})},_viewport:function(){var a=this._tokenStream,b,c;a.mustMatch(t.VIEWPORT_SYM);var d=this.startNode("Viewport",a.curr().range[0],"body");d.declarations=[];b=a.token().startLine;c=a.token().startCol;this._readWhitespace();this.fire({type:"startviewport",line:b,col:c});this._readDeclarations(!0);this.endNode(d,a.curr().range[1]);this.fire({type:"endviewport",line:b,col:c})},_operator:function(a){var b=
this._tokenStream,c=null;if(b.match([t.SLASH,t.COMMA])||a&&b.match([t.PLUS,t.STAR,t.MINUS]))c=b.token(),this._readWhitespace();c&&(a=this.startNode("Operator",b.curr().range[0],"operator"),a.value=k.fromToken(c),this.endNode(a,b.curr().range[1]));return c?k.fromToken(c):null},_combinator:function(){var a=this._tokenStream,b=null;a.match([t.PLUS,t.GREATER,t.TILDE])&&(b=a.token(),b=new c(b.value,b.startLine,b.startCol),this._readWhitespace());if(null!==b){var d=this.startNode("Combinator",a.curr().range[0],
"selector");d.value=b;this.endNode(d,a.curr().range[0])}return b},_unary_operator:function(){var a=this._tokenStream;if(a.match([t.MINUS,t.PLUS])){var b=this.startNode("UnaryOperator",a.curr().range[0],"operator");b.value=a.token().value;this.endNode(b,a.curr().range[1]);return a.token().value}return null},_property:function(){var a=this._tokenStream,b=null,c=null,d,e,f,k=this.startNode("Property");a.peek()==t.STAR&&this.options.starHack&&(a.get(),d=a.token(),c=d.value,e=d.startLine,f=d.startCol,
this.setNodeStart(k,a.curr().range[0]));a.match(t.IDENT)&&(d=a.token(),b=d.value,this.setNodeStart(k,a.curr().range[0]),"_"==b.charAt(0)&&this.options.underscoreHack&&(c="_",b=b.substring(1)),k.hack=c,k.value=b,this.addToParent(this.endNode(k,a.curr().range[1]),"property"),b=new l(b,c,e||d.startLine,f||d.startCol),this._readWhitespace());return b},_ruleset:function(){var a=this._tokenStream,b,c=this.startNode("RuleSet");try{b=this._selectors_group(),c.selectors&&0<c.selectors.length&&this.setNodeStart(c,
c.selectors[0].range[0])}catch(d){if(d instanceof D&&!this.options.strict){if(this.fire({type:"error",error:d,message:d.message,line:d.line,col:d.col}),a=a.advance([t.RBRACE]),a!=t.RBRACE)throw d;}else throw d;return!0}b&&(this.fire({type:"startrule",selectors:b,line:b[0].line,col:b[0].col}),this._readDeclarations(!0),this.fire({type:"endrule",selectors:b,line:b[0].line,col:b[0].col}),this.addToParent(this.endNode(c,a.curr().range[1]),"body"));return b},_selectors_group:function(){var a=this._tokenStream,
b=[],c;c=this._selector();if(null!==c)for(b.push(c);a.match(t.COMMA);)this._readWhitespace(),c=this._selector(),null!==c?b.push(c):this._unexpectedToken(a.LT(1));return b.length?b:null},_selector:function(){var a=this._tokenStream,b=[],e=null,f=null,k=null,e=this._simple_selector_sequence();if(null===e)return null;b.push(e);do if(f=this._combinator(),null!==f)b.push(f),e=this._simple_selector_sequence(),null===e?this._unexpectedToken(a.LT(1)):b.push(e);else if(this._readWhitespace())k=new c(a.token().value,
a.token().startLine,a.token().startCol),f=this._combinator(),e=this._simple_selector_sequence(),null===e?null!==f&&this._unexpectedToken(a.LT(1)):(null!==f?b.push(f):b.push(k),b.push(e));else break;while(1);return new d(b,b[0].line,b[0].col)},_simple_selector_sequence:function(){var a=this._tokenStream,b=null,c=[],d="",e=[function(){return a.match(t.HASH)?new n(a.token().value,"id",a.token().startLine,a.token().startCol):null},this._class,this._attrib,this._pseudo,this._negation],f=0,k=e.length,g=
null,l,q;l=a.LT(1).startLine;q=a.LT(1).startCol;(b=this._type_selector())||(b=this._universal());for(null!==b&&(d+=b);a.peek()!==t.S;){for(;f<k&&null===g;)g=e[f++].call(this);if(null===g){if(""===d)return null;break}else f=0,c.push(g),d+=g.toString(),g=null}return""!==d?new h(b,c,d,l,q):null},_type_selector:function(){var a=this._tokenStream,b=this._namespace_prefix(),c=this._element_name();if(c)return b&&(c.text=b+c.text,c.col-=b.length),c;b&&(a.unget(),1<b.length&&a.unget());return null},_class:function(){var a=
this._tokenStream;return a.match(t.DOT)?(a.mustMatch(t.IDENT),a=a.token(),new n("."+a.value,"class",a.startLine,a.startCol-1)):null},_element_name:function(){var a=this._tokenStream;return a.match(t.IDENT)?(a=a.token(),new n(a.value,"elementName",a.startLine,a.startCol)):null},_namespace_prefix:function(){var a=this._tokenStream,b="";if(a.LA(1)===t.PIPE||a.LA(2)===t.PIPE)a.match([t.IDENT,t.STAR])&&(b+=a.token().value),a.mustMatch(t.PIPE),b+="|";return b.length?b:null},_universal:function(){var a=
this._tokenStream,b="",c;(c=this._namespace_prefix())&&(b+=c);a.match(t.STAR)&&(b+="*");return b.length?b:null},_attrib:function(){var a=this._tokenStream,b=null,c,d;return a.match(t.LBRACKET)?(d=a.token(),b=d.value,b+=this._readWhitespace(),(c=this._namespace_prefix())&&(b+=c),a.mustMatch(t.IDENT),b+=a.token().value,b+=this._readWhitespace(),a.match([t.PREFIXMATCH,t.SUFFIXMATCH,t.SUBSTRINGMATCH,t.EQUALS,t.INCLUDES,t.DASHMATCH])&&(b+=a.token().value,b+=this._readWhitespace(),a.mustMatch([t.IDENT,
t.STRING]),b+=a.token().value,b+=this._readWhitespace()),a.mustMatch(t.RBRACKET),new n(b+"]","attribute",d.startLine,d.startCol)):null},_pseudo:function(){var a=this._tokenStream,b=null,c=":",d,e;a.match(t.COLON)&&(a.match(t.COLON)&&(c+=":"),a.match(t.IDENT)?(b=a.token().value,d=a.token().startLine,e=a.token().startCol-c.length):a.peek()==t.FUNCTION&&(d=a.LT(1).startLine,e=a.LT(1).startCol-c.length,b=this._functional_pseudo()),b&&(b=new n(c+b,"pseudo",d,e)));return b},_functional_pseudo:function(){var a=
this._tokenStream,b=null;a.match(t.FUNCTION)&&(b=a.token().value,b+=this._readWhitespace(),b+=this._expression(),a.mustMatch(t.RPAREN),b+=")");return b},_expression:function(){for(var a=this._tokenStream,b="",c=this.startNode("Expression",a.curr().range[0]);a.match([t.PLUS,t.MINUS,t.DIMENSION,t.NUMBER,t.STRING,t.IDENT,t.LENGTH,t.FREQ,t.ANGLE,t.TIME,t.RESOLUTION,t.SLASH]);)b+=a.token().value,b+=this._readWhitespace();b=b.length?b:null;c.value=b;this.addToParent(this.endNode(c,a.curr().range[1]),"expression");
return b},_negation:function(){var a=this._tokenStream,b,c,d="",e;b=null;a.match(t.NOT)&&(d=a.token().value,b=a.token().startLine,c=a.token().startCol,d+=this._readWhitespace(),e=this._negation_arg(),d=d+e+this._readWhitespace(),a.match(t.RPAREN),d+=a.token().value,b=new n(d,"not",b,c),b.args.push(e));return b},_negation_arg:function(){var a=this._tokenStream,b=[this._type_selector,this._universal,function(){return a.match(t.HASH)?new n(a.token().value,"id",a.token().startLine,a.token().startCol):
null},this._class,this._attrib,this._pseudo],c=null,d=0,e=b.length,f,k;f=a.LT(1).startLine;for(k=a.LT(1).startCol;d<e&&null===c;)c=b[d].call(this),d++;null===c&&this._unexpectedToken(a.LT(1));return"elementName"==c.type?new h(c,[],c.toString(),f,k):new h(null,[c],c.toString(),f,k)},_declaration:function(){var a=this._tokenStream,b=null,c=null,d=null,e=null,f="",b=this._property();if(null!==b){a.mustMatch(t.COLON);this._readWhitespace();c=this._expr();(!c||0===c.length)&&this._unexpectedToken(a.LT(1));
d=this._prio();f=b.toString();if(this.options.starHack&&"*"==b.hack||this.options.underscoreHack&&"_"==b.hack)f=b.text;try{this._validateProperty(f,c)}catch(k){e=k}this.fire({type:"property",property:b,value:c,important:d,line:b.line,col:b.col,invalid:e});return!0}return!1},_prio:function(){var a=this._tokenStream.match(t.IMPORTANT_SYM);this._readWhitespace();return a},_expr:function(a){var c=[],d=null,d=null,d=this._term();if(null!==d){c.push(d);do if((d=this._operator(a))&&c.push(d),d=this._term(),
null===d)break;else c.push(d);while(1)}return 0<c.length?new b(c,c[0].line,c[0].col):null},_term:function(){var a=this._tokenStream,b=null,c=null,d,e,f,b=this._unary_operator();null!==b&&(e=a.token().startLine,f=a.token().startCol);a.peek()==t.IE_FUNCTION&&this.options.ieFilters?(c=this._ie_function(),null===b&&(e=a.token().startLine,f=a.token().startCol)):a.match([t.NUMBER,t.PERCENTAGE,t.LENGTH,t.ANGLE,t.TIME,t.FREQ,t.STRING,t.IDENT,t.URI,t.UNICODE_RANGE])?(c=a.token().value,null===b&&(e=a.token().startLine,
f=a.token().startCol),this._readWhitespace()):(d=this._hexcolor(),null===d?(null===b&&(e=a.LT(1).startLine,f=a.LT(1).startCol),null===c&&(c=a.LA(3)==t.EQUALS&&this.options.ieFilters?this._ie_function():this._function())):(c=d.value,null===b&&(e=d.startLine,f=d.startCol)));return null!==c?new k(null!==b?b+c:c,e,f):null},_function:function(){var a=this._tokenStream,b=null,c=null;if(a.match(t.FUNCTION)){b=a.token().value;this._readWhitespace();c=this._expr(!0);b+=c;if(this.options.ieFilters&&a.peek()==
t.EQUALS){do{this._readWhitespace()&&(b+=a.token().value);a.LA(0)==t.COMMA&&(b+=a.token().value);a.match(t.IDENT);b+=a.token().value;a.match(t.EQUALS);b+=a.token().value;for(c=a.peek();c!=t.COMMA&&c!=t.S&&c!=t.RPAREN;)a.get(),b+=a.token().value,c=a.peek()}while(a.match([t.COMMA,t.S]))}a.match(t.RPAREN);b+=")";this._readWhitespace()}return b},_ie_function:function(){var a=this._tokenStream,b=null,c;if(a.match([t.IE_FUNCTION,t.FUNCTION])){b=a.token().value;do{this._readWhitespace()&&(b+=a.token().value);
a.LA(0)==t.COMMA&&(b+=a.token().value);a.match(t.IDENT);b+=a.token().value;a.match(t.EQUALS);b+=a.token().value;for(c=a.peek();c!=t.COMMA&&c!=t.S&&c!=t.RPAREN;)a.get(),b+=a.token().value,c=a.peek()}while(a.match([t.COMMA,t.S]));a.match(t.RPAREN);b+=")";this._readWhitespace()}return b},_hexcolor:function(){var a=this._tokenStream,b=null;if(a.match(t.HASH)){b=a.token();a=b.value;if(!/#[a-f0-9]{3,6}/i.test(a))throw new D("Expected a hex color but found '"+a+"' at line "+b.startLine+", col "+b.startCol+
".",b.startLine,b.startCol);this._readWhitespace()}return b},_keyframes:function(){var a=this._tokenStream,b,c,d,e="";a.mustMatch(t.KEYFRAMES_SYM);b=a.token();/^@\-([^\-]+)\-/.test(b.value)&&(e=RegExp.$1);this._readWhitespace();d=this._keyframe_name();this._readWhitespace();a.mustMatch(t.LBRACE);this.fire({type:"startkeyframes",name:d,prefix:e,line:b.startLine,col:b.startCol});this._readWhitespace();for(c=a.peek();c==t.IDENT||c==t.PERCENTAGE;)this._keyframe_rule(),this._readWhitespace(),c=a.peek();
this.fire({type:"endkeyframes",name:d,prefix:e,line:b.startLine,col:b.startCol});this._readWhitespace();a.mustMatch(t.RBRACE)},_keyframe_name:function(){var a=this._tokenStream;a.mustMatch([t.IDENT,t.STRING]);return y.fromToken(a.token())},_keyframe_rule:function(){var a=this._key_list();this.fire({type:"startkeyframerule",keys:a,line:a[0].line,col:a[0].col});this._readDeclarations(!0);this.fire({type:"endkeyframerule",keys:a,line:a[0].line,col:a[0].col})},_key_list:function(){var a=this._tokenStream,
b=[];b.push(this._key());for(this._readWhitespace();a.match(t.COMMA);)this._readWhitespace(),b.push(this._key()),this._readWhitespace();return b},_key:function(){var a=this._tokenStream,b;if(a.match(t.PERCENTAGE))return y.fromToken(a.token());if(a.match(t.IDENT)){b=a.token();if(/from|to/i.test(b.value))return y.fromToken(b);a.unget()}this._unexpectedToken(a.LT(1))},_skipCruft:function(){for(;this._tokenStream.match([t.S,t.CDO,t.CDC]););},_readDeclarations:function(a,b){var c=this._tokenStream;this._readWhitespace();
a&&c.mustMatch(t.LBRACE);this._readWhitespace();try{for(;;){if(!(c.match(t.SEMICOLON)||b&&this._margin()))if(this._declaration()){if(!c.match(t.SEMICOLON))break}else break;this._readWhitespace()}c.mustMatch(t.RBRACE);this._readWhitespace()}catch(d){if(d instanceof D&&!this.options.strict)if(this.fire({type:"error",error:d,message:d.message,line:d.line,col:d.col}),c=c.advance([t.SEMICOLON,t.RBRACE]),c==t.SEMICOLON)this._readDeclarations(!1,b);else{if(c!=t.RBRACE)throw d;}else throw d;}},_readWhitespace:function(){for(var a=
this._tokenStream,b="";a.match(t.S);)b+=a.token().value;return b},_unexpectedToken:function(a){throw new D("Unexpected token '"+a.value+"' at line "+a.startLine+", col "+a.startCol+".",a.startLine,a.startCol);},_verifyEnd:function(){this._tokenStream.LA(1)!=t.EOF&&this._unexpectedToken(this._tokenStream.LT(1))},_validateProperty:function(a,b){N.validate(a,b)},parse:function(a){this._tokenStream=new C(a,t);this._stylesheet()},parseStyleSheet:function(a){return this.parse(a)},parseMediaQuery:function(a){this._tokenStream=
new C(a,t);a=this._media_query();this._verifyEnd();return a},parsePropertyValue:function(a){this._tokenStream=new C(a,t);this._readWhitespace();a=this._expr();this._readWhitespace();this._verifyEnd();return a},parseRule:function(a){this._tokenStream=new C(a,t);this._readWhitespace();a=this._ruleset();this._readWhitespace();this._verifyEnd();return a},parseSelector:function(a){this._tokenStream=new C(a,t);this._readWhitespace();a=this._selector();this._readWhitespace();this._verifyEnd();return a},
parseStyleAttribute:function(a){this._tokenStream=new C(a+"}",t);this._readDeclarations()}};for(q in m)m.hasOwnProperty(q)&&(a[q]=m[q]);return a}();var P={"alignment-adjust":"auto | baseline | before-edge | text-before-edge | middle | central | after-edge | text-after-edge | ideographic | alphabetic | hanging | mathematical | \x3cpercentage\x3e | \x3clength\x3e","alignment-baseline":"baseline | use-script | before-edge | text-before-edge | after-edge | text-after-edge | central | middle | ideographic | alphabetic | hanging | mathematical",
animation:1,"animation-delay":{multi:"\x3ctime\x3e",comma:!0},"animation-direction":{multi:"normal | alternate",comma:!0},"animation-duration":{multi:"\x3ctime\x3e",comma:!0},"animation-iteration-count":{multi:"\x3cnumber\x3e | infinite",comma:!0},"animation-name":{multi:"none | \x3cident\x3e",comma:!0},"animation-play-state":{multi:"running | paused",comma:!0},"animation-timing-function":1,"-moz-animation-delay":{multi:"\x3ctime\x3e",comma:!0},"-moz-animation-direction":{multi:"normal | alternate",
comma:!0},"-moz-animation-duration":{multi:"\x3ctime\x3e",comma:!0},"-moz-animation-iteration-count":{multi:"\x3cnumber\x3e | infinite",comma:!0},"-moz-animation-name":{multi:"none | \x3cident\x3e",comma:!0},"-moz-animation-play-state":{multi:"running | paused",comma:!0},"-ms-animation-delay":{multi:"\x3ctime\x3e",comma:!0},"-ms-animation-direction":{multi:"normal | alternate",comma:!0},"-ms-animation-duration":{multi:"\x3ctime\x3e",comma:!0},"-ms-animation-iteration-count":{multi:"\x3cnumber\x3e | infinite",
comma:!0},"-ms-animation-name":{multi:"none | \x3cident\x3e",comma:!0},"-ms-animation-play-state":{multi:"running | paused",comma:!0},"-webkit-animation-delay":{multi:"\x3ctime\x3e",comma:!0},"-webkit-animation-direction":{multi:"normal | alternate",comma:!0},"-webkit-animation-duration":{multi:"\x3ctime\x3e",comma:!0},"-webkit-animation-iteration-count":{multi:"\x3cnumber\x3e | infinite",comma:!0},"-webkit-animation-name":{multi:"none | \x3cident\x3e",comma:!0},"-webkit-animation-play-state":{multi:"running | paused",
comma:!0},"-o-animation-delay":{multi:"\x3ctime\x3e",comma:!0},"-o-animation-direction":{multi:"normal | alternate",comma:!0},"-o-animation-duration":{multi:"\x3ctime\x3e",comma:!0},"-o-animation-iteration-count":{multi:"\x3cnumber\x3e | infinite",comma:!0},"-o-animation-name":{multi:"none | \x3cident\x3e",comma:!0},"-o-animation-play-state":{multi:"running | paused",comma:!0},appearance:"icon | window | desktop | workspace | document | tooltip | dialog | button | push-button | hyperlink | radio-button | checkbox | menu-item | tab | menu | menubar | pull-down-menu | pop-up-menu | list-menu | radio-group | checkbox-group | outline-tree | range | field | combo-box | signature | password | normal | none | inherit",
azimuth:function(a){var b=!1,c=!1;G.isAny(a,"\x3cangle\x3e | leftwards | rightwards | inherit")||(G.isAny(a,"behind")&&(c=b=!0),G.isAny(a,"left-side | far-left | left | center-left | center | center-right | right | far-right | right-side")&&(c=!0,b||G.isAny(a,"behind")));if(a.hasNext()){a=a.next();if(c)throw new z("Expected end of value but found '"+a+"'.",a.line,a.col);throw new z("Expected (\x3c'azimuth'\x3e) but found '"+a+"'.",a.line,a.col);}},"backface-visibility":"visible | hidden",background:1,
"background-attachment":{multi:"\x3cattachment\x3e",comma:!0},"background-clip":{multi:"\x3cbox\x3e",comma:!0},"background-color":"\x3ccolor\x3e | inherit","background-image":{multi:"\x3cbg-image\x3e",comma:!0},"background-origin":{multi:"\x3cbox\x3e",comma:!0},"background-position":{multi:"\x3cbg-position\x3e",comma:!0},"background-repeat":{multi:"\x3crepeat-style\x3e"},"background-size":{multi:"\x3cbg-size\x3e",comma:!0},"baseline-shift":"baseline | sub | super | \x3cpercentage\x3e | \x3clength\x3e",
behavior:1,binding:1,bleed:"\x3clength\x3e","bookmark-label":"\x3ccontent\x3e | \x3cattr\x3e | \x3cstring\x3e","bookmark-level":"none | \x3cinteger\x3e","bookmark-state":"open | closed","bookmark-target":"none | \x3curi\x3e | \x3cattr\x3e",border:"\x3cborder-width\x3e || \x3cborder-style\x3e || \x3ccolor\x3e","border-bottom":"\x3cborder-width\x3e || \x3cborder-style\x3e || \x3ccolor\x3e","border-bottom-color":"\x3ccolor\x3e | inherit","border-bottom-left-radius":"\x3cx-one-radius\x3e","border-bottom-right-radius":"\x3cx-one-radius\x3e",
"border-bottom-style":"\x3cborder-style\x3e","border-bottom-width":"\x3cborder-width\x3e","border-collapse":"collapse | separate | inherit","border-color":{multi:"\x3ccolor\x3e | inherit",max:4},"border-image":1,"border-image-outset":{multi:"\x3clength\x3e | \x3cnumber\x3e",max:4},"border-image-repeat":{multi:"stretch | repeat | round",max:2},"border-image-slice":function(a){var b=!1,c=!1,d=0;G.isAny(a,"fill")&&(b=c=!0);for(;a.hasNext()&&4>d;){b=G.isAny(a,"\x3cnumber\x3e | \x3cpercentage\x3e");if(!b)break;
d++}c?b=!0:G.isAny(a,"fill");if(a.hasNext()){a=a.next();if(b)throw new z("Expected end of value but found '"+a+"'.",a.line,a.col);throw new z("Expected ([\x3cnumber\x3e | \x3cpercentage\x3e]{1,4} \x26\x26 fill?) but found '"+a+"'.",a.line,a.col);}},"border-image-source":"\x3cimage\x3e | none","border-image-width":{multi:"\x3clength\x3e | \x3cpercentage\x3e | \x3cnumber\x3e | auto",max:4},"border-left":"\x3cborder-width\x3e || \x3cborder-style\x3e || \x3ccolor\x3e","border-left-color":"\x3ccolor\x3e | inherit",
"border-left-style":"\x3cborder-style\x3e","border-left-width":"\x3cborder-width\x3e","border-radius":function(a){for(var b=!1,c=!1,d=0,e=8;a.hasNext()&&d<e;){b=G.isAny(a,"\x3clength\x3e | \x3cpercentage\x3e | inherit");if(!b)if("/"==a.peek()&&0<d&&!c)c=!0,e=d+5,a.next();else break;d++}if(a.hasNext()){a=a.next();if(b)throw new z("Expected end of value but found '"+a+"'.",a.line,a.col);throw new z("Expected (\x3c'border-radius'\x3e) but found '"+a+"'.",a.line,a.col);}},"border-right":"\x3cborder-width\x3e || \x3cborder-style\x3e || \x3ccolor\x3e",
"border-right-color":"\x3ccolor\x3e | inherit","border-right-style":"\x3cborder-style\x3e","border-right-width":"\x3cborder-width\x3e","border-spacing":{multi:"\x3clength\x3e | inherit",max:2},"border-style":{multi:"\x3cborder-style\x3e",max:4},"border-top":"\x3cborder-width\x3e || \x3cborder-style\x3e || \x3ccolor\x3e","border-top-color":"\x3ccolor\x3e | inherit","border-top-left-radius":"\x3cx-one-radius\x3e","border-top-right-radius":"\x3cx-one-radius\x3e","border-top-style":"\x3cborder-style\x3e",
"border-top-width":"\x3cborder-width\x3e","border-width":{multi:"\x3cborder-width\x3e",max:4},bottom:"\x3cmargin-width\x3e | inherit","box-align":"start | end | center | baseline | stretch","box-decoration-break":"slice |clone","box-direction":"normal | reverse | inherit","box-flex":"\x3cnumber\x3e","box-flex-group":"\x3cinteger\x3e","box-lines":"single | multiple","box-ordinal-group":"\x3cinteger\x3e","box-orient":"horizontal | vertical | inline-axis | block-axis | inherit","box-pack":"start | end | center | justify",
"box-shadow":function(a){if(G.isAny(a,"none")){if(a.hasNext())throw a=a.next(),new z("Expected end of value but found '"+a+"'.",a.line,a.col);}else N.multiProperty("\x3cshadow\x3e",a,!0,Infinity)},"box-sizing":"content-box | border-box | inherit","break-after":"auto | always | avoid | left | right | page | column | avoid-page | avoid-column","break-before":"auto | always | avoid | left | right | page | column | avoid-page | avoid-column","break-inside":"auto | avoid | avoid-page | avoid-column","caption-side":"top | bottom | inherit",
clear:"none | right | left | both | inherit",clip:1,color:"\x3ccolor\x3e | inherit","color-profile":1,"column-count":"\x3cinteger\x3e | auto","column-fill":"auto | balance","column-gap":"\x3clength\x3e | normal","column-rule":"\x3cborder-width\x3e || \x3cborder-style\x3e || \x3ccolor\x3e","column-rule-color":"\x3ccolor\x3e","column-rule-style":"\x3cborder-style\x3e","column-rule-width":"\x3cborder-width\x3e","column-span":"none | all","column-width":"\x3clength\x3e | auto",columns:1,content:1,"counter-increment":1,
"counter-reset":1,crop:"\x3cshape\x3e | auto",cue:"cue-after | cue-before | inherit","cue-after":1,"cue-before":1,cursor:1,direction:"ltr | rtl | inherit",display:"inline | block | list-item | inline-block | table | inline-table | table-row-group | table-header-group | table-footer-group | table-row | table-column-group | table-column | table-cell | table-caption | box | inline-box | grid | inline-grid | none | inherit | -moz-box | -moz-inline-block | -moz-inline-box | -moz-inline-grid | -moz-inline-stack | -moz-inline-table | -moz-grid | -moz-grid-group | -moz-grid-line | -moz-groupbox | -moz-deck | -moz-popup | -moz-stack | -moz-marker | -webkit-box | -webkit-inline-box",
"dominant-baseline":1,"drop-initial-after-adjust":"central | middle | after-edge | text-after-edge | ideographic | alphabetic | mathematical | \x3cpercentage\x3e | \x3clength\x3e","drop-initial-after-align":"baseline | use-script | before-edge | text-before-edge | after-edge | text-after-edge | central | middle | ideographic | alphabetic | hanging | mathematical","drop-initial-before-adjust":"before-edge | text-before-edge | central | middle | hanging | mathematical | \x3cpercentage\x3e | \x3clength\x3e",
"drop-initial-before-align":"caps-height | baseline | use-script | before-edge | text-before-edge | after-edge | text-after-edge | central | middle | ideographic | alphabetic | hanging | mathematical","drop-initial-size":"auto | line | \x3clength\x3e | \x3cpercentage\x3e","drop-initial-value":"initial | \x3cinteger\x3e",elevation:"\x3cangle\x3e | below | level | above | higher | lower | inherit","empty-cells":"show | hide | inherit",filter:1,fit:"fill | hidden | meet | slice","fit-position":1,"float":"left | right | none | inherit",
"float-offset":1,font:1,"font-family":1,"font-size":"\x3cabsolute-size\x3e | \x3crelative-size\x3e | \x3clength\x3e | \x3cpercentage\x3e | inherit","font-size-adjust":"\x3cnumber\x3e | none | inherit","font-stretch":"normal | ultra-condensed | extra-condensed | condensed | semi-condensed | semi-expanded | expanded | extra-expanded | ultra-expanded | inherit","font-style":"normal | italic | oblique | inherit","font-variant":"normal | small-caps | inherit","font-weight":"normal | bold | bolder | lighter | 100 | 200 | 300 | 400 | 500 | 600 | 700 | 800 | 900 | inherit",
"grid-cell-stacking":"columns | rows | layer","grid-column":1,"grid-columns":1,"grid-column-align":"start | end | center | stretch","grid-column-sizing":1,"grid-column-span":"\x3cinteger\x3e","grid-flow":"none | rows | columns","grid-layer":"\x3cinteger\x3e","grid-row":1,"grid-rows":1,"grid-row-align":"start | end | center | stretch","grid-row-span":"\x3cinteger\x3e","grid-row-sizing":1,"hanging-punctuation":1,height:"\x3cmargin-width\x3e | inherit","hyphenate-after":"\x3cinteger\x3e | auto","hyphenate-before":"\x3cinteger\x3e | auto",
"hyphenate-character":"\x3cstring\x3e | auto","hyphenate-lines":"no-limit | \x3cinteger\x3e","hyphenate-resource":1,hyphens:"none | manual | auto",icon:1,"image-orientation":"angle | auto","image-rendering":1,"image-resolution":1,"inline-box-align":"initial | last | \x3cinteger\x3e",left:"\x3cmargin-width\x3e | inherit","letter-spacing":"\x3clength\x3e | normal | inherit","line-height":"\x3cnumber\x3e | \x3clength\x3e | \x3cpercentage\x3e | normal | inherit","line-break":"auto | loose | normal | strict",
"line-stacking":1,"line-stacking-ruby":"exclude-ruby | include-ruby","line-stacking-shift":"consider-shifts | disregard-shifts","line-stacking-strategy":"inline-line-height | block-line-height | max-height | grid-height","list-style":1,"list-style-image":"\x3curi\x3e | none | inherit","list-style-position":"inside | outside | inherit","list-style-type":"disc | circle | square | decimal | decimal-leading-zero | lower-roman | upper-roman | lower-greek | lower-latin | upper-latin | armenian | georgian | lower-alpha | upper-alpha | none | inherit",
margin:{multi:"\x3cmargin-width\x3e | inherit",max:4},"margin-bottom":"\x3cmargin-width\x3e | inherit","margin-left":"\x3cmargin-width\x3e | inherit","margin-right":"\x3cmargin-width\x3e | inherit","margin-top":"\x3cmargin-width\x3e | inherit",mark:1,"mark-after":1,"mark-before":1,marks:1,"marquee-direction":1,"marquee-play-count":1,"marquee-speed":1,"marquee-style":1,"max-height":"\x3clength\x3e | \x3cpercentage\x3e | none | inherit","max-width":"\x3clength\x3e | \x3cpercentage\x3e | none | inherit",
"min-height":"\x3clength\x3e | \x3cpercentage\x3e | inherit","min-width":"\x3clength\x3e | \x3cpercentage\x3e | inherit","move-to":1,"nav-down":1,"nav-index":1,"nav-left":1,"nav-right":1,"nav-up":1,opacity:"\x3cnumber\x3e | inherit",orphans:"\x3cinteger\x3e | inherit",outline:1,"outline-color":"\x3ccolor\x3e | invert | inherit","outline-offset":1,"outline-style":"\x3cborder-style\x3e | inherit","outline-width":"\x3cborder-width\x3e | inherit",overflow:"visible | hidden | scroll | auto | inherit",
"overflow-style":1,"overflow-x":1,"overflow-y":1,padding:{multi:"\x3cpadding-width\x3e | inherit",max:4},"padding-bottom":"\x3cpadding-width\x3e | inherit","padding-left":"\x3cpadding-width\x3e | inherit","padding-right":"\x3cpadding-width\x3e | inherit","padding-top":"\x3cpadding-width\x3e | inherit",page:1,"page-break-after":"auto | always | avoid | left | right | inherit","page-break-before":"auto | always | avoid | left | right | inherit","page-break-inside":"auto | avoid | inherit","page-policy":1,
pause:1,"pause-after":1,"pause-before":1,perspective:1,"perspective-origin":1,phonemes:1,pitch:1,"pitch-range":1,"play-during":1,"pointer-events":"auto | none | visiblePainted | visibleFill | visibleStroke | visible | painted | fill | stroke | all | inherit",position:"static | relative | absolute | fixed | inherit","presentation-level":1,"punctuation-trim":1,quotes:1,"rendering-intent":1,resize:1,rest:1,"rest-after":1,"rest-before":1,richness:1,right:"\x3cmargin-width\x3e | inherit",rotation:1,"rotation-point":1,
"ruby-align":1,"ruby-overhang":1,"ruby-position":1,"ruby-span":1,size:1,speak:"normal | none | spell-out | inherit","speak-header":"once | always | inherit","speak-numeral":"digits | continuous | inherit","speak-punctuation":"code | none | inherit","speech-rate":1,src:1,stress:1,"string-set":1,"table-layout":"auto | fixed | inherit","tab-size":"\x3cinteger\x3e | \x3clength\x3e",target:1,"target-name":1,"target-new":1,"target-position":1,"text-align":"left | right | center | justify | inherit","text-align-last":1,
"text-decoration":1,"text-emphasis":1,"text-height":1,"text-indent":"\x3clength\x3e | \x3cpercentage\x3e | inherit","text-justify":"auto | none | inter-word | inter-ideograph | inter-cluster | distribute | kashida","text-outline":1,"text-overflow":1,"text-rendering":"auto | optimizeSpeed | optimizeLegibility | geometricPrecision | inherit","text-shadow":1,"text-transform":"capitalize | uppercase | lowercase | none | inherit","text-wrap":"normal | none | avoid",top:"\x3cmargin-width\x3e | inherit",
transform:1,"transform-origin":1,"transform-style":1,transition:1,"transition-delay":1,"transition-duration":1,"transition-property":1,"transition-timing-function":1,"unicode-bidi":"normal | embed | bidi-override | inherit","user-modify":"read-only | read-write | write-only | inherit","user-select":"none | text | toggle | element | elements | all | inherit","vertical-align":"auto | use-script | baseline | sub | super | top | text-top | central | middle | bottom | text-bottom | \x3cpercentage\x3e | \x3clength\x3e",
visibility:"visible | hidden | collapse | inherit","voice-balance":1,"voice-duration":1,"voice-family":1,"voice-pitch":1,"voice-pitch-range":1,"voice-rate":1,"voice-stress":1,"voice-volume":1,volume:1,"white-space":"normal | pre | nowrap | pre-wrap | pre-line | inherit | -pre-wrap | -o-pre-wrap | -moz-pre-wrap | -hp-pre-wrap","white-space-collapse":1,widows:"\x3cinteger\x3e | inherit",width:"\x3clength\x3e | \x3cpercentage\x3e | auto | inherit","word-break":"normal | keep-all | break-all","word-spacing":"\x3clength\x3e | normal | inherit",
"word-wrap":1,"z-index":"\x3cinteger\x3e | auto | inherit",zoom:"\x3cnumber\x3e | \x3cpercentage\x3e | normal"};l.prototype=new y;l.prototype.constructor=l;l.prototype.toString=function(){return(this.hack?this.hack:"")+this.text};b.prototype=new y;b.prototype.constructor=b;a.prototype.count=function(){return this._parts.length};a.prototype.isFirst=function(){return 0===this._i};a.prototype.hasNext=function(){return this._i<this._parts.length};a.prototype.mark=function(){this._marks.push(this._i)};
a.prototype.peek=function(a){return this.hasNext()?this._parts[this._i+(a||0)]:null};a.prototype.next=function(){return this.hasNext()?this._parts[this._i++]:null};a.prototype.previous=function(){return 0<this._i?this._parts[--this._i]:null};a.prototype.restore=function(){this._marks.length&&(this._i=this._marks.pop())};k.prototype=new y;k.prototype.constructor=k;k.fromToken=function(a){return new k(a.value,a.startLine,a.startCol)};var L={":first-letter":1,":first-line":1,":before":1,":after":1,ELEMENT:1,
CLASS:2,isElement:function(a){return 0===a.indexOf("::")||L[a.toLowerCase()]==L.ELEMENT}};d.prototype=new y;d.prototype.constructor=d;h.prototype=new y;h.prototype.constructor=h;n.prototype=new y;n.prototype.constructor=n;m.prototype={constructor:m,compare:function(a){var b=["a","b","c","d"],c,d;c=0;for(d=b.length;c<d;c++){if(this[b[c]]<a[b[c]])return-1;if(this[b[c]]>a[b[c]])return 1}return 0},valueOf:function(){return 1E3*this.a+100*this.b+10*this.c+this.d},toString:function(){return this.a+","+
this.b+","+this.c+","+this.d}};m.calculate=function(a){function b(a){var c,d,e,l;c=a.elementName?a.elementName.text:"";var n;c&&"*"!=c.charAt(c.length-1)&&g++;c=0;for(e=a.modifiers.length;c<e;c++)switch(n=a.modifiers[c],n.type){case "class":case "attribute":k++;break;case "id":f++;break;case "pseudo":L.isElement(n.text)?g++:k++;break;case "not":d=0;for(l=n.args.length;d<l;d++)b(n.args[d])}}var c,d,e,f=0,k=0,g=0;c=0;for(d=a.parts.length;c<d;c++)e=a.parts[c],e instanceof h&&b(e);return new m(0,f,k,
g)};var K=/^[0-9a-fA-F]$/,J=/\n|\r\n|\r|\f/;C.prototype=function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a}(new A,{_getToken:function(a){var b;a=this._reader;var c=null,d=a.getLine(),e=a.getCol();start=a.getCursor();for(b=a.read();b;){switch(b){case "/":c="*"==a.peek()?this.commentToken(b,d,e):this.charToken(b,d,e);break;case "|":case "~":case "^":case "$":case "*":c="\x3d"==a.peek()?this.comparisonToken(b,d,e):this.charToken(b,d,e);break;case '"':case "'":c=this.stringToken(b,
d,e);break;case "#":c=x(a.peek())?this.hashToken(b,d,e):this.charToken(b,d,e);break;case ".":c=q(a.peek())?this.numberToken(b,d,e):this.charToken(b,d,e);break;case "-":c="-"==a.peek()?this.htmlCommentEndToken(b,d,e):B(a.peek())?this.identOrFunctionToken(b,d,e):this.charToken(b,d,e);break;case "!":c=this.importantToken(b,d,e);break;case "@":c=this.atRuleToken(b,d,e);break;case ":":c=this.notToken(b,d,e);break;case "\x3c":c=this.htmlCommentStartToken(b,d,e);break;case "U":case "u":if("+"==a.peek()){c=
this.unicodeRangeToken(b,d,e);break}default:c=q(b)?this.numberToken(b,d,e):v(b)?this.whitespaceToken(b,d,e):null!==b&&(B(b)||/\-\\/.test(b))?this.identOrFunctionToken(b,d,e):this.charToken(b,d,e)}break}!c&&null===b&&(c=this.createToken(t.EOF,null,d,e));c.type!==t.S&&(b=Object.create(null),b.type=t.name(c.type),b.value=c.value,b.range=[start,a.getCursor()],this.tokens.push(b));return c},curr:function(){return 0<this.tokens.length?this.tokens[this.tokens.length-1]:null},createToken:function(a,b,c,d,
e){var f=this._reader;e=e||{};return{value:b,type:a,channel:e.channel,hide:e.hide||!1,startLine:c,startCol:d,endLine:f.getLine(),endCol:f.getCol()}},atRuleToken:function(a,b,c){var d=a,e=this._reader,f=t.CHAR;e.mark();d=this.readName();d=a+d;f=t.type(d.toLowerCase());if(f==t.CHAR||f==t.UNKNOWN)1<d.length?f=t.UNKNOWN_SYM:(f=t.CHAR,d=a,e.reset());return this.createToken(f,d,b,c)},charToken:function(a,b,c){var d=t.type(a);-1==d&&(d=t.CHAR);return this.createToken(d,a,b,c)},commentToken:function(a,b,
c){a=this.readComment(a);return this.createToken(t.COMMENT,a,b,c)},comparisonToken:function(a,b,c){a+=this._reader.read();var d=t.type(a)||t.CHAR;return this.createToken(d,a,b,c)},hashToken:function(a,b,c){a=this.readName(a);return this.createToken(t.HASH,a,b,c)},htmlCommentStartToken:function(a,b,c){var d=this._reader,e=a;d.mark();e+=d.readCount(3);if("\x3c!--"==e)return this.createToken(t.CDO,e,b,c);d.reset();return this.charToken(a,b,c)},htmlCommentEndToken:function(a,b,c){var d=this._reader,e=
a;d.mark();e+=d.readCount(2);if("--\x3e"==e)return this.createToken(t.CDC,e,b,c);d.reset();return this.charToken(a,b,c)},identOrFunctionToken:function(a,b,c){var d=this._reader;a=this.readName(a);var e=t.IDENT;"("==d.peek()?(a+=d.read(),"url("==a.toLowerCase()?(e=t.URI,a=this.readURI(a),"url("==a.toLowerCase()&&(e=t.FUNCTION)):e=t.FUNCTION):":"==d.peek()&&"progid"==a.toLowerCase()&&(a+=d.readTo("("),e=t.IE_FUNCTION);return this.createToken(e,a,b,c)},importantToken:function(a,b,c){var d=this._reader,
e=a,f=t.CHAR,k,g;d.mark();for(g=d.read();g;){if("/"==g)if("*"!=d.peek())break;else{if(k=this.readComment(g),""===k)break}else if(v(g))e+=g+this.readWhitespace();else{/i/i.test(g)&&(k=d.readCount(8),/mportant/i.test(k)&&(e+=g+k,f=t.IMPORTANT_SYM));break}g=d.read()}return f==t.CHAR?(d.reset(),this.charToken(a,b,c)):this.createToken(f,e,b,c)},notToken:function(a,b,c){var d=this._reader,e=a;d.mark();e+=d.readCount(4);if(":not("==e.toLowerCase())return this.createToken(t.NOT,e,b,c);d.reset();return this.charToken(a,
b,c)},numberToken:function(a,b,c){var d=this._reader;a=this.readNumber(a);var e=t.NUMBER,f=d.peek();null!==f&&(B(f)||/\-\\/.test(f))?(d=this.readName(d.read()),a+=d,e=/^em$|^ex$|^px$|^gd$|^rem$|^vw$|^vh$|^vm$|^ch$|^cm$|^mm$|^in$|^pt$|^pc$/i.test(d)?t.LENGTH:/^deg|^rad$|^grad$/i.test(d)?t.ANGLE:/^ms$|^s$/i.test(d)?t.TIME:/^hz$|^khz$/i.test(d)?t.FREQ:/^dpi$|^dpcm$/i.test(d)?t.RESOLUTION:t.DIMENSION):"%"==f&&(a+=d.read(),e=t.PERCENTAGE);return this.createToken(e,a,b,c)},stringToken:function(a,b,c){for(var d=
a,e=this._reader,f=a,k=t.STRING,g=e.read();g;){d+=g;if(g==a&&"\\"!=f)break;if(s(e.peek())&&"\\"!=g){k=t.INVALID;break}f=g;g=e.read()}null===g&&(k=t.INVALID);return this.createToken(k,d,b,c)},unicodeRangeToken:function(a,b,c){var d=this._reader,e,f=t.CHAR;"+"==d.peek()&&(d.mark(),a+=d.read(),a+=this.readUnicodeRangePart(!0),2==a.length?d.reset():(f=t.UNICODE_RANGE,-1==a.indexOf("?")&&"-"==d.peek()&&(d.mark(),e=d.read(),e+=this.readUnicodeRangePart(!1),1==e.length?d.reset():a+=e)));return this.createToken(f,
a,b,c)},whitespaceToken:function(a,b,c){a+=this.readWhitespace();return this.createToken(t.S,a,b,c)},readUnicodeRangePart:function(a){for(var b=this._reader,c="",d=b.peek();null!==d&&K.test(d)&&6>c.length;)b.read(),c+=d,d=b.peek();if(a)for(;"?"==d&&6>c.length;)b.read(),c+=d,d=b.peek();return c},readWhitespace:function(){for(var a=this._reader,b="",c=a.peek();v(c);)a.read(),b+=c,c=a.peek();return b},readNumber:function(a){var b=this._reader,c=a;a="."==a;for(var d=b.peek();d;){if(q(d))c+=b.read();else if("."==
d)if(a)break;else a=!0,c+=b.read();else break;d=b.peek()}return c},readString:function(){for(var a=this._reader,b=a.read(),c=b,d=b,e=a.peek();e;){e=a.read();c+=e;if(e==b&&"\\"!=d)break;if(s(a.peek())&&"\\"!=e){c="";break}d=e;e=a.peek()}null===e&&(c="");return c},readURI:function(a){var b=this._reader,c=a,d="",e=b.peek();for(b.mark();e&&v(e);)b.read(),e=b.peek();d="'"==e||'"'==e?this.readString():this.readURL();for(e=b.peek();e&&v(e);)b.read(),e=b.peek();""===d||")"!=e?(c=a,b.reset()):c+=d+b.read();
return c},readURL:function(){for(var a=this._reader,b="",c=a.peek();/^[!#$%&\\*-~]$/.test(c);)b+=a.read(),c=a.peek();return b},readName:function(a){var b=this._reader;a=a||"";for(var c=b.peek();;)if("\\"==c)a+=this.readEscape(b.read()),c=b.peek();else if(c&&x(c))a+=b.read(),c=b.peek();else break;return a},readEscape:function(a){var b=this._reader;a=a||"";var c=0,d=b.peek();if(null!==d&&K.test(d)){do a+=b.read(),d=b.peek();while(d&&null!==d&&K.test(d)&&6>++c)}3==a.length&&/\s/.test(d)||7==a.length||
1==a.length?b.read():d="";return a+d},readComment:function(a){var b=this._reader;a=a||"";var c=b.read();if("*"==c){for(;c;){a+=c;if(2<a.length&&"*"==c&&"/"==b.peek()){a+=b.read();break}c=b.read()}return a}return""}});var t=[{name:"CDO"},{name:"CDC"},{name:"S",whitespace:!0},{name:"COMMENT",comment:!0,hide:!0,channel:"comment"},{name:"INCLUDES",text:"~\x3d"},{name:"DASHMATCH",text:"|\x3d"},{name:"PREFIXMATCH",text:"^\x3d"},{name:"SUFFIXMATCH",text:"$\x3d"},{name:"SUBSTRINGMATCH",text:"*\x3d"},{name:"STRING"},
{name:"IDENT"},{name:"HASH"},{name:"IMPORT_SYM",text:"@import"},{name:"PAGE_SYM",text:"@page"},{name:"MEDIA_SYM",text:"@media"},{name:"FONT_FACE_SYM",text:"@font-face"},{name:"CHARSET_SYM",text:"@charset"},{name:"NAMESPACE_SYM",text:"@namespace"},{name:"VIEWPORT_SYM",text:"@viewport"},{name:"UNKNOWN_SYM"},{name:"KEYFRAMES_SYM",text:["@keyframes","@-webkit-keyframes","@-moz-keyframes","@-o-keyframes"]},{name:"IMPORTANT_SYM"},{name:"LENGTH"},{name:"ANGLE"},{name:"TIME"},{name:"FREQ"},{name:"DIMENSION"},
{name:"PERCENTAGE"},{name:"NUMBER"},{name:"URI"},{name:"FUNCTION"},{name:"UNICODE_RANGE"},{name:"INVALID"},{name:"PLUS",text:"+"},{name:"GREATER",text:"\x3e"},{name:"COMMA",text:","},{name:"TILDE",text:"~"},{name:"NOT"},{name:"TOPLEFTCORNER_SYM",text:"@top-left-corner"},{name:"TOPLEFT_SYM",text:"@top-left"},{name:"TOPCENTER_SYM",text:"@top-center"},{name:"TOPRIGHT_SYM",text:"@top-right"},{name:"TOPRIGHTCORNER_SYM",text:"@top-right-corner"},{name:"BOTTOMLEFTCORNER_SYM",text:"@bottom-left-corner"},
{name:"BOTTOMLEFT_SYM",text:"@bottom-left"},{name:"BOTTOMCENTER_SYM",text:"@bottom-center"},{name:"BOTTOMRIGHT_SYM",text:"@bottom-right"},{name:"BOTTOMRIGHTCORNER_SYM",text:"@bottom-right-corner"},{name:"LEFTTOP_SYM",text:"@left-top"},{name:"LEFTMIDDLE_SYM",text:"@left-middle"},{name:"LEFTBOTTOM_SYM",text:"@left-bottom"},{name:"RIGHTTOP_SYM",text:"@right-top"},{name:"RIGHTMIDDLE_SYM",text:"@right-middle"},{name:"RIGHTBOTTOM_SYM",text:"@right-bottom"},{name:"RESOLUTION",state:"media"},{name:"IE_FUNCTION"},
{name:"CHAR"},{name:"PIPE",text:"|"},{name:"SLASH",text:"/"},{name:"MINUS",text:"-"},{name:"STAR",text:"*"},{name:"LBRACE",text:"{"},{name:"RBRACE",text:"}"},{name:"LBRACKET",text:"["},{name:"RBRACKET",text:"]"},{name:"EQUALS",text:"\x3d"},{name:"COLON",text:":"},{name:"SEMICOLON",text:";"},{name:"LPAREN",text:"("},{name:"RPAREN",text:")"},{name:"DOT",text:"."}];(function(){var a=[],b={};t.UNKNOWN=-1;t.unshift({name:"EOF"});for(var c=0,d=t.length;c<d;c++)if(a.push(t[c].name),t[t[c].name]=c,t[c].text)if(t[c].text instanceof
Array)for(var e=0;e<t[c].text.length;e++)b[t[c].text[e]]=c;else b[t[c].text]=c;t.name=function(b){return a[b]};t.type=function(a){return b[a]||-1}})();var N={validate:function(b,c){var d=b.toString().toLowerCase(),e=new a(c),f=P[d];if(f)"number"!=typeof f&&("string"==typeof f?-1<f.indexOf("||")?this.groupProperty(f,e):this.singleProperty(f,e,1):f.multi?this.multiProperty(f.multi,e,f.comma,f.max||Infinity):"function"==typeof f&&f(e));else if(0!==d.indexOf("-"))throw new z("Unknown property '"+b+"'.",
b.line,b.col);},singleProperty:function(a,b,c,d){d=!1;for(var e=b.value,f=0;b.hasNext()&&f<c;){d=G.isAny(b,a);if(!d)break;f++}if(d){if(b.hasNext())throw a=b.next(),new z("Expected end of value but found '"+a+"'.",a.line,a.col);}else{if(b.hasNext()&&!b.isFirst())throw a=b.peek(),new z("Expected end of value but found '"+a+"'.",a.line,a.col);throw new z("Expected ("+a+") but found '"+e+"'.",e.line,e.col);}},multiProperty:function(a,b,c,d){for(var e=!1,f=b.value,k=0;b.hasNext()&&!e&&k<d;)if(G.isAny(b,
a))if(k++,b.hasNext()){if(c)if(","==b.peek())b.next();else break}else e=!0;else break;if(e){if(b.hasNext())throw b=b.next(),new z("Expected end of value but found '"+b+"'.",b.line,b.col);}else{if(b.hasNext()&&!b.isFirst())throw b=b.peek(),new z("Expected end of value but found '"+b+"'.",b.line,b.col);b=b.previous();if(c&&","==b)throw new z("Expected end of value but found '"+b+"'.",b.line,b.col);throw new z("Expected ("+a+") but found '"+f+"'.",f.line,f.col);}},groupProperty:function(a,b,c){c=!1;
for(var d=b.value,e=a.split("||").length,f={count:0},k=!1,g;b.hasNext()&&!c;)if(g=G.isAnyOfGroup(b,a))if(f[g])break;else{if(f[g]=1,f.count++,k=!0,f.count==e||!b.hasNext())c=!0}else break;if(c){if(b.hasNext())throw a=b.next(),new z("Expected end of value but found '"+a+"'.",a.line,a.col);}else{if(k&&b.hasNext())throw a=b.peek(),new z("Expected end of value but found '"+a+"'.",a.line,a.col);throw new z("Expected ("+a+") but found '"+d+"'.",d.line,d.col);}}};z.prototype=Error();var G={isLiteral:function(a,
b){var c=a.text.toString().toLowerCase(),d=b.split(" | "),e,f,k=!1;e=0;for(f=d.length;e<f&&!k;e++)c==d[e].toLowerCase()&&(k=!0);return k},isSimple:function(a){return!!this.simple[a]},isComplex:function(a){return!!this.complex[a]},isAny:function(a,b){var c=b.split(" | "),d,e,f=!1;d=0;for(e=c.length;d<e&&!f&&a.hasNext();d++)f=this.isType(a,c[d]);return f},isAnyOfGroup:function(a,b){var c=b.split(" || "),d,e,f=!1;d=0;for(e=c.length;d<e&&!f;d++)f=this.isType(a,c[d]);return f?c[d-1]:!1},isType:function(a,
b){var c=a.peek(),d=!1;"\x3c"!=b.charAt(0)?(d=this.isLiteral(c,b))&&a.next():this.simple[b]?(d=this.simple[b](c))&&a.next():d=this.complex[b](a);return d},simple:{"\x3cabsolute-size\x3e":function(a){return G.isLiteral(a,"xx-small | x-small | small | medium | large | x-large | xx-large")},"\x3cattachment\x3e":function(a){return G.isLiteral(a,"scroll | fixed | local")},"\x3cattr\x3e":function(a){return"function"==a.type&&"attr"==a.name},"\x3cbg-image\x3e":function(a){return this["\x3cimage\x3e"](a)||
this["\x3cgradient\x3e"](a)||"none"==a},"\x3cgradient\x3e":function(a){return"function"==a.type&&/^(?:\-(?:ms|moz|o|webkit)\-)?(?:repeating\-)?(?:radial\-|linear\-)?gradient/i.test(a)},"\x3cbox\x3e":function(a){return G.isLiteral(a,"padding-box | border-box | content-box")},"\x3ccontent\x3e":function(a){return"function"==a.type&&"content"==a.name},"\x3crelative-size\x3e":function(a){return G.isLiteral(a,"smaller | larger")},"\x3cident\x3e":function(a){return"identifier"==a.type},"\x3clength\x3e":function(a){return"function"==
a.type&&/^(?:\-(?:ms|moz|o|webkit)\-)?calc/i.test(a)?!0:"length"==a.type||"number"==a.type||"integer"==a.type||"0"==a},"\x3ccolor\x3e":function(a){return"color"==a.type||"transparent"==a},"\x3cnumber\x3e":function(a){return"number"==a.type||this["\x3cinteger\x3e"](a)},"\x3cinteger\x3e":function(a){return"integer"==a.type},"\x3cline\x3e":function(a){return"integer"==a.type},"\x3cangle\x3e":function(a){return"angle"==a.type},"\x3curi\x3e":function(a){return"uri"==a.type},"\x3cimage\x3e":function(a){return this["\x3curi\x3e"](a)},
"\x3cpercentage\x3e":function(a){return"percentage"==a.type||"0"==a},"\x3cborder-width\x3e":function(a){return this["\x3clength\x3e"](a)||G.isLiteral(a,"thin | medium | thick")},"\x3cborder-style\x3e":function(a){return G.isLiteral(a,"none | hidden | dotted | dashed | solid | double | groove | ridge | inset | outset")},"\x3cmargin-width\x3e":function(a){return this["\x3clength\x3e"](a)||this["\x3cpercentage\x3e"](a)||G.isLiteral(a,"auto")},"\x3cpadding-width\x3e":function(a){return this["\x3clength\x3e"](a)||
this["\x3cpercentage\x3e"](a)},"\x3cshape\x3e":function(a){return"function"==a.type&&("rect"==a.name||"inset-rect"==a.name)},"\x3ctime\x3e":function(a){return"time"==a.type}},complex:{"\x3cbg-position\x3e":function(a){for(var b=!1,c=0;a.peek(c)&&","!=a.peek(c);)c++;3>c?G.isAny(a,"left | right | center | \x3cpercentage\x3e | \x3clength\x3e")?(b=!0,G.isAny(a,"top | bottom | center | \x3cpercentage\x3e | \x3clength\x3e")):G.isAny(a,"top | bottom")&&(b=!0,G.isAny(a,"left | right | center")):G.isAny(a,
"left | right")?G.isAny(a,"top | bottom")?(b=!0,G.isAny(a,"\x3cpercentage\x3e | \x3clength\x3e")):G.isAny(a,"\x3cpercentage\x3e | \x3clength\x3e")&&(G.isAny(a,"top | bottom")?(b=!0,G.isAny(a,"\x3cpercentage\x3e | \x3clength\x3e")):G.isAny(a,"center")&&(b=!0)):G.isAny(a,"top | bottom")?G.isAny(a,"left | right")?(b=!0,G.isAny(a,"\x3cpercentage\x3e | \x3clength\x3e")):G.isAny(a,"\x3cpercentage\x3e | \x3clength\x3e")&&(G.isAny(a,"left | right")?(b=!0,G.isAny(a,"\x3cpercentage\x3e | \x3clength\x3e")):
G.isAny(a,"center")&&(b=!0)):G.isAny(a,"center")&&G.isAny(a,"left | right | top | bottom")&&(b=!0,G.isAny(a,"\x3cpercentage\x3e | \x3clength\x3e"));return b},"\x3cbg-size\x3e":function(a){var b=!1;G.isAny(a,"cover | contain")?b=!0:G.isAny(a,"\x3cpercentage\x3e | \x3clength\x3e | auto")&&(b=!0,G.isAny(a,"\x3cpercentage\x3e | \x3clength\x3e | auto"));return b},"\x3crepeat-style\x3e":function(a){var b=!1,c;a.hasNext()&&(c=a.next(),G.isLiteral(c,"repeat-x | repeat-y")?b=!0:G.isLiteral(c,"repeat | space | round | no-repeat")&&
(b=!0,a.hasNext()&&G.isLiteral(a.peek(),"repeat | space | round | no-repeat")&&a.next()));return b},"\x3cshadow\x3e":function(a){var b=!1,c=0,d=!1,e=!1;if(a.hasNext()){G.isAny(a,"inset")&&(d=!0);for(G.isAny(a,"\x3ccolor\x3e")&&(e=!0);G.isAny(a,"\x3clength\x3e")&&4>c;)c++;a.hasNext()&&(e||G.isAny(a,"\x3ccolor\x3e"),d||G.isAny(a,"inset"));b=2<=c&&4>=c}return b},"\x3cx-one-radius\x3e":function(a){var b=!1;G.isAny(a,"\x3clength\x3e | \x3cpercentage\x3e | inherit")&&(b=!0,G.isAny(a,"\x3clength\x3e | \x3cpercentage\x3e | inherit"));
return b}}};p.css={Colors:H,Combinator:c,Parser:g,PropertyName:l,PropertyValue:b,PropertyValuePart:k,MediaFeature:f,MediaQuery:e,Selector:d,SelectorPart:h,SelectorSubPart:n,Specificity:m,TokenStream:C,Tokens:t,ValidationError:z}})();(function(){for(var c in p)m[c]=p[c]})();var h=function(){function c(b,a){var c,d=b&&b.match(g);if(d=d&&d[1])c={"true":2,"":1,"false":0,2:2,1:1,0:0},d.toLowerCase().split(",").forEach(function(b){b=b.split(":");var d=b[1]||"";a[(b[0]||"").trim()]=c[d.trim()]});return a}
var f=[],e=[],g=/\/\*\s*csslint([^\*]*)\*\//,l=new p.util.EventTarget;l.version="0.10.0";l.addRule=function(b){f.push(b);f[b.id]=b};l.clearRules=function(){f=[]};l.getRules=function(){return[].concat(f).sort(function(b,a){return b.id>a.id?1:0})};l.getRuleset=function(){for(var b={},a=0,c=f.length;a<c;)b[f[a++].id]=1;return b};l.addFormatter=function(b){e[b.id]=b};l.getFormatter=function(b){return e[b]};l.format=function(b,a,c,d){c=this.getFormatter(c);var e=null;c&&(e=c.startFormat(),e+=c.formatResults(b,
a,d||{}),e+=c.endFormat());return e};l.hasFormat=function(b){return e.hasOwnProperty(b)};l.verify=function(b,a){var e=0,d,l=new p.css.Parser({starHack:!0,ieFilters:!0,underscoreHack:!0,strict:!1});d=b.replace(/\n\r?/g,"$split$").split("$split$");a||(a=this.getRuleset());g.test(b)&&(a=c(b,a));d=new s(d,a);a.errors=2;for(e in a)a.hasOwnProperty(e)&&a[e]&&f[e]&&f[e].init(l,d);try{l.parse(b)}catch(n){d.error("Fatal error, cannot continue: "+n.message,n.line,n.col,{})}e={messages:d.messages,stats:d.stats,
ruleset:d.ruleset,tokens:l._tokenStream&&l._tokenStream.tokens?l._tokenStream.tokens:[],ast:l.ast};e.messages.sort(function(a,b){return a.rollup&&!b.rollup?1:!a.rollup&&b.rollup?-1:a.line-b.line});return e};return l}();s.prototype={constructor:s,error:function(c,f,e,g){this.messages.push({type:"error",line:f,col:e,message:c,evidence:this.lines[f-1],rule:g||{}})},warn:function(c,f,e,g){this.report(c,f,e,g)},report:function(c,f,e,g){this.messages.push({type:2==this.ruleset[g.id]?"error":"warning",line:f,
col:e,message:c,evidence:this.lines[f-1],rule:g})},info:function(c,f,e,g){this.messages.push({type:"info",line:f,col:e,message:c,evidence:this.lines[f-1],rule:g})},rollupError:function(c,f){this.messages.push({type:"error",rollup:!0,message:c,rule:f})},rollupWarn:function(c,f){this.messages.push({type:"warning",rollup:!0,message:c,rule:f})},stat:function(c,f){this.stats[c]=f}};h._Reporter=s;h.Colors=p.util.Colors;h.Util={mix:function(c,f){for(var e in f)f.hasOwnProperty(e)&&(c[e]=f[e]);return e},
indexOf:function(c,f){if(c.indexOf)return c.indexOf(f);for(var e=0,g=c.length;e<g;e++)if(c[e]===f)return e;return-1},forEach:function(c,f){if(c.forEach)return c.forEach(f);for(var e=0,g=c.length;e<g;e++)f(c[e],e,c)}};h.addRule({id:"adjoining-classes",name:"Disallow adjoining classes",desc:"Don't use adjoining classes.",browsers:"IE6",init:function(c,f){var e=this;c.addListener("startrule",function(g){g=g.selectors;var l,b,a,k,d,h,n;for(d=0;d<g.length;d++){l=g[d];for(h=0;h<l.parts.length;h++)if(b=
l.parts[h],b.type==c.SELECTOR_PART_TYPE)for(n=k=0;n<b.modifiers.length;n++)a=b.modifiers[n],"class"==a.type&&k++,1<k&&f.report("Don't use adjoining classes.",b.line,b.col,e)}})}});h.addRule({id:"box-model",name:"Beware of broken box size",desc:"Don't use width or height when using padding or border.",browsers:"All",init:function(c,f){function e(){k={};d=!1}function g(){var c,e;if(!d){if(k.height)for(c in a)a.hasOwnProperty(c)&&k[c]&&(e=k[c].value,"padding"==c&&2===e.parts.length&&0===e.parts[0].value||
f.report("Using height with "+c+" can sometimes make elements larger than you expect.",k[c].line,k[c].col,l));if(k.width)for(c in b)b.hasOwnProperty(c)&&k[c]&&(e=k[c].value,"padding"==c&&2===e.parts.length&&0===e.parts[1].value||f.report("Using width with "+c+" can sometimes make elements larger than you expect.",k[c].line,k[c].col,l))}}var l=this,b={border:1,"border-left":1,"border-right":1,padding:1,"padding-left":1,"padding-right":1},a={border:1,"border-bottom":1,"border-top":1,padding:1,"padding-bottom":1,
"padding-top":1},k,d=!1;c.addListener("startrule",e);c.addListener("startfontface",e);c.addListener("startpage",e);c.addListener("startpagemargin",e);c.addListener("startkeyframerule",e);c.addListener("property",function(c){var e=c.property.text.toLowerCase();a[e]||b[e]?!/^0\S*$/.test(c.value)&&!("border"==e&&"none"==c.value)&&(k[e]={line:c.property.line,col:c.property.col,value:c.value}):/^(width|height)/i.test(e)&&/^(length|percentage)/.test(c.value.parts[0].type)?k[e]=1:"box-sizing"==e&&(d=!0)});
c.addListener("endrule",g);c.addListener("endfontface",g);c.addListener("endpage",g);c.addListener("endpagemargin",g);c.addListener("endkeyframerule",g)}});h.addRule({id:"box-sizing",name:"Disallow use of box-sizing",desc:"The box-sizing properties isn't supported in IE6 and IE7.",browsers:"IE6, IE7",tags:["Compatibility"],init:function(c,f){var e=this;c.addListener("property",function(c){"box-sizing"==c.property.text.toLowerCase()&&f.report("The box-sizing property isn't supported in IE6 and IE7.",
c.line,c.col,e)})}});h.addRule({id:"bulletproof-font-face",name:"Use the bulletproof @font-face syntax",desc:"Use the bulletproof @font-face syntax to avoid 404's in old IE (http://www.fontspring.com/blog/the-new-bulletproof-font-face-syntax).",browsers:"All",init:function(c,f){var e=this,g=!1,l=!0,b=!1,a,k;c.addListener("startfontface",function(a){g=!0});c.addListener("property",function(c){if(g){var e=c.property.toString().toLowerCase(),f=c.value.toString();a=c.line;k=c.col;"src"===e&&(c=/^\s?url\(['"].+\.eot\?.*['"]\)\s*format\(['"]embedded-opentype['"]\).*$/i,
!f.match(c)&&l?(b=!0,l=!1):f.match(c)&&!l&&(b=!1))}});c.addListener("endfontface",function(c){g=!1;b&&f.report("@font-face declaration doesn't follow the fontspring bulletproof syntax.",a,k,e)})}});h.addRule({id:"compatible-vendor-prefixes",name:"Require compatible vendor prefixes",desc:"Include all compatible vendor prefixes to reach a wider range of users.",browsers:"All",init:function(c,f){var e=this,g,l,b,a,k,d,r,n=!1,m=Array.prototype.push,q=[];g={animation:"webkit moz","animation-delay":"webkit moz",
"animation-direction":"webkit moz","animation-duration":"webkit moz","animation-fill-mode":"webkit moz","animation-iteration-count":"webkit moz","animation-name":"webkit moz","animation-play-state":"webkit moz","animation-timing-function":"webkit moz",appearance:"webkit moz","border-end":"webkit moz","border-end-color":"webkit moz","border-end-style":"webkit moz","border-end-width":"webkit moz","border-image":"webkit moz o","border-radius":"webkit","border-start":"webkit moz","border-start-color":"webkit moz",
"border-start-style":"webkit moz","border-start-width":"webkit moz","box-align":"webkit moz ms","box-direction":"webkit moz ms","box-flex":"webkit moz ms","box-lines":"webkit ms","box-ordinal-group":"webkit moz ms","box-orient":"webkit moz ms","box-pack":"webkit moz ms","box-sizing":"webkit moz","box-shadow":"webkit moz","column-count":"webkit moz ms","column-gap":"webkit moz ms","column-rule":"webkit moz ms","column-rule-color":"webkit moz ms","column-rule-style":"webkit moz ms","column-rule-width":"webkit moz ms",
"column-width":"webkit moz ms",hyphens:"epub moz","line-break":"webkit ms","margin-end":"webkit moz","margin-start":"webkit moz","marquee-speed":"webkit wap","marquee-style":"webkit wap","padding-end":"webkit moz","padding-start":"webkit moz","tab-size":"moz o","text-size-adjust":"webkit ms",transform:"webkit moz ms o","transform-origin":"webkit moz ms o",transition:"webkit moz o","transition-delay":"webkit moz o","transition-duration":"webkit moz o","transition-property":"webkit moz o","transition-timing-function":"webkit moz o",
"user-modify":"webkit moz","user-select":"webkit moz ms","word-break":"epub ms","writing-mode":"epub ms"};for(b in g)if(g.hasOwnProperty(b)){a=[];k=g[b].split(" ");d=0;for(r=k.length;d<r;d++)a.push("-"+k[d]+"-"+b);g[b]=a;m.apply(q,a)}c.addListener("startrule",function(){l=[]});c.addListener("startkeyframes",function(a){n=a.prefix||!0});c.addListener("endkeyframes",function(a){n=!1});c.addListener("property",function(a){a=a.property;-1<h.Util.indexOf(q,a.text)&&(!n||"string"!=typeof n||0!==a.text.indexOf("-"+
n+"-"))&&l.push(a)});c.addListener("endrule",function(a){if(l.length){a={};var b,c,d,k,n,r,q,m;b=0;for(c=l.length;b<c;b++)for(k in d=l[b],g)g.hasOwnProperty(k)&&(n=g[k],-1<h.Util.indexOf(n,d.text)&&(a[k]||(a[k]={full:n.slice(0),actual:[],actualNodes:[]}),-1===h.Util.indexOf(a[k].actual,d.text)&&(a[k].actual.push(d.text),a[k].actualNodes.push(d))));for(k in a)if(a.hasOwnProperty(k)&&(d=a[k],n=d.full,r=d.actual,n.length>r.length)){b=0;for(c=n.length;b<c;b++)q=n[b],-1===h.Util.indexOf(r,q)&&(m=1===r.length?
r[0]:2==r.length?r.join(" and "):r.join(", "),f.report("The property "+q+" is compatible with "+m+" and should be included as well.",d.actualNodes[0].line,d.actualNodes[0].col,e))}}})}});h.addRule({id:"display-property-grouping",name:"Require properties appropriate for display",desc:"Certain properties shouldn't be used with certain display property values.",browsers:"All",init:function(c,f){function e(c,e,g){if(k[c]&&("string"!=typeof a[c]||k[c].value.toLowerCase()!=a[c]))f.report(g||c+" can't be used with display: "+
e+".",k[c].line,k[c].col,b)}function g(){k={}}function l(){var a=k.display?k.display.value:null;if(a)switch(a){case "inline":e("height",a);e("width",a);e("margin",a);e("margin-top",a);e("margin-bottom",a);e("float",a,"display:inline has no effect on floated elements (but may be used to fix the IE6 double-margin bug).");break;case "block":e("vertical-align",a);break;case "inline-block":e("float",a);break;default:0===a.indexOf("table-")&&(e("margin",a),e("margin-left",a),e("margin-right",a),e("margin-top",
a),e("margin-bottom",a),e("float",a))}}var b=this,a={display:1,"float":"none",height:1,width:1,margin:1,"margin-left":1,"margin-right":1,"margin-bottom":1,"margin-top":1,padding:1,"padding-left":1,"padding-right":1,"padding-bottom":1,"padding-top":1,"vertical-align":1},k;c.addListener("startrule",g);c.addListener("startfontface",g);c.addListener("startkeyframerule",g);c.addListener("startpagemargin",g);c.addListener("startpage",g);c.addListener("property",function(b){var c=b.property.text.toLowerCase();
a[c]&&(k[c]={value:b.value.text,line:b.property.line,col:b.property.col})});c.addListener("endrule",l);c.addListener("endfontface",l);c.addListener("endkeyframerule",l);c.addListener("endpagemargin",l);c.addListener("endpage",l)}});h.addRule({id:"duplicate-background-images",name:"Disallow duplicate background images",desc:"Every background-image should be unique. Use a common class for e.g. sprites.",browsers:"All",init:function(c,f){var e=this,g={};c.addListener("property",function(c){var b=c.value,
a,k;if(c.property.text.match(/background/i)){a=0;for(k=b.parts.length;a<k;a++)"uri"==b.parts[a].type&&("undefined"===typeof g[b.parts[a].uri]?g[b.parts[a].uri]=c:f.report("Background image '"+b.parts[a].uri+"' was used multiple times, first declared at line "+g[b.parts[a].uri].line+", col "+g[b.parts[a].uri].col+".",c.line,c.col,e))}})}});h.addRule({id:"duplicate-properties",name:"Disallow duplicate properties",desc:"Duplicate properties must appear one after the other.",browsers:"All",init:function(c,
f){function e(a){l={}}var g=this,l,b;c.addListener("startrule",e);c.addListener("startfontface",e);c.addListener("startpage",e);c.addListener("startpagemargin",e);c.addListener("startkeyframerule",e);c.addListener("property",function(a){var c=a.property.text.toLowerCase();l[c]&&(b!=c||l[c]==a.value.text)&&f.report("Duplicate property '"+a.property+"' found.",a.line,a.col,g);l[c]=a.value.text;b=c})}});h.addRule({id:"empty-rules",name:"Disallow empty rules",desc:"Rules without any properties specified should be removed.",
browsers:"All",init:function(c,f){var e=this,g=0;c.addListener("startrule",function(){g=0});c.addListener("property",function(){g++});c.addListener("endrule",function(c){c=c.selectors;0===g&&f.report("Rule is empty.",c[0].line,c[0].col,e)})}});h.addRule({id:"errors",name:"Parsing Errors",desc:"This rule looks for recoverable syntax errors.",browsers:"All",init:function(c,f){var e=this;c.addListener("error",function(c){f.error(c.message,c.line,c.col,e)})}});h.addRule({id:"fallback-colors",name:"Require fallback colors",
desc:"For older browsers that don't support RGBA, HSL, or HSLA, provide a fallback color.",browsers:"IE6,IE7,IE8",init:function(c,f){function e(a){l=null}var g=this,l,b={color:1,background:1,"border-color":1,"border-top-color":1,"border-right-color":1,"border-bottom-color":1,"border-left-color":1,border:1,"border-top":1,"border-right":1,"border-bottom":1,"border-left":1,"background-color":1};c.addListener("startrule",e);c.addListener("startfontface",e);c.addListener("startpage",e);c.addListener("startpagemargin",
e);c.addListener("startkeyframerule",e);c.addListener("property",function(a){var c=a.property.text.toLowerCase(),d=a.value.parts,e=0,n="",h=d.length;if(b[c])for(;e<h;)"color"==d[e].type&&("alpha"in d[e]||"hue"in d[e]?(/([^\)]+)\(/.test(d[e])&&(n=RegExp.$1.toUpperCase()),(!l||l.property.text.toLowerCase()!=c||"compat"!=l.colorType)&&f.report("Fallback "+c+" (hex or RGB) should precede "+n+" "+c+".",a.line,a.col,g)):a.colorType="compat"),e++;l=a})}});h.addRule({id:"floats",name:"Disallow too many floats",
desc:"This rule tests if the float property is used too many times",browsers:"All",init:function(c,f){var e=this,g=0;c.addListener("property",function(c){"float"==c.property.text.toLowerCase()&&"none"!=c.value.text.toLowerCase()&&g++});c.addListener("endstylesheet",function(){f.stat("floats",g);10<=g&&f.rollupWarn("Too many floats ("+g+"), you're probably using them for layout. Consider using a grid system instead.",e)})}});h.addRule({id:"font-faces",name:"Don't use too many web fonts",desc:"Too many different web fonts in the same stylesheet.",
browsers:"All",init:function(c,f){var e=this,g=0;c.addListener("startfontface",function(){g++});c.addListener("endstylesheet",function(){5<g&&f.rollupWarn("Too many @font-face declarations ("+g+").",e)})}});h.addRule({id:"font-sizes",name:"Disallow too many font sizes",desc:"Checks the number of font-size declarations.",browsers:"All",init:function(c,f){var e=this,g=0;c.addListener("property",function(c){"font-size"==c.property&&g++});c.addListener("endstylesheet",function(){f.stat("font-sizes",g);
10<=g&&f.rollupWarn("Too many font-size declarations ("+g+"), abstraction needed.",e)})}});h.addRule({id:"gradients",name:"Require all gradient definitions",desc:"When using a vendor-prefixed gradient, make sure to use them all.",browsers:"All",init:function(c,f){var e=this,g;c.addListener("startrule",function(){g={moz:0,webkit:0,oldWebkit:0,o:0}});c.addListener("property",function(c){/\-(moz|o|webkit)(?:\-(?:linear|radial))\-gradient/i.test(c.value)?g[RegExp.$1]=1:/\-webkit\-gradient/i.test(c.value)&&
(g.oldWebkit=1)});c.addListener("endrule",function(c){var b=[];g.moz||b.push("Firefox 3.6+");g.webkit||b.push("Webkit (Safari 5+, Chrome)");g.oldWebkit||b.push("Old Webkit (Safari 4+, Chrome)");g.o||b.push("Opera 11.1+");b.length&&4>b.length&&f.report("Missing vendor-prefixed CSS gradients for "+b.join(", ")+".",c.selectors[0].line,c.selectors[0].col,e)})}});h.addRule({id:"ids",name:"Disallow IDs in selectors",desc:"Selectors should not contain IDs.",browsers:"All",init:function(c,f){var e=this;c.addListener("startrule",
function(g){g=g.selectors;var l,b,a,k,d,h,n;for(d=0;d<g.length;d++){l=g[d];for(h=k=0;h<l.parts.length;h++)if(b=l.parts[h],b.type==c.SELECTOR_PART_TYPE)for(n=0;n<b.modifiers.length;n++)a=b.modifiers[n],"id"==a.type&&k++;1==k?f.report("Don't use IDs in selectors.",l.line,l.col,e):1<k&&f.report(k+" IDs in the selector, really?",l.line,l.col,e)}})}});h.addRule({id:"import",name:"Disallow @import",desc:"Don't use @import, use \x3clink\x3e instead.",browsers:"All",init:function(c,f){var e=this;c.addListener("import",
function(c){f.report("@import prevents parallel downloads, use \x3clink\x3e instead.",c.line,c.col,e)})}});h.addRule({id:"important",name:"Disallow !important",desc:"Be careful when using !important declaration",browsers:"All",init:function(c,f){var e=this,g=0;c.addListener("property",function(c){!0===c.important&&(g++,f.report("Use of !important",c.line,c.col,e))});c.addListener("endstylesheet",function(){f.stat("important",g);10<=g&&f.rollupWarn("Too many !important declarations ("+g+"), try to use less than 10 to avoid specificity issues.",
e)})}});h.addRule({id:"known-properties",name:"Require use of known properties",desc:"Properties should be known (listed in CSS3 specification) or be a vendor-prefixed property.",browsers:"All",init:function(c,f){var e=this;c.addListener("property",function(c){c.property.text.toLowerCase();c.invalid&&f.report(c.invalid.message,c.line,c.col,e)})}});h.addRule({id:"outline-none",name:"Disallow outline: none",desc:"Use of outline: none or outline: 0 should be limited to :focus rules.",browsers:"All",
tags:["Accessibility"],init:function(c,f){function e(a){b=a.selectors?{line:a.line,col:a.col,selectors:a.selectors,propCount:0,outline:!1}:null}function g(a){b&&b.outline&&(-1==b.selectors.toString().toLowerCase().indexOf(":focus")?f.report("Outlines should only be modified using :focus.",b.line,b.col,l):1==b.propCount&&f.report("Outlines shouldn't be hidden unless other visual changes are made.",b.line,b.col,l))}var l=this,b;c.addListener("startrule",e);c.addListener("startfontface",e);c.addListener("startpage",
e);c.addListener("startpagemargin",e);c.addListener("startkeyframerule",e);c.addListener("property",function(a){var c=a.property.text.toLowerCase();a=a.value;if(b&&(b.propCount++,"outline"==c&&("none"==a||"0"==a)))b.outline=!0});c.addListener("endrule",g);c.addListener("endfontface",g);c.addListener("endpage",g);c.addListener("endpagemargin",g);c.addListener("endkeyframerule",g)}});h.addRule({id:"overqualified-elements",name:"Disallow overqualified elements",desc:"Don't use classes or IDs with elements (a.foo or a#foo).",
browsers:"All",init:function(c,f){var e=this,g={};c.addListener("startrule",function(l){l=l.selectors;var b,a,k,d,h,n;for(d=0;d<l.length;d++){b=l[d];for(h=0;h<b.parts.length;h++)if(a=b.parts[h],a.type==c.SELECTOR_PART_TYPE)for(n=0;n<a.modifiers.length;n++)k=a.modifiers[n],a.elementName&&"id"==k.type?f.report("Element ("+a+") is overqualified, just use "+k+" without element name.",a.line,a.col,e):"class"==k.type&&(g[k]||(g[k]=[]),g[k].push({modifier:k,part:a}))}});c.addListener("endstylesheet",function(){for(var c in g)g.hasOwnProperty(c)&&
1==g[c].length&&g[c][0].part.elementName&&f.report("Element ("+g[c][0].part+") is overqualified, just use "+g[c][0].modifier+" without element name.",g[c][0].part.line,g[c][0].part.col,e)})}});h.addRule({id:"qualified-headings",name:"Disallow qualified headings",desc:"Headings should not be qualified (namespaced).",browsers:"All",init:function(c,f){var e=this;c.addListener("startrule",function(g){g=g.selectors;var l,b,a,k;for(a=0;a<g.length;a++){l=g[a];for(k=0;k<l.parts.length;k++)b=l.parts[k],b.type==
c.SELECTOR_PART_TYPE&&b.elementName&&(/h[1-6]/.test(b.elementName.toString())&&0<k)&&f.report("Heading ("+b.elementName+") should not be qualified.",b.line,b.col,e)}})}});h.addRule({id:"regex-selectors",name:"Disallow selectors that look like regexs",desc:"Selectors that look like regular expressions are slow and should be avoided.",browsers:"All",init:function(c,f){var e=this;c.addListener("startrule",function(g){g=g.selectors;var l,b,a,k,d,h;for(k=0;k<g.length;k++){l=g[k];for(d=0;d<l.parts.length;d++)if(b=
l.parts[d],b.type==c.SELECTOR_PART_TYPE)for(h=0;h<b.modifiers.length;h++)a=b.modifiers[h],"attribute"==a.type&&/([\~\|\^\$\*]=)/.test(a)&&f.report("Attribute selectors with "+RegExp.$1+" are slow!",a.line,a.col,e)}})}});h.addRule({id:"rules-count",name:"Rules Count",desc:"Track how many rules there are.",browsers:"All",init:function(c,f){var e=0;c.addListener("startrule",function(){e++});c.addListener("endstylesheet",function(){f.stat("rule-count",e)})}});h.addRule({id:"selector-max-approaching",
name:"Warn when approaching the 4095 selector limit for IE",desc:"Will warn when selector count is \x3e\x3d 3800 selectors.",browsers:"IE",init:function(c,f){var e=this,g=0;c.addListener("startrule",function(c){g+=c.selectors.length});c.addListener("endstylesheet",function(){3800<=g&&f.report("You have "+g+" selectors. Internet Explorer supports a maximum of 4095 selectors per stylesheet. Consider refactoring.",0,0,e)})}});h.addRule({id:"selector-max",name:"Error when past the 4095 selector limit for IE",
desc:"Will error when selector count is \x3e 4095.",browsers:"IE",init:function(c,f){var e=this,g=0;c.addListener("startrule",function(c){g+=c.selectors.length});c.addListener("endstylesheet",function(){4095<g&&f.report("You have "+g+" selectors. Internet Explorer supports a maximum of 4095 selectors per stylesheet. Consider refactoring.",0,0,e)})}});h.addRule({id:"shorthand",name:"Require shorthand properties",desc:"Use shorthand properties where possible.",browsers:"All",init:function(c,f){function e(a){h=
{}}function g(a){var b,c,d,e;for(b in n)if(n.hasOwnProperty(b)){c=e=0;for(d=n[b].length;c<d;c++)e+=h[n[b][c]]?1:0;e==n[b].length&&f.report("The properties "+n[b].join(", ")+" can be replaced by "+b+".",a.line,a.col,l)}}var l=this,b,a,k,d={},h,n={margin:["margin-top","margin-bottom","margin-left","margin-right"],padding:["padding-top","padding-bottom","padding-left","padding-right"]};for(b in n)if(n.hasOwnProperty(b)){a=0;for(k=n[b].length;a<k;a++)d[n[b][a]]=b}c.addListener("startrule",e);c.addListener("startfontface",
e);c.addListener("property",function(a){a=a.property.toString().toLowerCase();d[a]&&(h[a]=1)});c.addListener("endrule",g);c.addListener("endfontface",g)}});h.addRule({id:"star-property-hack",name:"Disallow properties with a star prefix",desc:"Checks for the star property hack (targets IE6/7)",browsers:"All",init:function(c,f){var e=this;c.addListener("property",function(c){"*"==c.property.hack&&f.report("Property with star prefix found.",c.property.line,c.property.col,e)})}});h.addRule({id:"text-indent",
name:"Disallow negative text-indent",desc:"Checks for text indent less than -99px",browsers:"All",init:function(c,f){function e(c){b=!1;a="inherit"}function g(c){b&&"ltr"!=a&&f.report("Negative text-indent doesn't work well with RTL. If you use text-indent for image replacement explicitly set direction for that item to ltr.",b.line,b.col,l)}var l=this,b,a;c.addListener("startrule",e);c.addListener("startfontface",e);c.addListener("property",function(c){var d=c.property.toString().toLowerCase(),e=
c.value;"text-indent"==d&&-99>e.parts[0].value?b=c.property:"direction"==d&&"ltr"==e&&(a="ltr")});c.addListener("endrule",g);c.addListener("endfontface",g)}});h.addRule({id:"underscore-property-hack",name:"Disallow properties with an underscore prefix",desc:"Checks for the underscore property hack (targets IE6)",browsers:"All",init:function(c,f){var e=this;c.addListener("property",function(c){"_"==c.property.hack&&f.report("Property with underscore prefix found.",c.property.line,c.property.col,e)})}});
h.addRule({id:"unique-headings",name:"Headings should only be defined once",desc:"Headings should be defined only once.",browsers:"All",init:function(c,f){var e=this,g={h1:0,h2:0,h3:0,h4:0,h5:0,h6:0};c.addListener("startrule",function(c){c=c.selectors;var b,a,k,d;for(k=0;k<c.length;k++)if(b=c[k],b=b.parts[b.parts.length-1],b.elementName&&/(h[1-6])/i.test(b.elementName.toString())){for(d=0;d<b.modifiers.length;d++)if("pseudo"==b.modifiers[d].type){a=!0;break}a||(g[RegExp.$1]++,1<g[RegExp.$1]&&f.report("Heading ("+
b.elementName+") has already been defined.",b.line,b.col,e))}});c.addListener("endstylesheet",function(c){var b;c=[];for(b in g)g.hasOwnProperty(b)&&1<g[b]&&c.push(g[b]+" "+b+"s");c.length&&f.rollupWarn("You have "+c.join(", ")+" defined in this stylesheet.",e)})}});h.addRule({id:"universal-selector",name:"Disallow universal selector",desc:"The universal selector (*) is known to be slow.",browsers:"All",init:function(c,f){var e=this;c.addListener("startrule",function(c){c=c.selectors;var l,b;for(b=
0;b<c.length;b++)l=c[b],l=l.parts[l.parts.length-1],"*"==l.elementName&&f.report(e.desc,l.line,l.col,e)})}});h.addRule({id:"unqualified-attributes",name:"Disallow unqualified attribute selectors",desc:"Unqualified attribute selectors are known to be slow.",browsers:"All",init:function(c,f){var e=this;c.addListener("startrule",function(g){g=g.selectors;var l,b,a,k;for(a=0;a<g.length;a++)if(l=g[a],l=l.parts[l.parts.length-1],l.type==c.SELECTOR_PART_TYPE)for(k=0;k<l.modifiers.length;k++)b=l.modifiers[k],
"attribute"==b.type&&(!l.elementName||"*"==l.elementName)&&f.report(e.desc,l.line,l.col,e)})}});h.addRule({id:"vendor-prefix",name:"Require standard property with vendor prefix",desc:"When using a vendor-prefixed property, make sure to include the standard one.",browsers:"All",init:function(c,f){function e(){b={};a=1}function g(a){var c,e,g,h;a=[];for(c in b)k[c]&&a.push({actual:c,needed:k[c]});c=0;for(e=a.length;c<e;c++)g=a[c].needed,h=a[c].actual,b[g]?b[g][0].pos<b[h][0].pos&&f.report("Standard property '"+
g+"' should come after vendor-prefixed property '"+h+"'.",b[h][0].name.line,b[h][0].name.col,l):f.report("Missing standard property '"+g+"' to go along with '"+h+"'.",b[h][0].name.line,b[h][0].name.col,l)}var l=this,b,a,k={"-webkit-border-radius":"border-radius","-webkit-border-top-left-radius":"border-top-left-radius","-webkit-border-top-right-radius":"border-top-right-radius","-webkit-border-bottom-left-radius":"border-bottom-left-radius","-webkit-border-bottom-right-radius":"border-bottom-right-radius",
"-o-border-radius":"border-radius","-o-border-top-left-radius":"border-top-left-radius","-o-border-top-right-radius":"border-top-right-radius","-o-border-bottom-left-radius":"border-bottom-left-radius","-o-border-bottom-right-radius":"border-bottom-right-radius","-moz-border-radius":"border-radius","-moz-border-radius-topleft":"border-top-left-radius","-moz-border-radius-topright":"border-top-right-radius","-moz-border-radius-bottomleft":"border-bottom-left-radius","-moz-border-radius-bottomright":"border-bottom-right-radius",
"-moz-column-count":"column-count","-webkit-column-count":"column-count","-moz-column-gap":"column-gap","-webkit-column-gap":"column-gap","-moz-column-rule":"column-rule","-webkit-column-rule":"column-rule","-moz-column-rule-style":"column-rule-style","-webkit-column-rule-style":"column-rule-style","-moz-column-rule-color":"column-rule-color","-webkit-column-rule-color":"column-rule-color","-moz-column-rule-width":"column-rule-width","-webkit-column-rule-width":"column-rule-width","-moz-column-width":"column-width",
"-webkit-column-width":"column-width","-webkit-column-span":"column-span","-webkit-columns":"columns","-moz-box-shadow":"box-shadow","-webkit-box-shadow":"box-shadow","-moz-transform":"transform","-webkit-transform":"transform","-o-transform":"transform","-ms-transform":"transform","-moz-transform-origin":"transform-origin","-webkit-transform-origin":"transform-origin","-o-transform-origin":"transform-origin","-ms-transform-origin":"transform-origin","-moz-box-sizing":"box-sizing","-webkit-box-sizing":"box-sizing",
"-moz-user-select":"user-select","-khtml-user-select":"user-select","-webkit-user-select":"user-select"};c.addListener("startrule",e);c.addListener("startfontface",e);c.addListener("startpage",e);c.addListener("startpagemargin",e);c.addListener("startkeyframerule",e);c.addListener("property",function(c){var e=c.property.text.toLowerCase();b[e]||(b[e]=[]);b[e].push({name:c.property,value:c.value,pos:a++})});c.addListener("endrule",g);c.addListener("endfontface",g);c.addListener("endpage",g);c.addListener("endpagemargin",
g);c.addListener("endkeyframerule",g)}});h.addRule({id:"zero-units",name:"Disallow units for 0 values",desc:"You don't need to specify units when a value is 0.",browsers:"All",init:function(c,f){var e=this;c.addListener("property",function(c){c=c.value.parts;for(var l=0,b=c.length;l<b;)(c[l].units||"percentage"==c[l].type)&&(0===c[l].value&&"time"!=c[l].type)&&f.report("Values of 0 shouldn't have units specified.",c[l].line,c[l].col,e),l++})}});(function(){var c=function(c){return!c||c.constructor!==
String?"":c.replace(/[\"&><]/g,function(c){switch(c){case '"':return"\x26quot;";case "\x26":return"\x26amp;";case "\x3c":return"\x26lt;";case "\x3e":return"\x26gt;"}})};h.addFormatter({id:"checkstyle-xml",name:"Checkstyle XML format",startFormat:function(){return'\x3c?xml version\x3d"1.0" encoding\x3d"utf-8"?\x3e\x3ccheckstyle\x3e'},endFormat:function(){return"\x3c/checkstyle\x3e"},readError:function(f,e){return'\x3cfile name\x3d"'+c(f)+'"\x3e\x3cerror line\x3d"0" column\x3d"0" severty\x3d"error" message\x3d"'+
c(e)+'"\x3e\x3c/error\x3e\x3c/file\x3e'},formatResults:function(f,e,g){f=f.messages;var l=[];0<f.length&&(l.push('\x3cfile name\x3d"'+e+'"\x3e'),h.Util.forEach(f,function(b,a){b.rollup||l.push('\x3cerror line\x3d"'+b.line+'" column\x3d"'+b.col+'" severity\x3d"'+b.type+'" message\x3d"'+c(b.message)+'" source\x3d"'+(!b.rule||!("name"in b.rule)?"":"net.csslint."+b.rule.name.replace(/\s/g,""))+'"/\x3e')}),l.push("\x3c/file\x3e"));return l.join("")}})})();h.addFormatter({id:"compact",name:"Compact, 'porcelain' format",
startFormat:function(){return""},endFormat:function(){return""},formatResults:function(c,f,e){c=c.messages;var g="";e=e||{};if(0===c.length)return e.quiet?"":f+": Lint Free!";h.Util.forEach(c,function(c,b){g=c.rollup?g+(f+": "+(c.type.charAt(0).toUpperCase()+c.type.slice(1))+" - "+c.message+"\n"):g+(f+": line "+c.line+", col "+c.col+", "+(c.type.charAt(0).toUpperCase()+c.type.slice(1))+" - "+c.message+"\n")});return g}});h.addFormatter({id:"csslint-xml",name:"CSSLint XML format",startFormat:function(){return'\x3c?xml version\x3d"1.0" encoding\x3d"utf-8"?\x3e\x3ccsslint\x3e'},
endFormat:function(){return"\x3c/csslint\x3e"},formatResults:function(c,f,e){c=c.messages;var g=[],l=function(b){return!b||b.constructor!==String?"":b.replace(/\"/g,"'").replace(/&/g,"\x26amp;").replace(/</g,"\x26lt;").replace(/>/g,"\x26gt;")};0<c.length&&(g.push('\x3cfile name\x3d"'+f+'"\x3e'),h.Util.forEach(c,function(b,a){b.rollup?g.push('\x3cissue severity\x3d"'+b.type+'" reason\x3d"'+l(b.message)+'" evidence\x3d"'+l(b.evidence)+'"/\x3e'):g.push('\x3cissue line\x3d"'+b.line+'" char\x3d"'+b.col+
'" severity\x3d"'+b.type+'" reason\x3d"'+l(b.message)+'" evidence\x3d"'+l(b.evidence)+'"/\x3e')}),g.push("\x3c/file\x3e"));return g.join("")}});h.addFormatter({id:"junit-xml",name:"JUNIT XML format",startFormat:function(){return'\x3c?xml version\x3d"1.0" encoding\x3d"utf-8"?\x3e\x3ctestsuites\x3e'},endFormat:function(){return"\x3c/testsuites\x3e"},formatResults:function(c,f,e){c=c.messages;var g=[],l={error:0,failure:0},b=function(a){return!a||a.constructor!==String?"":a.replace(/\"/g,"'").replace(/</g,
"\x26lt;").replace(/>/g,"\x26gt;")};0<c.length&&(c.forEach(function(a,c){var d="warning"===a.type?"error":a.type;a.rollup||(g.push('\x3ctestcase time\x3d"0" name\x3d"'+(!a.rule||!("name"in a.rule)?"":"net.csslint."+a.rule.name.replace(/\s/g,""))+'"\x3e'),g.push("\x3c"+d+' message\x3d"'+b(a.message)+'"\x3e\x3c![CDATA['+a.line+":"+a.col+":"+b(a.evidence)+"]]\x3e\x3c/"+d+"\x3e"),g.push("\x3c/testcase\x3e"),l[d]+=1)}),g.unshift('\x3ctestsuite time\x3d"0" tests\x3d"'+c.length+'" skipped\x3d"0" errors\x3d"'+
l.error+'" failures\x3d"'+l.failure+'" package\x3d"net.csslint" name\x3d"'+f+'"\x3e'),g.push("\x3c/testsuite\x3e"));return g.join("")}});h.addFormatter({id:"lint-xml",name:"Lint XML format",startFormat:function(){return'\x3c?xml version\x3d"1.0" encoding\x3d"utf-8"?\x3e\x3clint\x3e'},endFormat:function(){return"\x3c/lint\x3e"},formatResults:function(c,f,e){c=c.messages;var g=[],l=function(b){return!b||b.constructor!==String?"":b.replace(/\"/g,"'").replace(/&/g,"\x26amp;").replace(/</g,"\x26lt;").replace(/>/g,
"\x26gt;")};0<c.length&&(g.push('\x3cfile name\x3d"'+f+'"\x3e'),h.Util.forEach(c,function(b,a){b.rollup?g.push('\x3cissue severity\x3d"'+b.type+'" reason\x3d"'+l(b.message)+'" evidence\x3d"'+l(b.evidence)+'"/\x3e'):g.push('\x3cissue line\x3d"'+b.line+'" char\x3d"'+b.col+'" severity\x3d"'+b.type+'" reason\x3d"'+l(b.message)+'" evidence\x3d"'+l(b.evidence)+'"/\x3e')}),g.push("\x3c/file\x3e"));return g.join("")}});h.addFormatter({id:"text",name:"Plain Text",startFormat:function(){return""},endFormat:function(){return""},
formatResults:function(c,f,e){c=c.messages;var g="";e=e||{};if(0===c.length)return e.quiet?"":"\n\ncsslint: No errors in "+f+".";g="\n\ncsslint: There are "+c.length+" problems in "+f+".";e=f.lastIndexOf("/");var l=f;-1===e&&(e=f.lastIndexOf("\\"));-1<e&&(l=f.substring(e+1));h.Util.forEach(c,function(b,a){g=g+"\n\n"+l;b.rollup?(g+="\n"+(a+1)+": "+b.type,g+="\n"+b.message):(g+="\n"+(a+1)+": "+b.type+" at line "+b.line+", col "+b.col,g+="\n"+b.message,g+="\n"+b.evidence)});return g}});return h}()});
define("webtools/cssContentAssist","orion/editor/templates orion/editor/stylers/text_css/syntax orion/objects webtools/util javascript/compilationUnit csslint".split(" "),function(m,s,p,h,c,f){function e(a){return JSON.stringify(a).replace("}","\\}")}function g(a){this._resultManager=a}var l={type:"link",values:"visible hidden scroll auto no-display no-content".split(" ")},b={type:"link",values:"solid dashed dotted double groove ridge inset outset".split(" ")},a={type:"link",values:[]};a.values.push("0");
for(var k=1;10>k;k++)a.values.push(k.toString()+"px");f={type:"link",values:Object.keys(f.Colors)};for(var d=[{prefix:"rule",description:"rule - class selector rule",template:".${class} {\n\t${cursor}\n}"},{prefix:"rule",description:"rule - id selector rule",template:"#${id} {\n\t${cursor}\n}"},{prefix:"outline",description:"outline - outline style",template:"outline: ${color:"+e(f)+"} ${style:"+e(b)+"} ${width:"+e(a)+"};"},{prefix:"background-image",description:"background-image - image style",template:'background-image: url("${uri}");'},
{prefix:"url",description:"url - url image",template:'url("${uri}");'},{prefix:"rgb",description:"rgb - rgb color",template:"rgb(${red},${green},${blue});"},{prefix:"@import",description:"import - import style sheet",template:'@import "${uri}";'},{prefix:"csslint",description:"csslint - add embedded rule severity",template:"/*csslint ${:"+e({type:"link",values:"adjoining-classes box-model box-sizing bulletproof-font-face compatible-vendor-prefixes display-property-grouping duplicate-background-images duplicate-properties empty-rules fallback-colors floats font-faces font-sizes gradients ids import important known-properties outline-none overqualified-elements qualified-headings regex-selectors rules-count selector-max-approaching selector-max shorthand star-property-hack text-indent underscore-property-hack unique-headings universal-selector unqualified-attributes vendor-prefix zero-units".split(" ")})+
"}: ${a:"+e({type:"link",values:["false","true","0","1","2"]})+"} */"}],r=[{prop:"display",values:{type:"link",values:"none block box flex inline inline-block inline-flex inline-table list-item table table-caption table-cell table-column table-column-group table-footer-group table-header-group table-row table-row-group inherit".split(" ")}},{prop:"overflow",values:l},{prop:"overflow-x",values:l},{prop:"overflow-y",values:l},{prop:"float",values:{type:"link",values:["left","right","none","inherit"]}},
{prop:"position",values:{type:"link",values:["absolute","fixed","relative","static","inherit"]}},{prop:"cursor",values:{type:"link",values:"auto crosshair default e-resize help move n-resize ne-resize nw-resize pointer progress s-resize se-resize sw-resize text w-resize wait inherit".split(" ")}},{prop:"color",values:f},{prop:"border-top-color",values:f},{prop:"border-bottom-color",values:f},{prop:"border-right-color",values:f},{prop:"border-left-color",values:f},{prop:"background-color",values:f},
{prop:"font-style",values:{type:"link",values:["italic","normal","oblique","inherit"]}},{prop:"font-weight",values:{type:"link",values:"bold normal bolder lighter 100 200 300 400 500 600 700 800 900 inherit".split(" ")}},{prop:"white-space",values:{type:"link",values:"pre pre-line pre-wrap nowrap normal inherit".split(" ")}},{prop:"word-wrap",values:{type:"link",values:["normal","break-word"]}},{prop:"visibility",values:{type:"link",values:["hidden","visible","collapse","inherit"]}}],k=0;k<r.length;k++)l=
r[k],d.push({prefix:l.prop,description:l.prop+" - "+l.prop+" style",template:l.prop+": ${value:"+e(l.values)+"};"});r="width height top bottom left right min-width min-height max-width max-height margin padding padding-left padding-right padding-top padding-bottom margin-left margin-top margin-bottom margin-right".split(" ");for(k=0;k<r.length;k++)l=r[k],d.push({prefix:l,description:l+" - "+l+" pixel style",template:l+": ${value}px;"});r=["padding","margin"];for(k=0;k<r.length;k++)l=r[k],d.push({prefix:l,
description:l+" - "+l+" top right bottom left style",template:l+": ${top}px ${left}px ${bottom}px ${right}px;"}),d.push({prefix:l,description:l+" - "+l+" top right,left bottom style",template:l+": ${top}px ${right_left}px ${bottom}px;"}),d.push({prefix:l,description:l+" - "+l+" top,bottom right,left style",template:l+": ${top_bottom}px ${right_left}px"});r=["border","border-top","border-bottom","border-left","border-right"];for(k=0;k<r.length;k++)l=r[k],d.push({prefix:l,description:l+" - "+l+" style",
template:l+": ${width:"+e(a)+"} ${style:"+e(b)+"} ${color:"+e(f)+"};"});var n=new m.TemplateContentAssist(s.keywords,d);p.mixin(g.prototype,{getPrefix:function(a,b,c){for(c=b;c&&/[A-Za-z\-\@]/.test(a.charAt(c-1));)c--;return 0<=c?a.substring(c,b):""},computeContentAssist:function(a,b){var d=this;return a.getFileMetadata().then(function(e){return"text/html"===e.contentType.id?a.getText().then(function(a){var f=h.findStyleBlocks(a,b.offset);if(f&&0<f.length)return f=new c(f,e),d._computeProposals(f.getEditorContext(),
a,b)}):a.getText().then(function(c){return d._computeProposals(a,c,b)})})},_computeProposals:function(a,b,c){return[].concat(n.computeProposals(b,c.offset,c))},_getCompletionContext:function(a,b){return this._resultManager?this._resultManager.getResult(a).then(function(a){if(a){var c=h.findToken(b.offset,a.tokens);if(c)switch(c.type){case "EOF":if(1<a.tokens.length&&(c=a.tokens[a.tokens.length-2]))return{prefix:c.value,value:"root"}}}return null}):null}});return{CssContentAssistProvider:g}});
define("orion/editor/stylers/application_javascript/syntax",["orion/editor/stylers/lib/syntax"],function(m){var s="class const debugger delete enum export extends function implements import in instanceof interface let new package private protected public static super typeof var void with".split(" "),p="break case catch continue default do else finally for if return switch throw try while yield".split(" "),h=[];h.push.apply(h,m.grammars);h.push({id:"orion.js",contentTypes:["application/javascript"],
patterns:[{begin:"'(?:\\\\.|[^\\\\'])*\\\\$",end:"^(?:$|(?:\\\\.|[^\\\\'])*('|[^\\\\]$))",name:"string.quoted.single.js"},{begin:'"(?:\\\\.|[^\\\\"])*\\\\$',end:'^(?:$|(?:\\\\.|[^\\\\"])*("|[^\\\\]$))',name:"string.quoted.double.js"},{include:"orion.lib#string_doubleQuote"},{include:"orion.lib#string_singleQuote"},{include:"orion.c-like#comment_singleLine"},{match:"/(?![\\s\\*])(?:\\\\.|[^/])+/(?:[gim]{0,3})",name:"string.regexp.js"},{include:"orion.lib#doc_block"},{include:"orion.c-like#comment_block"},
{include:"#jsFunctionDef"},{include:"orion.lib#brace_open"},{include:"orion.lib#brace_close"},{include:"orion.lib#bracket_open"},{include:"orion.lib#bracket_close"},{include:"orion.lib#parenthesis_open"},{include:"orion.lib#parenthesis_close"},{include:"orion.lib#number_decimal"},{include:"orion.lib#number_hex"},{match:"\\b(?:"+s.join("|")+")\\b",name:"keyword.operator.js"},{match:"\\b(?:"+p.join("|")+")\\b",name:"keyword.control.js"},{match:"\\b(?:false|null|true|undefined)\\b",name:"constant.language.js"},
{match:"\\bthis\\b",name:"variable.language.js"}],repository:{jsFunctionDef:{begin:"(function)(\\s+[_$a-zA-Z\\xA0-\\uFFFF][_$a-zA-Z0-9\\xA0-\\uFFFF]*)?\\s*\\(",end:"\\)",captures:{1:{name:"keyword.operator.js"},2:{name:"entity.name.function.js"}},patterns:[{include:"orion.c-like#comment_singleLine"},{include:"orion.c-like#comment_block"},{match:"[^\\s,]+",name:"variable.parameter.js"}]}}});return{id:h[h.length-1].id,grammars:h,keywords:s.concat(p)}});
define("orion/editor/stylers/application_xml/syntax",["orion/editor/stylers/lib/syntax"],function(m){var s=[];s.push.apply(s,m.grammars);s.push({id:"orion.xml",contentTypes:["application/xml","application/xhtml+xml"],patterns:[{include:"#comment"},{include:"#doctype"},{include:"#xmlDeclaration"},{include:"#tag"},{include:"#ampersandEscape"}],repository:{ampersandEscape:{match:"\x26lt;|\x26gt;|\x26amp;",name:"constant.character"},comment:{begin:{match:"\x3c!--",literal:"\x3c!--"},end:{match:"--\x3e",
literal:"--\x3e"},name:"comment.block.xml",patterns:[{match:"(\\b)(TODO)(\\b)(((?!--\x3e).)*)",name:"meta.annotation.task.todo",captures:{2:{name:"keyword.other.documentation.task"},4:{name:"comment.line"}}}]},doctype:{begin:"\x3c!(?:doctype|DOCTYPE)",end:"\x3e",name:"meta.tag.doctype.xml",captures:{0:{name:"meta.tag.doctype.xml"}},patterns:[{include:"#comment"},{include:"orion.lib#string_doubleQuote"},{include:"orion.lib#string_singleQuote"}]},tag:{begin:"\x3c/?[A-Za-z0-9]+",end:"/?\x3e",captures:{0:{name:"meta.tag.xml"}},
name:"meta.tag.xml",patterns:[{include:"#comment"},{include:"orion.lib#string_doubleQuote"},{include:"orion.lib#string_singleQuote"}]},xmlDeclaration:{begin:"\x3c\\?xml",end:"\\?\x3e",captures:{0:{name:"meta.tag.declaration.xml"}},patterns:[{include:"#comment"},{include:"orion.lib#string_doubleQuote"},{include:"orion.lib#string_singleQuote"}],name:"meta.tag.declaration.xml"}}});return{id:s[s.length-1].id,grammars:s,keywords:[]}});
define("orion/editor/stylers/text_html/syntax",["orion/editor/stylers/application_javascript/syntax","orion/editor/stylers/text_css/syntax","orion/editor/stylers/application_xml/syntax"],function(m,s,p){var h=[];h.push.apply(h,m.grammars);h.push.apply(h,s.grammars);h.push.apply(h,p.grammars);h.push({id:"orion.html",contentTypes:["text/html"],patterns:[{begin:"(?i)(\x3cstyle)([^\x3e]*)(\x3e)",end:"(?i)(\x3c/style\x3e)",captures:{1:{name:"meta.tag.html"},3:{name:"meta.tag.html"}},contentName:"source.css.embedded.html",
patterns:[{include:"orion.css"}]},{begin:"(?i)\x3cscript\\s*\x3e|\x3cscript\\s.*?(?:language\\s*\x3d\\s*(['\"])javascript\\1|type\\s*\x3d\\s*(['\"])(?:text|application)/(?:javascript|ecmascript)\\2).*?\x3e",end:"(?i)\x3c/script\x3e",captures:{0:{name:"meta.tag.html"}},contentName:"source.js.embedded.html",patterns:[{include:"orion.js"}]},{include:"orion.xml#comment"},{include:"orion.xml#doctype"},{include:"orion.xml#tag"},{include:"orion.xml#ampersandEscape"}]});return{id:h[h.length-1].id,grammars:h,
keywords:[]}});
define("webtools/htmlContentAssist",["orion/editor/templates","orion/editor/stylers/text_html/syntax"],function(m,s){function p(){}var h=new m.Template("","Simple HTML document",'\x3c!DOCTYPE html\x3e\n\x3chtml lang\x3d"en"\x3e\n\t\x3chead\x3e\n\t\t\x3cmeta charset\x3dutf-8\x3e\n\t\t\x3ctitle\x3e${title}\x3c/title\x3e\n\t\x3c/head\x3e\n\t\x3cbody\x3e\n\t\t\x3ch1\x3e${header}\x3c/h1\x3e\n\t\t\x3cp\x3e\n\t\t\t${cursor}\n\t\t\x3c/p\x3e\n\t\x3c/body\x3e\n\x3c/html\x3e'),c=[{prefix:"\x3cimg",name:"\x3cimg\x3e",
description:" - HTML image element",template:'\x3cimg src\x3d"${URI}" alt\x3d"${Image}"/\x3e'},{prefix:"\x3ca",name:"\x3ca\x3e",description:" - HTML anchor element",template:'\x3ca href\x3d"${cursor}"\x3e\x3c/a\x3e'},{prefix:"\x3cul",name:"\x3cul\x3e",description:" - HTML unordered list",template:"\x3cul\x3e\n\t\x3cli\x3e${cursor}\x3c/li\x3e\n\x3c/ul\x3e"},{prefix:"\x3col",name:"\x3col\x3e",description:" - HTML ordered list",template:"\x3col\x3e\n\t\x3cli\x3e${cursor}\x3c/li\x3e\n\x3c/ol\x3e"},{prefix:"\x3cdl",
name:"\x3cdl\x3e",description:" - HTML definition list",template:"\x3cdl\x3e\n\t\x3cdt\x3e${cursor}\x3c/dt\x3e\n\t\x3cdd\x3e\x3c/dd\x3e\n\x3c/dl\x3e"},{prefix:"\x3ctable",name:"\x3ctable\x3e",description:" - basic HTML table",template:"\x3ctable\x3e\n\t\x3ctr\x3e\n\t\t\x3ctd\x3e${cursor}\x3c/td\x3e\n\t\x3c/tr\x3e\n\x3c/table\x3e"},{prefix:"\x3c!--",name:"\x3c!-- --\x3e",description:" - HTML comment",template:"\x3c!-- ${cursor} --\x3e"}],f,e,g,l,b="abbr b button canvas cite command dd del dfn dt em embed font h1 h2 h3 h4 h5 h6 i ins kbd label li mark meter object option output progress q rp rt samp small strong sub sup td time title tt u var".split(" ");
for(l=0;l<b.length;l++)f=b[l],g="\x3c"+f+"\x3e\x3c/"+f+"\x3e",e="\x3c"+f+"\x3e${cursor}\x3c/"+f+"\x3e",c.push({prefix:"\x3c"+f,description:g,template:e});b="address article aside audio bdo blockquote body caption code colgroup datalist details div fieldset figure footer form head header hgroup iframe legend map menu nav noframes noscript optgroup p pre ruby script section select span style tbody textarea tfoot th thead tr video".split(" ");for(l=0;l<b.length;l++)f=b[l],g="\x3c"+f+"\x3e\x3c/"+f+"\x3e",
e="\x3c"+f+"\x3e\n\t${cursor}\n\x3c/"+f+"\x3e",c.push({prefix:"\x3c"+f,description:g,template:e});b="area base br col hr input link meta param keygen source".split(" ");for(l=0;l<b.length;l++)f=b[l],e=g="\x3c"+f+"/\x3e",c.push({prefix:"\x3c"+f,description:g,template:e});p.prototype=new m.TemplateContentAssist(s.keywords,c);p.prototype.getPrefix=function(a,b,c){c="";for(var e=b;e&&/[A-Za-z0-9<!-]/.test(a.charAt(e-1));)e--,c=a.substring(e,b);return c};p.prototype.computeProposals=function(a,b,c){return 0===
a.length?[h.getProposal("",b,c)]:m.TemplateContentAssist.prototype.computeProposals.call(this,a,b,c).sort(function(a,b){var c=a.prefix||a.proposal,d=b.prefix||b.proposal;if(c){if(!d)return 1}else return-1;return c.toLowerCase().localeCompare(d.toLowerCase())})};return{HTMLContentAssistProvider:p}});
define("orion/editor/AsyncStyler",["i18n!orion/editor/nls/messages","orion/editor/annotations"],function(m,s){function p(e){return-1!==e.getProperty("objectClass").indexOf(c)&&"highlighter"===e.getProperty("type")}function h(c,f,l){this.initialize(c,f,l);this.lineStyles=[]}var c="orion.edit.highlighter",f=c+" service must be an event emitter";s.AnnotationType.registerType("orion.annotation.highlightError",{title:m.syntaxError,html:"\x3cdiv class\x3d'annotationHTML error'\x3e\x3c/div\x3e",rangeStyle:{styleClass:"annotationRange error"}});
h.prototype={initialize:function(e,f,l){this.textView=e;this.serviceRegistry=f;this.annotationModel=l;this.services=[];var b=this;this.listener={onModelChanging:function(a){b.onModelChanging(a)},onModelChanged:function(a){b.onModelChanged(a)},onDestroy:function(a){b.onDestroy(a)},onLineStyle:function(a){b.onLineStyle(a)},onStyleReady:function(a){b.onStyleReady(a)},onServiceAdded:function(a){b.onServiceAdded(a.serviceReference,b.serviceRegistry.getService(a.serviceReference))},onServiceRemoved:function(a){b.onServiceRemoved(a.serviceReference,
b.serviceRegistry.getService(a.serviceReference))}};e.addEventListener("ModelChanging",this.listener.onModelChanging);e.addEventListener("ModelChanged",this.listener.onModelChanged);e.addEventListener("Destroy",this.listener.onDestroy);e.addEventListener("LineStyle",this.listener.onLineStyle);f.addEventListener("registered",this.listener.onServiceAdded);f.addEventListener("unregistering",this.listener.onServiceRemoved);e=f.getServiceReferences(c);for(l=0;l<e.length;l++){var a=e[l];p(a)&&this.addServiceListener(f.getService(a))}},
onDestroy:function(c){this.destroy()},destroy:function(){this.textView&&(this.textView.removeEventListener("ModelChanging",this.listener.onModelChanging),this.textView.removeEventListener("ModelChanged",this.listener.onModelChanged),this.textView.removeEventListener("Destroy",this.listener.onDestroy),this.textView.removeEventListener("LineStyle",this.listener.onLineStyle),this.textView=null);if(this.services){for(var c=0;c<this.services.length;c++)this.removeServiceListener(this.services[c]);this.services=
null}this.serviceRegistry&&(this.serviceRegistry.removeEventListener("registered",this.listener.onServiceAdded),this.serviceRegistry.removeEventListener("unregistering",this.listener.onServiceRemoved),this.serviceRegistry=null);this.lineStyles=this.listener=null},onModelChanging:function(c){this.startLine=this.textView.getModel().getLineAtOffset(c.start)},onModelChanged:function(c){var f=this.startLine;(c.addedLineCount||c.removedLineCount)&&Array.prototype.splice.apply(this.lineStyles,[f,c.removedLineCount].concat(this._getEmptyStyle(c.addedLineCount)))},
onStyleReady:function(c){var f=c.lineStyles||c.style;c=Number.MAX_VALUE;var l=-1,b=this.textView.getModel(),a;for(a in f)Object.prototype.hasOwnProperty.call(f,a)&&(this.lineStyles[a]=f[a],c=Math.min(c,a),l=Math.max(l,a));c=Math.max(c,0);l=Math.min(l,b.getLineCount());if(f=this.annotationModel){for(var k=f.getAnnotations(b.getLineStart(c),b.getLineEnd(l)),d=[];k.hasNext();){var h=k.next();"orion.annotation.highlightError"===h.type&&d.push(h)}k=[];for(h=c;h<=l;h++){a=h;var n=this.lineStyles[a],n=n&&
n.errors;a=b.getLineStart(a);if(n)for(var m=0;m<n.length;m++){var q=n[m];k.push(s.AnnotationType.createAnnotation("orion.annotation.highlightError",q.start+a,q.end+a))}}f.replaceAnnotations(d,k)}this.textView.redrawLines(c,l+1)},onLineStyle:function(c){var f=this.lineStyles[c.lineIndex];if(f)if(f.ranges){for(var f=f.ranges,h=c.lineStart,b=f.length,a=[],k=0;k<b;k++){var d=f[k];a.push({start:d.start+h,end:d.end+h,style:d.style})}c.ranges=a}else f.style&&(c.style=f.style)},_getEmptyStyle:function(c){for(var f=
[],h=0;h<c;h++)f.push(null);return f},setContentType:function(c){this.contentType=c;if(this.services)for(c=0;c<this.services.length;c++){var f=this.services[c];if(f.setContentType){var h=this.serviceRegistry.getService("orion.page.progress");h?h.progress(f.setContentType(this.contentType),"Styling content type: "+this.contentType.id?this.contentType.id:this.contentType):f.setContentType(this.contentType)}}},onServiceAdded:function(c,f){p(c)&&this.addServiceListener(f)},onServiceRemoved:function(c,
f){-1!==this.services.indexOf(f)&&this.removeServiceListener(f)},addServiceListener:function(c){if("function"===typeof c.addEventListener){if(c.addEventListener("orion.edit.highlighter.styleReady",this.listener.onStyleReady),this.services.push(c),c.setContentType&&this.contentType){var g=this.serviceRegistry.getService("orion.page.progress");g?g.progress(c.setContentType(this.contentType),"Styling content type: "+this.contentType.id?this.contentType.id:this.contentType):c.setContentType(this.contentType)}}else"undefined"!==
typeof console&&console.log(Error(f))},removeServiceListener:function(c){"function"===typeof c.removeEventListener?(c.removeEventListener("orion.edit.highlighter.styleReady",this.listener.onStyleReady),c=this.services.indexOf(c),-1!==c&&this.services.splice(c,1)):"undefined"!==typeof console&&console.log(Error(f))}};return h});
define("orion/editor/mirror",["i18n!orion/editor/nls/messages","orion/editor/eventTarget","orion/editor/annotations"],function(m,s,p){function h(b){this.string=b;this.tokenStart=this.pos=0}function c(b,a){return{token:function(a,b){return a.skipToEnd()}}}function f(b){this._modes={};this.mimeModes={};this.options={};this.StringStream=h;this.defineMode("null",c);this.defineMIME("text/plain","null")}function e(b){var a=[],c;for(c in b)Object.prototype.hasOwnProperty.call(b,c)&&a.push(c);return a}function g(b,
a,c){c=c||{};this.model=b;this.codeMirror=a;this.isWhitespaceVisible="undefined"===typeof c.whitespacesVisible?!1:c.whitespacesVisible;this.mode=null;this.isModeLoaded=!1;this.lines=[];this.dirtyLines=[];this.startLine=Number.MAX_VALUE;this.endLine=-1;this.timer=null;this.initialize(b)}function l(b,a,c){this.init(b,a,c)}h.prototype={eol:function(){return this.pos>=this.string.length},sol:function(){return 0===this.pos},peek:function(){return this.string[this.pos]},next:function(){return this.string[this.pos++]},
eat:function(b){var a=this.string[this.pos];return"string"===typeof a&&(a===b||b.test&&b.test(a)||"function"===typeof b&&b(a))?this.string[this.pos++]:void 0},eatWhile:function(b){for(var a=!1;void 0!==this.eat(b);)a=!0;return a},eatSpace:function(){return this.eatWhile(/\s/)},skipToEnd:function(){this.pos=this.string.length},skipTo:function(b){b=this.string.indexOf(b,this.pos);return-1!==b?(this.pos=b,!0):!1},match:function(b,a,c){a=!0===a||"undefined"===typeof a;if("string"===typeof b){var d=c?
this.string.toLowerCase():this.string;b=c?b.toLowerCase():b;c=d.indexOf(b,this.pos);-1!==c&&a&&(this.pos=c+b.length);return-1!==c}if((b=this.string.substring(this.pos).match(b))&&a&&"string"===typeof b[0])this.pos+=b.index+b[0].length;return b},backUp:function(b){this.pos-=b},column:function(){for(var b=0,a=0;a<this.tokenStart;)b+="\t"===this.string[a++]?4:1;return b},indentation:function(){for(var b=this.string.search(/\S/),a=0,c=0;c<b;)a+="\t"===this.string[c++]?4:1;return a},current:function(){return this.string.substring(this.tokenStart,
this.pos)},advance:function(){this.tokenStart=this.pos}};f.prototype={options:{},setOption:function(b,a){this.options[b]=a},getOption:function(b){return this.options[b]},copyState:function(b,a){if("function"===typeof b.copyState)return b.copyState(a);var c={},d;for(d in a){var e=a[d];c[d]=e instanceof Array?e.slice():e}return c},startState:function(b,a){return b.startState(a)},defineMode:function(b,a){this._modes[b]=a},defineMIME:function(b,a){this.mimeModes[b]=a},getMode:function(b,a){var c={},d;
"string"===typeof a&&this.mimeModes[a]&&(a=this.mimeModes[a]);"object"===typeof a&&(c=a,d=this._modes[a.name]);d=d||this._modes[a];return"function"!==typeof d?("undefined"!==typeof console&&console&&console.log("Mode not found: "+a),this.getMode(b,"null")):d(b,c)},listModes:function(){return e(this._modes)},listMIMEs:function(){return e(this.mimeModes)},_getModeName:function(b){b=this.mimeModes[b];"object"===typeof b&&(b=b.name);return b}};g.prototype={initialize:function(b){var a=this;this.listener=
{onModelChanging:function(b){a._onModelChanging(b)},onModelChanged:function(b){a._onModelChanged(b)},onDestroy:function(b){a._onDestroy(b)}};this.model.addEventListener("Changing",this.listener.onModelChanging);this.model.addEventListener("Changed",this.listener.onModelChanged);this.model.addEventListener("Destroy",this.listener.onDestroy)},destroy:function(){this.model&&(this.model.removeEventListener("Changing",this.listener.onModelChanging),this.model.removeEventListener("Changed",this.listener.onModelChanged),
this.model.removeEventListener("Destroy",this.listener.onDestroy));this.dirtyLines=this.lines=this.mode=this.codeMirror=this.model=null;clearTimeout(this.timer);this.timer=null},_onModelChanging:function(b){this.startLine=this.model.getLineAtOffset(b.start)},_onModelChanged:function(b){this._dbgEvent(b);var a=this.startLine;(b.removedLineCount||b.addedLineCount)&&Array.prototype.splice.apply(this.lines,[a+1,b.removedLineCount].concat(this._newLines(b.addedLineCount)));this.mode&&(b=Math.max(b.addedLineCount,
b.removedLineCount),b=a+Math.min(b,500),this.highlight(a,b),this.highlightLater(b+1))},_onDestroy:function(b){this.destroy()},setViewportIndex:function(b){this.viewportIndex=b},_dbgEvent:function(b){},_dbgStyle:function(){},_newLines:function(b,a){for(var c=[],d=0;d<b;d++)c.push({style:null,eolState:null});return c},setMode:function(b,a){b&&(this.mode=this.codeMirror.getMode(this.codeMirror.options,b),this.lines=this._newLines(this.model.getLineCount()),a&&this.highlight())},highlight:function(b,
a,c){if(this.mode){var d=this.model.getLineCount();b="undefined"===typeof b?0:b;a="undefined"===typeof a?d-1:Math.min(a,d-1);for(var d=this.mode,e=this.getState(b),f=b;f<=a;f++){var g=this.lines[f];this.highlightLine(f,g,e);g.eolState=this.codeMirror.copyState(d,e)}this._expandRange(b,a);if(!c)this.onHighlightDone()}},highlightLater:function(b){this.dirtyLines.push(b);var a=this;this.timer=setTimeout(function(){a._highlightJob()},50)},_highlightJob:function(){for(var b=+new Date+30,a=this.mode.compareStates,
c=this.model.getLineCount();this.dirtyLines.length;){var d=this.viewportIndex,e=this.lines[d],d=e&&!e.eolState?d:this.dirtyLines.pop();if(d>=c)break;this._expandRange(d,d);for(var e=this._getResumeLineIndex(d),d=e+1,e=(e=0<=e&&this.lines[e].eolState)?this.codeMirror.copyState(this.mode,e):this.mode.startState(),f=0,g=d;g<c;g++){var h=this.lines[g],l=h.eolState,m=this.highlightLine(g,h,e);h.eolState=this.codeMirror.copyState(this.mode,e);m&&this._expandRange(d,g+1);var h=a&&l&&a(l,h.eolState),p=!a&&
!m&&3<f++;if(h||p)break;else if(!l||m)f=0;l=g<c||this.dirtyLines.length;if(+new Date>b&&l){this.highlightLater(g+1);this.onHighlightDone();return}}}this.onHighlightDone()},onHighlightDone:function(){this.startLine!==Number.MAX_VALUE&&-1!==this.endLine&&this.dispatchEvent({type:"Highlight",start:this.startLine,end:this.endLine});this.startLine=Number.MAX_VALUE;this.endLine=-1},_getResumeLineIndex:function(b){for(var a=this.lines,c=b-1;0<=c;c--)if(a[c].eolState||40<b-c)return c;return-1},getState:function(b){var a=
this.mode,c=this.lines,d,e;for(d=b-1;0<=d&&!(e=c[d],e.eolState||40<b-d);d--);var f=0<=d&&c[d].eolState;if(f){f=this.codeMirror.copyState(a,f);for(d=Math.max(0,d);d<b-1;d++)e=c[d],this.highlightLine(d,e,f),e.eolState=this.codeMirror.copyState(a,f);return f}return a.startState()},highlightLine:function(b,a,c){if(this.mode){var d=this.model;d.getLineStart(b)===d.getLineEnd(b)&&this.mode.blankLine&&this.mode.blankLine(c);var e=a.style||[];b=d.getLine(b);b=new h(b);for(var d=!a.style,f=[],g=0;!b.eol();g++){var l=
this.mode.token(b,c)||null,m=b.current();this._whitespaceStyle(l,m,b.tokenStart);l=[b.tokenStart,b.pos,l];m=e[g];f.push(l);d=d||!m||m[0]!==l[0]||m[1]!==l[1]||m[2]!==l[2];b.advance()}if(d=d||f.length!==e.length)a.style=f.length?f:null;return d}},_whitespaceStyle:function(b,a,c){if(!b&&this.isWhitespaceVisible&&/\s+/.test(a)){b=[];for(var d,e,f=0;f<a.length;f++){var g=a[f];g!==e&&(e&&b.push([c+d,c+f,"\t"===e?"punctuation separator tab":"punctuation separator space"]),d=f,e=g)}b.push([c+d,c+f,"\t"===
e?"punctuation separator tab":"punctuation separator space"]);return b}return null},_expandRange:function(b,a){this.startLine=Math.min(this.startLine,b);this.endLine=Math.max(this.endLine,a)},toStyleRangesAndErrors:function(b,a){var c=b.style;if(!c)return null;for(var d=[],e=[],f="undefined"===typeof a?0:this.model.getLineStart(a),g=0;g<c.length;g++){var h=c[g],l;l=(l=h[2])?"punctuation separator tab"===l||"punctuation separator space"===l?l:"cm-"+l:null;l&&(h={start:f+h[0],end:f+h[1],style:{styleClass:l}},
d.push(h),"cm-error"===l&&e.push(h))}return[d,e]},getLineStyle:function(b){return this.lines[b]},getLineStyles:function(){return this.lines}};s.EventTarget.addMixin(g.prototype);p.AnnotationType.registerType("orion.annotation.highlightError",{title:m.syntaxError,html:"\x3cdiv class\x3d'annotationHTML error'\x3e\x3c/div\x3e",rangeStyle:{styleClass:"annotationRange error"}});l.prototype={init:function(b,a,c){this.textView=b;this.annotationModel=c;this.modeApplier=new g(b.getModel(),a);var d=this;this.listener=
{onLineStyle:function(a){d.onLineStyle(a)},onDestroy:function(a){d.onDestroy(a)},onHighlight:function(a){d.onHighlight(a)}};b.addEventListener("LineStyle",this.listener.onLineStyle);b.addEventListener("Destroy",this.listener.onDestroy);this.modeApplier.addEventListener("Highlight",this.listener.onHighlight)},destroy:function(){this.modeApplier&&(this.modeApplier.removeEventListener("Highlight",this.listener.onHighlight),this.modeApplier.destroy());this.textView&&(this.textView.removeEventListener("LineStyle",
this.listener.onLineStyle),this.textView.removeEventListener("Destroy",this.listener.onDestroy));this.listener=this.modeApplier=this.annotationModel=this.textView=null},setMode:function(b){this.modeApplier.setMode(b)},onLineStyle:function(b){var a=b.lineIndex,c=this.modeApplier,d=c.getLineStyle(a);if(!d||!d.eolState){var e=this.textView.getModel().getLineCount();c.highlight(a,Math.min(a+20,e-1),!0);d=c.getLineStyle(a)}e=this.textView.getModel();if(d){var f=c.toStyleRangesAndErrors(d,a);if(f&&(b.ranges=
f[0],b=this.annotationModel)){c=[];d=[];if(f=f[1])for(var g=0;g<f.length;g++){var h=f[g];"cm-error"===h.style.styleClass&&d.push(p.AnnotationType.createAnnotation("orion.annotation.highlightError",h.start,h.end))}for(a=b.getAnnotations(e.getLineStart(a),e.getLineEnd(a));a.hasNext();)e=a.next(),"orion.annotation.highlightError"===e.type&&c.push(e);b.replaceAnnotations(c,d)}}},onHighlight:function(b){this.textView.redrawLines(b.start,b.end)},onDestroy:function(b){this.destroy()}};return{Mirror:f,ModeApplier:g,
CodeMirrorStyler:l}});
define("orion/editor/textMateStyler",["orion/regex"],function(m){function s(c){var f;if(c instanceof Array){f=Array(c.length);for(var e=0;e<c.length;e++)f[e]=s(c[e])}else for(e in f={},c)if(Object.prototype.hasOwnProperty.call(c,e)){var g=c[e];f[e]="object"===typeof g&&null!==g?s(g):g}return f}function p(c,f,e){this.initialize(c);this.grammar=s(f);this.externalGrammars=e?s(e):[];this._styles={};this._tree=null;this._allGrammars={};this.preprocess(this.grammar)}var h={unsupported:[{regex:/\(\?[ims\-]:/,func:function(c){return"option on/off for subexp"}},
{regex:/\(\?<([=!])/,func:function(c){return"\x3d"===c[1]?"lookbehind":"negative lookbehind"}},{regex:/\(\?>/,func:function(c){return"atomic group"}}],toRegExp:function(c){function f(b,a){throw Error('Unsupported regex feature "'+b+'": "'+a[0]+'" at index: '+a.index+" in "+a.input);}var e="",g;c=h.processGlobalFlag("x",c,function(b){for(var a="",c=!1,d=b.length,e=0;e<d;){var f=b.charAt(e);if(!c&&"#"===f)for(;e<d&&"\r"!==f&&"\n"!==f;)f=b.charAt(++e);else if(!c&&/\s/.test(f))for(;e<d&&/\s/.test(f);)f=
b.charAt(++e);else"\\"===f?(a+=f,/\s/.test(b.charAt(e+1))||(a+=b.charAt(e+1),e+=1)):("["===f?c=!0:"]"===f&&(c=!1),a+=f),e+=1}return a});c=h.processGlobalFlag("i",c,function(b){e+="i";return b});for(g=0;g<this.unsupported.length;g++){var l;(l=this.unsupported[g].regex.exec(c))&&f(this.unsupported[g].func(l),l)}return RegExp(c,e)},processGlobalFlag:function(c,f,e){var g="(?"+c+")";c="(?"+c+":";if(f.substring(0,g.length)===g)return e(f.substring(g.length));if(f.substring(0,c.length)===c){for(var g=0,
h=f.length,b=-1,a=0;a<h&&-1===b;a++)switch(f.charAt(a)){case "\\":a++;break;case "(":g++;break;case ")":g--,0===g&&(b=a)}g=b;if(g<f.length-1)throw Error("Only a "+c+") group that encloses the entire regex is supported in: "+f);return e(f.substring(c.length,g))}return f},hasBackReference:function(c){return/\\\d+/.test(c.source)},getSubstitutedRegex:function(c,f,e){e="undefined"===typeof e?!0:!1;c=c.source.split(/(\\\d+)/g);for(var g=[],h=0;h<c.length;h++){var b=c[h],a=/\\(\d+)/.exec(b);a?(b=f[a[1]]||
"",g.push(e?m.escape(b):b)):g.push(b)}return RegExp(g.join(""))},groupify:function(c,f){for(var e=c.source,g=e.length,h=[],b=0,a=[],k=1,d=1,r=[],n={},m={},q=0;q<g;q++){var p=h[h.length-1],s=e.charAt(q);switch(s){case "(":4===p&&(h.pop(),r.push(")"),a[a.length-1].end=q);var B=q+2<g?e.charAt(q+1)+""+e.charAt(q+2):null;if("?:"===B||"?\x3d"===B||"?!"===B){var x;"?:"===B?x=1:(x=3,b++);h.push(x);a.push({start:q,end:-1,type:x});r.push(s);r.push(B);q+=B.length}else h.push(2),a.push({start:q,end:-1,type:2,
oldNum:k,num:d}),r.push(s),0===b&&(m[d]=null),n[k]=d,k++,d++;break;case ")":p=h.pop();3===p&&b--;a[a.length-1].end=q;r.push(s);break;case "*":case "+":case "?":case "}":var C=s,z=e.charAt(q-1),B=q-1;if("}"===s){for(x=q-1;"{"!==e.charAt(x)&&0<=x;x--);z=e.charAt(x-1);B=x-1;C=e.substring(x,q+1)}x=a[a.length-1];if(")"===z&&(2===x.type||4===x.type)){r.splice(x.start,0,"(");r.push(C);r.push(")");s={start:x.start,end:r.length-1,type:4,num:x.num};for(z=0;z<a.length;z++)if(p=a[z],(2===p.type||4===p.type)&&
p.start>=x.start&&p.end<=B)p.start+=1,p.end+=1,p.num+=1,2===p.type&&(n[p.oldNum]=p.num);a.push(s);d++;break}default:"|"!==s&&(2!==p&&4!==p)&&0===b&&(h.push(4),a.push({start:q,end:-1,type:4,num:d}),r.push("("),m[d]=null,d++),r.push(s),"\\"===s&&(s=e.charAt(q+1),r.push(s),q+=1)}}for(;h.length;)h.pop(),r.push(")");e=RegExp(r.join(""));g={};f=f||n;for(var E in f)f.hasOwnProperty(E)&&(g[E]="\\"+f[E]);e=this.getSubstitutedRegex(e,g,!1);return[e,n,m]},complexCaptures:function(c){if(!c)return!1;for(var f in c)if(c.hasOwnProperty(f)&&
"0"!==f)return!0;return!1}};p.prototype={initialize:function(c){this.textView=c;this.textView.stylerOptions=this;var f=this;this._listener={onModelChanged:function(c){f.onModelChanged(c)},onDestroy:function(c){f.onDestroy(c)},onLineStyle:function(c){f.onLineStyle(c)},onStorage:function(c){f.onStorage(c)}};c.addEventListener("ModelChanged",this._listener.onModelChanged);c.addEventListener("Destroy",this._listener.onDestroy);c.addEventListener("LineStyle",this._listener.onLineStyle);c.redrawLines()},
onDestroy:function(c){this.destroy()},destroy:function(){this.textView&&(this.textView.removeEventListener("ModelChanged",this._listener.onModelChanged),this.textView.removeEventListener("Destroy",this._listener.onDestroy),this.textView.removeEventListener("LineStyle",this._listener.onLineStyle),this.textView=null);this._listener=this._tree=this._styles=this.grammar=null},preprocess:function(c){for(c=[c];0!==c.length;){var f=c.pop();if(!f._resolvedRule||!f._typedRule)if(f._resolvedRule=this._resolve(f),
f._typedRule=this._createTypedRule(f),this.addStyles(f.name),this.addStyles(f.contentName),this.addStylesForCaptures(f.captures),this.addStylesForCaptures(f.beginCaptures),this.addStylesForCaptures(f.endCaptures),f._resolvedRule!==f&&c.push(f._resolvedRule),f.patterns)for(var e=0;e<f.patterns.length;e++)c.push(f.patterns[e])}},addStyles:function(c){if(c&&!this._styles[c]){this._styles[c]=[];for(var f=c.split("."),e=0;e<f.length;e++)this._styles[c].push(f.slice(0,e+1).join("-"))}},addStylesForCaptures:function(c){for(var f in c)c.hasOwnProperty(f)&&
this.addStyles(c[f].name)},ContainerRule:function(){function c(c){this.rule=c;this.subrules=c.patterns}c.prototype.valueOf=function(){return"aa"};return c}(),BeginEndRule:function(){function c(c){this.rule=c;this.beginRegex=h.toRegExp(c.begin);this.endRegex=h.toRegExp(c.end);this.subrules=c.patterns||[];this.endRegexHasBackRef=h.hasBackReference(this.endRegex);var e=h.complexCaptures(c.captures);c=h.complexCaptures(c.beginCaptures)||h.complexCaptures(c.endCaptures);if(this.isComplex=e||c)e=h.groupify(this.beginRegex),
this.beginRegex=e[0],this.beginOld2New=e[1],this.beginConsuming=e[2],e=h.groupify(this.endRegex,this.beginOld2New),this.endRegex=e[0],this.endOld2New=e[1],this.endConsuming=e[2]}c.prototype.valueOf=function(){return this.beginRegex};return c}(),MatchRule:function(){function c(c){this.rule=c;this.matchRegex=h.toRegExp(c.match);if(this.isComplex=h.complexCaptures(c.captures))c=h.groupify(this.matchRegex),this.matchRegex=c[0],this.matchOld2New=c[1],this.matchConsuming=c[2]}c.prototype.valueOf=function(){return this.matchRegex};
return c}(),_createTypedRule:function(c){return c.match?new this.MatchRule(c):c.begin?new this.BeginEndRule(c):new this.ContainerRule(c)},_resolve:function(c){var f=c;if(c.include){if(c.begin||c.end||c.match)throw Error('Unexpected regex pattern in "include" rule '+c.include);c=c.include;if("#"===c.charAt(0)){if(f=this.grammar.repository&&this.grammar.repository[c.substring(1)],!f)throw Error("Couldn't find included rule "+c+" in grammar repository");}else if("$self"===c)f=this.grammar;else{if("$base"===
c)throw Error('Include "$base" is not supported');f=this._allGrammars[c];if(!f)for(var e=0;e<this.externalGrammars.length;e++){var g=this.externalGrammars[e];if(g.scopeName===c){this.preprocess(g);f=this._allGrammars[c]=g;break}}}}return f},ContainerNode:function(){function c(c,e){this.parent=c;this.rule=e;this.children=[];this.end=this.start=null}c.prototype.addChild=function(c){this.children.push(c)};c.prototype.valueOf=function(){var c=this.rule;return"ContainerNode { "+(c.include||"")+" "+(c.name||
"")+(c.comment||"")+"}"};return c}(),BeginEndNode:function(){function c(c,e,g){this.parent=c;this.rule=e;this.children=[];this.setStart(g);this.endMatch=this.end=null;this.endRegexSubstituted=e.endRegexHasBackRef?h.getSubstitutedRegex(e.endRegex,g):null}c.prototype.addChild=function(c){this.children.push(c)};c.prototype.getIndexInParent=function(c){return this.parent?this.parent.children.indexOf(this):-1};c.prototype.setStart=function(c){this.start=c.index;this.beginMatch=c};c.prototype.setEnd=function(c){c&&
"object"===typeof c?(this.endMatch=c,this.end=c.index+c[0].length):(this.endMatch=null,this.end=c)};c.prototype.shiftStart=function(c){this.start+=c;this.beginMatch.index+=c};c.prototype.shiftEnd=function(c){this.end+=c;this.endMatch&&(this.endMatch.index+=c)};c.prototype.valueOf=function(){return"{"+this.rule.beginRegex+" range\x3d"+this.start+".."+this.end+"}"};return c}(),push:function(c,f){if(f)for(var e=f.length;0<e;)c.push(f[--e])},exec:function(c,f,e){if(f=c.exec(f))f.index+=e;c.lastIndex=
0;return f},afterMatch:function(c){return c.index+c[0].length},getEndMatch:function(c,f,e){if(c instanceof this.BeginEndNode){var g=c.rule;c=c.endRegexSubstituted||g.endRegex;return!c?null:this.exec(c,f,e)}return null},initialParse:function(){this.textView.getModel().getCharCount();this._tree=new this.ContainerNode(null,this.grammar._typedRule);this.parse(this._tree,!1,0)},onModelChanged:function(c){var f=c.addedCharCount,e=c.removedCharCount;c=c.start;if(this._tree){var g=this.textView.getModel(),
h=g.getCharCount(),g=g.getLineEnd(g.getLineAtOffset(c)-1),b=this.getFirstDamaged(g,g),g=-1===g?0:g,f=b?this.parse(b,!0,g,c,f,e):h;this.textView.redrawRange(g,f)}else this.initialParse()},getFirstDamaged:function(c,f){if(0>c)return this._tree;for(var e=[this._tree],g=null;e.length;){var h=e.pop();if(!h.parent||this.isDamaged(h,c,f)){h instanceof this.BeginEndNode&&(g=h);for(var b=0;b<h.children.length;b++)e.push(h.children[b])}}return g||this._tree},isDamaged:function(c,f,e){return c.start<=e&&c.end>
f},parse:function(c,f,e,g,h,b){var a=this.textView.getModel(),k=a.getLineStart(a.getLineCount()-1),d=a.getCharCount(),r=this.getInitialExpected(c,e),n=-1;f&&(c.repaired=!0,c.endNeedsUpdate=!0,n=(n=c.children[c.children.length-1])?a.getLineEnd(a.getLineAtOffset(n.end+(h-b))):-1,g=a.getLineEnd(a.getLineAtOffset(g+b)),n=Math.max(n,g));n=-1===n?d:n;g=r;for(var m=c,q=!1,p=e,s=-1;m&&(!f||p<n);){var B=this.getNextMatch(a,m,p);B||(p=p>=k?d:a.getLineStart(a.getLineAtOffset(p)+1));var x=B&&B.match,C=B&&B.rule,
z=B&&B.isEnd;if(B&&B.isSub)p=this.afterMatch(x),C instanceof this.BeginEndRule&&(q=!0,f&&C===g.rule&&m===g.parent?(m=g,m.setStart(x),m.repaired=!0,m.endNeedsUpdate=!0,g=this.getNextExpected(g,"begin")):(f&&(this.prune(m,g),f=!1),x=new this.BeginEndNode(m,C,x),m.addChild(x),m=x));else if(z||p===d)m instanceof this.BeginEndNode&&(x?(q=!0,s=Math.max(s,m.end),m.setEnd(x),p=this.afterMatch(x),f&&m===g&&m.parent===g.parent?(m.repaired=!0,delete m.endNeedsUpdate,g=this.getNextExpected(g,"end")):f&&(this.prune(m,
g),f=!1)):(m.setEnd(d),delete m.endNeedsUpdate)),m=m.parent;f&&(p>=n&&!q)&&(this.prune(c,r),f=!1)}this.removeUnrepairedChildren(c,f,e);this.cleanup(f,c,e,n,d,h,b);return f?Math.max(s,p):p},removeUnrepairedChildren:function(c,f,e){if(f){f=c.children;for(var g=-1,h=0;h<f.length;h++){var b=f[h];if(!b.repaired&&this.isDamaged(b,e,Number.MAX_VALUE)){g=h;break}}-1!==g&&(c.children.length=g)}},cleanup:function(c,f,e,g,h,b,a){if(c){c=b-a;h=this.getIntersecting(g-c+1,h);f=this.getIntersecting(e,g);for(e=0;e<
h.length;e++)g=h[e],!g.repaired&&g instanceof this.BeginEndNode&&(g.shiftEnd(c),g.shiftStart(c));for(e=0;e<f.length;e++)g=f[e],g.repaired&&g.endNeedsUpdate&&g.shiftEnd(c),delete g.endNeedsUpdate,delete g.repaired}else{f=this.getIntersecting(e,g);for(e=0;e<f.length;e++)delete f[e].repaired}},getNextMatch:function(c,f,e,g){var h=c.getLineAtOffset(e),h=c.getLineEnd(h),b=c.getText(e,h),a=[],k=[];c=[];h=[];for(this.push(a,f.rule.subrules);a.length;){var d=a.length?a.pop():null,d=d&&d._resolvedRule._typedRule;
if(d instanceof this.ContainerRule&&-1===k.indexOf(d))k.push(d),this.push(a,d.subrules);else if(!d||!g||d.matchRegex){var r=d&&this.exec(d.matchRegex||d.beginRegex,b,e);r&&(c.push(r),h.push(d))}}a=Number.MAX_VALUE;k=-1;for(d=0;d<c.length;d++)r=c[d],r.index<a&&(a=r.index,k=d);if(!g&&(e=this.getEndMatch(f,b,e)))if(g=f.rule.applyEndPatternLast,-1===k||e.index<a||!g&&e.index===a)return{isEnd:!0,rule:f.rule,match:e};return-1===k?null:{isSub:!0,rule:h[k],match:c[k]}},getInitialExpected:function(c,f){var e,
g;if(c===this._tree)for(e=0;e<c.children.length;e++){if(g=c.children[e],g.start>=f)return g}else if(c instanceof this.BeginEndNode&&c.endMatch){var h=c.endMatch.index;for(e=0;e<c.children.length&&!(g=c.children[e],g.start>=f);e++);if(g&&g.start<h)return g}return c},getNextExpected:function(c,f){if("begin"===f){var e=c.children[0];return e?e:c}if("end"===f&&(e=c.parent)){var g=e.children[e.children.indexOf(c)+1];return g?g:e}return null},prune:function(c,f){f.parent===c?c.children.length=f.getIndexInParent():
c instanceof this.BeginEndNode&&(c.endMatch=null,c.end=null);c.parent&&(c.parent.children.length=c.getIndexInParent()+1)},onLineStyle:function(c){this._tree||this.initialParse();var f=c.lineStart,e=this.textView.getModel(),g=e.getLineEnd(c.lineIndex),h=e.getLineEnd(e.getLineAtOffset(f)-1),h=this.getFirstDamaged(h,h),f=this.getLineScope(e,h,f,g);c.ranges=this.toStyleRanges(f);c.ranges.sort(function(b,a){return b.start-a.start})},getLineScope:function(c,f,e,g){for(var h=e,b=this.getInitialExpected(f,
e),a=[],k=[];f&&h<g;){var d=this.getNextMatch(c,f,h);if(!d)break;var r=d&&d.match,n=d&&d.rule,m=d&&d.isSub,d=d&&d.isEnd;r.index!==h&&k.push({start:h,end:r.index,node:f});m?(h=this.afterMatch(r),n instanceof this.BeginEndRule?(this.addBeginScope(a,r,n),f=b,b=this.getNextExpected(b,"begin")):this.addMatchScope(a,r,n)):d&&(h=this.afterMatch(r),this.addEndScope(a,r,n),b=this.getNextExpected(b,"end"),f=f.parent)}h<g&&k.push({start:h,end:g,node:f});c=this.getInheritedLineScope(k,e,g);return a.concat(c)},
getInheritedLineScope:function(c,f,e){f=[];for(e=0;e<c.length;e++)for(var g=c[e],h=g.node;h;){var b=h.rule.rule,a=b.name;if(b=b.contentName||a){this.addScopeRange(f,g.start,g.end,b);break}h=h.parent}return f},addBeginScope:function(c,f,e){var g=e.rule;this.addCapturesScope(c,f,g.beginCaptures||g.captures,e.isComplex,e.beginOld2New,e.beginConsuming)},addEndScope:function(c,f,e){var g=e.rule;this.addCapturesScope(c,f,g.endCaptures||g.captures,e.isComplex,e.endOld2New,e.endConsuming)},addMatchScope:function(c,
f,e){var g=e.rule,h=g.name;(g=g.captures)?this.addCapturesScope(c,f,g,e.isComplex,e.matchOld2New,e.matchConsuming):this.addScope(c,f,h)},addScope:function(c,f,e){e&&c.push({start:f.index,end:this.afterMatch(f),scope:e})},addScopeRange:function(c,f,e,g){g&&c.push({start:f,end:e,scope:g})},addCapturesScope:function(c,f,e,g,h,b){if(e)if(g){g={1:0};for(var a=0,k=1;void 0!==f[k];k++)void 0!==b[k]&&(a+=f[k].length),void 0!==f[k+1]&&(g[k+1]=a);b=f.index;for(a=1;e[a];a++){var k=e[a].name,d=h[a],r=b+g[d];
"undefined"!==typeof f[d]&&this.addScopeRange(c,r,r+f[d].length,k)}}else this.addScope(c,f,e[0]&&e[0].name)},getIntersecting:function(c,f){for(var e=[],g=this._tree?[this._tree]:[];g.length;){var h=g.pop(),b=!1;h instanceof this.ContainerNode?b=!0:this.isDamaged(h,c,f)&&(b=!0,e.push(h));if(b)for(var b=h.children.length,a=0;a<b;a++)g.push(h.children[a])}return e.reverse()},toStyleRanges:function(c){for(var f=[],e=0;e<c.length;e++){var g=c[e],h=this._styles[g.scope];if(!h)throw Error("styles not found for "+
g.scope);h=h.join(" ");f.push({start:g.start,end:g.end,style:{styleClass:h}})}return f}};return{RegexUtil:h,TextMateStyler:p}});
define("orion/editor/htmlGrammar",[],function(){return{HtmlGrammar:function(){return{scopeName:"source.html",uuid:"3B5C76FB-EBB5-D930-F40C-047D082CE99B",patterns:[{begin:"\x3c!(doctype|DOCTYPE)",end:"\x3e",contentName:"entity.name.tag.doctype.html",beginCaptures:{0:{name:"entity.name.tag.doctype.html"}},endCaptures:{0:{name:"entity.name.tag.doctype.html"}}},{begin:"\x3c!--",end:"--\x3e",beginCaptures:{0:{name:"punctuation.definition.comment.html"}},endCaptures:{0:{name:"punctuation.definition.comment.html"}},
patterns:[{match:"--",name:"invalid.illegal.badcomment.html"}],contentName:"comment.block.html"},{match:"\x3c[A-Za-z0-9_\\-:]+(?\x3d ?)",name:"entity.name.tag.html"},{include:"#attrName"},{include:"#qString"},{include:"#qqString"},{include:"#entity"},{match:"\x3c/[A-Za-z0-9_\\-:]+\x3e",name:"entity.name.tag.html"},{match:"\x3e",name:"entity.name.tag.html"}],repository:{attrName:{match:"[A-Za-z\\-:]+(?\x3d\\s*\x3d\\s*['\"])",name:"entity.other.attribute.name.html"},qqString:{match:'(")[^"]+(")',name:"string.quoted.double.html"},
qString:{match:"(')[^']+(')",name:"string.quoted.single.html"},entity:{match:"\x26[A-Za-z0-9]+;",name:"constant.character.entity.html"}}}}}});
define("orion/editor/textStyler",["orion/editor/annotations","orion/editor/eventTarget","orion/metrics"],function(m,s,p){function h(b,a,e){this._patternManager=new c(b,a);this._contentType=e}function c(b,a){this._unnamedCounter=0;this._patterns=[];this._rootId=a;b.forEach(function(a){this._addRepositoryPatterns(a.repository||{},a.id);this._addPatterns(a.patterns||[],a.id)}.bind(this))}function f(b,a,c,d,e,f,g){this.start=b.start;this.end=b.end;this.contentStart=b.contentStart;this.contentEnd=b.contentEnd;
this.name=a;this.typeId=c;this.styler=d;this.parent=f;g&&g(this);this._subBlocks=d.computeBlocks(e,e.getText(this.contentStart,this.end),this,this.contentStart,null,null,null)}function e(b){this._styler=b}function g(b,a,c){this._highlightCaretLine=this._whitespacesVisible=!1;this._detectTasks=this._foldingEnabled=!0;this._annotationProviders=[];this._view=b;this._annotationModel=a;this._stylerAdapter=c;this._stylerAdapter.setStyler(this);this._accessor=new e(this);this._bracketAnnotations;var d=this;
this._listener={onChanged:function(a){d._onModelChanged(a)},onDestroy:function(a){d._onDestroy(a)},onLineStyle:function(a){d._onLineStyle(a)},onMouseDown:function(a){d._onMouseDown(a)},onSelection:function(a){d._onSelection(a)}};var f=b.getModel();f.getBaseModel&&(f=f.getBaseModel());f.addEventListener("Changed",this._listener.onChanged);b.addEventListener("MouseDown",this._listener.onMouseDown);b.addEventListener("Selection",this._listener.onSelection);b.addEventListener("Destroy",this._listener.onDestroy);
b.addEventListener("LineStyle",this._listener.onLineStyle);var g=f.getCharCount(),h={start:0,contentStart:0,end:g,contentEnd:g};if(5E4<=g)var l=(new Date).getTime();this._rootBlock=this._stylerAdapter.createBlock(h,this,f,null);l&&(h=(new Date).getTime()-l,10<h&&p.logTiming("editor","styler compute blocks (ms/50000 chars)",5E4*h/g,c.getContentType()));a&&(c=[],a.removeAnnotations(m.AnnotationType.ANNOTATION_FOLDING),this._computeFolding(this._rootBlock.getBlocks(),b.getModel(),c),this._detectTasks&&
(a.removeAnnotations(m.AnnotationType.ANNOTATION_TASK),this._computeTasks(this._rootBlock,f,c)),a.replaceAnnotations([],c));b.redrawLines()}var l=function(b,a,c,d,e){var f;void 0===d&&(d=-1);void 0===e&&(e=b.length);for(;1<e-d;)if(f=Math.floor((e+d)/2),a<=b[f].start)e=f;else if(c&&a<b[f].end){e=f;break}else d=f;return e};h.prototype={blockSpansBeyondEnd:function(b){return b.pattern.regexEnd===this._eolRegex},computeBlocks:function(b,a,c,d,e,f,g){if(!a)return[];var h=[],l=[];e=e||0;f=f||Infinity;g=
g||Infinity;c.blockPatterns.forEach(function(b){var c=this._findMatch(b.regexBegin||b.regex,a,e);c&&l.push({result:c,pattern:b})}.bind(this));if(!l.length)return h;l.sort(function(a,b){return a.result.index<b.result.index?-1:a.result.index>b.result.index?1:a.pattern.pattern.index<b.pattern.pattern.index?-1:1});for(var m=0;0<l.length;){var p=l[0];l.splice(0,1);if(f<p.result.index)break;if(!(p.result.index<m)){var m=d+p.result.index,s=p.result.index,C=null,z=p.pattern.regexEnd;if(z){var s=s+p.result[0].length,
E=p.pattern,A=this._substituteCaptureValues(z,p.result);A!==z&&(E={pattern:E.pattern,regexBegin:E.regexBegin,regexEnd:A},z=A);for(A=s;!C;){A=this._findMatch(z,a,A);A||(this._eolRegex.lastIndex=0,A=this._eolRegex.exec(a),E={pattern:E.pattern,regexBegin:E.regexBegin,regexEnd:this._eolRegex});var D=this.createBlock({start:m,end:d+A.index+A[0].length,contentStart:d+s,contentEnd:d+A.index},c.styler,b,c,E),y=D.getBlocks();if(!y.length||y[y.length-1].end<=A.index+d)C=D;A=A.index+A[0].length}}else C=this.createBlock({start:m,
end:m+p.result[0].length,contentStart:m,contentEnd:m+p.result[0].length},c.styler,b,c,p.pattern);h.push(C);if(h.length===g||f<=C.end)break;m=C.end-d}this._updateMatch(p,a,l,m,f)}return h},computeStyle:function(b,a,c){if(!b.pattern)return null;var d={start:b.start,end:b.end,style:b.pattern.pattern.name};if(b.contentStart<=c&&c<b.contentEnd)return b.pattern.pattern.contentName?{start:b.contentStart,end:b.contentEnd,style:b.pattern.pattern.contentName}:d;var e,f;if(c<b.contentStart){f=b.pattern.pattern.beginCaptures||
b.pattern.pattern.captures;if(!f)return d;e=b.pattern.regexBegin;a=a.getText(b.start,b.contentStart);b=b.start}else{f=b.pattern.pattern.endCaptures||b.pattern.pattern.captures;if(!f)return d;e=b.pattern.regexEnd;a=a.getText(b.contentEnd,b.end);b=b.contentEnd}e.lastIndex=0;if(e=e.exec(a))if(a=[],this._getCaptureStyles(e,f,b,a),(f=a[l(a,c,!0)])&&f.start<=c&&c<f.end)return f;return d},createBlock:function(b,a,c,d,e){return new f(b,e?e.pattern.name:null,e?e.pattern.id:null,a,c,d,function(a){a.pattern=
e;a.linePatterns=[];a.blockPatterns=[];a.enclosurePatterns={};this._initPatterns(this._patternManager,a)}.bind(this))},getBlockContentStyleName:function(b){return b.pattern.pattern.contentName||b.pattern.pattern.name},getBlockEndStyle:function(b,a,c,d){var e;if(b.pattern.regexEnd&&(e=this._findMatch(b.pattern.regexEnd,a,0)))(a=b.pattern.pattern.endCaptures||b.pattern.pattern.captures)?this._getCaptureStyles(e,a,c-e[0].length,d):b.pattern.pattern.name&&d.push({start:c-e[0].length,end:c,style:b.pattern.pattern.name});
return e?e[0]:null},getBlockFoldBounds:function(b,a){return{start:b.start,end:b.end}},getBlockStartStyle:function(b,a,c,d){var e;if(b.pattern.regexBegin&&(e=this._findMatch(b.pattern.regexBegin,a,0)))(a=b.pattern.pattern.beginCaptures||b.pattern.pattern.captures)?this._getCaptureStyles(e,a,c,d):d.push({start:c,end:c+e[0].length,style:b.pattern.pattern.name});return e?e[0]:null},getBracketMatch:function(b,a){for(var c,d=Object.keys(b.enclosurePatterns),e=0;e<d.length;e++){var f=b.enclosurePatterns[d[e]],
g=this._findMatch(f.regex,a,0);if(g&&0===g.index){c=f;break}}if(!c)return null;e=!1;-1!==c.pattern.name.indexOf(this._PUNCTUATION_SECTION_BEGIN)?(e=!0,d=c.pattern.name.replace(this._PUNCTUATION_SECTION_BEGIN,this._PUNCTUATION_SECTION_END)):d=c.pattern.name.replace(this._PUNCTUATION_SECTION_END,this._PUNCTUATION_SECTION_BEGIN);return!b.enclosurePatterns[d]?null:{beginName:c.pattern.name,endName:d,atStart:e}},getContentType:function(){return this._contentType},parse:function(b,a,c,d,e){if(b&&(c=c.linePatterns)){var f=
[];c.forEach(function(a){var c=a.regex||a.regexBegin;c.oldLastIndex=c.lastIndex;(c=this._findMatch(c,b,0))&&f.push({result:c,pattern:a})}.bind(this));f.sort(function(a,b){return a.result.index<b.result.index?-1:a.result.index>b.result.index?1:a.pattern.pattern.index<b.pattern.pattern.index?-1:1});for(var g=0;0<f.length;){var h=f[0];f.splice(0,1);if(!(h.result.index<g)){var l=h.result.index,m,p=[];if(h.pattern.regex){g=h.result;m=l+g[0].length;m={start:a+l,end:a+m,style:h.pattern.pattern.name};if(!e){h.pattern.pattern.captures&&
this._getCaptureStyles(g,h.pattern.pattern.captures,a+l,p);p.sort(function(a,b){return a.start<b.start?-1:a.start>b.start?1:0});for(l=0;l<p.length-1;l++)if(p[l+1].start<p[l].end){var s={start:p[l+1].end,end:p[l].end,style:p[l].style};p[l].end=p[l+1].start;p.splice(l+2,0,s)}}this._mergeStyles(m,p,d)}else g=h.pattern.regexEnd,g=this._substituteCaptureValues(g,h.result),g=this._findMatch(g,b,h.result.index+h.result[0].length),g||(this._eolRegex.lastIndex=0,g=this._eolRegex.exec(b)),m=g.index+g[0].length,
d.push({start:a+l,end:a+m,style:h.pattern.pattern.name});g=g.index+g[0].length}this._updateMatch(h,b,f,g)}c.forEach(function(a){a=a.regex||a.regexBegin;a.lastIndex=a.oldLastIndex})}},setStyler:function(b){},verifyBlock:function(b,a,c,d){var e=null,f=[];c.parent.blockPatterns.forEach(function(b){var c=this._findMatch(b.regexBegin||b.regex,a,0);c&&f.push({result:c,pattern:b})}.bind(this));f.sort(function(a,b){return!a.result.index&&b.result.index?-1:a.result.index&&!b.result.index?1:!a.result.index&&
!b.result.index?a.pattern.pattern.index<b.pattern.pattern.index?-1:1:0});if(!f.length||0!==f[0].result.index||f[0].pattern.pattern.id!==c.pattern.pattern.id)e=!1;else{var g=f[0],h=g.pattern.regexEnd;if(h){for(var h=this._substituteCaptureValues(h,g.result),g=g.result[0].length,l=this._findMatch(h,a,g);null===e&&l&&c.start+l.index!==c.contentEnd+d;){var m=this.computeBlocks(b,a,c,c.start,g,l.index+1,null);!m.length||m[m.length-1].end<=c.start+l.index?e=!1:m.length?(g=m[m.length-1].end-c.start,l=this._findMatch(h,
a,g)):l=null}l||(this._eolRegex.lastIndex=0,l=this._eolRegex.exec(a),e=c.start+l.index===c.end+d)}else e=c.start+g.result[0].length===c.end+d}return null!==e?e:!0},_findMatch:function(b,a,c,d){var e=c,f=b.lastIndex;this._linebreakRegex.lastIndex=c;c=this._linebreakRegex.exec(a);var g,h;b.lastIndex=0;if(c){for(h=c.index;0<=--h&&!(g=a.charAt(h),g===this._NEWLINE||g===this._CR););g=a.substring(h+1,c.index+c[1].length);b.lastIndex=h=c.index-h-1}for(;c&&c.index<a.length;){var l;if(d){var m=b.lastIndex;
b.test(g)&&(b.lastIndex=m,l=b.exec(g))}else l=b.exec(g);if(l)return l.index+=e,l.index-=h,b.lastIndex=f,l;h=0;e+=c[0].length;if(c=this._linebreakRegex.exec(a))g=c[1],b.lastIndex=0}b.lastIndex=f;return null},_getCaptureStyles:function(b,a,c,d){if(a[0])d.push({start:c,end:c+b[0].length,style:a[0].name});else for(var e=0,f=1;f<b.length;f++)if(b[f]){var g=a[f];if(g){var h=c+e;d.push({start:h,end:h+b[f].length,style:g.name})}e+=b[f].length}},_initPatterns:function(b,a){if(a.pattern&&a.pattern.pattern.linePatterns)a.linePatterns=
a.pattern.pattern.linePatterns,a.blockPatterns=a.pattern.pattern.blockPatterns,a.enclosurePatterns=a.pattern.pattern.enclosurePatterns;else{var c=b.getPatterns(a.pattern?a.pattern.pattern:null),d=function(a){a="string"===typeof a?a:a.match;var b=this._ignoreCaseRegex.exec(a),c=this._FLAGS;b&&(a=a.substring(b[0].length),c+="i");return RegExp(a,c)}.bind(this),e=-1,f=0;c.forEach(function(b){var c;if(b.match&&!b.begin&&!b.end){if(c={regex:d(b.match),pattern:b},a.linePatterns.push(c),b.name&&0===b.name.indexOf("punctuation.section")&&
(-1!==b.name.indexOf(this._PUNCTUATION_SECTION_BEGIN)||-1!==b.name.indexOf(this._PUNCTUATION_SECTION_END)))a.enclosurePatterns[b.name]=c}else!b.match&&(b.begin&&b.end)&&(e=f,c={regexBegin:d(b.begin),regexEnd:d(b.end),pattern:b},a.linePatterns.push(c));f++}.bind(this));a.blockPatterns=a.linePatterns.slice(0,e+1);a.pattern&&(a.pattern.pattern.enclosurePatterns=a.enclosurePatterns,a.pattern.pattern.linePatterns=a.linePatterns,a.pattern.pattern.blockPatterns=a.blockPatterns)}},_mergeStyles:function(b,
a,c){var d=b.start;a.forEach(function(a){d<=a.start&&c.push({start:d,end:a.start,style:b.style});c.push(a);d=a.end});d<b.end&&c.push({start:d,end:b.end,style:b.style})},_substituteCaptureValues:function(b,a){var c=b.toString();this._captureReferenceRegex.lastIndex=0;if(!this._captureReferenceRegex.test(c))return b;this._captureReferenceRegex.lastIndex=0;for(var d=this._captureReferenceRegex.exec(c);d;)c=c.replace(d[0],a[d[1]]||""),this._captureReferenceRegex.lastIndex=0,d=this._captureReferenceRegex.exec(c);
return RegExp(c.substring(1,c.length-1-this._FLAGS.length),this._FLAGS)},_updateMatch:function(b,a,c,d,e){var f=b.pattern.regex?b.pattern.regex:b.pattern.regexBegin;e=e||Infinity;if((a=this._findMatch(f,a,d,!0))&&a.index<e){b.result=a;for(e=0;e<c.length;e++)if(a.index<c[e].result.index||a.index===c[e].result.index&&b.pattern.pattern.index<c[e].pattern.pattern.index){c.splice(e,0,b);return}c.push(b)}},_captureReferenceRegex:/\\(\d)/g,_eolRegex:/$/,_ignoreCaseRegex:/^\(\?i\)\s*/,_linebreakRegex:/(.*)(?:[\r\n]|$)/g,
_CR:"\r",_FLAGS:"g",_NEWLINE:"\n",_PUNCTUATION_SECTION_BEGIN:".begin",_PUNCTUATION_SECTION_END:".end"};c.prototype={getPatterns:function(b){b?(b="string"===typeof b?b:b.qualifiedId,b+="#"):b=this._rootId+"#"+this._NO_ID;var a=[0],c={},d=RegExp("^"+b+"[^#]+$");this._patterns.forEach(function(b){if(d.test(b.qualifiedId))if(b.include)this._processInclude(b,a,c);else{var e=JSON.parse(JSON.stringify(b));e.index=a[0]++;c[b.qualifiedId]=e}}.bind(this));var e=[];Object.keys(c).forEach(function(a){e.push(c[a])});
return e},_addPattern:function(b,a,c){b.parentId=c;b.id=a;b.qualifiedId=b.parentId+"#"+b.id;this._patterns.push(b);b.patterns&&!b.include&&this._addPatterns(b.patterns,b.qualifiedId)},_addPatterns:function(b,a){b.forEach(function(b){this._addPattern(b,this._NO_ID+this._unnamedCounter++,a)}.bind(this))},_addRepositoryPatterns:function(b,a){Object.keys(b).forEach(function(c){this._addPattern(b[c],c,a)}.bind(this))},_processInclude:function(b,a,c){var d,e=b.include.indexOf("#");d=0===e?RegExp("^"+b.qualifiedId.substring(0,
b.qualifiedId.indexOf("#"))+b.include+"$"):-1===e?RegExp("^"+b.include+"#"+this._NO_ID+"[^#]+$"):RegExp("^"+b.include+"$");this._patterns.forEach(function(b){if(d.test(b.qualifiedId))if(b.include)this._processInclude(b,a,c);else if(!c[b.qualifiedId]){var e=JSON.parse(JSON.stringify(b));e.index=a[0]++;c[b.qualifiedId]=e}}.bind(this))},_NO_ID:"NoID"};f.prototype={adjustBounds:function(b,a){b<this.start&&(this.start+=a);b<this.contentStart&&(this.contentStart+=a);b<=this.end&&(this.end+=a);b<=this.contentEnd&&
(this.contentEnd+=a);this._subBlocks.forEach(function(c){b<=c.end&&c.adjustBounds(b,a)})},getBlocks:function(){return this._subBlocks},getBlockAtIndex:function(b){return l(this.getBlocks(),b,!0)},isRenderingWhitespace:function(){return this.styler._isRenderingWhitespace()}};e.prototype={getStyles:function(b){return this._styler.getStyles(b)}};g.prototype={addAnnotationProvider:function(b){"function"===typeof b&&this._annotationProviders.push(b)},computeBlocks:function(b,a,c,d,e,f,g){return this._stylerAdapter.computeBlocks(b,
a,c,d,e,f,g)},destroy:function(){if(this._view){var b=this._view.getModel();b.getBaseModel&&(b=b.getBaseModel());b.removeEventListener("Changed",this._listener.onChanged);this._view.removeEventListener("MouseDown",this._listener.onMouseDown);this._view.removeEventListener("Selection",this._listener.onSelection);this._view.removeEventListener("Destroy",this._listener.onDestroy);this._view.removeEventListener("LineStyle",this._listener.onLineStyle);this._view=null}},getAnnotationModel:function(){return this._annotationModel},
getBlockAtIndex:function(b){return this._findBlock(this._rootBlock,b)},getRootBlock:function(){return this._rootBlock},getStyleAccessor:function(){return this._accessor},getStyles:function(b){var a=[],c=this._view.getModel();c.getBaseModel&&(c=c.getBaseModel());var d=this._findBlock(this._rootBlock,b),e=c.getLineAtOffset(b),f=c.getLine(e),g=[];this._stylerAdapter.parse(f,c.getLineStart(e),d,g);for((e=g[l(g,b,!0)])&&(e.start<=b&&b<e.end)&&a.push(e);d;)(e=this._stylerAdapter.computeStyle(d,c,b))&&a.splice(0,
0,e),d=d.parent;return a},getTextModel:function(){var b=this._view.getModel();b.getBaseModel&&(b=b.getBaseModel());return b},removeAnnotationProvider:function(b){"function"===typeof b&&(b=this._annotationProviders.indexOf(b),-1!==b&&this._annotationProviders.splice(b,1))},setDetectHyperlinks:function(){},setDetectTasks:function(b){this._detectTasks=b},setFoldingEnabled:function(b){this._foldingEnabled=b},setHighlightCaretLine:function(b){this._highlightCaretLine=b},setWhitespacesVisible:function(b,
a){this._whitespacesVisible!==b&&(this._whitespacesVisible=b,a&&this._view.redraw())},_computeFolding:function(b,a,c){if(a.getBaseModel){var d=a.getBaseModel();b.forEach(function(b){var e=this._stylerAdapter.getBlockFoldBounds(b,d);(e=this._createFoldingAnnotation(a,d,e.start,e.end))&&c.push(e);this._computeFolding(b.getBlocks(),a,c)}.bind(this))}},_computeTasks:function(b,a,c,d,e){d=d||b.start;e=e||b.end;if(b.start<=e&&d<=b.end&&this._annotationModel){var f=m.AnnotationType.ANNOTATION_TASK;if(b.name&&
0===b.name.indexOf("comment")){var g=[];this._stylerAdapter.parse(a.getText(b.contentStart,b.end),b.contentStart,b,g,!0);for(var h=0;h<g.length;h++)"meta.annotation.task.todo"===g[h].style&&(d<=g[h].start&&g[h].end<=e)&&c.push(m.AnnotationType.createAnnotation(f,g[h].start,g[h].end,a.getText(g[h].start,g[h].end)))}b.getBlocks().forEach(function(b){this._computeTasks(b,a,c,d,e)}.bind(this))}},_createFoldingAnnotation:function(b,a,c,d){var e=a.getLineAtOffset(c),f=a.getLineAtOffset(d);return e===f||
e+1===f&&a.getLineStart(f)===a.getLineEnd(f)?null:new (m.AnnotationType.getType(m.AnnotationType.ANNOTATION_FOLDING))(c,d,b)},_findBlock:function(b,a){var c=b.getBlocks();if(!c.length)return b;var d=l(c,a,!0);return d<c.length&&c[d].start<=a&&a<c[d].end?this._findBlock(c[d],a):b},_findBrackets:function(b,a,c,d,e){for(var f=[],g=[],h=d,m=a.getBlocks(),p=l(m,d,!0);p<m.length&&!(m[p].start>=e);p++){var s=m[p].start,x=m[p].end;h<s&&(this._stylerAdapter.parse(c.substring(h-d,s-d),h,a,g),g.forEach(function(a){a.style&&
(0===a.style.indexOf(b.beginName)?f.push(a.start+1):0===a.style.indexOf(b.endName)&&f.push(-(a.start+1)))}),g=[]);h=x}h<e&&(this._stylerAdapter.parse(c.substring(h-d,e-d),h,a,g),g.forEach(function(a){a.style&&(0===a.style.indexOf(b.beginName)?f.push(a.start+1):0===a.style.indexOf(b.endName)&&f.push(-(a.start+1)))}));return f},_findMatchingBracket:function(b,a,c){var d=b.getLineAtOffset(c),e=b.getLineEnd(d),f=b.getText(c,e),f=this._stylerAdapter.getBracketMatch(a,f);if(!f)return-1;for(var g=b.getLine(d),
h=b.getLineStart(d),e=this._findBrackets(f,a,g,h,e),l=0;l<e.length;l++)if(g=0<=e[l]?1:-1,e[l]*g-1===c){c=1;if(f.atStart){for(l++;l<e.length;l++)if(g=0<=e[l]?1:-1,c+=g,0===c)return e[l]*g-1;d+=1;for(l=b.getLineCount();d<l;){g=b.getLine(d);h=b.getLineStart(d);e=b.getLineEnd(d);e=this._findBrackets(f,a,g,h,e);for(h=0;h<e.length;h++)if(g=0<=e[h]?1:-1,c+=g,0===c)return e[h]*g-1;d++}}else{for(l--;0<=l;l--)if(g=0<=e[l]?1:-1,c+=g,0===c)return e[l]*g-1;for(d-=1;0<=d;){g=b.getLine(d);h=b.getLineStart(d);e=
b.getLineEnd(d);e=this._findBrackets(f,a,g,h,e);for(l=e.length-1;0<=l;l--)if(g=0<=e[l]?1:-1,c+=g,0===c)return e[l]*g-1;d--}}break}return-1},_getLineStyle:function(b){if(this._highlightCaretLine){var a=this._view,c=a.getModel(),d=!1;if(!a.getSelections().some(function(a){return a.start===a.end?(d=d||c.getLineAtOffset(a.start)===b,!1):!0})&&d)return this._caretLineStyle}return null},_getStyles:function(b,a,c,d){a.getBaseModel&&(d=a.mapOffset(d));for(var e=d+c.length,f=[],g=d,h=b.getBlocks(),m=l(h,d,
!0);m<h.length&&!(h[m].start>=e);m++){var p=h[m].start,s=h[m].end;g<p&&this._stylerAdapter.parse(c.substring(g-d,p-d),g,b,f);var x=Math.max(g,p);x===p&&(p=this._stylerAdapter.getBlockStartStyle(h[m],c.substring(x-d),x,f))&&(x+=p.length);var p=Math.min(e,s),C=[];p===s&&(g=c.substring(p-g-(h[m].end-h[m].contentEnd)),(g=this._stylerAdapter.getBlockEndStyle(h[m],g,p,C))&&(p-=g.length));var g=this._getStyles(h[m],a,c.substring(x-d,p-d),x),z=this._stylerAdapter.getBlockContentStyleName(h[m]);if(z){var E=
x;g.forEach(function(a){a.start-E&&f.push({start:E,end:a.start,style:z});a.mergeable&&(a.style+=","+z);f.push(a);E=a.end});p-E&&f.push({start:E,end:p,style:z})}else f=f.concat(g);f=f.concat(C);g=s}g<e&&this._stylerAdapter.parse(c.substring(g-d,e-d),g,b,f);if(a.getBaseModel)for(b=0;b<f.length;b++)c=f[b].end-f[b].start,f[b].start=a.mapOffset(f[b].start,!0),f[b].end=f[b].start+c;return f},_isRenderingWhitespace:function(){return this._whitespacesVisible},_onDestroy:function(){this.destroy()},_onLineStyle:function(b){b.textView===
this._view&&(b.style=this._getLineStyle(b.lineIndex));b.ranges=this._getStyles(this._rootBlock,b.textView.getModel(),b.lineText,b.lineStart);b.ranges.forEach(function(a){a.style&&(a.style={styleClass:a.style.replace(/\./g," ")})});this._isRenderingWhitespace()&&(this._spliceStyles(this._spacePattern,b.ranges,b.lineText,b.lineStart),this._spliceStyles(this._tabPattern,b.ranges,b.lineText,b.lineStart))},_onModelChanged:function(b){var a=b.start,c=b.removedCharCount;b=b.addedCharCount-c;var d=this._view.getModel(),
e=d.getBaseModel?d.getBaseModel():d,c=a+c,f=e.getCharCount(),g=e.getLineStart(e.getLineAtOffset(a)),h=this._findBlock(this._rootBlock,a),p,s,B,x,C,z,E;do{B=h.parent;if(!p&&B){if(0>b&&h.end-a<=-b){h=B;continue}C=e.getText(h.start,Math.min(f,h.end+b+1));if(!this._stylerAdapter.verifyBlock(e,C,h,b)){h=B;continue}}s=h.getBlocks();var A=s.length,D=l(s,g,!0),y=l(s,c,!1,D-1,A);p=!1;if(D&&s.length&&s[D-1].end===a){C=e.getText(s[D-1].start,Math.min(f,a+1));var H=this.computeBlocks(e,C,h,s[D-1].start,null,
null,null);H.length&&H[0].end!==s[D-1].end&&(D--,p=!0)}D<A&&s[D].start<=g&&(g<s[D].end||p)?(E=s[D].start,E>a&&(E+=b)):D===A&&0<A&&h.end-b===s[A-1].end?(E=s[--D].start,E>a&&(E+=b)):E=Math.max(g,h.contentStart);z=y<A?s[y].end:h.contentEnd;a<=z&&(z+=b);z=Math.min(z,f-1);C=e.getText(E,z+1);H=this.computeBlocks(e,C,h,E,null,null,null);if(y<A){if(H.length&&H[H.length-1].end===z&&H[H.length-1].typeId===s[y].typeId)break;if(H.length&&this._stylerAdapter.blockSpansBeyondEnd(H[H.length-1])){y++;for(var P=H[H.length-
1].getBlocks(),P=(P.length?P[P.length-1]:H[H.length-1]).typeId;y<A;){if(s[y].typeId===P){var L=s[y].end+b,L=Math.min(L,f-1);C=e.getText(E,L+1);C=this.computeBlocks(e,C,h,E,null,null,null);if(C.length&&C[C.length-1].end===L){z=L;H=C;break}}y++}if(y<A)break}}else if(!H.length||H[H.length-1].end<=h.contentEnd+b)break;if(!B){z=f;y=A;C=e.getText(E,z);H=this.computeBlocks(e,C,h,E,null,null,null);break}h=B;x=!0}while(1);this._rootBlock.adjustBounds(a,b);y=Math.min(y+1,A);x||(x=y-D!==H.length);if(!x)for(A=
0;A<H.length;A++)if(p=s[D+A],f=H[A],p.start!==f.start||p.end!==f.end||p.typeId!==f.typeId){x=!0;break}!s.length&&!H.length?(p=[h],this.dispatchEvent({type:"BlocksChanged",oldBlocks:[h],newBlocks:p}),h=p[0]):this.dispatchEvent({type:"BlocksChanged",oldBlocks:s.slice(D,y),newBlocks:H});D=[D,y-D].concat(H);Array.prototype.splice.apply(s,D);x&&(s=E,x=z,d!==e&&(s=d.mapOffset(s,!0),x=d.mapOffset(x,!0)),this._view.redrawRange(s,x));if(this._annotationModel){var K=[],J=[],t=[];s=this._annotationModel.getAnnotations(E,
z);x=this._foldingEnabled&&e!==d;for(D=h.parent||h;s.hasNext();)if(y=s.next(),x&&y.type===m.AnnotationType.ANNOTATION_FOLDING){t.push(y);for(p=this._findBlock(D,y.start);p;){var N=this._stylerAdapter.getBlockFoldBounds(p,e);if(y.start===N.start&&y.end===N.end)break;p=p.parent}p&&y.start===N.start&&y.end===N.end?(H=y.start,p=y.end,H>a&&(H-=b),p>a&&(p-=b),H<=a&&(a<p&&H<=c&&c<p)&&(H=e.getLineAtOffset(y.start),p=e.getLineAtOffset(y.end),H!==p?y.expanded||y.expand():K.push(y))):(K.push(y),y.expand())}else y.type===
m.AnnotationType.ANNOTATION_TASK&&h.start<=y.start&&y.end<=h.end&&K.push(y);x&&D.getBlocks().forEach(function(a){this._updateFolding(a,e,d,t,J,E,z)}.bind(this));this._detectTasks&&this._computeTasks(h,e,J,E,z);this._annotationProviders.forEach(function(a){var b=[],c=[];a(this._annotationModel,e,h,E,z,b,c);K=K.concat(b);J=J.concat(c)}.bind(this));this._annotationModel.replaceAnnotations(K,J)}},_onMouseDown:function(b){if(2===b.clickCount){var a=this._view.getModel(),c=this._view.getOffsetAtLocation(b.x,
b.y);if(0<c){var d=c-1,e=a;a.getBaseModel&&(d=a.mapOffset(d),e=a.getBaseModel());var f=this._findBlock(this._rootBlock,d),d=this._findMatchingBracket(e,f,d);-1!==d&&(b.preventDefault(),b=d,a.getBaseModel&&(b=a.mapOffset(b,!0)),c>b&&(c--,b++),this._view.setSelection(b,c))}}},_onSelection:function(b){var a=Array.isArray(b.oldValue)?b.oldValue:[b.oldValue];b=Array.isArray(b.newValue)?b.newValue:[b.newValue];var c=this._view,d=c.getModel(),e;if(this._highlightCaretLine){var f=function(a){var b={};return a.some(function(a){if(a.isEmpty())b[d.getLineAtOffset(a.start).toString()]=
!0;else return!0;return!1})?{}:b},a=f(a),f=f(b),g=function(a,b){for(var d in a)b[d]||(e=d>>0,c.redrawLines(e,e+1))};g(a,f);g(f,a)}if(this._annotationModel){var a=this._bracketAnnotations,h,l;if(1===b.length&&b[0].isEmpty()&&0<(l=b[0].getCaret()))l-=1,d.getBaseModel&&(l=d.mapOffset(l),d=d.getBaseModel()),b=this._findBlock(this._rootBlock,l),b=this._findMatchingBracket(d,b,l),-1!==b&&(h=[m.AnnotationType.createAnnotation(m.AnnotationType.ANNOTATION_MATCHING_BRACKET,b,b+1),m.AnnotationType.createAnnotation(m.AnnotationType.ANNOTATION_CURRENT_BRACKET,
l,l+1)]);this._bracketAnnotations=h;this._annotationModel.replaceAnnotations(a,h)}},_spliceStyles:function(b,a,c,d){for(var e=b.regex,f=e.lastIndex=0,g=e.exec(c);g;){for(g=d+g.index;f<a.length&&!(g<a[f].end);)f++;var h={start:g,end:g+1,style:b.style};if(f<a.length&&a[f].start<=g){var l={start:g+1,end:a[f].end,style:a[f].style};a[f].end=g;a.splice(f+1,0,l);a.splice(f+1,0,h);f+=2}else a.splice(f,0,h),f++;g=e.exec(c)}},_updateFolding:function(b,a,c,d,e,f,g){f=f||b.start;g=g||b.end;var h=this._stylerAdapter.getBlockFoldBounds(b,
a);if(!b.doNotFold&&h.start<=g&&f<=h.end){var m=l(d,h.start,!0);m<d.length&&d[m].start===h.start&&d[m].end===h.end||(h=this._createFoldingAnnotation(c,a,h.start,h.end))&&e.push(h);b.getBlocks().forEach(function(b){this._updateFolding(b,a,c,d,e,f,g)}.bind(this))}},_caretLineStyle:{styleClass:"meta annotation currentLine"},_spacePattern:{regex:/[ ]/g,style:{styleClass:"punctuation separator space",unmergeable:!0}},_tabPattern:{regex:/\t/g,style:{styleClass:"punctuation separator tab",unmergeable:!0}}};
s.EventTarget.addMixin(g.prototype);return{TextStyler:g,Block:f,createPatternBasedAdapter:function(b,a,c){return new h(b,a,c)}}});
define("orion/editor/edit","require orion/editor/config orion/editor/shim orion/editor/textView orion/editor/textModel orion/editor/textTheme orion/editor/projectionTextModel orion/editor/eventTarget orion/keyBinding orion/editor/rulers orion/editor/annotations orion/editor/tooltip orion/editor/undoStack orion/editor/textDND orion/editor/editor orion/editor/editorFeatures orion/editor/contentAssist webtools/cssContentAssist webtools/htmlContentAssist orion/editor/AsyncStyler orion/editor/mirror orion/editor/textMateStyler orion/editor/htmlGrammar orion/editor/textStyler orion/editor/stylers/application_javascript/syntax orion/editor/stylers/text_css/syntax orion/editor/stylers/text_html/syntax".split(" "),function(m,
s,p,h,c,f,e,g,l,b,a,k,d,r,n,u,q,v,w,B,x,C,z,E,A,D,y){function H(a,b,c){for(var d;c&&c!==b&&"none"!==d;)d=a.getComputedStyle?a.getComputedStyle(c,null).getPropertyValue("display"):c.currentStyle.display,c=c.parentNode;return!c||!d?"none":d}function P(a){var b=a.firstChild;if(b&&"TEXTAREA"===b.tagName)return b.value;var c=a.ownerDocument,d=c.defaultView||c.parentWindow;if(!d.getSelection||1===a.childNodes.length&&b.nodeType===Node.TEXT_NODE||"none"===H(d,c,a))return a.innerText||a.textContent;b=c.createRange();
b.selectNode(a);a=d.getSelection();d=[];for(c=0;c<a.rangeCount;c++)d.push(a.getRangeAt(c));a.removeAllRanges();a.addRange(b);b=a.toString();a.removeAllRanges();for(c=0;c<d.length;c++)a.addRange(d[c]);return b}function L(a){if("data-editor-"===a.substring(0,12))return a=a.substring(12),a=a.replace(/-([a-z])/ig,function(a,b){return b.toUpperCase()})}function K(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])}function J(a,b){var c={};K(c,b);for(var d,e=0,f=a.attributes,g=f.length;e<g;e++){d=f.item(e);
var h=L(d.nodeName);if(h){d=d.nodeValue;if("true"===d||"false"===d)d="true"===d;c[h]=d}}return c}function t(a,b){if(a.getElementsByClassName)return a.getElementsByClassName(b);b=b.replace(/ *$/,"");return a.querySelectorAll?a.querySelectorAll((" "+b).replace(/ +/g,".")):null}function N(a){var b=a.document||document,d=a.parent;d||(d="editor");"string"===typeof d&&(d=b.getElementById(d));if(!d&&a.className){var g=t(b,a.className);if(g){a.className=void 0;1<g.length&&void 0===a.noFocus&&(a.noFocus=!0);
for(var b=[],k=g.length-1;0<=k;k--)a.parent=g[k],b.push(N(a));return b}}if(!d)throw"no parent";a=J(d,a);if("string"===typeof a.theme){var g=f.TextTheme.getTheme(a.theme),l=a.theme.lastIndexOf("/"),p=a.theme;-1!==l&&(p=p.substring(l+1));".css"===p.substring(p.length-4)&&(p=p.substring(0,p.length-4));g.setThemeClass(p,{href:a.theme});a.theme=g}var r;a.readonly||(k={createContentAssistMode:function(a){r=new q.ContentAssist(a.getTextView());a=new q.ContentAssistWidget(r);a=new q.ContentAssistMode(r,a);
r.setMode(a);return a}});var s=new n.Editor({textViewFactory:function(){return new h.TextView({parent:d,model:new e.ProjectionTextModel(a.model?a.model:new c.TextModel("")),tabSize:a.tabSize?a.tabSize:4,readonly:a.readonly,fullSelection:a.fullSelection,tabMode:a.tabMode,expandTab:a.expandTab,singleMode:a.singleMode,themeClass:a.themeClass,theme:a.theme,wrapMode:a.wrapMode,wrappable:a.wrappable})},undoStackFactory:new u.UndoFactory,annotationFactory:new u.AnnotationFactory,lineNumberRulerFactory:new u.LineNumberRulerFactory,
foldingRulerFactory:new u.FoldingRulerFactory,textDNDFactory:new u.TextDNDFactory,contentAssistFactory:k,keyBindingFactory:new u.KeyBindingsFactory,statusReporter:a.statusReporter,domNode:d});s.addEventListener("TextViewInstalled",function(){var b=s.getLineNumberRuler();b&&void 0!==a.firstLineIndex&&b.setFirstLine(a.firstLineIndex);if(b=s.getSourceCodeActions())b.setAutoPairParentheses(a.autoPairParentheses),b.setAutoPairBraces(a.autoPairBraces),b.setAutoPairSquareBrackets(a.autoPairSquareBrackets),
b.setAutoPairAngleBrackets(a.autoPairAngleBrackets),b.setAutoPairQuotations(a.autoPairQuotations),b.setAutoCompleteComments(a.autoCompleteComments),b.setSmartIndentation(a.smartIndentation)});k=a.contents;void 0===k&&(k=P(d));k||(k="");s.installTextView();s.setLineNumberRulerVisible(void 0===a.showLinesRuler||a.showLinesRuler);s.setAnnotationRulerVisible(void 0===a.showAnnotationRuler||a.showFoldingRuler);s.setOverviewRulerVisible(void 0===a.showOverviewRuler||a.showOverviewRuler);s.setZoomRulerVisible(void 0===
a.showZoomRuler||a.showZoomRuler);s.setFoldingRulerVisible(void 0===a.showFoldingRuler||a.showFoldingRuler);s.setInput(a.title,null,k,!1,a.noFocus);({styler:null,highlight:function(b,c){this.styler&&this.styler.destroy&&this.styler.destroy();this.styler=null;"js"===b?b="application/javascript":"css"===b?b="text/css":"html"===b?b="text/html":"java"===b&&(b="text/x-java-source");var d=c.getTextView(),e=c.getAnnotationModel();if(b){var f=b.replace(/[*|:/".<>?+]/g,"_");m(["./stylers/"+f+"/syntax"],function(a){a=
new E.createPatternBasedAdapter(a.grammars,a.id,b);this.styler=new E.TextStyler(d,e,a)},function(a){})}"text/css"===b&&c.setFoldingRulerVisible(void 0===a.showFoldingRuler||a.showFoldingRuler)}}).highlight(a.contentType||a.lang,s);if(r){var x=new v.CssContentAssistProvider,y=new w.HTMLContentAssistProvider;r.addEventListener("Activating",function(){/css$/.test(a.lang)?r.setProviders([x]):/html$/.test(a.lang)&&r.setProviders([y])})}k=b.defaultView||b.parentWindow;!a.noComputeSize&&("none"!==H(k,b,
d)&&50>=d.clientHeight)&&(b=s.getTextView().computeSize().height,d.style.height=b+"px");return s}var G=this.orion?this.orion.editor:void 0;if(G){for(var S=0;S<arguments.length;S++)K(G,arguments[S]);G.edit=N}return N});var orion=this.orion||(this.orion={}),editor=orion.editor||(orion.editor={});